
// console.log("Smart Bundle Discount app new version6.0");
// // let server = "https://yu-hand-cambodia-springfield.trycloudflare.com";
// let smartNoImg = `data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAHYUlEQVR4nO2da0wUVxTHb/xSk/qxNbXCzsyyvGYWFhF51Qeo0IeAjxRba/1kW9MiVA1FGkGbippabWJsVBDQVjuNbEF5iCBoLWw1ltqaan01NmlD6wdi+sAvTWtOcy67I4/VXXF3587s/Scnk50Pyzn3t+eec2fDWUK4uLi4uLi4zCtBlF2CKPdZrYmT9faFawjIt4KkgCAqlzgUBmSzJT0piPIPCMUiyVctlrgpevsU9uJQGBSHwqA4FAbFoTAoDoVBcSgMikNhUBwKg+JQGBSHwqA4FINAiYpSIi2SvNoiKSfwniDJd+gDS0OafIfGJSntFkkummpLiCAGg/KHIMr/6r+QSrDsriApDaIYLxCWZRGVFYIoo7MgWBXIy38ZNm3aCbX7neBs6IaW5h5DmrOhm8aAsSxesgKstkQKxiIqf0dKSj5hURZRLnZ/ciAufjp1ODV9Lhw+1Kr7grYE2OrrG6Fg4XItW3BrJiwpUpQL0DHRaoeStytB/awdMjJzTA2lpbkHSkoqAGPG2JnJlIgIx1RMXVx8hOFxFqGkZcyjUGyxSRAdn6z3vg/+WOrsZ8F16/ZI+20Aztzsh+4L16Ct/esxUNzb119MfJEniHItOoQpPNzRLR9Vg+LIAHtSBnU4fc5z0HbpxthgDWa9/QPQ0XtxRKz597aval1hYGsrSPJ/WOTq65pGwJiWlg1qz3k4cfUmzJqfTx3OyHreFFBct26PgFJX1whSVCJgZ4k7hm5AsJjhQmPn4XHu8yMdYE/KpDA8zpsRSm//ALQeP6vFvWjRCk+WvKUjEKUdncB20ONY0Tvvwar1G8cEYEYoXReuaXFXbtwxBESU2/QDIio30Ina2i80x3DRPznl8hqA2aCcudmvxY3nFPeh+JpuQARRGUQnnM4uzbFYOQW6f+6/bxBmgtLbP6DFjWswlCHKoH5A3K3i8I4DX/sKxExQWkbFjmY4IKxAOfrdZVi5phRSUjPBGp1AryvXltL7YQdEbyh7m09A0vRU2LklF37qK4Q7vy6n1x1VueBIToW9zR3hB0QvKEcvXKYwzp9cDP/8/uoYO3dyMYVy7Psfww+IHlBWrimlmeENhsc+rMqF19aVhieQUENJSc2k29ODgNzoK4SU9JnhCySUUKKiE2nNeBCQwV9eAVuMI7yBuEIEJSXtGZ8Zcv2bQpiREeYZ4goRFGxtsZt6EJDtm7GGlHEgrhBAwXMGdlHYTXmDcbZzqMtqvniFA3GFKFPwnIGLjt0UFnCsKXjFzBg6h3T6fA/8MisstixXiKDgOQNbW+ymsNDjFbcpfzIDzVvshgdy+Mw5mFnwEkQnptErvg4llEcx02XI/uOnINqRDpPKK2BCXT294mu8bxQopgFS1/kl2BzpMLFqKxBV1eyxbR/Q+9VtXYaAYgog94NBDAbFFFuWLxjEQFAMX9T9hUEMAsXQQGo7Tj8UDGIAKIYFMl4YJIhQsL3OWrgU4hxpkL1oqdd225Q15FFhkCBAwbY6LikdsreVw8LWffSKr721277MUEACBYMEEArWMVz8nD3vw5LTBzXLra6i9729tymABBoGCQCU+8EYLxTDbFnBgkEeAYovGOOBYpiiHkwYZBxQdjUc8wvGw0IxDJCJVduCCoO4Df+OzY9nX6ItAbK3v+sXjIeBYhggoYBB/MiU3Y2tIEUlUJ9iM2dBftPHAYXCgaj+Q/HUjLk7N0DcrDlBgcKBqP5lyugCXtC8NyhQOBDV9/ZlTUiFmIQZYwp4MKBwIKp/NUWwp3jtqAINhQNR/S/0gpcsCTQUDkRlCwoHorIDJWfPZg6EMAaFZ4jKFhQORGULCgeisgWFOSCeoTPD/y1akOwwoaYmIM+pCMNQ8pt201g9cTcc6dSG0OgJ5Dr9/qPWqTlmjZ0Gk9aV6b7wxMdTYpFC2TxuKLM3rQNbfLIW9/4abXDAFd1Ha2wcNlpj3gsvQkTmPN0XnQQZSvzMLMjJW6rFXVnJwmgNSS4aPXym7kATCFY7PF5eYVooWVvLaIy1BxvHDp+xKm/qBgSnc+JIIjqeqf6ec6+vXk8nrZkRStbWMpCi7LBqdbkWL856YWI8E0qQlBpvA8wQCn6KIjLnwqS1ZUwX+ok+oCAM+s1jdCKN6Y2iezCaj30FefnL3PVD2Uf0VmRk7NPaiL+SihFQMKXnLyiEqLhkEBkY3yeM2+ye2YqQPGPOiBmSxSUb3N2V/KcgyE8RFoQDILUhmKOgmMXUUYM9D33aAsXFG7QhmBarfQFhSe7pcnRMLM4gxLF3ZoYSE5c8fExsEWFRFknJw4MROopFDjsPnLSGPfrww6PRzOnsgpqaBtra5uUtG7b9yndxeDRhWVNiYp4QJHmXqUeNiwrGdttQv/OI7R/25BZROY6nV8/0OUOaqAwOxSC3YUwYG/9VCAbFoTAoDoVBcSgMikNhUBwKg+JQGBSHwqA4FAbFoTAoDoVBcSgMikNhUFZr4mRBVC4NPbCU+/T2h4t4oMh9gqj08AXh4uLi4uIi5tX/Fms2vZkCm94AAAAASUVORK5CYII=`;
// let productPageClass = document.getElementsByClassName("sd-bundle-app");

// let cartDrawer = () =>{
//   if (sdCartType === "drawer") {
//     const btn = document.getElementById('cart-icon-bubble')
//     if (btn) {
//       setTimeout(()=>{
//         btn.click() // Trigger the drawer to open
//       },1000);
//       fetch('/cart')
//       .then(response => response.text())  
//       .then(cart => {
//         const parser = new DOMParser();
//         const doc = parser.parseFromString(cart, 'text/html');
//         // Find the #CartDrawer element in the fetched HTML
//         const cartDrawerContent = doc?.querySelector('#CartDrawer');
//           const cartIconContent = doc?.querySelector('#cart-icon-bubble');
//         // If found, update the content of the current #CartDrawer element
//         if (cartDrawerContent) {
//           document.querySelector('#CartDrawer').innerHTML = cartDrawerContent.innerHTML;
//         document.querySelector('#cart-icon-bubble').innerHTML = cartIconContent.innerHTML;
//           document.querySelector('cart-drawer.drawer').classList.remove('is-empty');
//           updateCart();
//         }
//       })
//       .catch(error => {
//         console.error('Error fetching cart:', error);
//       });
//     }else{
//       window.location.assign(`https://${Shopify.shop}/cart`);
//     }
//   } else {
//       window.location.assign(`https://${Shopify.shop}/cart`);
//   }
// }

// let updateCart = () =>{
//   const localData = JSON.parse(localStorage.getItem("sd_bundle_data"));
//   if (localData.discountType == "Fix") {
//     fetch(window.Shopify.routes.root + "cart.js", {
//       method: "GET",
//       headers: {
//         "Content-Type": "application/json",
//       },
//     })
//       .then((response) => response.json())
//       .then((response) => {
//         let allIdsMatch = localData.variantsId.every((item) => {
//           let matchingItem = response.items.find(
//             (i) => i.id === parseInt(item.id) && item.quantity <= i.quantity
//           );
//           return !!matchingItem;
//         });
//         if (allIdsMatch == true) {
//           activateRule(localData);
//           if (localData.discountType == "Fix") {
//             addDiscountToProduct();
//           }
//         } else {
//           deactivateRule(localData);
//           let formData = {
//             attributes: { SD_BUNDLE_ID: el._id },
//           };
//           fetch(window.Shopify.routes.root + "cart/add.js", {
//             method: "POST",
//             headers: {
//               "Content-Type": "application/json",
//             },
//             body: JSON.stringify(formData),
//           });
//         }
//       })
//       .catch((error) => {
//         console.log(error.message);
//       });
//   }
// }

// function getRandomItems(arr, numItems) {
//   for (let i = arr.length - 1; i > 0; i--) {
//       const j = Math.floor(Math.random() * (i + 1));
//       [arr[i], arr[j]] = [arr[j], arr[i]];
//   }
//   return arr.slice(0, numItems);
// }

// if (sdbundlePageType == "product") {
//   if (productPageClass.length) {
//     let sdBundleLoader = document.createElement("div");
//     sdBundleLoader.id = "sd-bundle-main-container-loader";
//     sdBundleLoader.className = "sd-bundle-main-container-loader";
//     let Gdiv = document.createElement("div");
//     Gdiv.innerText = "G";
//     sdBundleLoader.appendChild(Gdiv);
//     let Ndiv = document.createElement("div");
//     Ndiv.innerText = "N";
//     sdBundleLoader.appendChild(Ndiv);
//     let Idiv = document.createElement("div");
//     Idiv.innerText = "I";
//     sdBundleLoader.appendChild(Idiv);
//     let Ddiv = document.createElement("div");
//     Ddiv.innerText = "D";
//     sdBundleLoader.appendChild(Ddiv);
//     let Adiv = document.createElement("div");
//     Adiv.innerText = "A";
//     sdBundleLoader.appendChild(Adiv);
//     let Odiv = document.createElement("div");
//     Odiv.innerText = "O";
//     sdBundleLoader.appendChild(Odiv);
//     let Ldiv = document.createElement("div");
//     Ldiv.innerText = "L";
//     sdBundleLoader.appendChild(Ldiv);

//     productPageClass[0].append(sdBundleLoader);

//     document.getElementById("sd-bundle-main-container-loader").style.display =
//       "block";

//     getData();
//   } else {
//     console.log("SMART BUNDLE BLOCK is not enabled");
//   }
// }

// async function getData() {
//   let shop = Shopify.shop;
//   let collectionId = [];
//   sdBundleCollectionId.map((id) => {
//     collectionId.push(`gid://shopify/Collection/${id}`);
//   });
//   const response = await fetch(`${server}/api/storefront/getBundleData`, {
//     method: "POST",
//     headers: {
//       "Content-Type": "application/json",
//     },
//     body: JSON.stringify({
//       shop: shop,
//       id: sdBundleProductId,
//       collId: collectionId,
//     }),
//   });
//   data = await response.json();
//   if (data.status === 200) {
//     if (sdbundlePageType == "product") {
//       document.getElementById("sd-bundle-main-container-loader").style.display =
//         "none";
//       document.getElementById("sd-bundle-main-container-loader").remove();
//       let dataArray = [];
//       data.response.map((el) => {
//         if (el.type == "productBundle") {
//           dataArray.push(el);
//         } else if (el.type == "volumeBundle") {
//           if (el.bundleDetail.discountedProductType == "specific_product") {
//             dataArray.push(el);
//           } else if (el.bundleDetail.discountedProductType == "collection") {
//             el.bundleDetail.products = [sdProductJson];
//             dataArray.push(el);
//           } else if (el.bundleDetail.discountedProductType == "all_products") {
//             el.bundleDetail.products = [sdProductJson];
//             dataArray.push(el);
//           }
//         } else if (el.type == "collectionMixMatch") {
//           dataArray.push(el);
//         } else if(el.type == "productMixMatch") {
//           dataArray.push(el);
//         } else if(el.type == "fbt") {
//           dataArray.push(el);
//         } else if(el.type == "bxgy") {
//           dataArray.push(el)
//         }
//       });

//       if (dataArray.length) {
//         createDiscountName(dataArray);
//       }

//       createBundle(dataArray);
//       let bundleId = [];
//       dataArray.forEach((id) => {
//         bundleId.push(id._id);
//       });
//       await fetch(`${server}/api/storefront/getBundleViews`, {
//         method: "POST",
//         headers: {
//           "Content-Type": "application/json",
//         },
//         body: JSON.stringify({
//           shop: Shopify.shop,
//           bundleId: bundleId,
//         }),
//       });
//     }
//   }
// }

// if (sdbundlePageType == "cart") {
//   updateCart();
// }
// if (sdCartType === "drawer") {
//   updateCart();
// }

// if (sdbundlePageType == "page") {
//   const url = window.location.href;
//   const urlSearchParams = new URLSearchParams(url.split("?")[1]);
//   const path = url.split("/").pop().split("?")[0];
//   const id = urlSearchParams.get("b");
//   if (path == "collection-mix-match") {
//     fetch(`${server}/api/storefront/getCollectionMixMatchData`, {
//       method: "POST",
//       headers: {
//         "Content-Type": "application/json",
//       },
//       body: JSON.stringify({
//         shop: Shopify.shop,
//         id: id,
//       }),
//     })
//       .then((response) => response.json())
//       .then((data) => {
//         bundlePageBuilder(data);
//       })
//       .catch((error) => {
//       });
//   }
// }

// const arr = [];
// const bundleData = [];
// const bundleSum = [];
// const gidArray = [];
// let volumeBundleArr = []; 
// let volumeBundleSum = [];
// function createBundle(BUNDLE_DATA) {
//   // console.log("check foreach working=======**********",BUNDLE_DATA)
//   let bundleMainDiv = document.createElement("div");
//   bundleMainDiv.className = "sd-bundle-main-container";
//   bundleMainDiv.id = "sd-bundle-main-container";

//   productPageClass[0].append(bundleMainDiv);

//   let mainDiv = document.getElementById("sd-bundle-main-container");

//   BUNDLE_DATA.forEach((el, bundleIndex) => {
//     bundleData.push([]);
//     bundleSum.push([]);
//     gidArray.push([]);
//     if (el?.type == "productBundle") {
//         let BUNDLE_DIV = document.createElement("div");
//         BUNDLE_DIV.className = "sd-bundle-main-column";
//         BUNDLE_DIV.style.borderRadius = `${el?.customization?.bundle?.box?.borderRadius}px`;
//         BUNDLE_DIV.style.borderColor = el?.customization?.bundle?.box?.borderColor;
//         BUNDLE_DIV.style.background = el?.customization?.bundle?.box?.backgroundColor;
//         mainDiv.append(BUNDLE_DIV);
      
//           if ((el?.bundleDetail?.discountType === "percent" || el?.bundleDetail?.discountType === "fixed") && el?.badgeText) {
//             let VOLUME_HEADER_DIV = document.createElement("span");
//             VOLUME_HEADER_DIV.className = "sd-badges-part-optional";
//             VOLUME_HEADER_DIV.style.background =el?.customization?.bundle?.optionalBadge?.background;
//             VOLUME_HEADER_DIV.style.color = el?.customization?.bundle?.optionalBadge?.color;
//             VOLUME_HEADER_DIV.style.fontSize =`${el?.customization?.bundle?.optionalBadge?.fontSize}px`;
//             let discountBadge = document.createElement("span");
//             discountBadge.className = "sd-collectionMM-badge";
//             // if (el?.bundleDetail?.discountType === "percent") {
//             //     discountBadge.innerText = el?.translations?.translation?.save + " " + el?.bundleDetail?.discountValue + "%";
//             // } else if (el?.bundleDetail?.discountType === "fixed") {
//             //     let newPrice = el?.bundleDetail?.discountValue;
//             //     discountBadge.innerText = el?.translations?.translation?.save + " " + showAmountWithCurrency(newPrice);
//             // }
//             discountBadge.innerText = el?.badgeText||"";
//             VOLUME_HEADER_DIV.append(discountBadge);
//             BUNDLE_DIV.append(VOLUME_HEADER_DIV);
//           }
        

//         let BUNDLE_TITLE = document.createElement("div");
//         BUNDLE_TITLE.className = "sd-bundle-text-detail";
//         BUNDLE_DIV.append(BUNDLE_TITLE);
//           if ((el?.bundleDetail?.discountType === "percent" || el?.bundleDetail?.discountType === "fixed")&& el?.badgeText) {
//             BUNDLE_TITLE.classList.add("extra-padding");
//           }
        
//         let bundleTitleText = document.createElement("h4");
//         bundleTitleText.innerText = el?.title;
//         bundleTitleText.style.color = el?.customization?.bundle?.title?.color;
//         bundleTitleText.style.fontSize = `${el?.customization?.bundle?.title?.fontSize}px`;
//         bundleTitleText.style.fontWeight = el?.customization?.bundle?.title?.titleBold;
//         bundleTitleText.style.textAlign = el?.customization?.bundle?.title?.alignment;
//         bundleTitleText.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
//         BUNDLE_TITLE.append(bundleTitleText);
      
//         let ProductBundleDescription = document.createElement("p");
//         ProductBundleDescription.innerText = el?.description;
//         ProductBundleDescription.style.textAlign = el?.customization?.bundle?.title?.alignment;
//         ProductBundleDescription.style.color = el?.customization?.bundle?.title?.descriptionColor;
//         ProductBundleDescription.style.fontSize = `${el?.customization?.bundle?.title?.descriptionFontSize}px`;
//         ProductBundleDescription.style.fontWeight = el?.customization?.bundle?.title?.descriptionBold;
//         ProductBundleDescription.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
//         BUNDLE_TITLE.append(ProductBundleDescription);
      
//         el?.bundleDetail?.products?.map((ele, index) => {
//           bundleData[bundleIndex].push([]);
//           bundleSum[bundleIndex].push([]);
//           gidArray[bundleIndex].push([]);
//           let BUNDLE_PRODUCT_DIV = document.createElement("div");
//           BUNDLE_PRODUCT_DIV.className ="sd-bundle-product-detail";
//           BUNDLE_PRODUCT_DIV.style.backgroundColor = el?.customization?.bundle?.productDetails?.productDetailsBox?.backgroundColor
          
//           let DATA_SECTION_IMAGE_TITLE_DIV = document.createElement("div");
//           DATA_SECTION_IMAGE_TITLE_DIV.className ="sd-bundle-product-inner";
          
//           let DATA_SECTION_IMAGE_DIV = document.createElement("div");
//           DATA_SECTION_IMAGE_DIV.className = "sd-bundle-product-img";
//           DATA_SECTION_IMAGE_DIV.style.border ="1px solid" + el?.customization?.bundle?.productDetails?.image?.borderColor;
//           DATA_SECTION_IMAGE_DIV.style.borderRadius = `${el?.customization?.bundle?.productDetails?.image?.borderRadius}px`;
          
//           let DATA_SECTION_IMG = document.createElement("img");
//           let bundleProductImg = ele?.images[0]?.originalSrc ?? smartNoImg;
//           DATA_SECTION_IMG.setAttribute("src", bundleProductImg);
//           DATA_SECTION_IMG.style.width = "80";
//           DATA_SECTION_IMG.style.height = "80";
//           DATA_SECTION_IMAGE_DIV.append(DATA_SECTION_IMG);
          
//           let DATA_SECTION_TITLE_PRICE_DIV = document.createElement("div");
//           DATA_SECTION_TITLE_PRICE_DIV.className ="sd-bundle-product-name";
          
//           let DATA_SECTION_TITLE = document.createElement("h5");
//           DATA_SECTION_TITLE.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
//           DATA_SECTION_TITLE.style.color = el?.customization?.bundle?.productDetails?.title?.color;
//           DATA_SECTION_TITLE.style.fontSize = `${el?.customization?.bundle?.productDetails?.title?.fontSize}px`;

//           DATA_SECTION_TITLE.innerText = ele?.title;
//           let DATA_SECTION_PRICE = document.createElement("h4");
//           DATA_SECTION_PRICE.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
//           DATA_SECTION_PRICE.style.color = el?.customization?.bundle?.productDetails?.price?.color;
//           DATA_SECTION_PRICE.style.fontSize = `${el?.customization?.bundle?.productDetails?.price?.fontSize}px`;
//           DATA_SECTION_PRICE.id = `sd-bundle-datasection-price${index}${bundleIndex}`;
//           let covertedPrice = ele?.variants[0]?.price;
//           DATA_SECTION_PRICE.innerText = showAmountWithCurrency(covertedPrice);
          
//           DATA_SECTION_TITLE_PRICE_DIV.append(
//             DATA_SECTION_TITLE,
//             DATA_SECTION_PRICE
//           );
//           DATA_SECTION_IMAGE_TITLE_DIV.append(
//             DATA_SECTION_IMAGE_DIV,
//             DATA_SECTION_TITLE_PRICE_DIV
//           );
//           let DATA_SECTION_QUANTITY_DIV = document.createElement("div");
//           DATA_SECTION_QUANTITY_DIV.className = "sd-bundle-product-quantity";
//           let DATA_SECTION_QUANTITY = document.createElement("h6");
//           let QUANTITY_SPAN = document.createElement("span");
//           QUANTITY_SPAN.innerText = ele.minimumOrder;
//           DATA_SECTION_QUANTITY.append(QUANTITY_SPAN);
//           DATA_SECTION_QUANTITY.style.fontSize = el?.customization?.bundle?.productDetails?.quantities?.size+"px";
//           DATA_SECTION_QUANTITY.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
//           DATA_SECTION_QUANTITY.style.color = el?.customization?.bundle?.productDetails?.quantities?.color;
//           DATA_SECTION_QUANTITY.innerText = `Qty: ${QUANTITY_SPAN.innerText}`;
//           DATA_SECTION_QUANTITY_DIV.append(DATA_SECTION_QUANTITY);
        
//           BUNDLE_PRODUCT_DIV.append(DATA_SECTION_IMAGE_TITLE_DIV,
//             DATA_SECTION_QUANTITY_DIV);
//           let BUNDLE_SELECT;
//           let selectRow = document.createElement("div");
//           selectRow.className = "sd-bundle-product-select-main";
//           let seeMoreDiv = document.createElement("div");
//           let show_more = document.createElement("button");
//           show_more.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
//           show_more.className = "sd-volume-showMoreLess"
//           seeMoreDiv.append(show_more);
//           show_more.innerText = el?.translations?.translation?.seeMore;
//           let seeLessDiv = document.createElement("div");
//           let show_less = document.createElement("button");
//           show_less.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
//           show_less.className = "sd-volume-showMoreLess"
//           seeLessDiv.append(show_less);
//           show_less.innerText = el?.translations?.translation?.seeLess;
//           seeLessDiv.classList.add("sd-bundle-hide-click");
//           for (let i = 1; i <= ele?.minimumOrder; i++) {
//             if (ele?.minimumOrder <= 2 || ele?.variants?.length <= 1) {
//               seeMoreDiv.style.display = "none";
//             }
//             gidArray[bundleIndex][index][i - 1] = ele?.variants[0].id;
//             bundleData[bundleIndex][index][i - 1] = {
//               id: ele?.variants[0]?.id?.replace(
//                 "gid://shopify/ProductVariant/",
//                 ""
//               ),
//               quantity: 1,
//             };
//             bundleSum[bundleIndex][index][i - 1] = ele?.variants[0]?.price;

//             if (ele.variants.length > 1) {
//               BUNDLE_SELECT = document.createElement("select");
//               BUNDLE_SELECT.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
//               BUNDLE_SELECT.style.color = el?.customization?.bundle?.productDetails?.variantSelector?.color;
//               BUNDLE_SELECT.style.background = el?.customization?.bundle?.productDetails?.variantSelector?.backgroundColor;
//               BUNDLE_SELECT.style.width = `${el?.customization?.bundle?.productDetails?.variantSelector?.width}px`;
//               BUNDLE_SELECT.id = `sd-bundle-select-option${i}${bundleIndex}${index}`;
//               BUNDLE_SELECT.className = "sd-bundle-select-option";
//               BUNDLE_SELECT.classList.add(
//                 `sd-bundle-select-option${i}${bundleIndex}${index}`
//               );

//               ele?.variants?.map((elem, optionIndex) => {
//                 let BUNDLE_OPTION = document.createElement("option");
//                 BUNDLE_OPTION.textContent = elem?.title;
//                 BUNDLE_OPTION.value = elem?.id?.replace(
//                   "gid://shopify/ProductVariant/",
//                   ""
//                 );
//                 BUNDLE_OPTION.setAttribute("optionIndex", optionIndex);
//                 BUNDLE_OPTION.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
//                 BUNDLE_OPTION.setAttribute("data-id", elem?.price);
//                 BUNDLE_SELECT.appendChild(BUNDLE_OPTION);

//                 selectRow.append(BUNDLE_SELECT);
//               });
//               if (i > 2) {
//                 BUNDLE_SELECT.classList.add("sd-bundle-hide-click");
//               }
//               show_more.addEventListener("click", function (e) {
//                 BUNDLE_SELECT.classList.remove("sd-bundle-hide-click");
//                 seeMoreDiv.classList.add("sd-bundle-hide-click");
//                 seeLessDiv.classList.remove("sd-bundle-hide-click");
//               });

//               show_less.addEventListener("click", function (e) {
//                 if (i > 2) {
//                   BUNDLE_SELECT.classList.add("sd-bundle-hide-click");
//                 }
//                 seeLessDiv.classList.add("sd-bundle-hide-click");
//                 seeMoreDiv.classList.remove("sd-bundle-hide-click");
//               });
//             }
//             DATA_SECTION_TITLE_PRICE_DIV.append(selectRow);
//             BUNDLE_DIV.append(BUNDLE_PRODUCT_DIV);

//             let selectedElement = document.querySelectorAll(
//               `.sd-bundle-select-option${i}${bundleIndex}${index}`
//             );

//             selectedElement.forEach((selected) => {
//               const selectedOption = selected.options[1];
//               const id = selectedOption?.getAttribute("data-id");
//               arr.push(id);

//               selected.addEventListener("change", (e) => {
//                 const varientPrice = e?.target?.options[e?.target?.selectedIndex]?.dataset?.id;
//                 bundleSum[bundleIndex][index][i - 1] = varientPrice;
//                 bundleData[bundleIndex][index][i - 1] = {
//                   id: e?.target?.value,
//                   quantity: 1,
//                 };
//                 const gitVal = "gid://shopify/ProductVariant/" + e?.target?.value;
//                 gidArray[bundleIndex][index][i - 1] = gitVal;
//                 let priceDiv = document.getElementById(
//                   `sd-bundle-datasection-price${index}${bundleIndex}`
//                 );
//                 const selectedOption = selected?.options[selected?.selectedIndex];
//                 const id = selectedOption.getAttribute("data-id");

//                 priceDiv.innerText = showAmountWithCurrency(id);

//                 arr.splice(i, 0, id);

//                 const finalSumBundle = bundleSum[bundleIndex].reduce(
//                   (acc, curr) => acc.concat(curr),
//                   []
//                 );
//                 let myArray = finalSumBundle.map(parseFloat);

//                 let total = myArray.reduce(
//                   (accumulator, currentValue) => accumulator + currentValue,
//                   0
//                 );

//                 const getDivPrice = document.getElementById(
//                   `sd-bundle-discount-price${bundleIndex}`
//                 );

//                 var newPrice = total.toFixed(2);

//                 getDivPrice.innerHTML = showAmountWithCurrency(newPrice);

//                 const discountedPriceDiv = document.getElementById(
//                   `sd-bundle-final-price${bundleIndex}`
//                 );

//                 if (el?.bundleDetail?.discountType == "percent") {
//                   let part = parseFloat(el?.bundleDetail?.discountValue);
//                   let percentage = (total * part) / 100;
//                   let totalPrice = total - percentage;
//                   var newPrice = totalPrice.toFixed(2);
//                   discountedPriceDiv.innerHTML = showAmountWithCurrency(newPrice);
//                 } else if (el?.bundleDetail?.discountType == "fixed") {
//                   let part = parseFloat(el?.bundleDetail?.discountValue);
//                   let fixed = total - part;
//                   var newPrice = fixed.toFixed(2);
//                   discountedPriceDiv.innerHTML = showAmountWithCurrency(newPrice);
//                 }
//               });

//               selected.addEventListener("blur", function () {
//               });
//             });
//           }
//               selectRow.append(seeMoreDiv);
//               selectRow.append(seeLessDiv);
//           // console.log("dgdwydfui",el.bundleDetail.products.length)
//           if (index < el.bundleDetail.products.length - 1) {
//             let BUNDLE_PLUS_BTN_DIV = document.createElement("div");
//             BUNDLE_PLUS_BTN_DIV.className = "sd-add-bundle";
//             BUNDLE_PLUS_BTN_DIV.innerHTML = `<svg viewBox="0 0 18 18" focusable="false" width="18" height="18" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
//             <path d="M6.98047 17.3842V0.580255H10.3239V17.3842H6.98047ZM0.256392 10.6477V7.30433H17.0604V10.6477H0.256392Z" fill= ${el?.customization?.bundle?.productDetails?.plusColor}></path>
//             </svg>`;
//             BUNDLE_DIV.append(BUNDLE_PLUS_BTN_DIV);
//           }
//         });
//         let finalSumBundle = bundleSum[bundleIndex].reduce(
//           (acc, curr) => acc.concat(curr),
//           []
//         );
//         let myArray = finalSumBundle.map(parseFloat);
//         let total = myArray.reduce(
//           (accumulator, currentValue) => accumulator + currentValue,
//           0
//         );
//         let discountedPrice;
//         if (el?.bundleDetail?.discountType == "percent") {
//           let part = parseFloat(el?.bundleDetail?.discountValue);
//           let percentage = (total * part) / 100;
//           result = total - percentage;
//           discountedPrice = result.toFixed(2);
//         } else if (el?.bundleDetail?.discountType == "fixed") {
//           let part = parseFloat(el?.bundleDetail?.discountValue);
//           let fixed = total - part;
//           discountedPrice = fixed.toFixed(2);
//         } else if (el?.bundleDetail?.discountType == "price") {
//           let part = parseFloat(el?.bundleDetail?.discountValue);
//           discountedPrice = part;
//         } else if (el?.bundleDetail?.discountType == "noDiscount") {
//         }

//         let TOTAL_DIV = document.createElement("div");
//         TOTAL_DIV.className = "sd-product-bundle-total";
//         let total_text_Desc = document.createElement("div");
//         total_text_Desc.className = "sd-total-desc";
//         TOTAL_DIV.append(total_text_Desc);
      
//         let total_text =  document.createElement("h4");
//         total_text.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
//         total_text.style.color = el?.customization?.bundle?.totalSection?.color;
//         total_text.style.fontSize = el?.customization?.bundle?.totalSection?.fontSize + "px";
//         total_text.innerText = el?.translations?.translation?.total;
//         total_text_Desc.append(total_text);
      
//         if (
//           el?.bundleDetail?.discountType == "freeShipping" ||
//           el?.bundleDetail?.discountType == "noDiscount"
//         ) {
//           // no changes
//         } else {
//           let infoDescription = document.createElement("p");
//           infoDescription.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
//           infoDescription.style.color = el?.customization?.bundle?.totalSection?.discountMessage?.color;
//           infoDescription.style.fontSize = el?.customization?.bundle?.totalSection?.discountMessage?.size + "px";
//           infoDescription.innerText = el?.translations?.translation?.discountApplied;
//           total_text_Desc.append(infoDescription);
//         }

//       if (el?.bundleDetail?.discountType == "freeShipping") {
//           let noShippingDiv = document.createElement("div");
//           noShippingDiv.className = "sd-bundle-no-shopping-container";
//           total_text_Desc.append(noShippingDiv);
//           let shippingIcon = document.createElement("span");
//           shippingIcon.className = "sd-bundle-shipping-icon";
//           shippingIcon.innerHTML = `<svg viewBox="0 0 1024 1024" focusable="false" data-icon="shopping-cart" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M922.9 701.9H327.4l29.9-60.9 496.8-.9c16.8 0 31.2-12 34.2-28.6l68.8-385.1c1.8-10.1-.9-20.5-7.5-28.4a34.99 34.99 0 00-26.6-12.5l-632-2.1-5.4-25.4c-3.4-16.2-18-28-34.6-28H96.5a35.3 35.3 0 100 70.6h125.9L246 312.8l58.1 281.3-74.8 122.1a34.96 34.96 0 00-3 36.8c6 11.9 18.1 19.4 31.5 19.4h62.8a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7h161.1a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7H923c19.4 0 35.3-15.8 35.3-35.3a35.42 35.42 0 00-35.4-35.2zM305.7 253l575.8 1.9-56.4 315.8-452.3.8L305.7 253zm96.9 612.7c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6zm325.1 0c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6z"></path></svg>`;
//           noShippingDiv.append(shippingIcon);
//           let noShippingText = document.createElement("span");
//           noShippingText.className = "sd-bundle-noShipping-text";
//           noShippingText.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
//           noShippingText.innerText = el?.translations?.translation?.FreeShipping;
//           noShippingDiv.append(noShippingText);
//         }
      
//         let discountedPriceDiv = document.createElement("div");
//         discountedPriceDiv.className = "sd-total-amount";
      
//         if (
//           el?.bundleDetail?.discountType == "freeShipping" ||
//           el?.bundleDetail?.discountType == "noDiscount"
//         ) {
//           let discountPrice = document.createElement("h4");
//           discountPrice.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
//           discountPrice.id = `sd-bundle-discount-price${bundleIndex}`;
//           discountPrice.style.color = el?.customization?.bundle?.totalSection?.originalPrice?.color;
//           discountPrice.style.fontSize = el?.customization?.bundle?.totalSection?.originalPrice?.fontSize + "px";
//           let newDiscountPrice = total.toFixed(2);
//           discountPrice.innerText = showAmountWithCurrency(newDiscountPrice);
//           discountedPriceDiv.append(discountPrice);
//         } else {
//           let finalPrice = document.createElement("h4");
//           finalPrice.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
//           finalPrice.id = "sd-bundle-final-price" + bundleIndex;
//           finalPrice.style.color = el?.customization?.bundle?.totalSection?.finalPrice?.color;
//           finalPrice.style.fontSize = el?.customization?.bundle?.totalSection?.finalPrice?.fontSize + "px";
//           finalPrice.innerText = showAmountWithCurrency(discountedPrice);
//           discountedPriceDiv.append(finalPrice);
          
//           let discountPrice = document.createElement("h6");
//           discountPrice.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
//           discountPrice.id = `sd-bundle-discount-price${bundleIndex}`;
//           discountPrice.style.color =
//             el?.customization?.bundle?.totalSection?.originalPrice?.color;
//           discountPrice.style.fontSize =
//             el?.customization?.bundle?.totalSection?.originalPrice?.fontSize + "px";
//           let newDiscountPrice = total.toFixed(2);
//           discountPrice.innerText = showAmountWithCurrency(newDiscountPrice);
//           discountedPriceDiv.append(discountPrice);
//         }
      
//         TOTAL_DIV.append(discountedPriceDiv);
//         BUNDLE_DIV.append(TOTAL_DIV);
//         let ADD_TO_CART_BTN_DIV = document.createElement("div");
//         ADD_TO_CART_BTN_DIV.className = "sd-bundle-addto-cart";
//         let ADD_TO_CART_BUTTON = document.createElement("button");
//         ADD_TO_CART_BUTTON.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
//         ADD_TO_CART_BUTTON.style.background = el?.customization?.bundle?.button?.backgroundColor;
//         ADD_TO_CART_BUTTON.style.color = el?.customization?.bundle?.button?.color;
//         ADD_TO_CART_BUTTON.style.borderColor = el?.customization?.bundle?.button?.borderColor;
//         ADD_TO_CART_BUTTON.style.borderRadius = el?.customization?.bundle?.button?.borderRadius + "px";
//         ADD_TO_CART_BUTTON.style.fontSize = `${el?.customization?.bundle?.button?.fontSize}px`;
//         ADD_TO_CART_BUTTON.innerText = el?.translations?.translation?.addToCartButton;
//         ADD_TO_CART_BTN_DIV.append(ADD_TO_CART_BUTTON);
//         ADD_TO_CART_BUTTON.addEventListener("click", (e) => {
//           let code = JSON.parse(localStorage.getItem("sd_bundle_data"));
//           let discountCodeId = code?.discountCreateId ?? "";
//           ADD_TO_CART_BUTTON.innerText = "";
//           let btnSpinner = document.createElement("div");
//           btnSpinner.className = "bundleBtnSpinner";
//           ADD_TO_CART_BUTTON.append(btnSpinner);

//           btnSpinner.style.display = "block";
//           const mergedArray = bundleData[bundleIndex].reduce(
//             (acc, curr) => acc.concat(curr),
//             []
//           );
//           const mergedGidArray = gidArray[bundleIndex].reduce(
//             (acc, curr) => acc.concat(curr),
//             []
//           );
//           let mergedResult = {};
          
//           for (let item of mergedArray) {
//             if (mergedResult[item.id]) {
//               mergedResult[item.id].quantity += item.quantity;
//             } else {
//               mergedResult[item.id] = { ...item };
//             }
//           }
//           let mergedArrayResult = Object.values(mergedResult);
//           let formData = {
//             items: mergedArrayResult,
//             attributes: { SD_BUNDLE_ID: el._id },
//           };
//           let cartRes ;
//           fetch(window.Shopify.routes.root + "cart/add.js", {
//             method: "POST",
//             headers: {
//               "Content-Type": "application/json",
//             },
//             body: JSON.stringify(formData),
//           })
//             .then((response) => {
//               return response.json();
//             })
//             .then((response) => {
//               let errorDiv = document.getElementsByClassName(
//                 "sd-bundle-error-message"
//               );
//               errorDiv[0]?.remove();

              
//               if (response.status == 422 || response.status == 404) {
//                 ADD_TO_CART_BUTTON.innerText =
//                   el.translations.translation.addToCartButton;
//                 btnSpinner.remove();
//                 let errorMessage = document.createElement("div");
//                 errorMessage.className = "sd-bundle-error-message";
//                 BUNDLE_DIV.append(errorMessage);
//                 errorMessage.innerText = response.description;
//               } else {
//           cartRes = response
          
//                 fetch(window.Shopify.routes.root + "cart.js", {
//                   method: "GET",
//                   headers: {
//                     "Content-Type": "application/json",
//                   },
//                 })
//                   .then((response) => {
//                     return response.json();
//                   })
//                   .then((response) => {
//                     if (el.bundleDetail.discountType == "noDiscount") {
//                       fetch(`${server}/api/storefront/getBundleClick`, {
//                         method: "POST",
//                         headers: {
//                           "Content-Type": "application/json",
//                         },
//                         body: JSON.stringify({
//                           shop: Shopify.shop,
//                           bundleId: el._id,
//                         }),
//                       });
//                       let isDiscount =
//                         el.bundleDetail.discountType == "noDiscount"
//                           ? "noDiscount"
//                           : "Fix";
//                       const localData = JSON.parse(
//                         localStorage.getItem("sd_bundle_data")
//                       );
//                       let sd_bundle_data = {
//                         discount_name: el.name,
//                         code: code.code,
//                         bundleId: el._id,
//                         discountType: isDiscount,
//                         variantsId: mergedArrayResult,
//                         discountCreateId: discountCodeId,
//                         prefixCode: el.settings.discountLabel,
//                         bundle_type:el.type,
//                       };
//                       var jsonString = JSON.stringify(sd_bundle_data);
//                       localStorage.setItem("sd_bundle_data", jsonString);

//                       btnSpinner.remove();
//                       window.location.assign(`https://${Shopify.shop}/cart`);
//                     } else {
//                       let finalSumBundle = bundleSum[bundleIndex].reduce(
//                         (acc, curr) => acc.concat(curr),
//                         []
//                       );
//                       let myArray = finalSumBundle.map(parseFloat);
//                       let total = myArray.reduce(
//                         (accumulator, currentValue) =>
//                           accumulator + currentValue,
//                         0
//                       );

//                       let totalPrice = Number(total.toFixed(2));
//                       let finalPrice;
//                       switch (el.bundleDetail.discountType) {
//                         case "percent":
//                           let percentagepart = parseFloat(
//                             el.bundleDetail.discountValue
//                           );
//                           let percentage = (totalPrice * percentagepart) / 100;
//                           finalPrice = percentage.toFixed(2);
//                           break;
//                         case "price":
//                           let pricePart = parseFloat(
//                             el.bundleDetail.discountValue
//                           );
//                           result = totalPrice - pricePart;
//                           finalPrice = result.toFixed(2);
//                           break;
//                         case "fixed":
//                           let fixedPart = parseFloat(
//                             el.bundleDetail.discountValue
//                           );
//                           finalPrice = fixedPart.toFixed(2);
//                           break;
//                         default:
//                           break;
//                       }

//                       let isDiscount =
//                         el.bundleDetail.discountType == "noDiscount"
//                           ? "noDiscount"
//                           : "Fix";
//                       let sd_bundle_data = {
//                         discount_name: el.name,
//                         code: `${el.settings.discountLabel}-${code.code}`,
//                         discountType: isDiscount,
//                         discountValue: finalPrice,
//                         variantsId: mergedGidArray,
//                         startDate: new Date(),
//                         endDate: el.endDate,
//                         shop: Shopify.shop,
//                         bundleType: el.bundleDetail.discountType,
//                         totalPrice: total.toFixed(2),
//                         discountCreateId: discountCodeId,
//                       };

//                       fetch(server + "/api/storefront/createRule", {
//                         method: "POST",
//                         headers: {
//                           "Content-Type": "application/json",
//                         },
//                         body: JSON.stringify(sd_bundle_data),
//                       })
//                         .then((response) => response.json())
//                         .then((data) => {
//                           if (data.status == 200) {
//                             fetch(`${server}/api/storefront/getBundleClick`, {
//                               method: "POST",
//                               headers: {
//                                 "Content-Type": "application/json",
//                               },
//                               body: JSON.stringify({
//                                 shop: Shopify.shop,
//                                 bundleId: el._id,
//                               }),
//                             });
//                             ADD_TO_CART_BUTTON.innerText =
//                               el.translations.translation.addToCartButton;
//                             btnSpinner.remove();

//                             let sd_bundle_data = {
//                               discount_name: el.name,
//                               code: code.code,
//                               bundleId: el._id,
//                               discountType: isDiscount,
//                               variantsId: mergedArrayResult,
//                               discountCreateId: data.response,
//                               prefixCode: el.settings.discountLabel,
//                               bundle_type:el.type,
//                             };
//                             var jsonString = JSON.stringify(sd_bundle_data);
//                             localStorage.setItem("sd_bundle_data", jsonString);
//                             cartDrawer();
//                           }
//                         });
//                     }
//                   })
//                   .catch((error) => {
//                     ADD_TO_CART_BUTTON.innerText =
//                       el.translations.translation.addToCartButton;
//                   });
//               }
//             })
//             .catch((error) => {
//               // console.error("Error:", error);
//             });
//         });
//         BUNDLE_DIV.append(ADD_TO_CART_BTN_DIV);
//         if (el?.plans?.plan == "free") {
//         waterMark(BUNDLE_DIV);
//         }
//     } 
//     else if (el.type == "volumeBundle") {
//     console.log(el.type,el)

//         let optionIndex;
//         let discountedPrice;
//         let VOLUME_DIV = document.createElement("div");
//         VOLUME_DIV.className = "sd-bundle-main-column";
//         VOLUME_DIV.classList.add("sd-volumeBundle" + bundleIndex);
//         VOLUME_DIV.style.background = el?.customization?.volume?.box?.backgroundColor;
//         VOLUME_DIV.style.borderRadius = `${el?.customization?.volume?.box?.borderRadius}px`;
//         VOLUME_DIV.style.borderColor = el?.customization?.volume?.box?.borderColor;
      
//         let VOLUME_TITLE_DIV = document.createElement("div");
//         VOLUME_TITLE_DIV.className = "sd-bundle-text-detail";
        
//         let volumeTitleText = document.createElement("h4");
//         volumeTitleText.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
//         volumeTitleText.style.color = el?.customization?.volume?.title?.color;
//         volumeTitleText.style.fontWeight = el?.customization?.volume?.title?.titleBold;
//         volumeTitleText.style.textAlign =  el?.customization?.volume?.title?.alignment;
//         volumeTitleText.style.fontSize =  `${el?.customization?.volume?.title?.fontSize}px`;
//         volumeTitleText.innerText = el?.title;
//         VOLUME_TITLE_DIV.append(volumeTitleText);

//         let VolumeDescription = document.createElement("p");
//         VolumeDescription.style.color = el?.customization?.volume?.title?.descriptionColor;
//         VolumeDescription.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
//         VolumeDescription.style.fontWeight = el?.customization?.volume?.title?.descriptionBold;
//         VolumeDescription.style.textAlign = el?.customization?.volume?.title?.alignment;
//         VolumeDescription.style.fontSize = `${el?.customization?.volume?.title?.descriptionFontSize}px`;
//         VolumeDescription.innerText = el?.description;
//         VOLUME_TITLE_DIV.append(VolumeDescription);
      
//         VOLUME_DIV.append(VOLUME_TITLE_DIV);

//         el.bundleDetail.discountOptions.forEach((ele, volumeIndex) => {
//           let DISCOUNTOPTIONS = document.createElement("div");
//           DISCOUNTOPTIONS.className = "sd-volume-bundle-detail";
//           DISCOUNTOPTIONS.style.background = el?.customization?.volume?.productDetails?.productDetailsBox?.backgroundColor;
//           VOLUME_DIV.append(DISCOUNTOPTIONS);
//           mainDiv.append(VOLUME_DIV);

//           el.bundleDetail.products.map((elem, index) => {
//             let DISCOUNT_OPT_HEADLINE = document.createElement("div");
//             DISCOUNT_OPT_HEADLINE.className = "sd-select-radio-with-text";
//             let DISCOUNT_OPT_titleDiv = document.createElement("div");
//             DISCOUNT_OPT_titleDiv.className = "radio";
//             DISCOUNT_OPT_titleDiv.id = `sd-bundle-volume-discountOpt-title-box${volumeIndex}${index}`;

//             let radioBtn = document.createElement("input");
//             radioBtn.classList.add("sd-radio-btn" + bundleIndex);
//             radioBtn.setAttribute("type", "radio");
//             radioBtn.setAttribute("value", volumeIndex);
//             radioBtn.setAttribute("name", "bundle-radio" + bundleIndex);
//             radioBtn.setAttribute(
//               "id",
//               "volumeDiscount" + volumeIndex + bundleIndex
//             );

//             if (volumeIndex === 0) {
//               radioBtn.setAttribute("checked", "checked");
//               optionIndex = volumeIndex;
//             }

//             DISCOUNT_OPT_titleDiv.append(radioBtn);

//             let discountOptTitle = document.createElement("label");
//             discountOptTitle.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
//             discountOptTitle.style.color = el?.customization?.volume?.options?.color;
//             discountOptTitle.style.fontSize = `${el?.customization?.volume?.options?.fontSize}px`;
//             discountOptTitle.setAttribute(
//               "for",
//               "volumeDiscount" + volumeIndex + bundleIndex
//             );
//             discountOptTitle.className = "sd-radio-label";

//             if (ele?.description.includes("{discount}")) {
//               if (ele?.type == "percent") {
//                 let updatedString = ele?.description?.replace(
//                   "{discount}",
//                   ele.value + "%"
//                 );
//                 discountOptTitle.innerText = updatedString;
//               } else if (ele?.type == "fixed") {
//                 let newPrice = showAmountWithCurrency(ele?.value);
//                 let updatedString = ele.description.replace(
//                   "{discount}",
//                   newPrice + " " + el.translations.translation.off
//                 );
//                 discountOptTitle.innerText = updatedString;
//               } else if (ele?.type == "price") {
//                 let updatedString = ele?.description?.replace("{discount}", "");
//                 discountOptTitle.innerText = updatedString;
//               } else if (
//                 ele?.type == "noDiscount" ||
//                 ele?.type == "freeShipping"
//               ) {
//                 discountOptTitle.innerText = ele?.description;
//               }
//             } else {
//               discountOptTitle.innerText = ele?.description;
//             }

//             DISCOUNT_OPT_titleDiv.append(discountOptTitle);

//             let DISCOUNT_OPT_BadgeSection = document.createElement("div");
            

//             console.log("ele.type",ele.type)
//             if(ele.type == "percent" || ele.type == "fixed"){
//               // if(el?.customization?.volume?.options?.DiscountBadge?.badgeType == "options"){
//                 DISCOUNT_OPT_BadgeSection.className = "sd-percent-badge";
//                 let BagdeSpan = document.createElement("span");
//                 BagdeSpan.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
//                 BagdeSpan.style.color = el?.customization?.volume?.options?.saveDiscount?.color;
//                 BagdeSpan.style.background = el?.customization?.volume?.options?.saveDiscount?.backgroundColor;
//                 BagdeSpan.style.borderRadius = `${el?.customization?.volume?.options?.saveDiscount?.borderRadius}px`;
//                 BagdeSpan.style.fontSize = `${el?.customization?.volume?.options?.saveDiscount?.fontSize}px`;
//                 if (ele.type == "percent") {
//                   BagdeSpan.innerText =
//                     el.translations.translation.save + " " + ele.value + "%";
//                 } else if (ele.type == "price") {
//                   let newPrice = ele.value;
//                   BagdeSpan.innerText = showAmountWithCurrency(newPrice);
//                 } else if (ele.type == "fixed") {
//                   let newPrice = ele.value;
    
//                   BagdeSpan.innerText =
//                     el.translations.translation.save +
//                     " " +
//                     showAmountWithCurrency(newPrice) +
//                     " ";
//                 }
//                 DISCOUNT_OPT_BadgeSection.append(BagdeSpan) 
//               // }
              
//               // else{

//               //   DISCOUNT_OPT_BadgeSection.className = `sd-bundle-product-badge${volumeIndex+1}`;
//               //   DISCOUNT_OPT_BadgeSection.innerHTML = `<svg
//               //             width="91"
//               //             height="24"
//               //             viewBox="0 0 91 24"
//               //             fill="none"
//               //             xmlns="http://www.w3.org/2000/svg"
//               //           >
//               //             <path
//               //               d="M0 10L8.63148 0H83.3261L91 10H0Z"
//               //               fill= ${
//               //                 el?.customization?.volume?.options
//               //                   ?.saveDiscount?.backgroundColor
//               //               }
//               //             />
//               //             <path
//               //               d="M9 0H83V19C83 21.7614 80.7614 24 78 24H14C11.2386 24 9 21.7614 9 19V0Z"
//               //               fill= ${
//               //                 el?.customization?.volume?.options
//               //                   ?.saveDiscount?.backgroundColor
//               //               }
//               //             />
//               //           </svg>`
//               //   let Badge_Text = document.createElement("h4");
//               //   if (ele.type == "percent") {
//               //     Badge_Text.innerText =
//               //       ele.value + "% Off";
//               //   } else if (ele.type == "fixed") {
//               //     let newPrice = ele.value;
//               //     Badge_Text.innerText =
//               //       showAmountWithCurrency(newPrice)+
//               //       " Off";
//               //   }
//               //   Badge_Text.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
//               //   Badge_Text.style.fontSize = el?.customization?.volume?.options?.saveDiscount?.fontSize+"px";
//               //   Badge_Text.style.color = el?.customization?.volume?.options?.saveDiscount?.color;
//               //   DISCOUNT_OPT_BadgeSection.append(Badge_Text);
//               // }
//             }

//             DISCOUNT_OPT_HEADLINE.append(
//               DISCOUNT_OPT_titleDiv,
//               DISCOUNT_OPT_BadgeSection
//             );
//             DISCOUNTOPTIONS.append(DISCOUNT_OPT_HEADLINE);
//             VOLUME_DIV.append(DISCOUNTOPTIONS);
//             let DISCOUNT_OPT_PRODUCT_DATA = document.createElement("div");
//             if (volumeIndex === 0) {
//               DISCOUNT_OPT_PRODUCT_DATA.className =
//                 "sd-bundle-product-detail";
//             } else {
//               DISCOUNT_OPT_PRODUCT_DATA.className =
//                 "close";
//             }
//             DISCOUNT_OPT_PRODUCT_DATA.id = `sd-bundle-volume-productdata-container${index}${volumeIndex}`;
//             let DISCOUNT_OPT_PRODUCT = document.createElement("div");
//             DISCOUNT_OPT_PRODUCT.className = "sd-bundle-product-inner";
//             let productImgDiv = document.createElement("div");
//             productImgDiv.className = "sd-bundle-product-img";
//             productImgDiv.style.borderColor = el?.customization?.volume?.productDetails?.image?.borderColor;
//             productImgDiv.style.borderRadius = `${el?.customization?.volume?.productDetails?.image?.borderRadius}px`;
//             let productImg = document.createElement("img");
//             if (
//               el.bundleDetail.discountedProductType == "collection" ||
//               el.bundleDetail.discountedProductType == "all_products"
//             ) {
//               productImg.setAttribute(
//                 "src",
//                 el.bundleDetail.products[0].images[0]
//               );
//             } else {
//               productImg.setAttribute(
//                 "src",
//                 el.bundleDetail.products[0].images[0].originalSrc
//               );
//             }
//             productImgDiv.append(productImg);
//             let productTitlePriceDiv = document.createElement("div");
//             productTitlePriceDiv.className = "sd-bundle-product-name";
//             let productTitle = document.createElement("h5");
//             productTitle.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
//             productTitle.style.color = el?.customization?.volume?.productDetails?.title?.color;
//             productTitle.style.fontSize = `${el?.customization?.volume?.productDetails?.title?.fontSize}px`;
//             productTitle.innerText = el?.bundleDetail?.products[0]?.title;
//             let productPrice = document.createElement("h4");
//             productPrice.classList.add(
//               "productPrice" + bundleIndex + volumeIndex
//             );
//             let xprice;
//             if (
//               el.bundleDetail.discountedProductType == "all_products" ||
//               el.bundleDetail.discountedProductType == "collection"
//             ) {
//               let sdDivivde =
//                 el.bundleDetail.products[0].variants[0].price / 100;
//               xprice = sdDivivde.toFixed(2);
//             } else {
//               let toFixedPrice = el.bundleDetail.products[0].variants[0].price;
//               xprice = parseFloat(toFixedPrice).toFixed(2);
//             }
//             productPrice.innerText = showAmountWithCurrency(xprice);
//             productPrice.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
//             productPrice.id = `sd-volume-datasection-price${index}${bundleIndex}${volumeIndex}`;
//             productPrice.style.color = el?.customization?.volume?.productDetails?.price?.color;
//             productPrice.style.fontSize = `${el?.customization?.volume?.productDetails?.price?.fontSize}px`;
//             productTitlePriceDiv.append(productTitle, productPrice);

//             DISCOUNT_OPT_PRODUCT.append(productImgDiv, productTitlePriceDiv);
//             let discountOptionQuantityBox = document.createElement("div");
//             discountOptionQuantityBox.className = "sd-bundle-product-quantity";
//             let discountOptionQuantity = document.createElement("h6");
//             let QUANTITY_SPAN = document.createElement("span");
//             discountOptionQuantity.innerText = ele.quantity;
//             QUANTITY_SPAN.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
//             discountOptionQuantity.append(QUANTITY_SPAN);
//             discountOptionQuantity.style.color = el?.customization?.volume?.productDetails?.quantities?.color;
//             discountOptionQuantity.innerText = `Qty: ${ele.quantity}`;
//             discountOptionQuantity.style.fontSize = el?.customization?.volume?.productDetails?.quantities?.size + "px";
//             // discountOptionQuantity.innerText = `Qty: ${QUANTITY_SPAN.innerText}`;
//             discountOptionQuantity.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
//             discountOptionQuantityBox.append(discountOptionQuantity);
            
//             DISCOUNT_OPT_PRODUCT_DATA.append(DISCOUNT_OPT_PRODUCT,discountOptionQuantityBox);
//             DISCOUNTOPTIONS.append(DISCOUNT_OPT_PRODUCT_DATA);

//             let VOLUME_SELECT;

//             let selectRow = document.createElement("div");
//             selectRow.className = "sd-bundle-product-select-main";
//             let seeMoreDiv = document.createElement("div");
//             let show_more = document.createElement("button");
//             show_more.className = "sd-volume-showMoreLess";
//             show_more.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
//             seeMoreDiv.append(show_more);
//             show_more.innerText = el?.translations?.translation?.seeMore;
//             let seeLessDiv = document.createElement("div");

//             let show_less = document.createElement("button");
//             show_less.className = "sd-volume-showMoreLess";
//             show_less.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
//             seeLessDiv.append(show_less);
//             show_less.innerText = el?.translations?.translation?.seeLess;
//             seeLessDiv.classList.add("sd-volume-hide-click");
//             if (ele.quantity <= 2) {
//               seeMoreDiv.style.display = "none";
//             };
//             for (let i = 1; i <= ele.quantity; i++) {
//               VOLUME_SELECT = document.createElement("select");
//               VOLUME_SELECT.style.color = el?.customization?.volume?.productDetails?.variantSelector?.color;
//               VOLUME_SELECT.style.background = el?.customization?.volume?.productDetails?.variantSelector?.backgroundColor;
//               VOLUME_SELECT.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
//               VOLUME_SELECT.style.width = el?.customization?.volume?.productDetails?.variantSelector?.width+"px";
//               VOLUME_SELECT.id = `sd-volume-select-option${i}${volumeIndex}`;
//               VOLUME_SELECT.classList.add(
//                 "volumeDiscount" + volumeIndex + bundleIndex
//               );

//               VOLUME_SELECT.addEventListener("change", (e) => {
//                 bundleData[bundleIndex][i - 1] = {
//                   id: e.target.value,
//                   quantity: 1,
//                 };
//                 const gitVal = "gid://shopify/ProductVariant/" + e.target.value;
//                 gidArray[bundleIndex][i - 1] = gitVal;

//                 const varientPrice = e.target.options[e.target.selectedIndex].dataset.id;
//                 const displayPrice = document.getElementById(
//                   `sd-volume-datasection-price${index}${bundleIndex}${volumeIndex}`
//                 );

//                 let xPrice;
//                 if (
//                   el.bundleDetail.discountedProductType == "all_products" ||
//                   el.bundleDetail.discountedProductType == "collection"
//                 ) {
//                   xPrice = (varientPrice / 100).toFixed(2);
//                 } else {
//                   let toFixedPrice = parseInt(varientPrice).toFixed(2);
//                   xPrice = toFixedPrice;
//                 }
//                 let newdisplayPrice = showAmountWithCurrency(xPrice);

//                 displayPrice.innerText = newdisplayPrice;
//                 bundleSum[bundleIndex][i - 1] = varientPrice;
//                 const textAmount = document.getElementById(
//                   `sd-bundle-volume-discounted-price${bundleIndex}`
//                 );
//                 let myArray = bundleSum[bundleIndex].map(parseFloat);
//                 let tAmount = myArray.reduce(
//                   (accumulator, currentValue) => accumulator + currentValue,
//                   0
//                 );
//                 let tPrice;
//                 if (
//                   el.bundleDetail.discountedProductType == "all_products" ||
//                   el.bundleDetail.discountedProductType == "collection"
//                 ) {
//                   tPrice = (tAmount / 100).toFixed(2);
//                 } else {
//                   tPrice = tAmount.toFixed(2);
//                 }
//                 var newTextAmt = showAmountWithCurrency(tPrice);

//                 textAmount.innerHTML = newTextAmt;

//                 let total = myArray.reduce(
//                   (accumulator, currentValue) => accumulator + currentValue,
//                   0
//                 );

//                 let dTotalprice;
//                 if (
//                   el.bundleDetail.discountedProductType == "all_products" ||
//                   el.bundleDetail.discountedProductType == "collection"
//                 ) {
//                   dTotalprice = total / 100;
//                 } else {
//                   dTotalprice = total;
//                 }

//                 if (
//                   el.bundleDetail.discountOptions[volumeIndex].type == "percent"
//                 ) {
//                   let part = parseFloat(
//                     el.bundleDetail.discountOptions[volumeIndex].value
//                   );
//                   let percentage = (dTotalprice * part) / 100;
//                   result = dTotalprice - percentage;
//                   discountedPrice = result.toFixed(2);
//                 } else if (
//                   el.bundleDetail.discountOptions[volumeIndex].type == "fixed"
//                 ) {
//                   let part = parseFloat(
//                     el.bundleDetail.discountOptions[volumeIndex].value
//                   );
//                   let fixed = dTotalprice - part;
//                   discountedPrice = fixed.toFixed(2);
//                 } else if (
//                   el.bundleDetail.discountOptions[volumeIndex].type == "price"
//                 ) {
//                   let part = parseFloat(
//                     el.bundleDetail.discountOptions[volumeIndex].value
//                   );
//                   discountedPrice = part.toFixed(2);
//                 }

//                 let newProductPrice = showAmountWithCurrency(discountedPrice);

//                 if (
//                   el.bundleDetail.discountOptions[optionIndex].type ==
//                     "noDiscount" ||
//                   el.bundleDetail.discountOptions[optionIndex].type ==
//                     "freeShipping"
//                 ) {
//                   document.getElementById(
//                     "sd-bundle-volume-discount-final-price" + bundleIndex
//                   ).innerText = newTextAmt;
//                 } else {
//                   document.getElementById(
//                     "sd-bundle-volume-discount-final-price" + bundleIndex
//                   ).innerText = newProductPrice;
//                 }
//               });
//               elem.variants.map((element) => {
//                 let VOLUME_OPTION = document.createElement("option");
//                 VOLUME_OPTION.textContent = element.title;

//                 if (
//                   el.bundleDetail.discountedProductType == "collection" ||
//                   el.bundleDetail.discountedProductType == "all_products"
//                 ) {
//                   VOLUME_OPTION.value = element.id;
//                 } else {
//                   VOLUME_OPTION.value = element.id.replace(
//                     "gid://shopify/ProductVariant/",
//                     ""
//                   );
//                 }

//                 VOLUME_OPTION.setAttribute("data-id", element.price);
//                 VOLUME_SELECT.appendChild(VOLUME_OPTION);
//                 selectRow.append(VOLUME_SELECT);
//               });

//               if (el.bundleDetail.products[0].variants.length <= 1) {
//                 selectRow.style.display = "none";
//               }
//               if (i > 2) {
//                 VOLUME_SELECT.classList.add("sd-volume-hide-click");
//               }
//               show_more.addEventListener("click", function (e) {
//                 VOLUME_SELECT.classList.remove("sd-volume-hide-click");
//                 seeMoreDiv.classList.add("sd-volume-hide-click");
//                 seeLessDiv.classList.remove("sd-volume-hide-click");
//               });

//               show_less.addEventListener("click", function (e) {
//                 if (i > 2) {
//                   VOLUME_SELECT.classList.add("sd-volume-hide-click");
//                 }
//                 seeLessDiv.classList.add("sd-volume-hide-click");
//                 seeMoreDiv.classList.remove("sd-volume-hide-click");
//               });
//               productTitlePriceDiv.append(selectRow);
//             }
//             selectRow.append(seeMoreDiv);
//             selectRow.append(seeLessDiv);
//             let selectedElement = document.getElementsByClassName(
//               "sd-volume-select-option"
//             );

//             let radioGroup = document.getElementsByName(
//               "bundle-radio" + bundleIndex
//             );
//           });

//           let radioGroup = document.getElementsByName(
//             "bundle-radio" + bundleIndex
//           );

//           radioGroup.forEach((radio) => {
//             radio.addEventListener("change", () => {
//               document
//                 .querySelectorAll(".volumeDiscount" + volumeIndex + bundleIndex)
//                 .forEach((selected) => {
//                   selected.options[0].selected = true;

//                   let price = selected.options[0].getAttribute("data-id");
//                   document
//                     .querySelectorAll(
//                       ".productPrice" + bundleIndex + volumeIndex
//                     )
//                     .forEach((priceDiv) => {
//                       let xprice;
//                       if (
//                         el.bundleDetail.discountedProductType ==
//                           "all_products" ||
//                         el.bundleDetail.discountedProductType == "collection"
//                       ) {
//                         xprice = (price / 100).toFixed(2);
//                       } else {
//                         let toFixedPrice = parseInt(price).toFixed(2);
//                         xprice = toFixedPrice;
//                       }
//                       let newProductPrice = showAmountWithCurrency(xprice);

//                       priceDiv.innerText = newProductPrice;
//                     });
//                 });
//               radioGroup.forEach((r) => {
//                 if (r.checked) {
//                   r.parentElement.parentElement.nextSibling.classList.remove(
//                     "close"
//                   );
//                   r.parentElement.parentElement.nextSibling.classList.add(
//                     "sd-bundle-product-detail"
//                   );
//                 } else {
//                   r.parentElement.parentElement.nextSibling.classList.add(
//                     "close"
//                   );
//                   r.parentElement.parentElement.nextSibling.classList.remove(
//                     "sd-bundle-product-detail"
//                   );
//                 }
//               });
//             });
//           });
//         });

//         let volBundle = document.getElementsByClassName(
//           "sd-volumeBundle" + bundleIndex
//         )[0];

//         let volBundleData = volBundle.querySelectorAll(
//           ".sd-radio-btn" + bundleIndex
//         );
//         volBundleData.forEach((e) => {
//           if (e.checked == true) {
//             let getId = e.getAttribute("id");
//             let getIdData = document.querySelectorAll("." + getId);
//             getIdData.forEach((id) => {
//               bundleSum[bundleIndex].push(
//                 id.options[0].getAttribute("data-id")
//               );

//               bundleData[bundleIndex].push({ id: id.value, quantity: 1 });
//               gidArray[bundleIndex].push(
//                 "gid://shopify/ProductVariant/" + id.value
//               );
//             });
//           }
//         });
//         let radioBtnBundle = document.querySelectorAll(
//           ".sd-radio-btn" + bundleIndex
//         );
//         radioBtnBundle.forEach((elem, ind) => {
//           elem.addEventListener("change", (e) => {
//             optionIndex = ind;
//             bundleData[bundleIndex] = [];
//             bundleSum[bundleIndex] = [];
//             gidArray[bundleIndex] = [];
//             let getId = e.target.id;
//             let getIdData = document.querySelectorAll("." + getId);
//             getIdData.forEach((id) => {
//               bundleSum[bundleIndex].push(
//                 id.options[0].getAttribute("data-id")
//               );

//               bundleData[bundleIndex].push({ id: id.value, quantity: 1 });
//               gidArray[bundleIndex].push(
//                 "gid://shopify/ProductVariant/" + id.value
//               );
//             });

//             let total = bundleSum[bundleIndex].reduce(
//               (accumulator, currentValue) => {
//                 return accumulator + parseInt(currentValue, 10);
//               },
//               0
//             );

//             let xprice;
//             let xtotal;
//             if (
//               el.bundleDetail.discountedProductType == "all_products" ||
//               el.bundleDetail.discountedProductType == "collection"
//             ) {
//               xprice = (total / 100).toFixed(2);
//               xtotal = (total / 100).toFixed(2);
//             } else {
//               xprice = total.toFixed(2);
//               xtotal = total;
//             }
//             let newProductPrice = showAmountWithCurrency(xprice);

//             const showTotalval = document.getElementById(
//               `sd-bundle-volume-discounted-price${bundleIndex}`
//             );

//             showTotalval.innerText = newProductPrice;

//             if (el.bundleDetail.discountOptions[ind].type == "percent") {
//               let part = parseFloat(el.bundleDetail.discountOptions[ind].value);
//               let percentage = (xtotal * part) / 100;
//               result = xtotal - percentage;
//               discountedPrice = result.toFixed(2);
//             } else if (el.bundleDetail.discountOptions[ind].type == "fixed") {
//               let part = parseFloat(el.bundleDetail.discountOptions[ind].value);
//               let fixed = xtotal - part;
//               discountedPrice = fixed.toFixed(2);
//             } else if (el.bundleDetail.discountOptions[ind].type == "price") {
//               let part = parseFloat(el.bundleDetail.discountOptions[ind].value);
//               discountedPrice = part.toFixed(2);
//             }
//             let newDiscountedProductPrice =
//               showAmountWithCurrency(discountedPrice);
//             if (
//               el.bundleDetail.discountOptions[optionIndex].type ==
//                 "noDiscount" ||
//               el.bundleDetail.discountOptions[optionIndex].type ==
//                 "freeShipping"
//             ) {
//               document.getElementById(
//                 "sd-bundle-volume-discount-final-price" + bundleIndex
//               ).innerText = newProductPrice;
//             } else {
//               document.getElementById(
//                 "sd-bundle-volume-discount-final-price" + bundleIndex
//               ).innerText = newDiscountedProductPrice;
//             }
//           });
//         });

//         let total = bundleSum[bundleIndex].reduce(
//           (accumulator, currentValue) => {
//             return accumulator + parseInt(currentValue, 10);
//           },
//           0
//         );
//         let dNewTotalprice;
//         if (
//           el.bundleDetail.discountedProductType == "all_products" ||
//           el.bundleDetail.discountedProductType == "collection"
//         ) {
//           dNewTotalprice = total / 100;
//         } else {
//           dNewTotalprice = total;
//         }

//         if (el.bundleDetail.discountOptions[0].type == "percent") {
//           let part = parseFloat(el.bundleDetail.discountOptions[0].value);
//           let percentage = (dNewTotalprice * part) / 100;
//           result = dNewTotalprice - percentage;
//           discountedPrice = result.toFixed(2);
//         } else if (el.bundleDetail.discountOptions[0].type == "fixed") {
//           let part = parseFloat(el.bundleDetail.discountOptions[0].value);
//           let fixed = dNewTotalprice - part;
//           discountedPrice = fixed.toFixed(2);
//         } else if (el.bundleDetail.discountOptions[0].type == "price") {
//           let part = parseFloat(el.bundleDetail.discountOptions[0].value);
//           discountedPrice = part;
//         }

//         let totalDiv = document.createElement("div");
//         totalDiv.className = "sd-bundle-volume-total-box";
//         let totalTextDiv = document.createElement("div");
//         totalTextDiv.className = "sd-total-desc";
//         let TotalText = document.createElement("h4");
//         TotalText.style.color = el?.customization?.volume?.totalSection?.color;
//         TotalText.style.fontSize = el?.customization?.volume?.totalSection?.fontSize + "px";
//         TotalText.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
//         TotalText.innerText = el?.translations?.translation?.total;
//         TotalText.style.color = el?.customization?.volume?.totalSection?.color;
//         totalTextDiv.append(TotalText);

//         let DiscountText = document.createElement("p");
//         DiscountText.style.fontSize = el?.customization?.volume?.totalSection?.discountMessage?.size + "px";
//         DiscountText.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
//         DiscountText.style.color = el?.customization?.volume?.totalSection?.discountMessage?.color;
//         DiscountText.innerText = el?.translations?.translation?.discountApplied;
//         totalTextDiv.append(DiscountText);
//         let totalDiscountDiv = document.createElement("div");
//         totalDiscountDiv.className = "sd-total-amount";
//         let firstDiscountText = document.createElement("h6");
//         firstDiscountText.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
//         firstDiscountText.id = `sd-bundle-volume-discounted-price${bundleIndex}`;
//         firstDiscountText.style.color = el?.customization?.volume?.totalSection?.originalPrice.color;
//         firstDiscountText.style.fontSize = el?.customization?.volume.totalSection?.originalPrice?.fontSize + "px";
//         let tPrice;
//         if (
//           el.bundleDetail.discountedProductType == "all_products" ||
//           el.bundleDetail.discountedProductType == "collection"
//         ) {
//           tPrice = (total / 100).toFixed(2);
//         } else {
//           tPrice = total.toFixed(2);
//         }
//         let newFirstDiscountPrice = tPrice;
//         firstDiscountText.innerText = showAmountWithCurrency(
//           newFirstDiscountPrice
//         );

//         let secondDiscountText = document.createElement("h4");
//         secondDiscountText.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
//         secondDiscountText.style.color = el?.customization?.volume?.totalSection?.finalPrice?.color;
//         secondDiscountText.style.fontSize = el?.customization?.volume?.totalSection?.finalPrice?.fontSize + "px";
//         secondDiscountText.id = "sd-bundle-volume-discount-final-price" + bundleIndex;
       
//         newSecondDiscountPrice = discountedPrice;
//         if (
//           el.bundleDetail.discountOptions[optionIndex].type == "noDiscount" ||
//           el.bundleDetail.discountOptions[optionIndex].type == "freeShipping"
//         ) {
//           secondDiscountText.innerText = showAmountWithCurrency(newFirstDiscountPrice);
//         } else {
//           secondDiscountText.innerText = showAmountWithCurrency(
//             newSecondDiscountPrice
//           );
//         }
//         totalDiscountDiv.append(secondDiscountText,firstDiscountText);
//         totalDiv.append(totalTextDiv, totalDiscountDiv);
//         let addToCart = document.createElement("div");
//         addToCart.className = "sd-bundle-addto-cart";
//         totalDiv.className = "sd-product-bundle-total";
//         VOLUME_DIV.append(totalDiv);
//         let addToCartBtn = document.createElement("button");
//         addToCartBtn.style.borderColor = el?.customization?.volume?.button?.borderColor;
//         addToCartBtn.style.borderRadius = el?.customization?.volume.button?.borderRadius+"px";
//         addToCartBtn.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
//         addToCartBtn.style.background = el?.customization?.volume?.button?.backgroundColor;
//         addToCartBtn.style.color = el?.customization?.volume?.button?.color;
//         addToCartBtn.style.fontSize = `${el?.customization?.volume?.button?.fontSize}px`;
//         addToCartBtn.innerText = el?.translations?.translation?.addToCartButton;
//         addToCart.append(addToCartBtn);

//         if (el?.customization?.volume?.button?.position == "bottom") {
//           VOLUME_DIV.append(addToCart);
//         } else {
//           VOLUME_DIV.prepend(addToCart);
//         }

//         addToCartBtn.addEventListener("click", function () {
//           let code = JSON.parse(localStorage.getItem("sd_bundle_data"));
//           let discountCodeId = code.discountCreateId ?? "";
//           addToCartBtn.innerText = "";
//           let volumeBtnSpinner = document.createElement("div");
//           addToCartBtn.append(volumeBtnSpinner);
//           volumeBtnSpinner.className = "bundleBtnSpinner";
//           volumeBtnSpinner.style.display = "block";

//           const mergedArray = bundleData[bundleIndex].reduce(
//             (acc, curr) => acc.concat(curr),
//             []
//           );
//           const mergedGidArray = gidArray[bundleIndex].reduce(
//             (acc, curr) => acc.concat(curr),
//             []
//           );

//           let mergedResult = {};
//           for (let item of mergedArray) {
//             if (mergedResult[item.id]) {
//               mergedResult[item.id].quantity += item.quantity;
//             } else {
//               mergedResult[item.id] = { ...item };
//             }
//           }
//           let mergedArrayResult = Object.values(mergedResult);

//           let formData = {
//             items: mergedArrayResult,
//             attributes: { SD_BUNDLE_ID: el._id },
//           };
//           fetch(window.Shopify.routes.root + "cart/add.js", {
//             method: "POST",
//             headers: {
//               "Content-Type": "application/json",
//             },
//             body: JSON.stringify(formData),
//           })
//             .then((response) => {
//               return response.json();
//             })
//             .then((response) => {
//               let errorDiv = document.getElementsByClassName(
//                 "sd-bundle-error-message"
//               );
//               errorDiv[0]?.remove();
//               if (response.status == 422 || response.status == 404) {
//                 addToCartBtn.innerText =
//                   el.translations.translation.addToCartButton;
//                 volumeBtnSpinner.remove();
//                 let errorMessage = document.createElement("div");
//                 errorMessage.className = "sd-bundle-error-message";
//                 VOLUME_DIV.append(errorMessage);
//                 errorMessage.innerText = response.description;
//               } else {
//                 fetch(window.Shopify.routes.root + "cart.js", {
//                   method: "GET",
//                   headers: {
//                     "Content-Type": "application/json",
//                   },
//                 })
//                   .then((response) => {
//                     return response.json();
//                   })
//                   .then((response) => {
//                     if (
//                       el.bundleDetail.discountOptions[optionIndex].type ==
//                       "noDiscount"
//                     ) {
//                       fetch(`${server}/api/storefront/getBundleClick`, {
//                         method: "POST",
//                         headers: {
//                           "Content-Type": "application/json",
//                         },
//                         body: JSON.stringify({
//                           shop: Shopify.shop,
//                           bundleId: el._id,
//                         }),
//                       });
//                       let isDiscount =
//                         el.bundleDetail.discountOptions[optionIndex].type ==
//                         "noDiscount"
//                           ? "noDiscount"
//                           : "Fix";
//                       const localData = JSON.parse(
//                         localStorage.getItem("sd_bundle_data")
//                       );
//                       let sd_bundle_data = {
//                         discount_name: el.name,
//                         code: code.code,
//                         bundleId: el._id,
//                         discountType: isDiscount,
//                         variantsId: mergedArrayResult,
//                         discountCreateId: localData.discountCreateId,
//                         prefixCode: el.settings.discountLabel,
//                       };
//                       var jsonString = JSON.stringify(sd_bundle_data);
//                       localStorage.setItem("sd_bundle_data", jsonString);
//                       addToCartBtn.innerText =
//                         el.translations.translation.addToCartButton;
//                       volumeBtnSpinner.remove();
//                       window.location.assign(`https://${Shopify.shop}/cart`);
//                     } else {
//                       let finalSumBundle = bundleSum[bundleIndex].reduce(
//                         (acc, curr) => acc.concat(curr),
//                         []
//                       );
//                       let myArray = finalSumBundle.map(parseFloat);
//                       let total = myArray.reduce(
//                         (accumulator, currentValue) =>
//                           accumulator + currentValue,
//                         0
//                       );
//                       let xtotalprice;
//                       if (
//                         el.bundleDetail.discountedProductType ==
//                           "all_products" ||
//                         el.bundleDetail.discountedProductType == "collection"
//                       ) {
//                         xtotalprice = (total / 100).toFixed(2);
//                       } else {
//                         xtotalprice = total;
//                       }

//                       let finalPrice;

//                       switch (
//                         el.bundleDetail.discountOptions[optionIndex].type
//                       ) {
//                         case "percent":
//                           let percentage = xtotalprice - discountedPrice;
//                           if (
//                             el.bundleDetail.discountedProductType ==
//                             "all_products"
//                           ) {
//                             finalPrice = percentage.toFixed(2);
//                           } else {
//                             finalPrice = percentage.toFixed(2);
//                           }
//                           break;
//                         case "price":
//                           let pricePart = parseFloat(
//                             el.bundleDetail.discountOptions[optionIndex].value
//                           );
//                           result = xtotalprice - pricePart;
//                           finalPrice = result.toFixed(2);
//                           break;
//                         case "fixed":
//                           let fixedPart = parseFloat(
//                             el.bundleDetail.discountOptions[optionIndex].value
//                           );
//                           finalPrice = fixedPart.toFixed(2);
//                         break;

//                         default:
//                           break;
//                       }

//                       let isDiscount =
//                         el.bundleDetail.discountOptions[optionIndex].type ==
//                         "noDiscount"
//                           ? "noDiscount"
//                           : "Fix";

//                       let sd_bundle_data = {
//                         discount_name: el.name,
//                         code: el.settings.discountLabel + "-" + code.code,
//                         discountType: isDiscount,
//                         discountValue: finalPrice,
//                         variantsId: mergedGidArray,
//                         startDate: new Date(),
//                         endDate: el.endDate,
//                         shop: Shopify.shop,
//                         bundleType: el.bundleDetail.discountOptions[optionIndex].type,
//                         totalPrice: xtotalprice,
//                         discountCreateId: discountCodeId,
//                       };

//                       fetch(server + "/api/storefront/createRule", {
//                         method: "POST",
//                         headers: {
//                           "Content-Type": "application/json",
//                         },
//                         body: JSON.stringify(sd_bundle_data),
//                       })
//                         .then((response) => response.json())
//                         .then((data) => {
//                           if (data.status == 200) {
//                             fetch(`${server}/api/storefront/getBundleClick`, {
//                               method: "POST",
//                               headers: {
//                                 "Content-Type": "application/json",
//                               },
//                               body: JSON.stringify({
//                                 shop: Shopify.shop,
//                                 bundleId: el._id,
//                               }),
//                             });

//                             let isDiscount =
//                               el.bundleDetail.discountOptions[optionIndex]
//                                 .type == "noDiscount"
//                                 ? "noDiscount"
//                                 : "Fix";
//                             let sd_bundle_data = {
//                               discount_name: el.name,
//                               code: code.code,
//                               bundleId: el._id,
//                               discountType: isDiscount,
//                               variantsId: mergedArrayResult,
//                               discountCreateId: data.response,
//                               prefixCode: el.settings.discountLabel,
//                             };
//                             var jsonString = JSON.stringify(sd_bundle_data);
//                             localStorage.setItem("sd_bundle_data", jsonString);
//                             addToCartBtn.innerText =
//                               el.translations.translation.addToCartButton;
//                             volumeBtnSpinner.remove();
//                             cartDrawer();
//                           }
//                         });
//                     }
//                     // .catch((err) => console.error(err));
//                   })
//                   .catch((error) => {
//                     // console.log(error.message);
//                   });
//               }
//             })
//             .catch((error) => {
//               console.error("Error:", error.message);
//             });
//         });

//         if (el?.plans?.plan == "free") {
//         waterMark(VOLUME_DIV);
//         }
//     } 
//     else if (el.type == "collectionMixMatch") {
//       // console.log("test....collection data........",el)
//       //--------------------------------------------------------------------------Collection Bundle----------------------------------------------------------------------------
//       let collectionDiv = document.createElement("div");
//         collectionDiv.className = "sd-collection-main-column";
//         collectionDiv.style.background = el?.customization?.collectionMixMatch?.box?.backgroundColor;
//         collectionDiv.style.border = "1px solid" + el?.customization?.collectionMixMatch?.box?.borderColor;
//         collectionDiv.style.borderRadius = el?.customization?.collectionMixMatch?.box?.borderRadius + "px";
//         mainDiv.append(collectionDiv);
//         if (el?.bundleDetail?.discountType === "percent" || el?.bundleDetail?.discountType === "fixed") {
//         let VOLUME_HEADER_DIV = document.createElement("span");
//         VOLUME_HEADER_DIV.className = "sd-badges-part";
//         VOLUME_HEADER_DIV.style.background = el?.customization?.collectionMixMatch?.DiscountBadge?.backgroundColor;
//         VOLUME_HEADER_DIV.style.fontFamily = el?.customization?.collectionMixMatch?.box?.fontFamily;
//         VOLUME_HEADER_DIV.style.color = el?.customization?.collectionMixMatch?.DiscountBadge?.color;
//         let discountBadge = document.createElement("span");
//         discountBadge.className = "sd-collectionMM-badge";
//         // discountBadge.innerText = el?.translations?.translation?.grabTheDeal;
//         discountBadge.innerText = el?.badgeText||"";
//         VOLUME_HEADER_DIV.append(discountBadge);
//         collectionDiv.append(VOLUME_HEADER_DIV);
//         }
//         let customiseTitle = document.createElement("div");
//         customiseTitle.className = "sd-bundle-text-detail";
//         collectionDiv.append(customiseTitle);
//         let customiseTitleText = document.createElement("h4");
//         customiseTitleText.style.fontFamily = el?.customization?.collectionMixMatch?.box?.fontFamily;
//         customiseTitleText.innerText = el?.title;
//         customiseTitleText.style.color = el?.customization?.collectionMixMatch?.title?.color;
//         customiseTitleText.style.fontSize = el?.customization?.collectionMixMatch?.title?.fontSize + "px";
//         customiseTitleText.style.textAlign = el?.customization?.collectionMixMatch?.title?.alignment;

//         customiseTitle.append(customiseTitleText);

//         let customiseDescriptionText = document.createElement("p");
//         customiseDescriptionText.style.fontFamily = el?.customization?.collectionMixMatch?.box?.fontFamily;
//         customiseDescriptionText.innerText = el?.description;
//         customiseDescriptionText.style.color =
//           el?.customization?.collectionMixMatch?.title?.descriptionColor;
//         customiseDescriptionText.style.fontSize =
//           el?.customization?.collectionMixMatch?.title?.descriptionFontSize + "px";
//         customiseDescriptionText.style.textAlign = el?.customization?.collectionMixMatch?.title?.alignment;
//         customiseTitle.append(customiseDescriptionText);

//         el.bundleDetail.products.forEach((ele, index) => {
//           let CollectionDetails = document.createElement("div")
//           CollectionDetails.className = "sd-bundle-product-detail create-bundle-discount";
//           CollectionDetails.style.backgroundColor = el?.customization?.collectionMixMatch?.collectionDetails?.collectionDetailsBox?.backgroundColor;
//           collectionDiv.append(CollectionDetails);
//           let selectedCollection = document.createElement("div");
//           selectedCollection.className = "sd-bundle-product-inner";
//           CollectionDetails.append(selectedCollection);

//           let SelectedCollectionImgDiv = document.createElement("div");
//           SelectedCollectionImgDiv.className = "sd-bundle-product-img";
//           SelectedCollectionImgDiv.style.border = "1px solid" + el?.customization?.collectionMixMatch?.collectionDetails?.imageBorderColor;
//           selectedCollection.append(SelectedCollectionImgDiv);
//           let selectedCollectionImg = document.createElement("img");
//           selectedCollectionImg.style.width = "100%";
//           let collectionImg = ele?.image?.originalSrc ?? smartNoImg;
//           selectedCollectionImg.setAttribute("src", collectionImg);
//           SelectedCollectionImgDiv.append(selectedCollectionImg);
          
//           let selectedCollectionData = document.createElement("div");
//           selectedCollectionData.className = "sd-bundle-product-name";
//           selectedCollection.append(selectedCollectionData);

//           let selectedCollectionName = document.createElement("h5");
//           selectedCollectionName.style.fontFamily = el?.customization?.collectionMixMatch?.box?.fontFamily;
//           selectedCollectionName.style.color = el?.customization?.collectionMixMatch?.collectionDetails?.title?.color;
//           selectedCollectionName.style.fontSize = el?.customization?.collectionMixMatch?.collectionDetails?.title?.fontSize + "px";
//           selectedCollectionName.innerText = ele.title;
//           selectedCollectionData.append(selectedCollectionName);
//           let selectedCollectionQuantity = document.createElement("p");
//           selectedCollectionQuantity.style.fontFamily = el?.customization?.collectionMixMatch?.box?.fontFamily;
//           selectedCollectionQuantity.innerText = `Add ${ele.quantity} items from ${ele.title}`;
//           selectedCollectionQuantity.style.color = el?.customization?.collectionMixMatch?.collectionDetails?.description?.color;
//           selectedCollectionQuantity.style.fontSize =el?.customization?.collectionMixMatch?.collectionDetails?.description?.fontSize + "px";
//           selectedCollectionData.append(selectedCollectionQuantity);

//            if (index < el.bundleDetail.products.length - 1) {
//             let BUNDLE_PLUS_BTN_DIV = document.createElement("div");
//             BUNDLE_PLUS_BTN_DIV.className = "sd-add-bundle";
//             BUNDLE_PLUS_BTN_DIV.style.color = el?.customization?.collectionMixMatch?.collectionDetails?.plus?.color;
//             BUNDLE_PLUS_BTN_DIV.innerHTML = `<svg viewBox="0 0 18 18" focusable="false" width="18" height="18" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
//             <path d="M6.98047 17.3842V0.580255H10.3239V17.3842H6.98047ZM0.256392 10.6477V7.30433H17.0604V10.6477H0.256392Z" fill= ${
//                           el?.customization?.collectionMixMatch
//                             ?.collectionDetails?.plus?.color
//                         }></path>
//             </svg>`;
//             collectionDiv.append(BUNDLE_PLUS_BTN_DIV);
//           } else {
//           }
//         });

//         let Go_To_Bundle_Div = document.createElement("div");
//         Go_To_Bundle_Div.className = "sd-bundle-addto-cart"
//         let go_to_bundleBuilder_btn = document.createElement("button");
//         go_to_bundleBuilder_btn.style.fontFamily = el?.customization?.collectionMixMatch?.box?.fontFamily;
//         go_to_bundleBuilder_btn.style.borderColor = el?.customization?.collectionMixMatch?.button?.borderColor;
//         go_to_bundleBuilder_btn.style.borderRadius = el?.customization?.collectionMixMatch?.button?.borderRadius + "px";
//         go_to_bundleBuilder_btn.style.background = el?.customization?.collectionMixMatch?.button?.backgroundColor;
//         go_to_bundleBuilder_btn.style.color = el?.customization?.collectionMixMatch?.button?.color;
//         go_to_bundleBuilder_btn.style.fontSize = el?.customization?.collectionMixMatch?.button?.fontSize + "px";
//         go_to_bundleBuilder_btn.innerText = el?.translations?.translation?.goToBundleBuilder;
        
//         collectionDiv.append(Go_To_Bundle_Div);
//         Go_To_Bundle_Div.append(go_to_bundleBuilder_btn)
//         go_to_bundleBuilder_btn.addEventListener("click", async (e) => {
//           go_to_bundleBuilder_btn.innerText = "";
//           let collectionSpinner = document.createElement("div");
//           go_to_bundleBuilder_btn.append(collectionSpinner);
//           collectionSpinner.className = "bundleBtnSpinner";
//           collectionSpinner.style.display = "block";

//           const data = {
//             shop: Shopify.shop,
//           };
//           fetch(server + "/api/storefront/getPage", {
//             method: "POST",
//             headers: {
//               "Content-Type": "application/json",
//             },
//             body: JSON.stringify(data),
//           })
//             .then((response) => response.json())
//             .then((response) => {
//               if (response.status == 400) {
//                 fetch(server + "/api/storefront/createPage", {
//                   method: "POST",
//                   headers: {
//                     "content-Type": "application/json",
//                   },
//                   body: JSON.stringify(data),
//                 })
//                   .then((response) => response.json())
//                   .then((response) => {
//                     if (response.status == 200) {
//                       go_to_bundleBuilder_btn.innerText =
//                         el.translations.translation.goToBundleBuilder;
//                       collectionSpinner.remove();
//                       navigator.sayswho = (function () {
//                         var N = navigator.appName,
//                           ua = navigator.userAgent,
//                           tem,
//                           M = ua.match(
//                             /(opera|chrome|safari|firefox|msie)\/?\s*([\d\.]+)/i
//                           );
//                         if (
//                           M &&
//                           (tem = ua.match(/version\/([\.\d]+)/i)) != null
//                         )
//                           M[2] = tem[1];
//                         M = M ? [M[1], M[2]] : [N, navigator.appVersion, "-?"];
//                         return M.join(" ");
//                       })();

//                       if (navigator.sayswho.includes("Safari") == true) {
//                         window.location.assign(
//                           `https://${Shopify.shop}/pages/collection-mix-match?b=${el._id}`
//                         );
//                       } else {
//                         let newWindow = window.open("", "_blank");
//                         newWindow.location.href = `https://${Shopify.shop}/pages/collection-mix-match?b=${el._id}`;
//                       }
//                     }
//                   });
//               } else {
//                 if (response.status == 200) {
//                   go_to_bundleBuilder_btn.innerText =
//                     el.translations.translation.goToBundleBuilder;

//                   collectionSpinner.remove();
//                   navigator.sayswho = (function () {
//                     var N = navigator.appName,
//                       ua = navigator.userAgent,
//                       tem,
//                       M = ua.match(
//                         /(opera|chrome|safari|firefox|msie)\/?\s*([\d\.]+)/i
//                       );
//                     if (M && (tem = ua.match(/version\/([\.\d]+)/i)) != null)
//                       M[2] = tem[1];
//                     M = M ? [M[1], M[2]] : [N, navigator.appVersion, "-?"];
//                     return M.join(" ");
//                   })();

//                   if (navigator.sayswho.includes("Safari") == true) {
//                     window.location.assign(
//                       `https://${Shopify.shop}/pages/collection-mix-match?b=${el._id}`
//                     );
//                   } else {
//                     let newWindow = window.open("", "_blank");
//                     newWindow.location.href = `https://${Shopify.shop}/pages/collection-mix-match?b=${el._id}`;
//                   }
//                 }
//               }
//             });
//         });
        
//         if (el?.plans?.plan == "free") {
//         waterMark(collectionDiv);
//         }
//     }
//     else if (el.type == "fbt") {
//       if(el.plans.plan == "standard"){
//         let totalProducts =[];
//         function execFbtModern(){
//           let originalPriceArray=[];
//           let originalPrice ;
//           let sellingPrice ;
//           let selectedOfferedProductCount = 0;
//           let calculateOriginalPrice = () => {
//             total = 0;
//             originalPriceArray.map((item) => {
//               if(item.selected==true){
//                 total += parseFloat(item.price);        
//               }
//               });
//               originalPrice=total
//               document.querySelector(`.sd-fbt-mrp-span${bundleIndex}`).innerText=showAmountWithCurrency(total.toFixed(2))
//             return total ; 
//           };  
            
//           function calculateSellingPrice() {
//             let finalPrice = 0;      
//             if (el.bundleDetail.discountType == "percent") {
//               if (el.bundleDetail.discountValue > 100) {
//                 finalPrice = 0;
//               } else {
//                 finalPrice =
//                   originalPrice -
//                 originalPrice * (el.bundleDetail.discountValue / 100);
//               }
//             } else if (el.bundleDetail.discountType == "fixed") {
//                 if (parseFloat(el.bundleDetail.discountValue) > originalPrice) {
//                   finalPrice = 0;
//                 } else {
//                   finalPrice = originalPrice - el.bundleDetail.discountValue;
//                 }
//             } else if (el.bundleDetail.discountType == "freeShipping" || el.bundleDetail.discountType == "noDiscount") {
//                 finalPrice = originalPrice;
//             }
//             sellingPrice=finalPrice;
//             document.querySelector(`.sd-fbt-sellingPrice-span${bundleIndex}`).innerText=showAmountWithCurrency(finalPrice.toFixed(2))
//             return finalPrice;
//           }
      
//           let FBT_DIV = document.createElement("div");
//           FBT_DIV.className = "sd-bundle-main-column";
//           FBT_DIV.style.backgroundColor = el?.customization?.frequentlyBoughtTogether?.box?.backgroundColor;
//           FBT_DIV.style.borderRadius = el?.customization?.frequentlyBoughtTogether?.box?.borderRadius+"px";
//           FBT_DIV.style.borderColor = el?.customization?.frequentlyBoughtTogether?.box?.borderColor;
//           FBT_DIV.id = `FBT_DIV${bundleIndex}`;
//           mainDiv.append(FBT_DIV);

//             if (el?.bundleDetail?.discountType === "percent" || el?.bundleDetail?.discountType === "fixed") {
//               let VOLUME_HEADER_DIV = document.createElement("span");
//               VOLUME_HEADER_DIV.className = "sd-badges-part-optional";
//               VOLUME_HEADER_DIV.style.background = el?.customization?.frequentlyBoughtTogether?.optionalBadge?.background;
//               VOLUME_HEADER_DIV.style.color = el?.customization?.frequentlyBoughtTogether?.optionalBadge?.color;
//               VOLUME_HEADER_DIV.style.fontSize = el?.customization?.frequentlyBoughtTogether?.optionalBadge?.fontSize + "px"; 
//               let discountBadge = document.createElement("span");
//               discountBadge.className = "sd-collectionMM-badge";
//               // if (el.bundleDetail.discountType === "percent") {
//               //     discountBadge.innerText = el.bundleDetail.discountValue + "% Off";
//               // } else if (el.bundleDetail.discountType === "fixed") {
//               //     let newPrice = el.bundleDetail.discountValue;
//               //     discountBadge.innerText = showAmountWithCurrency(newPrice)+ " Off";
//               // }
//               discountBadge.innerText = el?.badgeText||"";
//               VOLUME_HEADER_DIV.append(discountBadge);
//               FBT_DIV.append(VOLUME_HEADER_DIV);
//             }
          
//           let FBT_TITLE_DIV = document.createElement("div");
//           FBT_TITLE_DIV.className = "sd-bundle-text-detail";
//             if (el.bundleDetail.discountType === "percent" || el.bundleDetail.discountType === "fixed") {
//               FBT_TITLE_DIV.classList.add("extra-padding");
//             }
//           let FBT_TITLE_TEXT_DIV = document.createElement("h4");
//           FBT_TITLE_TEXT_DIV.style.color = el?.customization?.frequentlyBoughtTogether?.title?.color;
//           FBT_TITLE_TEXT_DIV.style.fontWeight = el?.customization?.frequentlyBoughtTogether?.title?.titleBold;
//           FBT_TITLE_TEXT_DIV.style.fontSize = el?.customization?.frequentlyBoughtTogether?.title?.fontSize+"px";
//           FBT_TITLE_TEXT_DIV.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
//           FBT_TITLE_TEXT_DIV.innerText = el?.title;
//           let FBT_DESCRIPTION_TEXT_DIV = document.createElement("p");
//           FBT_DESCRIPTION_TEXT_DIV.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
//           FBT_DESCRIPTION_TEXT_DIV.style.color = el?.customization?.frequentlyBoughtTogether?.title?.descriptionColor;
//           FBT_DESCRIPTION_TEXT_DIV.style.fontWeight = el?.customization?.frequentlyBoughtTogether?.title?.descriptionBold;
//           FBT_DESCRIPTION_TEXT_DIV.style.fontSize = el?.customization?.frequentlyBoughtTogether?.title?.descriptionFontSize+"px";
//           FBT_DESCRIPTION_TEXT_DIV.innerText = el?.description;

//           FBT_TITLE_DIV.append(FBT_TITLE_TEXT_DIV, FBT_DESCRIPTION_TEXT_DIV)
//           FBT_DIV.append(FBT_TITLE_DIV);
      
//           totalProducts.map((item, index) => {         
//             originalPriceArray.push({price: el.bundleDetail.discountedProductType != 'all_products'  ? item.variants[0].price  : item.variants[0].price/100 ,id: el.bundleDetail.discountedProductType != 'all_products'  ? item.variants[0].id : ('gid://shopify/ProductVariant/' + item.variants[0].id) , selected:true ,quantity:1});
//             let FBT_PRODUCT_DETAILS_DIV = document.createElement("div");
//             FBT_PRODUCT_DETAILS_DIV.className = "sd-bundle-product-detail";
//             FBT_PRODUCT_DETAILS_DIV.style.backgroundColor = el?.customization?.frequentlyBoughtTogether?.productDetails?.productDetailsBox?.backgroundColor;
//             FBT_DIV.append(FBT_PRODUCT_DETAILS_DIV);
              
//             let SINGLE_PRODUCT_DIV = document.createElement("div");
//             SINGLE_PRODUCT_DIV.className = "sd-bundle-product-inner";
//             FBT_PRODUCT_DETAILS_DIV.append(SINGLE_PRODUCT_DIV);  
      
//            if (index == 0) {
//               let CheckBox_Wrapper_Div = document.createElement("div");
//               CheckBox_Wrapper_Div.className = "checkbox-wrapper-18";
//               SINGLE_PRODUCT_DIV.append(CheckBox_Wrapper_Div);
              
//               let FBT_PRODUCT_CHECKBOX_DIV = document.createElement("div");
//               FBT_PRODUCT_CHECKBOX_DIV.className = "round";
//               CheckBox_Wrapper_Div.append(FBT_PRODUCT_CHECKBOX_DIV);
              
//               let FBT_PRODUCT_CHECKBOX = document.createElement("input");
//               FBT_PRODUCT_CHECKBOX.setAttribute("type", "checkbox");
//               FBT_PRODUCT_CHECKBOX.setAttribute("checked", true);
//               FBT_PRODUCT_CHECKBOX.className = "sd-bundle-fbt-product-checkbox-input";
//               FBT_PRODUCT_CHECKBOX.id = `FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`;
              
//               let FBT_PRODUCT_CHECKBOX_LABEL = document.createElement("label");
//               FBT_PRODUCT_CHECKBOX_LABEL.setAttribute("for", `FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`);
//               FBT_PRODUCT_CHECKBOX_LABEL.id = `FBT_PRODUCT_CHECKBOX_LABEL${bundleIndex}${index}`;
              
//               FBT_PRODUCT_CHECKBOX_DIV.append(FBT_PRODUCT_CHECKBOX, FBT_PRODUCT_CHECKBOX_LABEL);
              
//               FBT_PRODUCT_CHECKBOX.addEventListener('change', (e) => {   
//                   e.preventDefault();
                  
//                   let PopUpMessageDiv = document.createElement("div");
//                   PopUpMessageDiv.id = `PopUpMessageDiv${bundleIndex}${index}`;
//                   PopUpMessageDiv.className = "sd-bundle-mix-match-checkBox-popup-div";
//                   FBT_PRODUCT_CHECKBOX_DIV.append(PopUpMessageDiv);
                  
//                   let PopupSpan = document.createElement("span");
//                   PopupSpan.className = "sd-bundle-mix-match-checkBox-popup-span";
//                   PopupSpan.innerText = "This product is required and can not be deselected";
//                   PopUpMessageDiv.append(PopupSpan);
                  
//                   setTimeout(() => {
//                       document.getElementById(`PopUpMessageDiv${bundleIndex}${index}`).remove();
//                       FBT_PRODUCT_CHECKBOX.checked = true;
//                   }, 2000);
//               });
//             }

//             if (index != 0) {
//               let CheckBox_Wrapper_Div = document.createElement("div");
//               CheckBox_Wrapper_Div.className = "checkbox-wrapper-18";
//               SINGLE_PRODUCT_DIV.append(CheckBox_Wrapper_Div);
              
//               let FBT_PRODUCT_CHECKBOX_DIV = document.createElement("div");
//               FBT_PRODUCT_CHECKBOX_DIV.className = "round";
//               CheckBox_Wrapper_Div.append(FBT_PRODUCT_CHECKBOX_DIV);
              
//               let FBT_PRODUCT_CHECKBOX = document.createElement("input");
//               FBT_PRODUCT_CHECKBOX.className = "sd-bundle-fbt-product-checkbox-input";
//               FBT_PRODUCT_CHECKBOX.id =`FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`;
//               FBT_PRODUCT_CHECKBOX.setAttribute("type", "checkbox");
//               FBT_PRODUCT_CHECKBOX.setAttribute("checked", "checked");
//               FBT_PRODUCT_CHECKBOX.dataset.bundleindex=bundleIndex;
//               if(totalProducts.length <3){
//               FBT_PRODUCT_CHECKBOX.disabled=true;
//               }
                            
//               FBT_PRODUCT_CHECKBOX.dataset.selectedvariantprice =el.bundleDetail.discountedProductType != 'all_products'  ? item.variants[0].price  : item.variants[0].price/100 ;
//               FBT_PRODUCT_CHECKBOX.dataset.selectedvariantid = item.variants[0].id ;
//               let FBT_PRODUCT_CHECKBOX_LABEL = document.createElement("label");
//               FBT_PRODUCT_CHECKBOX_LABEL.setAttribute("for", `FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`);
//               FBT_PRODUCT_CHECKBOX_LABEL.id = `FBT_PRODUCT_CHECKBOX_LABEL${bundleIndex}${index}`;
//               FBT_PRODUCT_CHECKBOX_DIV.append(FBT_PRODUCT_CHECKBOX, FBT_PRODUCT_CHECKBOX_LABEL);
//               selectedOfferedProductCount += 1
//               document.getElementById(`FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`).addEventListener('change',(e)=>{
//                 if(e.target.checked){
//                   originalPriceArray[index].selected=true;
//                   document.querySelectorAll(`[data-bundleindex="${bundleIndex}"]`).forEach(item=>{
//                     if(item.checked==true && selectedOfferedProductCount == 1){ 
//                       item.disabled=false
//                     }                  
//                   })                                   
//                   selectedOfferedProductCount += 1 ;                     
//                 }else{
//                   originalPriceArray[index].selected=false;                                 
//                   document.querySelectorAll(`[data-bundleindex="${bundleIndex}"]`).forEach(item=>{
//                     if(item.checked==true && selectedOfferedProductCount == 2){ 
//                       item.disabled=true
//                     }                  
//                   })                     
//                   selectedOfferedProductCount -= 1 ;
//                 }
//                 calculateOriginalPrice()
//                 calculateSellingPrice()
//               })
//             }
            
//             let GET_PRODUCT_IMAGE_DIV = document.createElement("div");
//             GET_PRODUCT_IMAGE_DIV.className = "sd-bundle-product-img";    
//             GET_PRODUCT_IMAGE_DIV.style.borderColor = el?.customization?.frequentlyBoughtTogether?.productDetails?.image?.borderColor;
//             GET_PRODUCT_IMAGE_DIV.style.borderRadius = el?.customization?.frequentlyBoughtTogether?.productDetails?.image?.borderRadius+"px";
//             GET_PRODUCT_IMAGE_DIV.id = `GET_PRODUCT_IMAGE_DIV${bundleIndex}${index}`;
//             SINGLE_PRODUCT_DIV.append(GET_PRODUCT_IMAGE_DIV);
      
//             let GET_PRODUCTS_IMAGE = document.createElement("img");
//             GET_PRODUCTS_IMAGE.src = el.bundleDetail.discountedProductType != 'all_products' ? `${item?.images[0]?.originalSrc}` : ('https:' +`${item?.images[0]}`)  ;
//             GET_PRODUCT_IMAGE_DIV.append(GET_PRODUCTS_IMAGE);

//             let GET_PRODUCTS_NAME_PRICE_DIV = document.createElement("div");
//             GET_PRODUCTS_NAME_PRICE_DIV.className = "sd-bundle-product-name";
//             SINGLE_PRODUCT_DIV.append(GET_PRODUCTS_NAME_PRICE_DIV);

//             let GET_PRODUCTS_NAME = document.createElement("h5");
//             GET_PRODUCTS_NAME.style.color = el?.customization?.frequentlyBoughtTogether?.productDetails?.title?.color;
//             GET_PRODUCTS_NAME.style.fontSize = el?.customization?.frequentlyBoughtTogether?.productDetails?.title?.fontSize+"px";
//             GET_PRODUCTS_NAME.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
//             GET_PRODUCTS_NAME.innerText = item.title;
//             GET_PRODUCTS_NAME_PRICE_DIV.append(GET_PRODUCTS_NAME);

//             let GET_PRODUCTS_PRICE = document.createElement("h4");
//             GET_PRODUCTS_PRICE.style.color = el?.customization?.frequentlyBoughtTogether?.productDetails?.price?.color;
//             GET_PRODUCTS_PRICE.style.fontSize = el?.customization?.frequentlyBoughtTogether?.productDetails?.price?.fontSize+"px";
//             GET_PRODUCTS_PRICE.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
//             GET_PRODUCTS_PRICE.id = `productsPriceDiv${bundleIndex}${index}`;       
//             GET_PRODUCTS_PRICE.innerText = el.bundleDetail.discountedProductType != 'all_products'  ? showAmountWithCurrency(item.variants[0].price)  : showAmountWithCurrency(item.variants[0].price/100);
//             GET_PRODUCTS_NAME_PRICE_DIV.append(GET_PRODUCTS_PRICE);
      
//             if (item.variants.length > 1) {
//               const select = document.createElement("select");
//               select.id=`fbtSelect${bundleIndex}${index}` 
//               select.style.backgroundColor = el?.customization?.frequentlyBoughtTogether?.productDetails?.variantSelector?.backgroundColor;
//               select.style.color = el?.customization?.frequentlyBoughtTogether?.productDetails?.variantSelector?.color;
//               select.style.width = el?.customization?.frequentlyBoughtTogether?.productDetails?.variantSelector?.width+"px";
//               select.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
//               item.variants.forEach((optionData) => {
//                 const option = document.createElement("option");
//                 option.value = el.bundleDetail.discountedProductType != 'all_products'  ? optionData.price  : (optionData.price)/100;
//                 option.text = optionData.title;
//                 option.dataset.id= el.bundleDetail.discountedProductType != 'all_products'  ? optionData.id  : ( 'gid://shopify/ProductVariant/'+ optionData.id ); 
//                 select.appendChild(option);
//               });
//               GET_PRODUCTS_NAME_PRICE_DIV.append(select);
//               document.getElementById(`fbtSelect${bundleIndex}${index}`).addEventListener('change',(e)=>{
//                 originalPriceArray[index].price=e.target.value;
//                 originalPriceArray[index].id=e.target.selectedOptions[0].dataset.id;
//                 document.querySelector(`#productsPriceDiv${bundleIndex}${index}`).innerText= showAmountWithCurrency(e.target.value);
//                 if(index != 0) {
//                   document.querySelector(`#FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`).dataset.selectedvariantprice= e.target.value;
//                   document.querySelector(`#FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`).dataset.selectedvariantid=e.target.selectedOptions[0].dataset.id;
//                 }
//                 document.querySelector(`.sd-fbt-mrp-span${bundleIndex}`).innerText=showAmountWithCurrency(parseFloat(calculateOriginalPrice()).toFixed(2))
//                 document.querySelector(`.sd-fbt-sellingPrice-span${bundleIndex}`).innerText=showAmountWithCurrency(parseFloat(calculateSellingPrice()).toFixed(2))
//               })
//             }

//             if(el.bundleDetail.discountedProductType == "specific_product"){
//               if (index < ((el.bundleDetail.mainProducts.length + el.bundleDetail.offeredProducts.length) - 1)) {
//                 let BUNDLE_PLUS_BTN_DIV = document.createElement("div");
//                 BUNDLE_PLUS_BTN_DIV.className = "sd-add-bundle";
//                 BUNDLE_PLUS_BTN_DIV.innerHTML = `<svg viewBox="0 0 18 18" focusable="false" width="18" height="18" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
//                 <path d="M6.98047 17.3842V0.580255H10.3239V17.3842H6.98047ZM0.256392 10.6477V7.30433H17.0604V10.6477H0.256392Z" fill= "#000000"></path>
//                 </svg>`;
//                 FBT_DIV.append(BUNDLE_PLUS_BTN_DIV);
//               } else {
//               }
//             }else{
//               if (index < (4 - 1)) {
//                 let BUNDLE_PLUS_BTN_DIV = document.createElement("div");
//                 BUNDLE_PLUS_BTN_DIV.className = "sd-add-bundle";
//                 BUNDLE_PLUS_BTN_DIV.innerHTML = `<svg viewBox="0 0 18 18" focusable="false" width="18" height="18" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
//                 <path d="M6.98047 17.3842V0.580255H10.3239V17.3842H6.98047ZM0.256392 10.6477V7.30433H17.0604V10.6477H0.256392Z" fill= "#000000"></path>
//                 </svg>`;
//                 FBT_DIV.append(BUNDLE_PLUS_BTN_DIV);
//               } else {
//               }
//             }
//           let GET_PRODUCT_QUANTITY =  document.createElement("div");
//           GET_PRODUCT_QUANTITY.className = "sd-bundle-product-quantity";
//           FBT_PRODUCT_DETAILS_DIV.append(GET_PRODUCT_QUANTITY);

//           let GET_PRODUCT_QUANTITY_TEXT = document.createElement("h6");
//           GET_PRODUCT_QUANTITY_TEXT.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
//           GET_PRODUCT_QUANTITY_TEXT.style.color = el?.customization?.frequentlyBoughtTogether?.productDetails?.quantities?.color;
//           GET_PRODUCT_QUANTITY_TEXT.style.fontSize = el?.customization?.frequentlyBoughtTogether?.productDetails?.quantities?.size+"px";
//           GET_PRODUCT_QUANTITY_TEXT.innerText = `Qty: 1`;
//           GET_PRODUCT_QUANTITY.append(GET_PRODUCT_QUANTITY_TEXT)
//           });
            
//           let FBT_ADDTOCART_TOTAL_DIV = document.createElement("div");
//           FBT_ADDTOCART_TOTAL_DIV.className = "sd-product-bundle-total";
//           FBT_DIV.append(FBT_ADDTOCART_TOTAL_DIV);
      
//           let FBT_TOTAL_DIV = document.createElement("div");
//           FBT_TOTAL_DIV.className = "sd-total-desc";
//           FBT_ADDTOCART_TOTAL_DIV.append(FBT_TOTAL_DIV);

//           let FBT_TOTAL_LABEL = document.createElement("h4");
//           FBT_TOTAL_LABEL.style.color = el?.customization?.frequentlyBoughtTogether?.totalSection?.color;
//           FBT_TOTAL_LABEL.style.fontSize = el?.customization?.frequentlyBoughtTogether?.totalSection?.fontSize+"px";
//           FBT_TOTAL_LABEL.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
//           FBT_TOTAL_LABEL.innerText = "TOTAL ";
//           FBT_TOTAL_DIV.append(FBT_TOTAL_LABEL);

//           if (
//             el.bundleDetail.discountType == "freeShipping" ||
//             el.bundleDetail.discountType == "noDiscount"
//           ) {
//             // no changes
//           } else {
//             let FBT_TOTAL_DESCRIPTION = document.createElement("p");
//             FBT_TOTAL_DESCRIPTION.style.color = el?.customization?.frequentlyBoughtTogether?.totalSection?.discountMessage?.color;
//             FBT_TOTAL_DESCRIPTION.style.fontSize = el?.customization?.frequentlyBoughtTogether?.totalSection?.discountMessage?.size+"px";
//             FBT_TOTAL_DESCRIPTION.innerText = `${el?.translations?.translation?.discountApplied}`
//             FBT_TOTAL_DESCRIPTION.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
//             FBT_TOTAL_DIV.append(FBT_TOTAL_DESCRIPTION);
//           }

//           let Price_Div = document.createElement("div");
//           Price_Div.className = "sd-total-amount";
//           FBT_ADDTOCART_TOTAL_DIV.append(Price_Div);

//           let FBT_MRP_PRICE = document.createElement("h6");
//           FBT_MRP_PRICE.style.color = el?.customization?.frequentlyBoughtTogether?.totalSection?.originalPrice.color;
//           FBT_MRP_PRICE.style.fontSize = el?.customization?.frequentlyBoughtTogether?.totalSection?.originalPrice.size+"px";
//           FBT_MRP_PRICE.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
//           FBT_MRP_PRICE.className = `sd-fbt-mrp-span${bundleIndex}`;

//           let FBT_SELLING_PRICE = document.createElement("h4");
//           FBT_SELLING_PRICE.style.color = el?.customization?.frequentlyBoughtTogether?.totalSection?.finalPrice?.color;
//           FBT_SELLING_PRICE.style.fontSize = el?.customization?.frequentlyBoughtTogether?.totalSection?.finalPrice?.size+"px";
//           FBT_SELLING_PRICE.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
//           FBT_SELLING_PRICE.className = `sd-fbt-sellingPrice-span${bundleIndex}`;
//           Price_Div.append(FBT_SELLING_PRICE);  
//           Price_Div.append(FBT_MRP_PRICE);
          
//           calculateOriginalPrice()  
//           calculateSellingPrice()
//           let ADD_TO_CART_BUTTON_DIV = document.createElement("div");
//           ADD_TO_CART_BUTTON_DIV.className = "sd-bundle-addto-cart";
//           FBT_DIV.append(ADD_TO_CART_BUTTON_DIV);
//           let ADD_TO_CART_BUTTON = document.createElement("button");
//           ADD_TO_CART_BUTTON.style.backgroundColor = el?.customization?.frequentlyBoughtTogether?.button?.backgroundColor;
//           ADD_TO_CART_BUTTON.style.borderColor = el?.customization?.frequentlyBoughtTogether?.button?.borderColor;
//           ADD_TO_CART_BUTTON.style.borderRadius = el?.customization?.frequentlyBoughtTogether?.button?.borderRadius+"px";
//           ADD_TO_CART_BUTTON.style.color = el?.customization?.frequentlyBoughtTogether?.button?.color;
//           ADD_TO_CART_BUTTON.style.fontSize = el?.customization?.frequentlyBoughtTogether?.button?.fontSize+"px";
//           ADD_TO_CART_BUTTON.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
//           ADD_TO_CART_BUTTON.className = `sd-bundle-fbt-add-to-cart-button${bundleIndex}`;
//           ADD_TO_CART_BUTTON.innerHTML = el?.translations?.translation?.addToCartButton;
//           ADD_TO_CART_BUTTON.type = "button";
//           ADD_TO_CART_BUTTON_DIV.append(ADD_TO_CART_BUTTON);    
          
//           ADD_TO_CART_BUTTON.addEventListener("click", (e) => {
//             let count=0;         
//             let addToCartArray=[];
//             let itemsVariantIdArray=[];
//             let copyArray=JSON.parse(JSON.stringify(originalPriceArray))
//             copyArray.map(item=>{
//               if(item.selected){ 
//                 count +=1 ;
//                 delete item.selected ;
//                 delete item.price ;
//                 itemsVariantIdArray.push(item.id);
//                 item.id=item.id.split('/').pop()
//                 addToCartArray.push(item)                      
//               }
//             })
        
//             if(count<2){
//               return ;
//             }
//             let code = JSON.parse(localStorage.getItem("sd_bundle_data"));
//             let discountCodeId = code.discountCreateId ?? "";
          
//             ADD_TO_CART_BUTTON.innerText = "";
//             let btnSpinner = document.createElement("div");
//             btnSpinner.className = "bundleBtnSpinner";
//             ADD_TO_CART_BUTTON.append(btnSpinner);
//             btnSpinner.style.display = "block";         
          
//             let formData = {
//               items: addToCartArray,
//               attributes: { SD_BUNDLE_ID: el._id },
//             };
              
//               fetch(window.Shopify.routes.root + "cart/add.js", {
//                 method: "POST",
//                 headers: {
//                   "Content-Type": "application/json",
//                 },
//                 body: JSON.stringify(formData),
//               })
//               .then((response) => {
//                 return response.json();
//               })
//               .then((response) => {
//                 let errorDiv = document.getElementsByClassName(
//                   "sd-bundle-error-message"
//                 );
//                 errorDiv[0]?.remove();
//                 if (response.status == 422 || response.status == 404) {
//                   ADD_TO_CART_BUTTON.innerText =
//                     el.translations.translation.addToCartButton;
//                   btnSpinner.remove();
//                   let errorMessage = document.createElement("div");
//                   errorMessage.className = "sd-bundle-error-message";
//                   FBT_DIV.append(errorMessage);
//                   errorMessage.innerText = response.description;
//                 } else {
//                   fetch(window.Shopify.routes.root + "cart.js", {
//                     method: "GET",
//                     headers: {
//                       "Content-Type": "application/json",
//                     },
//                   })
//                     .then((response) => {
//                       return response.json();
//                     })
//                     .then((response) => {
//                       if (el.bundleDetail.discountType == "noDiscount") {
//                         fetch(`${server}/api/storefront/getBundleClick`, {
//                           method: "POST",
//                           headers: {
//                             "Content-Type": "application/json",
//                           },
//                           body: JSON.stringify({
//                             shop: Shopify.shop,
//                             bundleId: el._id,
//                           }),
//                         });
//                         let isDiscount =
//                           el.bundleDetail.discountType == "noDiscount"
//                             ? "noDiscount"
//                             : "Fix";
//                         const localData = JSON.parse(
//                           localStorage.getItem("sd_bundle_data")
//                         );

                        
//                         let sd_bundle_data = {
//                           discount_name: el.name,
//                           code: code.code,
//                           bundleId: el._id,
//                           discountType: isDiscount,
//                           variantsId: addToCartArray,
//                           discountCreateId: localData.discountCreateId,
//                           prefixCode: el.settings.discountLabel,
//                         };
//                         var jsonString = JSON.stringify(sd_bundle_data);
//                         localStorage.setItem("sd_bundle_data", jsonString);

//                         btnSpinner.remove();
//                         window.location.assign(`https://${Shopify.shop}/cart`);
//                       } else {
//                         let finalPrice;
//                         switch (el.bundleDetail.discountType) {
//                           case "percent":
//                             let percentagepart = parseFloat(
//                               el.bundleDetail.discountValue
//                             );
//                             let percentage = (originalPrice * percentagepart) / 100;
//                             finalPrice = percentage.toFixed(2);
//                             break;
//                           case "price":
//                             let pricePart = parseFloat(
//                               el.bundleDetail.discountValue
//                             );
//                             result = originalPrice - pricePart;
//                             finalPrice = result.toFixed(2);
//                             break;
//                           case "fixed":
//                             let fixedPart = parseFloat(
//                               el.bundleDetail.discountValue
//                             );
//                             finalPrice = fixedPart.toFixed(2);
//                             break;
//                           default:
//                             break;
//                         }
//                         let isDiscount =
//                           el.bundleDetail.discountType == "noDiscount"
//                             ? "noDiscount"
//                             : "Fix";
//                         let sd_bundle_data = {
//                           discount_name: el.name,
//                           code: `${el.settings.discountLabel}-${code.code}`,
//                           discountType: isDiscount,
//                           discountValue: finalPrice,                        
//                           variantsId: itemsVariantIdArray,
//                           startDate: new Date(),
//                           shop: Shopify.shop,
//                           bundleType: el.bundleDetail.discountType,
//                           totalPrice: originalPrice.toFixed(2),
//                           discountCreateId: discountCodeId,
//                         };
//                         fetch(server + "/api/storefront/createRule", {
//                           method: "POST",
//                           headers: {
//                             "Content-Type": "application/json",
//                           },
//                           body: JSON.stringify(sd_bundle_data),
//                         })
//                           .then((response) => response.json())
//                           .then((data) => {
//                             if (data.status == 200) {
//                               fetch(`${server}/api/storefront/getBundleClick`, {
//                                 method: "POST",
//                                 headers: {
//                                   "Content-Type": "application/json",
//                                 },
//                                 body: JSON.stringify({
//                                   shop: Shopify.shop,
//                                   bundleId: el._id,
//                                 }),
//                               });
//                               ADD_TO_CART_BUTTON.innerText =
//                                 el.translations.translation.addToCartButton;
//                               btnSpinner.remove();

//                               let sd_bundle_data = {
//                                 discount_name: el.name,
//                                 code: code.code,
//                                 bundleId: el._id,
//                                 discountType: isDiscount,
//                                 variantsId: addToCartArray,
//                                 discountCreateId: data.response,
//                                 prefixCode: el.settings.discountLabel,
//                               };
//                               var jsonString = JSON.stringify(sd_bundle_data);
//                               localStorage.setItem("sd_bundle_data", jsonString);
//                               cartDrawer();
//                             }
//                           });
//                       }
//                     })
//                     .catch((error) => {
//                       ADD_TO_CART_BUTTON.innerText =
//                         el.translations.translation.addToCartButton;
//                     });
//                 }
//               })
//               .catch((error) => {
//                 console.error("Error:", error);
//               });
//           });          
//         }
    
//         function execFbtClassic(){
//         let  originalPriceArray=[];
//         let originalPrice ;
//         let sellingPrice ;
//         let selectedOfferedProductCount = 0;
//         let calculateOriginalPrice = () => {
//           total = 0;
//           originalPriceArray.map((item) => {
//             if(item.selected==true){
//               total += parseFloat(item.price);        
//             }
//             });
//           originalPrice=total
//           document.querySelector(`.sd-fbt-mrp-span${bundleIndex}`).innerText=showAmountWithCurrency(total.toFixed(2))
//           return total ; 
//         };  
        
//         function calculateSellingPrice() {
//           let finalPrice = 0;      
//           if(el.bundleDetail.discountType == "percent") {
//             if (el.bundleDetail.discountValue > 100) {
//               finalPrice = 0;
//             } else {
//               finalPrice =
//                 originalPrice -
//               originalPrice * (el.bundleDetail.discountValue / 100);
//             }
//           } else
//           if (el.bundleDetail.discountType == "fixed") {
//             if (parseFloat(el.bundleDetail.discountValue) > originalPrice) {
//               finalPrice = 0;
//             } else {
//               finalPrice = originalPrice - el.bundleDetail.discountValue;
//             }
//           }  else if (
//             el.bundleDetail.discountType == "freeShipping" ||
//             el.bundleDetail.discountType == "noDiscount"
//           ) {
//             finalPrice = originalPrice;
//           }
//           sellingPrice=finalPrice;
//           document.querySelector(`.sd-fbt-sellingPrice-span${bundleIndex}`).innerText=showAmountWithCurrency(finalPrice.toFixed(2))
//           return finalPrice;
//         }
    
//         let FBT_DIV = document.createElement("div");
          
//         FBT_DIV.className = "sd-bundle-main-column";
//         FBT_DIV.style.backgroundColor = el?.customization?.frequentlyBoughtTogether?.box?.backgroundColor;
//         FBT_DIV.style.borderRadius = el?.customization?.frequentlyBoughtTogether?.box?.borderRadius+"px";
//         FBT_DIV.style.borderColor = el?.customization?.frequentlyBoughtTogether?.box?.borderColor;
//         FBT_DIV.id = `FBT_DIV${bundleIndex}`;
//         mainDiv.append(FBT_DIV);

//           if (el.bundleDetail.discountType === "percent" || el.bundleDetail.discountType === "fixed") {
//             let VOLUME_HEADER_DIV = document.createElement("span");
//             VOLUME_HEADER_DIV.className = "sd-badges-part-optional";
//             VOLUME_HEADER_DIV.style.background = el?.customization?.frequentlyBoughtTogether?.optionalBadge?.background;
//             VOLUME_HEADER_DIV.style.color = el?.customization?.frequentlyBoughtTogether?.optionalBadge?.color;
//             VOLUME_HEADER_DIV.style.fontSize = el?.customization?.frequentlyBoughtTogether?.optionalBadge?.fontSize + "px"; 
//             let discountBadge = document.createElement("span");
//             discountBadge.className = "sd-collectionMM-badge";
//             // if (el.bundleDetail.discountType === "percent") {
//             //     discountBadge.innerText = el.bundleDetail.discountValue + "% Off";
//             // } else if (el.bundleDetail.discountType === "fixed") {
//             //     let newPrice = el.bundleDetail.discountValue;
//             //     discountBadge.innerText = showAmountWithCurrency(newPrice) + " Off";
//             // }
//             discountBadge.innerText = el?.badgeText||"";
//             VOLUME_HEADER_DIV.append(discountBadge);
//             FBT_DIV.append(VOLUME_HEADER_DIV);
//           }

//         let FBT_BUNDLE_DETAILS_DIV = document.createElement("div");
       
//         FBT_BUNDLE_DETAILS_DIV.className = "sd-bundle-text-detail";
//           if (el?.bundleDetail?.discountType === "percent" || el?.bundleDetail?.discountType === "fixed") {
//             FBT_BUNDLE_DETAILS_DIV.classList.add("extra-padding");
//           }
//         FBT_DIV.append(FBT_BUNDLE_DETAILS_DIV);

//         let FBT_TITLE_DIV = document.createElement("h4");
//         FBT_TITLE_DIV.style.color = el?.customization?.frequentlyBoughtTogether?.title?.color;
//         FBT_TITLE_DIV.style.fontWeight = el?.customization?.frequentlyBoughtTogether?.title?.titleBold;
//         FBT_TITLE_DIV.style.fontSize = el?.customization?.frequentlyBoughtTogether?.title?.fontSize+"px";
//         FBT_TITLE_DIV.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
//         FBT_TITLE_DIV.innerText = el.title;
//         FBT_BUNDLE_DETAILS_DIV.append(FBT_TITLE_DIV);

//         let FBT_DESCRIPTION_DIV = document.createElement("p");
//         FBT_DESCRIPTION_DIV.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
//         FBT_DESCRIPTION_DIV.style.color = el?.customization?.frequentlyBoughtTogether?.title?.descriptionColor;
//         FBT_DESCRIPTION_DIV.style.fontWeight = el?.customization?.frequentlyBoughtTogether?.title?.descriptionBold;
//         FBT_DESCRIPTION_DIV.style.fontSize = el?.customization?.frequentlyBoughtTogether?.title?.descriptionFontSize+"px";
//         FBT_DESCRIPTION_DIV.innerText = el.description;
//         FBT_BUNDLE_DETAILS_DIV.append(FBT_DESCRIPTION_DIV);
          
//         let FBT_PRODUCTS_IMAGE_DIV = document.createElement("div");
//         FBT_PRODUCTS_IMAGE_DIV.className = "sd-show-selected-product-item";
//         FBT_BUNDLE_DETAILS_DIV.append(FBT_PRODUCTS_IMAGE_DIV);

//         totalProducts.map((item, index) => {         
//           originalPriceArray.push({price: el.bundleDetail.discountedProductType != 'all_products'  ? item.variants[0].price  : item.variants[0].price/100 ,id: el.bundleDetail.discountedProductType != 'all_products'  ? item.variants[0].id : ('gid://shopify/ProductVariant/' + item.variants[0].id) , selected:true ,quantity:1});
//           let GET_PRODUCT_IMAGE_DIV = document.createElement("div");
//           GET_PRODUCT_IMAGE_DIV.className = "sd-bundle-product-img";    
//           GET_PRODUCT_IMAGE_DIV.style.borderColor = el?.customization?.frequentlyBoughtTogether?.productDetails?.image?.borderColor;
//           GET_PRODUCT_IMAGE_DIV.style.borderRadius = el?.customization?.frequentlyBoughtTogether?.productDetails?.image?.borderRadius+"px";
//           GET_PRODUCT_IMAGE_DIV.className = "sd-selected-product-itemImg";       
//           GET_PRODUCT_IMAGE_DIV.id = `GET_PRODUCT_IMAGE_DIV${bundleIndex}${index}`;
//           FBT_PRODUCTS_IMAGE_DIV.append(GET_PRODUCT_IMAGE_DIV);

//           let GET_PRODUCTS_IMAGE = document.createElement("img");
//           GET_PRODUCTS_IMAGE.className = "sd-bundle-fbt-imageThumbnails";
//           GET_PRODUCTS_IMAGE.src = el.bundleDetail.discountedProductType != 'all_products' ? `${item?.images[0]?.originalSrc}` : ('https:' +`${item?.images[0]}`);
//           GET_PRODUCT_IMAGE_DIV.append(GET_PRODUCTS_IMAGE);

//           if (index < totalProducts.length - 1) {
//             let BUNDLE_PLUS_BTN_DIV = document.createElement("div");
//             BUNDLE_PLUS_BTN_DIV.className = "plus-selectedIcon";
//             BUNDLE_PLUS_BTN_DIV.innerHTML = `<svg viewBox="0 0 18 18" focusable="false" width="18" height="18" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
//             <path d="M6.98047 17.3842V0.580255H10.3239V17.3842H6.98047ZM0.256392 10.6477V7.30433H17.0604V10.6477H0.256392Z" fill= ${el?.customization?.frequentlyBoughtTogether?.productDetails?.plusColor}></path>
//             </svg>`;
//             FBT_PRODUCTS_IMAGE_DIV.append(BUNDLE_PLUS_BTN_DIV);
//           }  

//           let SINGLE_PRODUCT_DIV_CONTAINER=document.createElement("div");
//           SINGLE_PRODUCT_DIV_CONTAINER.className = "sd-bundle-product-detail";
//           SINGLE_PRODUCT_DIV_CONTAINER.style.backgroundColor = el?.customization?.frequentlyBoughtTogether?.productDetails?.productDetailsBox?.backgroundColor;
//           FBT_DIV.append(SINGLE_PRODUCT_DIV_CONTAINER);

//           let SINGLE_PRODUCT_DIV = document.createElement("div");
//           SINGLE_PRODUCT_DIV.className = "sd-bundle-product-inner";
//           SINGLE_PRODUCT_DIV_CONTAINER.append(SINGLE_PRODUCT_DIV);

//           if (index == 0) {
//             let FBT_PRODUCT_CHECKBOX_DIV=document.createElement("div");
//             FBT_PRODUCT_CHECKBOX_DIV.className='checkbox-wrapper-18';
//             SINGLE_PRODUCT_DIV.append(FBT_PRODUCT_CHECKBOX_DIV);
            
//             let InnerDivFBTClassic = document.createElement("div");
//             InnerDivFBTClassic.className = 'round';
//             FBT_PRODUCT_CHECKBOX_DIV.append(InnerDivFBTClassic);
            
//             let FBT_PRODUCT_CHECKBOX = document.createElement("input");
//             FBT_PRODUCT_CHECKBOX.setAttribute("type", "checkbox");
//             FBT_PRODUCT_CHECKBOX.setAttribute("checked", "checked");
//             FBT_PRODUCT_CHECKBOX.id =`FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`;

//             let FBT_PRODUCT_CHECKBOX_LABEL = document.createElement("label");
//             FBT_PRODUCT_CHECKBOX_LABEL.setAttribute("for", `FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`);
//             FBT_PRODUCT_CHECKBOX_LABEL.id = `FBT_PRODUCT_CHECKBOX_LABEL${bundleIndex}${index}`;
//             InnerDivFBTClassic.append(FBT_PRODUCT_CHECKBOX, FBT_PRODUCT_CHECKBOX_LABEL);
             
//             document.getElementById(`FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`).addEventListener('click',(e)=>{   
//               e.preventDefault();        
//               let PopUpMessageDiv = document.createElement("div");
//               PopUpMessageDiv.id = `PopUpMessageDiv${bundleIndex}${index}`;
//               PopUpMessageDiv.className = "sd-bundle-mix-match-checkBox-popup-div";
//               InnerDivFBTClassic.append(PopUpMessageDiv);
//               let PopupSpan = document.createElement("span");
//               PopupSpan.className = "sd-bundle-mix-match-checkBox-popup-span";
//               PopupSpan.innerText = "This product is required and can not be deselected";
//               PopUpMessageDiv.append(PopupSpan);
//               setTimeout(()=>{
//                 document.getElementById(`PopUpMessageDiv${bundleIndex}${index}`).remove();
//               },2000);  
//             }) 
//           }
//           if (index != 0) {

//             let FBT_PRODUCT_CHECKBOX_DIV=document.createElement("div");
//             FBT_PRODUCT_CHECKBOX_DIV.className='checkbox-wrapper-18';
//             SINGLE_PRODUCT_DIV.append(FBT_PRODUCT_CHECKBOX_DIV);
            
//             let InnerDivFBTClassic = document.createElement("div");
//             InnerDivFBTClassic.className = 'round';
//             FBT_PRODUCT_CHECKBOX_DIV.append(InnerDivFBTClassic);
            
//             let FBT_PRODUCT_CHECKBOX = document.createElement("input");
//             FBT_PRODUCT_CHECKBOX.className = "sd-bundle-fbt-product-checkbox-input";
//             FBT_PRODUCT_CHECKBOX.id =`FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`;
//             FBT_PRODUCT_CHECKBOX.setAttribute("type", "checkbox");
//             FBT_PRODUCT_CHECKBOX.setAttribute("checked", "checked");
//             FBT_PRODUCT_CHECKBOX.dataset.bundleindex=bundleIndex;
            
//             if(totalProducts.length <3){
//             FBT_PRODUCT_CHECKBOX.disabled=true;
//             }
//             FBT_PRODUCT_CHECKBOX.dataset.selectedvariantprice =el.bundleDetail.discountedProductType != 'all_products'  ? item.variants[0].price  : item.variants[0].price/100 ;
//             FBT_PRODUCT_CHECKBOX.dataset.selectedvariantid = item.variants[0].id ;
            
//             let FBT_PRODUCT_CHECKBOX_LABEL = document.createElement("label");
//             FBT_PRODUCT_CHECKBOX_LABEL.setAttribute("for", `FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`);
//             FBT_PRODUCT_CHECKBOX_LABEL.id = `FBT_PRODUCT_CHECKBOX_LABEL${bundleIndex}${index}`;
//             InnerDivFBTClassic.append(FBT_PRODUCT_CHECKBOX, FBT_PRODUCT_CHECKBOX_LABEL);
            
//             selectedOfferedProductCount += 1
//             document.getElementById(`FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`).addEventListener('change',(e)=>{
//               if(e.target.checked){
//                 originalPriceArray[index].selected=true;
//                 document.querySelectorAll(`[data-bundleindex="${bundleIndex}"]`).forEach(item=>{
//                   if(item.checked==true && selectedOfferedProductCount == 1){ 
//                     item.disabled=false
//                   }
//                 })
//                 selectedOfferedProductCount += 1 ;
//               }else{
//                 originalPriceArray[index].selected=false;                                 
//                 document.querySelectorAll(`[data-bundleindex="${bundleIndex}"]`).forEach(item=>{
//                   if(item.checked==true && selectedOfferedProductCount == 2){ 
//                     item.disabled=true
//                   }                  
//                 })                     
//                 selectedOfferedProductCount -= 1 ;
//               }
//               calculateOriginalPrice()
//               calculateSellingPrice()
//             })
//           }
          
//           let GET_PRODUCTS_NAME_PRICE_DIV = document.createElement("div");
//           GET_PRODUCTS_NAME_PRICE_DIV.className = "sd-bundle-product-name";
//           SINGLE_PRODUCT_DIV.append(GET_PRODUCTS_NAME_PRICE_DIV);
      
//           let GET_PRODUCTS_NAME = document.createElement("h5");
//           GET_PRODUCTS_NAME.style.color = el?.customization?.frequentlyBoughtTogether?.productDetails?.title?.color;
//           GET_PRODUCTS_NAME.style.fontSize = el?.customization?.frequentlyBoughtTogether?.productDetails?.title?.fontSize+"px";
//           GET_PRODUCTS_NAME.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
//           GET_PRODUCTS_NAME.innerText = item.title;
//           GET_PRODUCTS_NAME_PRICE_DIV.append(GET_PRODUCTS_NAME);

//           let GET_PRODUCTS_PRICE = document.createElement("h4");
//           GET_PRODUCTS_PRICE.style.color = el?.customization?.frequentlyBoughtTogether?.productDetails?.price?.color;
//           GET_PRODUCTS_PRICE.style.fontSize = el?.customization?.frequentlyBoughtTogether?.productDetails?.price.fontSize+"px";
//           GET_PRODUCTS_PRICE.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
//           GET_PRODUCTS_PRICE.id = `productsPriceDiv${bundleIndex}${index}`;       
//           GET_PRODUCTS_PRICE.innerText = el.bundleDetail.discountedProductType != 'all_products'  ? showAmountWithCurrency(item.variants[0].price)  : showAmountWithCurrency(item.variants[0].price/100);
//           GET_PRODUCTS_NAME_PRICE_DIV.append(GET_PRODUCTS_PRICE);

//           if (item.variants.length > 1) {
//             const select = document.createElement("select");
//             select.id=`fbtSelect${bundleIndex}${index}` 
//             select.style.backgroundColor = el?.customization?.frequentlyBoughtTogether?.productDetails?.variantSelector?.backgroundColor;
//             select.style.color = el?.customization?.frequentlyBoughtTogether?.productDetails?.variantSelector?.color;
//             select.style.width = el?.customization?.frequentlyBoughtTogether?.productDetails?.variantSelector?.width+"px";
//             select.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
//             item.variants.forEach((optionData) => {
//               const option = document.createElement("option");
//               option.value = el.bundleDetail.discountedProductType != 'all_products'  ? optionData.price  : (optionData.price)/100;
//               option.text = optionData.title;
//               option.dataset.id= el.bundleDetail.discountedProductType != 'all_products'  ? optionData.id  : ( 'gid://shopify/ProductVariant/'+ optionData.id ); 
//               select.appendChild(option);
//             });
    
//             GET_PRODUCTS_NAME_PRICE_DIV.append(select);
//             document.getElementById(`fbtSelect${bundleIndex}${index}`).addEventListener('change',(e)=>{
//               originalPriceArray[index].price=e.target.value;
//               originalPriceArray[index].id=e.target.selectedOptions[0].dataset.id;
//               document.querySelector(`#productsPriceDiv${bundleIndex}${index}`).innerText= showAmountWithCurrency(e.target.value);
//                 if(index != 0) {
//                   document.querySelector(`#FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`).dataset.selectedvariantprice= e.target.value;
//                   document.querySelector(`#FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`).dataset.selectedvariantid=e.target.selectedOptions[0].dataset.id;
//                 }
//               document.querySelector(`.sd-fbt-mrp-span${bundleIndex}`).innerText=showAmountWithCurrency(parseFloat(calculateOriginalPrice()).toFixed(2))
//               document.querySelector(`.sd-fbt-sellingPrice-span${bundleIndex}`).innerText=showAmountWithCurrency(parseFloat(calculateSellingPrice()).toFixed(2))
//             })
//           }

//           let GET_PRODUCT_QUANTITY =  document.createElement("div");
//           GET_PRODUCT_QUANTITY.className = "sd-bundle-product-quantity";
//           SINGLE_PRODUCT_DIV_CONTAINER.append(GET_PRODUCT_QUANTITY);

//           let GET_PRODUCT_QUANTITY_TEXT = document.createElement("h6");
//           GET_PRODUCT_QUANTITY_TEXT.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
//           GET_PRODUCT_QUANTITY_TEXT.style.color = el?.customization?.frequentlyBoughtTogether?.productDetails?.quantities?.color;
//           GET_PRODUCT_QUANTITY_TEXT.style.fontSize = el?.customization?.frequentlyBoughtTogether?.productDetails?.quantities?.size+"px";
//           GET_PRODUCT_QUANTITY_TEXT.innerText = `Qty: 1`;
//           GET_PRODUCT_QUANTITY.append(GET_PRODUCT_QUANTITY_TEXT)

//           if (index < totalProducts.length - 1) {
//             let BUNDLE_PLUS_BTN_DIV = document.createElement("div");
//             BUNDLE_PLUS_BTN_DIV.className = "sd-add-bundle";
//             BUNDLE_PLUS_BTN_DIV.innerHTML = `<svg viewBox="0 0 18 18" focusable="false" width="18" height="18" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
//             <path d="M6.98047 17.3842V0.580255H10.3239V17.3842H6.98047ZM0.256392 10.6477V7.30433H17.0604V10.6477H0.256392Z" fill= ${el?.customization?.frequentlyBoughtTogether?.productDetails?.plusColor}></path>
//             </svg>`;
//             FBT_DIV.append(BUNDLE_PLUS_BTN_DIV);
//           }
//         });      
       
//         let FBT_TOTAL_DIV = document.createElement("div");
//         FBT_TOTAL_DIV.className = "sd-product-bundle-total";
//         FBT_DIV.append(FBT_TOTAL_DIV);

//         let Total_Description_Div = document.createElement("div");
//         Total_Description_Div.className = "sd-total-desc";
//         FBT_TOTAL_DIV.append(Total_Description_Div);

//         let FBT_TOTAL_LABEL = document.createElement("h4");
//         FBT_TOTAL_LABEL.style.color = el?.customization?.frequentlyBoughtTogether?.totalSection?.color;
//         FBT_TOTAL_LABEL.style.fontSize = el?.customization?.frequentlyBoughtTogether?.totalSection?.fontSize+"px";
//         FBT_TOTAL_LABEL.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
//         FBT_TOTAL_LABEL.innerText = "TOTAL ";
//         Total_Description_Div.append(FBT_TOTAL_LABEL);

//         if (
//         el.bundleDetail.discountType == "freeShipping" ||
//         el.bundleDetail.discountType == "noDiscount"
//         ) {
//             // no changes
//         } else {
//           let FBT_DESCRIPTION = document.createElement("p");
//           FBT_DESCRIPTION.style.color = el?.customization?.frequentlyBoughtTogether?.totalSection?.discountMessage?.color;
//           FBT_DESCRIPTION.style.fontSize = el?.customization?.frequentlyBoughtTogether?.totalSection?.discountMessage?.size+"px";
//           FBT_DESCRIPTION.innerText = `${el?.translations?.translation?.discountApplied}`
//           FBT_DESCRIPTION.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
//           Total_Description_Div.append(FBT_DESCRIPTION);
//         }

//         let AMOUNT_DIV = document.createElement("div");
//         AMOUNT_DIV.className = "sd-total-amount";
//         FBT_TOTAL_DIV.append(AMOUNT_DIV);

//         let FBT_SELLING_PRICE = document.createElement("h4");
//         FBT_SELLING_PRICE.style.color = el?.customization?.frequentlyBoughtTogether?.totalSection?.finalPrice?.color;
//         FBT_SELLING_PRICE.style.fontSize = el?.customization?.frequentlyBoughtTogether?.totalSection?.finalPrice?.size+"px";
//         FBT_SELLING_PRICE.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
//         FBT_SELLING_PRICE.className = `sd-fbt-sellingPrice-span${bundleIndex}`;
//         AMOUNT_DIV.append(FBT_SELLING_PRICE);
          
//         let FBT_MRP_PRICE = document.createElement("h6");
//         FBT_MRP_PRICE.style.color = el?.customization?.frequentlyBoughtTogether?.totalSection?.originalPrice.color;
//         FBT_MRP_PRICE.style.fontSize = el?.customization?.frequentlyBoughtTogether?.totalSection?.originalPrice.size+"px";
//         FBT_MRP_PRICE.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
//         FBT_MRP_PRICE.className = `sd-fbt-mrp-span${bundleIndex}`;
//         AMOUNT_DIV.append(FBT_MRP_PRICE);
        
//         calculateOriginalPrice()  
//         calculateSellingPrice()

//         let FBT_ADDTOCART_TOTAL_DIV = document.createElement("div");
//         FBT_ADDTOCART_TOTAL_DIV.className = "sd-bundle-addto-cart";
//         FBT_DIV.append(FBT_ADDTOCART_TOTAL_DIV);
        
//         let ADD_TO_CART_BUTTON = document.createElement("button");
//         ADD_TO_CART_BUTTON.style.backgroundColor = el?.customization?.frequentlyBoughtTogether?.butto?.backgroundColor;
//         ADD_TO_CART_BUTTON.style.borderColor = el?.customization?.frequentlyBoughtTogether?.button?.borderColor;
//         ADD_TO_CART_BUTTON.style.borderRadius = el?.customization?.frequentlyBoughtTogether?.button?.borderRadius+"px";
//         ADD_TO_CART_BUTTON.style.color = el?.customization?.frequentlyBoughtTogether?.button?.color;
//         ADD_TO_CART_BUTTON.style.fontSize = el?.customization?.frequentlyBoughtTogether?.button?.fontSize+"px";
//         ADD_TO_CART_BUTTON.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
//         ADD_TO_CART_BUTTON.className = `sd-bundle-fbt-add-to-cart-classic-button sd-bundle-fbt-add-to-cart-button${bundleIndex} `;
//         ADD_TO_CART_BUTTON.innerHTML = el?.translations?.translation?.addToCartButton;
//         ADD_TO_CART_BUTTON.type = "button";
//         FBT_ADDTOCART_TOTAL_DIV.append(ADD_TO_CART_BUTTON);    
        
//         ADD_TO_CART_BUTTON.addEventListener("click", (e) => {
//           let count=0;         
//           let addToCartArray=[];
//           let itemsVariantIdArray=[];
//           let copyArray=JSON.parse(JSON.stringify(originalPriceArray))
//           copyArray.map(item=>{
//             if(item.selected){ 
//               count +=1 ;
//               delete item.selected ;
//               delete item.price ;
//               itemsVariantIdArray.push(item.id);
//               item.id=item.id.split('/').pop()
//               addToCartArray.push(item)                      
//             }
//           })
      
//           if(count<2){
//             return ;
//           }

//           let code = JSON.parse(localStorage.getItem("sd_bundle_data"));
//           let discountCodeId = code.discountCreateId ?? "";
        
//           ADD_TO_CART_BUTTON.innerText = "";
//           let btnSpinner = document.createElement("div");
//           btnSpinner.className = "bundleBtnSpinner";
//           ADD_TO_CART_BUTTON.append(btnSpinner);
//           btnSpinner.style.display = "block";         
//           let formData = {
//             items: addToCartArray,
//             attributes: { SD_BUNDLE_ID: el._id },
//           };
            
//           fetch(window.Shopify.routes.root + "cart/add.js", {
//             method: "POST",
//             headers: {
//               "Content-Type": "application/json",
//             },
//             body: JSON.stringify(formData),
//           })
//           .then((response) => {
//             return response.json();
//           })
//           .then((response) => {
//             let errorDiv = document.getElementsByClassName(
//               "sd-bundle-error-message"
//             );
//             errorDiv[0]?.remove();
//             if (response.status == 422 || response.status == 404) {
//               ADD_TO_CART_BUTTON.innerText =
//                 el.translations.translation.addToCartButton;
//               btnSpinner.remove();
//               let errorMessage = document.createElement("div");
//               errorMessage.className = "sd-bundle-error-message";
//               FBT_DIV.append(errorMessage);
//               errorMessage.innerText = response.description;
//             } else {
//               fetch(window.Shopify.routes.root + "cart.js", {
//                 method: "GET",
//                 headers: {
//                   "Content-Type": "application/json",
//                 },
//               })
//                 .then((response) => {
//                   return response.json();
//                 })
//                 .then((response) => {
//                   if (el.bundleDetail.discountType == "noDiscount") {
//                     fetch(`${server}/api/storefront/getBundleClick`, {
//                       method: "POST",
//                       headers: {
//                         "Content-Type": "application/json",
//                       },
//                       body: JSON.stringify({
//                         shop: Shopify.shop,
//                         bundleId: el._id,
//                       }),
//                     });
//                     let isDiscount =
//                       el.bundleDetail.discountType == "noDiscount"
//                         ? "noDiscount"
//                         : "Fix";
//                     const localData = JSON.parse(
//                       localStorage.getItem("sd_bundle_data")
//                     );

//                     let sd_bundle_data = {
//                       discount_name: el.name,
//                       code: code.code,
//                       bundleId: el._id,
//                       discountType: isDiscount,
//                       variantsId: addToCartArray,
//                       discountCreateId: localData.discountCreateId,
//                       prefixCode: el.settings.discountLabel,
//                     };
//                     var jsonString = JSON.stringify(sd_bundle_data);
//                     localStorage.setItem("sd_bundle_data", jsonString);

//                     btnSpinner.remove();
//                     window.location.assign(`https://${Shopify.shop}/cart`);
//                   } else {
//                     let finalPrice;
//                     switch (el.bundleDetail.discountType) {
//                       case "percent":
//                         let percentagepart = parseFloat(
//                           el.bundleDetail.discountValue
//                         );
//                         let percentage = (originalPrice * percentagepart) / 100;
//                         finalPrice = percentage.toFixed(2);
//                         break;
//                       case "price":
//                         let pricePart = parseFloat(
//                           el.bundleDetail.discountValue
//                         );
//                         result = originalPrice - pricePart;
//                         finalPrice = result.toFixed(2);
//                         break;
//                       case "fixed":
//                         let fixedPart = parseFloat(
//                           el.bundleDetail.discountValue
//                         );
//                         finalPrice = fixedPart.toFixed(2);
//                         break;
//                       default:
//                         break;
//                     }
//                     let isDiscount =
//                       el.bundleDetail.discountType == "noDiscount"
//                         ? "noDiscount"
//                         : "Fix";
//                     let sd_bundle_data = {
//                       discount_name: el.name,
//                       code: `${el.settings.discountLabel}-${code.code}`,
//                       discountType: isDiscount,
//                       discountValue: finalPrice,                        
//                       variantsId: itemsVariantIdArray,
//                       // startDate: el.startdate,
//                       startDate: new Date(),
//                       // endDate: el.endDate,
//                       shop: Shopify.shop,
//                       bundleType: el.bundleDetail.discountType,
//                       totalPrice: originalPrice.toFixed(2),
//                       discountCreateId: discountCodeId,
//                     };
//                     fetch(server + "/api/storefront/createRule", {
//                       method: "POST",
//                       headers: {
//                         "Content-Type": "application/json",
//                       },
//                       body: JSON.stringify(sd_bundle_data),
//                     })
//                       .then((response) => response.json())
//                       .then((data) => {
//                         if (data.status == 200) {
//                           fetch(`${server}/api/storefront/getBundleClick`, {
//                             method: "POST",
//                             headers: {
//                               "Content-Type": "application/json",
//                             },
//                             body: JSON.stringify({
//                               shop: Shopify.shop,
//                               bundleId: el._id,
//                             }),
//                           });
//                           ADD_TO_CART_BUTTON.innerText =
//                             el.translations.translation.addToCartButton;
//                           btnSpinner.remove();

//                           let sd_bundle_data = {
//                             discount_name: el.name,
//                             code: code.code,
//                             bundleId: el._id,
//                             discountType: isDiscount,
//                             variantsId: addToCartArray,
//                             discountCreateId: data.response,
//                             prefixCode: el.settings.discountLabel,
//                           };
//                           var jsonString = JSON.stringify(sd_bundle_data);
//                           localStorage.setItem("sd_bundle_data", jsonString);
//                           cartDrawer();
//                         }
//                       });
//                   }
//                 })
//                 .catch((error) => {
//                   ADD_TO_CART_BUTTON.innerText =
//                     el.translations.translation.addToCartButton;
//                 });
//             }
//           })
//           .catch((error) => {
//             console.error("Error:", error);
//           });
//         });          
//         }
  
//         if(el.bundleDetail.discountedProductType=='all_products'){
//           fetch(window.Shopify.routes.root + `recommendations/products.json?product_id=${sdBundleProductId}&limit=15&intent=related`)
//             .then(response => response.json())
//             .then(({ products }) => {
//               if (products.length > 0) {
//             let suggestedProducts=getRandomItems(products,3);
//                 // console.log("suggestedproducts",sdProductJson)
//                 totalProducts=[sdProductJson,...suggestedProducts]
//                 el?.customization?.frequentlyBoughtTogether?.design =='modern' ?  execFbtModern() : execFbtClassic() ;      
//               }    
//             }
//           );
//         }
         
//         if(el.bundleDetail.discountedProductType !='all_products'){
//           totalProducts = [
//             ...el.bundleDetail.mainProducts,
//             ...el.bundleDetail.offeredProducts,
//           ];
//           el?.customization?.frequentlyBoughtTogether?.design =='modern'?  execFbtModern() : execFbtClassic() ;  
//         }
//       }
//     }
//     else if (el.type == "productMixMatch") {
//       if(el.plans.plan != "free"){
//         let OriginalPrice = 0;
//         let FinalPrice = 0;
//         let PriceArray = [];
//         let SelectedProducts = [];
//         let SelectedProductsQuantity = 0;
//         let DiscountType;
//         let DiscountValue;
//         // console.log("product mixmatch...............",el)
//         let VariantDropDownFun = (productIndex,elements,VariantOptionDiv,TotalQuantity) => {
//             let SelectVariants = document.createElement("SELECT");
//             SelectVariants.id = `SelectVariants${bundleIndex}${productIndex}${TotalQuantity}`;
//             SelectVariants.style.background = el?.customization?.productMixMatch?.productDetails?.variantSelector?.backgroundColor;
//             SelectVariants.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
//             SelectVariants.style.color = el?.customization?.productMixMatch?.productDetails?.variantSelector?.color;
//             SelectVariants.style.width = el?.customization?.productMixMatch?.productDetails?.variantSelector?.width + "px";
//             SelectVariants.addEventListener("change",VariantOptionFun=(e)=>{
//               let SelectedVariantsId = document.querySelector(`#SelectVariants${bundleIndex}${productIndex}${TotalQuantity}`).value;
//               let SelectVariantPrice = document.getElementById([`variants${TotalQuantity}${bundleIndex}${SelectedVariantsId}`]).getAttribute("price");
//               let variantsIndex = document.getElementById([`variants${TotalQuantity}${bundleIndex}${SelectedVariantsId}`]).getAttribute("variantsId");
//               let indexOfPrice = PriceArray.findIndex((checkProduct)=>checkProduct.productQuantity === `${elements.title}${productIndex}Q${TotalQuantity}`);
//               let indexOfProduct;
//               elements.variants.map((variants,variantIndex)=>{
//                 SelectedProducts.map((item,itemIndex)=>{
//                   item.map((itemProducts,indexOfItemProduct)=>{
//                     if(variants.id == itemProducts){
//                       indexOfProduct = SelectedProducts.findIndex((checkPrducts)=> checkPrducts[indexOfItemProduct] == variants.id)
//                     }
//                   })
//                 })
//               }) 
//               if(PriceArray[indexOfPrice].productName === `Copy${elements.title}${productIndex}`){
//                 PriceArray.splice(indexOfPrice,1,{productName:`Copy${elements.title}${productIndex}`,productQuantity:`${elements.title}${productIndex}Q${TotalQuantity}`,price:SelectVariantPrice});
//               }else{
//                 PriceArray.splice(indexOfPrice,1,{productName:`${elements.title}${productIndex}`,productQuantity:`${elements.title}${productIndex}Q${TotalQuantity}`,price:SelectVariantPrice});
//               }
//               SelectedProducts[indexOfProduct].splice(variantsIndex,1,SelectedVariantsId);
//               calaculateOriginalPrice();
//               calculateFinalPriceFunction();
//               document.getElementById(`ProductPrice${bundleIndex}${productIndex}`).innerText = showAmountWithCurrency(SelectVariantPrice);
//               document.getElementById(`${bundleIndex}OriginalPrice`).innerText = showAmountWithCurrency(OriginalPrice.toFixed(2));
//               document.getElementById(`${bundleIndex}FInalPrice`).innerText = showAmountWithCurrency(FinalPrice.toFixed(2));
//             })
//           if(elements.variants.length > 1){elements.variants.map((items,index)=>{
//               let VariantOptions = document.createElement("option");
//               VariantOptions.value = `${items.id}`;
//               VariantOptions.text =`${items.title}`;
//               VariantOptions.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
//               VariantOptions.setAttribute("variantsId",TotalQuantity-1);
//               VariantOptions.id = `variants${TotalQuantity}${bundleIndex}${items.id}`;
//               VariantOptions.setAttribute("price",items.price);
//               SelectVariants.add(VariantOptions);
//               VariantOptionDiv.appendChild(SelectVariants);
//             })}
//           }

//         let calaculateOriginalPrice = ()  =>{
//           OriginalPrice = 0;
//           PriceArray.map((item)=>{
//             OriginalPrice += parseFloat(item.price);
//             return OriginalPrice.toFixed(2);
//           })
//         }

//         let ActiveAppliedDiscount = (index) =>{
//           let ActiveBadge = document.getElementById(`DiscountBadge${bundleIndex}${index}`)
//           let addToCartBTN = document.getElementById(`sd-bundle-add-to-cart-buttonID${bundleIndex}`);
//           if(ActiveBadge !== null){
//             ActiveBadge.setAttribute("class","active");
//             addToCartBTN.disabled = false;
//             addToCartBTN.style.cursor = "pointer";
//             addToCartBTN.style.background = `${el?.customization?.productMixMatch?.button?.backgroundColor}`
//             if(ActiveBadge.previousSibling !== null){
//               ActiveBadge.previousSibling.setAttribute("class","")
//             }
//             if(ActiveBadge.nextSibling !== null){
//               ActiveBadge.nextSibling.setAttribute("class","")
//             }
//           }
//         }

//         let DeactivateDiscount = (index) => {
//           let ActiveBadge = document.getElementById(`DiscountBadge${bundleIndex}${index}`);
//           let addToCartBTN = document.getElementById(`sd-bundle-add-to-cart-buttonID${bundleIndex}`);
//           if(ActiveBadge !== null){
//             ActiveBadge.setAttribute("class","");
//             addToCartBTN.disabled = true
//             addToCartBTN.style.cursor = "not-allowed";
//             addToCartBTN.style.background = "grey";
//             if(ActiveBadge.previousSibling !== null) {
//               ActiveBadge.previousSibling.setAttribute("class","")
//             }
//             if(ActiveBadge.nextSibling !== null){
//               ActiveBadge.nextSibling.setAttribute("class","")
//             }
//           }
//         }
        
//         let calculateFinalPriceFunction = () =>{
//           el.bundleDetail.discountOptions.map((item,index)=>{
//             if(SelectedProductsQuantity < el.bundleDetail.discountOptions[0].quantity ){
//               DeactivateDiscount(index);
//               let appliedDiscount = document.getElementById(`${bundleIndex}discountOffer`);
//               let PriceDiv = document.getElementById(`${bundleIndex}OriginalPrice`);
//               if(appliedDiscount !==null && PriceDiv !== null){
//                 let selectedItemMsg = el?.translations?.translation?.selectAtLeastItemsToApplyTheDiscount.replace('{{item}}', `${el.bundleDetail.discountOptions[0].quantity}`);
//                 appliedDiscount.innerText = selectedItemMsg;
//                 PriceDiv.style.display = "none";
//               }
//               FinalPrice = OriginalPrice;
//               return FinalPrice.toFixed(2);
//             }else if( item.quantity < SelectedProductsQuantity && index !== el.bundleDetail.discountOptions.length-1){
//               DeactivateDiscount(index);
//               let appliedDiscount = document.getElementById(`${bundleIndex}discountOffer`);
//               let PriceDiv = document.getElementById(`${bundleIndex}OriginalPrice`);
//               if(appliedDiscount !==null && PriceDiv !== null){
//                 appliedDiscount.innerText = el.translations.translation.noDiscountIsApplied;
//                 PriceDiv.style.display = "none";
//               }
//               FinalPrice = OriginalPrice;
//               return FinalPrice.toFixed(2);
//             }else{
//               if(el.bundleDetail.discountOptions[index].type === "percent"){
//                 if((item.quantity == SelectedProductsQuantity)  || (index === el.bundleDetail.discountOptions.length-1 && SelectedProductsQuantity >= item.quantity)) {
//                   ActiveAppliedDiscount(index);
//                   DiscountType = "percent";
//                   DiscountValue = item.value;
//                   let percentage = OriginalPrice*el.bundleDetail.discountOptions[index].value/100;
//                   FinalPrice = OriginalPrice-percentage.toFixed(2);
//                   let appliedDiscount = document.getElementById(`${bundleIndex}discountOffer`);
//                   let PriceDiv = document.getElementById(`${bundleIndex}OriginalPrice`);
//                   if(appliedDiscount !==null && PriceDiv !== null){
//                     appliedDiscount.innerText = `${item.value}% ${el.translations.translation.discountIsApplied}.`;
//                     PriceDiv.style.display = "block";
//                   }
//                   return FinalPrice.toFixed(2);
//                 }
//               }else if(el.bundleDetail.discountOptions[index].type === "fixed"){
//                 if((item.quantity == SelectedProductsQuantity)  || (index === el.bundleDetail.discountOptions.length-1 && SelectedProductsQuantity >= item.quantity)) {
//                   ActiveAppliedDiscount(index);
//                   DiscountType = "fixed";
//                   DiscountValue = item.value;
//                   FinalPrice = OriginalPrice-el.bundleDetail.discountOptions[index].value;
//                   let appliedDiscount = document.getElementById(`${bundleIndex}discountOffer`);
//                   let PriceDiv = document.getElementById(`${bundleIndex}OriginalPrice`);
//                   if(appliedDiscount !==null && PriceDiv !== null){
//                     appliedDiscount.innerText = `-${showAmountWithCurrency(item.value)} ${el.translations.translation.discountIsApplied}.`;
//                     PriceDiv.style.display = "block";
//                   }
//                   if(FinalPrice <0){
//                     FinalPrice = 0;
//                     return FinalPrice.toFixed(2);
//                   }else{
//                     return FinalPrice.toFixed(2);
//                   }
//                 }
//               }else if(el.bundleDetail.discountOptions[index].type ==="freeShipping"){
//                 if((item.quantity == SelectedProductsQuantity)  || (index === el.bundleDetail.discountOptions.length-1 && SelectedProductsQuantity >= item.quantity)) {
//                   ActiveAppliedDiscount(index);
//                   DiscountType = "freeShipping";
//                   DiscountValue = item.value;
//                   FinalPrice = OriginalPrice;
//                   let appliedDiscount = document.getElementById(`${bundleIndex}discountOffer`);
//                   let PriceDiv = document.getElementById(`${bundleIndex}OriginalPrice`);
//                   if(appliedDiscount !==null && PriceDiv !== null){
//                     appliedDiscount.innerText = `100% ${el.translations.translation.FreeShipping} ${el.translations.translation.discountIsApplied}.`;
//                     PriceDiv.style.display = "none";
//                   }
//                   return FinalPrice.toFixed(2)
//                 }
//               }else if(el.bundleDetail.discountOptions[index].type === "noDiscount"){
//                 if((item.quantity == SelectedProductsQuantity)  || (index === el.bundleDetail.discountOptions.length-1 && SelectedProductsQuantity >= item.quantity)) {
//                   ActiveAppliedDiscount(index);
//                   DiscountType = "noDiscount";
//                   DiscountValue = item.value;
//                   FinalPrice = OriginalPrice;
//                   let PriceDiv = document.getElementById(`${bundleIndex}OriginalPrice`);
//                   let appliedDiscount = document.getElementById(`${bundleIndex}discountOffer`);
//                   if(appliedDiscount !==null && PriceDiv !== null){
//                     appliedDiscount.innerText = `${el.translations.translation.discountIsApplied}.`;
//                     PriceDiv.style.display = "none";
//                   }
//                   return FinalPrice.toFixed(2)
//                 }
//               }
//             }
//           })
//         }

//         let MixMatchDiv = document.createElement("div");
//         MixMatchDiv.className = "sd-bundle-main-column";
//         MixMatchDiv.style.borderColor = el?.customization?.productMixMatch?.box?.borderColor;
//         MixMatchDiv.style.borderRadius = `${el?.customization?.productMixMatch?.box?.borderRadius}px`;
//         MixMatchDiv.style.background = el?.customization?.productMixMatch?.box?.backgroundColor;
//         MixMatchDiv.style.borderWidth = `${el?.customization?.productMixMatch?.box?.thickness}px`;

//         let Title_Description_Div = document.createElement("div");
//         Title_Description_Div.className = "sd-bundle-text-detail";
//         MixMatchDiv.append(Title_Description_Div);

//         let TitleDiv = document.createElement("h4");
//         TitleDiv.innerText = el.title;
//         TitleDiv.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
//         TitleDiv.style.color = el?.customization?.productMixMatch?.title?.color;
//         TitleDiv.style.textAlign = el?.customization?.productMixMatch?.title?.alignment;
//         TitleDiv.style.fontSize = `${el?.customization?.productMixMatch?.title?.fontSize}px`;
//         TitleDiv.style.fontWeight = el?.customization?.productMixMatch?.title?.titleBold;
//         Title_Description_Div.append(TitleDiv);

//         let DescriptionDiv = document.createElement("p");
//         if(el.description != "" && el.description != null && el.description != undefined){
//           DescriptionDiv.innerText = el.description;
//         }
//         DescriptionDiv.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
//         DescriptionDiv.style.color = el?.customization?.productMixMatch?.title?.descriptionColor;
//         DescriptionDiv.style.fontSize = `${el?.customization?.productMixMatch?.title?.descriptionFontSize}px`;
//         DescriptionDiv.style.fontWeight = el?.customization?.productMixMatch?.title?.descriptionBold;
//         Title_Description_Div.append(DescriptionDiv);

//         let Discount_Information_Div = document.createElement("div");
//         Discount_Information_Div.className = "sd-show-selected-items-row";
//         MixMatchDiv.append(Discount_Information_Div)

//         let ShowActiveDiscountBadgeDiv = document.createElement("div");
//         ShowActiveDiscountBadgeDiv.id = `ShowActiveDiscountBadgeDiv${bundleIndex}`;
//         ShowActiveDiscountBadgeDiv.className = "sd-show-items";
//         el.bundleDetail.discountOptions.map((items,discountBadgeIndex)=>{
//           let ShowMultiDiscountBadgeDiv = document.createElement("span");
//           ShowMultiDiscountBadgeDiv.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
//           ShowMultiDiscountBadgeDiv.id = `DiscountBadge${bundleIndex}${discountBadgeIndex}`;
//           if(items.type === "percent"){
//             ShowMultiDiscountBadgeDiv.innerText = `${items.quantity} items|${items.value}% ${el.translations.translation.off}`;
//           }else if(items.type === "fixed"){
//             ShowMultiDiscountBadgeDiv.innerText = `${items.quantity} items|-${showAmountWithCurrency(items.value)} ${el.translations.translation.off}`;
//           }else if(items.type === "freeShipping"){
//             ShowMultiDiscountBadgeDiv.innerText = `${items.quantity} items|${el.translations.translation.FreeShipping}`;
//           }else if(items.type === "noDiscount"){
//             ShowMultiDiscountBadgeDiv.innerText = `${items.quantity} items|${el.translations.translation.off}`;
//           }
//           ShowActiveDiscountBadgeDiv.append(ShowMultiDiscountBadgeDiv);
//         })
//         Discount_Information_Div.append(ShowActiveDiscountBadgeDiv);

//         let Selected_Text_Description_Div = document.createElement("div");
//         Selected_Text_Description_Div.className = "sd-have-selected";
//         Discount_Information_Div.append(Selected_Text_Description_Div);
        
//         let ShowSelectedItemDiv = document.createElement("h5");
//         ShowSelectedItemDiv.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
//         ShowSelectedItemDiv.style.textAlign = el?.customization?.productMixMatch?.orderOverview?.alignment;
//         ShowSelectedItemDiv.style.color = el?.customization.productMixMatch?.orderOverview?.selectedText?.color;
//         ShowSelectedItemDiv.style.fontSize = el.customization?.productMixMatch?.orderOverview?.selectedText?.fontSize+"px";
//         // ShowSelectedItemDiv.className = "sd-bundle-mix-match-selected-item-div";
//         ShowSelectedItemDiv.id = `${bundleIndex}selectedItems`;
//         let selectedItemMsg = el.translations.translation.youHaveSelectedItems.replace('{{item}}', `${el.bundleDetail.products.length}`);
//         ShowSelectedItemDiv.innerText = selectedItemMsg;
//         Selected_Text_Description_Div.append(ShowSelectedItemDiv);

//         let DiscountOfferDiv = document.createElement("p");
//         DiscountOfferDiv.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
//         DiscountOfferDiv.style.textAlign = el?.customization?.productMixMatch?.orderOverview?.alignment;
//         DiscountOfferDiv.style.color = el?.customization?.productMixMatch?.orderOverview?.discountText?.color;
//         DiscountOfferDiv.style.fontSize = el?.customization?.productMixMatch?.orderOverview?.discountText?.fontSize+"px";
//         DiscountOfferDiv.className = "sd-bundle-mix-match-discount-offer-div";
//         DiscountOfferDiv.id = `${bundleIndex}discountOffer`;
//         Selected_Text_Description_Div.append(DiscountOfferDiv);
        
//         let ImageDiv = document.createElement("div");
//         ImageDiv.className = "sd-show-selected-product-item";
//         el.bundleDetail.products.map((elements,index)=>{
//           let MapProductsImages = document.createElement("div");
//           MapProductsImages.style.border = "2px solid black";
//           MapProductsImages.style.borderColor = el?.customization?.productMixMatch?.productDetails?.image?.borderColor;
//           MapProductsImages.style.borderRadius = `${el?.customization?.productMixMatch?.productDetails?.image?.borderRadius}px`;
//           MapProductsImages.className = "sd-selected-product-itemImg";
//           ImageDiv.append(MapProductsImages);
//           let Images = document.createElement("img");
//           Images.src = `${elements?.images[0]?.originalSrc}`;
//           MapProductsImages.append(Images);

//           if (index < el.bundleDetail.products.length - 1) {
//               let BUNDLE_PLUS_BTN_DIV = document.createElement("div");
//               BUNDLE_PLUS_BTN_DIV.className = "plus-selectedIcon";
//               BUNDLE_PLUS_BTN_DIV.style.color = el?.customization?.collectionMixMatch?.collectionDetails?.plus?.color;
//               BUNDLE_PLUS_BTN_DIV.innerHTML = `<svg viewBox="0 0 18 18" focusable="false" width="18" height="18" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
//               <path d="M6.98047 17.3842V0.580255H10.3239V17.3842H6.98047ZM0.256392 10.6477V7.30433H17.0604V10.6477H0.256392Z" fill= ${
//                             el?.customization?.productMixMatch
//                               ?.productDetails?.plusColor
//                           }></path>
//               </svg>`;
//               ImageDiv.append(BUNDLE_PLUS_BTN_DIV);
//             } else {
//             }
//         })
//         Discount_Information_Div.append(ImageDiv);
        
//         let ItemCounterDiv = document.createElement("div");
//         ItemCounterDiv.className = "sd-select-all-product";

//         let CheckboxLableDiv = document.createElement("div");
//         CheckboxLableDiv.className = "sd-checkbox-wrapper-21";
//         ItemCounterDiv.append(CheckboxLableDiv);

//         let AllCheckBoxLabel = document.createElement("label");
//         AllCheckBoxLabel.className = "sd-control sd-control--checkbox";
//         AllCheckBoxLabel.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
//         AllCheckBoxLabel.style.color = el?.customization?.productMixMatch?.productDetails?.productDetailsBox?.allProductColor;
//         AllCheckBoxLabel.innerText = el?.translations?.translation?.allProducts;
//         CheckboxLableDiv.append(AllCheckBoxLabel);
        
//         let AllProductCheckBox = document.createElement("input");
//         AllProductCheckBox.id = `AllProductCheckBox${bundleIndex}`;
//         AllProductCheckBox.setAttribute("type", "checkbox");
//         AllProductCheckBox.setAttribute("checked","checked");
//         AllProductCheckBox.addEventListener("change",handleAllProducts = (e)=>{
//           if(e.target.checked === false){
//             if(el.bundleDetail.requiredItem.enable === false){
//               SelectedProducts = [];
//               PriceArray = [];
//               SelectedProductsQuantity = SelectedProducts.length;
//               calaculateOriginalPrice();
//               calculateFinalPriceFunction();
//               el.bundleDetail.products.map((allProducts,allProductIndex)=>{
//                 document.getElementById(`ProductCheckbox${bundleIndex}${allProductIndex}`).checked = false;
//                 let variantDiv = document.getElementById(`VariantOptionDiv${bundleIndex}${allProductIndex}`);
//                 if(variantDiv !== null){
//                   const childNodes = variantDiv.querySelectorAll('*');
//                   childNodes.forEach(node => node.remove());
//                 }
//                 let quantityCounter = document.getElementById(`QuantityCount${bundleIndex}${allProductIndex}`);
//                 let plusButton = document.getElementById(`PlusBtn${bundleIndex}${allProductIndex}`); 
//                 if(quantityCounter !== null && plusButton !== null){
//                   quantityCounter.innerText = 0;
//                   plusButton.disabled = true;
//                 }
//               })
//               document.getElementById(`${bundleIndex}selectedItems`).innerText = el.translations.translation.youHavenotSelectedanyItemsYet;
//               document.getElementById(`${bundleIndex}QuantityCounter`).innerText = `Qty: ${SelectedProductsQuantity}`;
//               document.getElementById(`${bundleIndex}OriginalPrice`).innerText = showAmountWithCurrency(OriginalPrice.toFixed(2));
//               document.getElementById(`${bundleIndex}FInalPrice`).innerText = showAmountWithCurrency(FinalPrice.toFixed(2));
//             }else{
//               el.bundleDetail.products.map((requireItem,requiredItemIndex)=>{
//                 if(requireItem.required === false){
//                   let TotalQuantity = 1;
//                   let i = SelectedProducts.findIndex((items)=>items[0] === requireItem.variants[0].id);
//                   SelectedProductsQuantity -= SelectedProducts[i].length;
//                   SelectedProducts.splice(i,1);
//                   PriceArray.splice(requiredItemIndex,1,{productName:`${requireItem.title}${requiredItemIndex}`,productQuantity:`${requireItem.title}${requiredItemIndex}Q${TotalQuantity}`,price:"0"})
//                   document.getElementById(`ProductCheckbox${bundleIndex}${requiredItemIndex}`).checked = false;
//                   let variantDiv = document.getElementById(`VariantOptionDiv${bundleIndex}${requiredItemIndex}`);
//                   if(variantDiv !== null){
//                     const childNodes = variantDiv.querySelectorAll('*');
//                     childNodes.forEach(node => node.remove());
//                   }
//                   let quantityCounter = document.getElementById(`QuantityCount${bundleIndex}${requiredItemIndex}`);
//                   let plusButton = document.getElementById(`PlusBtn${bundleIndex}${requiredItemIndex}`); 
//                   if(quantityCounter !== null && plusButton !== null){
//                     quantityCounter.innerText = 0;
//                     plusButton.disabled = true;
//                   }
//                 }
//                 calaculateOriginalPrice();
//                 calculateFinalPriceFunction();
//                 let selectedItemMsg = el.translations.translation.youHaveSelectedItems.replace('{{item}}', `${SelectedProductsQuantity}`);
//                 document.getElementById(`${bundleIndex}selectedItems`).innerText = selectedItemMsg;
//                 document.getElementById(`${bundleIndex}QuantityCounter`).innerText = `Qty: ${SelectedProductsQuantity}`;
//                 document.getElementById(`${bundleIndex}OriginalPrice`).innerText = showAmountWithCurrency(OriginalPrice.toFixed(2));
//                 document.getElementById(`${bundleIndex}FInalPrice`).innerText = showAmountWithCurrency(FinalPrice.toFixed(2));
//               })
//             } 
//           }
//           if(e.target.checked === true){
//             if(SelectedProducts.length === 0){
//               el.bundleDetail.products.map((allProducts,allProductIndex)=>{
//                 let TotalQuantity = 1;
//                 SelectedProducts.push([allProducts.variants[0].id]);
//                 PriceArray.push({productName:`${allProducts.title}${allProductIndex}`,productQuantity:`${allProducts.title}${allProductIndex}Q${TotalQuantity}`,price:allProducts.variants[0].price});
//                 SelectedProductsQuantity += SelectedProducts[allProductIndex].length;
//                 calaculateOriginalPrice();
//                 calculateFinalPriceFunction();
//                 let VariantOptionDiv = document.getElementById(`VariantOptionDiv${bundleIndex}${allProductIndex}`);
//                 VariantDropDownFun(allProductIndex,allProducts,VariantOptionDiv,TotalQuantity);
//                 let quantityCounter = document.getElementById(`QuantityCount${bundleIndex}${allProductIndex}`);
//                 let plusButton = document.getElementById(`PlusBtn${bundleIndex}${allProductIndex}`); 
//                 if(quantityCounter !== null && plusButton !== null){
//                   quantityCounter.innerText = TotalQuantity;
//                   plusButton.disabled = false;
//                 }
//                 let selectedItemMsg = el.translations.translation.youHaveSelectedItems.replace('{{item}}', `${SelectedProductsQuantity}`);
//                 document.getElementById(`ProductCheckbox${bundleIndex}${allProductIndex}`).checked = true;
//                 document.getElementById(`${bundleIndex}selectedItems`).innerText = selectedItemMsg;
//                 document.getElementById(`${bundleIndex}QuantityCounter`).innerText = `Qty: ${SelectedProductsQuantity}`;
//                 document.getElementById(`${bundleIndex}OriginalPrice`).innerText = showAmountWithCurrency(OriginalPrice.toFixed(2));
//                 document.getElementById(`${bundleIndex}FInalPrice`).innerText = showAmountWithCurrency(FinalPrice.toFixed(2));
//               })
//             }else{
//               el.bundleDetail.products.map((elItem,elIndex)=>{
//                 let TotalQuantity = 1;
//                 let indexof = SelectedProducts.findIndex((items)=> items[0] === elItem.variants[0].id);
//                 if(indexof === -1){
//                   SelectedProducts.push([elItem.variants[0].id]);
//                   PriceArray.splice(elIndex,1,{productName:`${elItem.title}${elIndex}`,productQuantity:`${elItem.title}${elIndex}Q${TotalQuantity}`,price:elItem.variants[0].price})
//                   let VariantOptionDiv = document.getElementById(`VariantOptionDiv${bundleIndex}${elIndex}`);
//                   VariantDropDownFun(elIndex,elItem,VariantOptionDiv,TotalQuantity);
//                   SelectedProductsQuantity += 1;
//                   let quantityCounter = document.getElementById(`QuantityCount${bundleIndex}${elIndex}`);
//                   let plusButton = document.getElementById(`PlusBtn${bundleIndex}${elIndex}`); 
//                   if(quantityCounter !== null && plusButton !== null){
//                     quantityCounter.innerText = TotalQuantity;
//                     plusButton.disabled = false;
//                   }
//                 }
//                 calaculateOriginalPrice();
//                 calculateFinalPriceFunction();
//                 let selectedItemMsg = el.translations.translation.youHaveSelectedItems.replace('{{item}}', `${SelectedProductsQuantity}`);
//                 document.getElementById(`ProductCheckbox${bundleIndex}${elIndex}`).checked = true;
//                 document.getElementById(`${bundleIndex}selectedItems`).innerText = selectedItemMsg;
//                 document.getElementById(`${bundleIndex}QuantityCounter`).innerText = `Qty: ${SelectedProductsQuantity}`;
//                 document.getElementById(`${bundleIndex}OriginalPrice`).innerText = showAmountWithCurrency(OriginalPrice.toFixed(2));
//                 document.getElementById(`${bundleIndex}FInalPrice`).innerText = showAmountWithCurrency(FinalPrice.toFixed(2));
//               })
//             }
//           }
//         })
//         AllCheckBoxLabel.append(AllProductCheckBox);   

//         let Empty_Div = document.createElement("div");
//         Empty_Div.className = "sd-control-indicator";
//         AllCheckBoxLabel.append(Empty_Div);
        
//         let QuantityCounterDiv = document.createElement("div");
//         QuantityCounterDiv.className = "sd-bundle-product-quantity";
//         ItemCounterDiv.append(QuantityCounterDiv);
//         let Quantity_Text = document.createElement("h6");
//         Quantity_Text.id = `${bundleIndex}QuantityCounter`;
//         Quantity_Text.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
//         Quantity_Text.style.fontSize = el?.customization?.productMixMatch?.productDetails?.quantities?.size + "px";
//         Quantity_Text.style.color = el?.customization?.productMixMatch?.productDetails?.quantities?.color;
//         Quantity_Text.innerText = `Qty: ${el?.bundleDetail?.products?.length}`;
//         QuantityCounterDiv.append(Quantity_Text);
        
//         MixMatchDiv.append(ItemCounterDiv);

//         el.bundleDetail.products.map((elements,productIndex)=>{
//           SelectedProducts.push([elements.variants[0].id]);
//           let TotalQuantity = 1;
//           SelectedProductsQuantity = SelectedProducts.length;
//           PriceArray.push({productName:`${elements.title}${productIndex}`,productQuantity:`${elements.title}${productIndex}Q${TotalQuantity}`,price:elements.variants[0].price});
//           calaculateOriginalPrice();
//           calculateFinalPriceFunction();
//           let SetProductsDetailsDiv = document.createElement("div");
//           SetProductsDetailsDiv.className = "sd-bundle-product-detail";
//           SetProductsDetailsDiv.style.backgroundColor = el?.customization?.productMixMatch?.productDetails?.productDetailsBox?.backgroundColor;

//           let Inner_Div = document.createElement("div");
//           Inner_Div.className = "sd-bundle-product-inner";
//           SetProductsDetailsDiv.append(Inner_Div);

//           let CheckBoxDiv = document.createElement("div");
//           CheckBoxDiv.className = "checkbox-wrapper-18";
//           Inner_Div.append(CheckBoxDiv);

//           let CheckBox_Round_Div = document.createElement("div");
//           CheckBox_Round_Div.className = "round";
//           CheckBoxDiv.append(CheckBox_Round_Div);
                  
//           let ProductsCheckBox = document.createElement("input");
//           ProductsCheckBox.id = `ProductCheckbox${bundleIndex}${productIndex}`;
//           ProductsCheckBox.setAttribute("type", "checkbox");
//           ProductsCheckBox.setAttribute("checked","checked");
//           ProductsCheckBox.addEventListener("click", (e) =>{
//             // console.log("test",e)
//             if(elements.required === true){
//               document.getElementById(`ProductCheckbox${bundleIndex}${productIndex}`).checked = true; 
//               let PopUpMessageDiv = document.createElement("div");
//               PopUpMessageDiv.id = `PopUpMessageDiv${bundleIndex}${productIndex}`;
//               PopUpMessageDiv.className = "sd-bundle-mix-match-checkBox-popup-div";
//               CheckBox_Round_Div.append(PopUpMessageDiv);
//               let PopupSpan = document.createElement("span");
//               PopupSpan.className = "sd-bundle-mix-match-checkBox-popup-span";
//               PopupSpan.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
//               PopupSpan.innerText = "This product is required and can not be deselected";
//               PopUpMessageDiv.append(PopupSpan);
//               setTimeout(()=>{
//                 document.getElementById(`PopUpMessageDiv${bundleIndex}${productIndex}`).remove();
//               },2000);
//             }else{
//               if (e.target.checked === true) {
//               OriginalPrice = 0;
//                 TotalQuantity = 1;
//                 SelectedProducts.push([elements.variants[0].id]);
//                 let indexOfPrice = PriceArray.findIndex((checkProduct)=>checkProduct.productName === `${elements.title}${productIndex}`);
//                 if(indexOfPrice === -1){
//                   PriceArray.push({productName:`${elements.title}${productIndex}`,productQuantity:`${elements.title}${productIndex}Q${TotalQuantity}`,price:elements.variants[0].price});
//                 }else{
//                   PriceArray.splice(indexOfPrice,1,{productName:`${elements.title}${productIndex}`,productQuantity:`${elements.title}${productIndex}Q${TotalQuantity}`,price:elements.variants[0].price});
//                 }
//                 SelectedProductsQuantity += 1;
//                 calaculateOriginalPrice();
//                 calculateFinalPriceFunction();
//                 if(elements.multiItemSelect === true){
//                   if(TotalQuantity >= 1){
//                     document.getElementById(`Minusbtn${bundleIndex}${productIndex}`).disabled = true;
//                     document.getElementById(`QuantityCount${bundleIndex}${productIndex}`).innerText = TotalQuantity;
//                   }
//                 }
//                 if(SelectedProductsQuantity >= el.bundleDetail.products.length){
//                   document.getElementById(`AllProductCheckBox${bundleIndex}`).checked = true;
//                 }
//                 let plusButton = document.getElementById(`PlusBtn${bundleIndex}${productIndex}`); 
//                 if(plusButton !== null){
//                   plusButton.disabled = false;
//                 }
//                 let selectedItemMsg = el.translations.translation.youHaveSelectedItems.replace('{{item}}', `${SelectedProductsQuantity}`);
//                 let VariantOptionDiv = document.getElementById(`VariantOptionDiv${bundleIndex}${productIndex}`);
//                 VariantDropDownFun(productIndex,elements,VariantOptionDiv,TotalQuantity);
//                 document.getElementById(`${bundleIndex}OriginalPrice`).innerText = showAmountWithCurrency(OriginalPrice.toFixed(2));
//                 document.getElementById(`${bundleIndex}selectedItems`).innerText = selectedItemMsg;
//                 document.getElementById(`${bundleIndex}QuantityCounter`).innerText = `Qty: ${SelectedProductsQuantity}`;
//                 document.getElementById(`${bundleIndex}FInalPrice`).innerText = showAmountWithCurrency(FinalPrice.toFixed(2));
//               }
//               if(e.target.checked === false){
//               OriginalPrice = 0;
//               let indexProducts ;
//               for(i=0; i<elements.variants.length; i++){
//                 let indexOfProducts = SelectedProducts.findIndex((item)=>item[0] === elements.variants[i].id);
//                 if(indexOfProducts !== null && indexOfProducts !== undefined && indexOfProducts !== -1){
//                   indexProducts = indexOfProducts;
//                   break;
//                 }
//               }
//               let plusButton = document.getElementById(`PlusBtn${bundleIndex}${productIndex}`); 
//               if(plusButton !== null){
//                 plusButton.disabled = true;
//               }
//               SelectedProductsQuantity -= SelectedProducts[indexProducts].length;
//               SelectedProducts.splice(indexProducts,1);
                
//               PriceArray = PriceArray.filter((item)=>{
//                 return item.productName !== `Copy${elements.title}${productIndex}`;
//               })
              
//               if(SelectedProductsQuantity !== el.bundleDetail.products.length){
//                 document.getElementById(`AllProductCheckBox${bundleIndex}`).checked = false;
//               }
//               let indexOfPrice = PriceArray.findIndex((checkProduct)=>checkProduct.productName === `${elements.title}${productIndex}`);
//               PriceArray.splice(indexOfPrice,1,{productName:`${elements.title}${productIndex}`,productQuantity:`${elements.title}${productIndex}Q${TotalQuantity}`,price:"0"});
//               TotalQuantity = 0;
                
//               if(elements.multiItemSelect === true){
//                 if(TotalQuantity <= 1){
//                   document.getElementById(`Minusbtn${bundleIndex}${productIndex}`).disabled = true;
//                   document.getElementById(`QuantityCount${bundleIndex}${productIndex}`).innerText = TotalQuantity;
//                 }
//               }
//               calaculateOriginalPrice();
//               calculateFinalPriceFunction();
//               let variantDiv = document.getElementById(`VariantOptionDiv${bundleIndex}${productIndex}`);
//               if(variantDiv !== null){
//                 const childNodes = variantDiv.querySelectorAll('*');
//                 childNodes.forEach(node => node.remove());
//               }
//               let selectedItemMsg = el.translations.translation.youHaveSelectedItems.replace('{{item}}', `${SelectedProductsQuantity}`);
//               document.getElementById(`${bundleIndex}OriginalPrice`).innerText = showAmountWithCurrency(OriginalPrice.toFixed(2));
//               if(SelectedProductsQuantity === 0 ){
//                 document.getElementById(`${bundleIndex}selectedItems`).innerText = el.translations.translation.youHavenotSelectedanyItemsYet;
//               }else{
//                 document.getElementById(`${bundleIndex}selectedItems`).innerText = selectedItemMsg;
//               }
//               document.getElementById(`${bundleIndex}QuantityCounter`).innerText = `Qty: ${SelectedProductsQuantity}`;
//               document.getElementById(`${bundleIndex}FInalPrice`).innerText = showAmountWithCurrency(FinalPrice.toFixed(2));
//               document.getElementById(`ProductPrice${bundleIndex}${productIndex}`).innerText = showAmountWithCurrency(`${elements.variants[0].price}`);
//             }
//           }
//           });

//           let Product_CheckBox_Label = document.createElement("label");
//           Product_CheckBox_Label.setAttribute("for",`ProductCheckbox${bundleIndex}${productIndex}`);
//           Product_CheckBox_Label.id = `Product_CheckBox_Label${bundleIndex}${productIndex}`;
//           CheckBox_Round_Div.append(ProductsCheckBox,Product_CheckBox_Label);

//           let ImageDiv = document.createElement("div");
//           ImageDiv.className = "sd-bundle-product-img";
//           ImageDiv.style.border = "2px solid black";
//           ImageDiv.style.borderColor = el?.customization?.productMixMatch?.productDetails?.image?.borderColor;
//           ImageDiv.style.borderRadius = `${el?.customization?.productMixMatch?.productDetails?.image?.borderRadius}px`;
//           Inner_Div.append(ImageDiv);
          
//           let ProductImages = document.createElement("img");
//           ProductImages.src = `${elements?.images[0]?.originalSrc}`;
//           ImageDiv.append(ProductImages);

//           let ProductNamePriceDiv = document.createElement("div");
//           ProductNamePriceDiv.className = "sd-bundle-product-name";
//           let ProductName = document.createElement("h5");
//           ProductName.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
//           ProductName.innerText = `${elements?.title}`;
//           ProductName.style.color = el?.customization?.productMixMatch?.productDetails?.title?.color;
//           ProductName.style.fontSize = `${el?.customization?.productMixMatch?.productDetails?.title?.fontSize}px`;
//           ProductNamePriceDiv.append(ProductName);

//           let ProductPrice = document.createElement("h4");
//           ProductPrice.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
//           ProductPrice.id = `ProductPrice${bundleIndex}${productIndex}`;
//           ProductPrice.innerText = showAmountWithCurrency(`${elements?.variants[0]?.price}`);
//           ProductPrice.style.color = el?.customization?.productMixMatch?.productDetails?.price?.color;
//           ProductPrice.style.fontSize = `${el?.customization?.productMixMatch?.productDetails?.price?.fontSize}px`;
//           ProductNamePriceDiv.append(ProductPrice);
//           Inner_Div.append(ProductNamePriceDiv);

//           if(elements.multiItemSelect === true) {
//             let QuantitySelectorDiv = document.createElement("div");
//             QuantitySelectorDiv.className = "sd-bundle-mix-match-quantityselector-div";
//             QuantitySelectorDiv.id = `QuantitySelectorDiv${bundleIndex}${productIndex}`;
//             ProductNamePriceDiv.append(QuantitySelectorDiv);

//             let MinusBtnDiv = document.createElement("div");
//             MinusBtnDiv.className = "sd-bundle-mix-match-minusbtn-div"; 
//             QuantitySelectorDiv.append(MinusBtnDiv);

//             let MinusBtn = document.createElement("button");
//             MinusBtn.id = `Minusbtn${bundleIndex}${productIndex}`;
//             MinusBtn.className = "sd-bundle-mix-match-minus-btn";
//             MinusBtn.innerText = "-";
//             MinusBtn.setAttribute("disabled",true);
//             MinusBtn.style.cursor = "pointer";
//             MinusBtn.addEventListener("click",removeProduct = ()=>{
//               let indexOfPrice = PriceArray.findIndex((checkProduct)=>checkProduct.productName === `${elements.title}${productIndex}Q${TotalQuantity}`);
//               let indexofProducts;
//               elements.variants.map((variants,variantsIndex)=>{
//                 SelectedProducts.map((item,itemIndex)=>{
//                   item.map((itemProducts,indexOfItemProduct)=>{
//                     if(variants.id == itemProducts){
//                       indexofProducts = SelectedProducts.findIndex((checkPrducts)=> checkPrducts[indexOfItemProduct] == variants.id)
//                     }
//                   })
//                 })
//               })
//               let selectDropdown = document.getElementById(`SelectVariants${bundleIndex}${productIndex}${TotalQuantity}`);
//               if(selectDropdown !==null){
//                 selectDropdown.remove();
//               }
//               TotalQuantity = TotalQuantity - 1;
//               SelectedProducts[indexofProducts].pop();
//               PriceArray.splice(indexOfPrice,1);
//               SelectedProductsQuantity -= 1;
//               calaculateOriginalPrice();
//               calculateFinalPriceFunction();
//               if(TotalQuantity <= 1){
//                 document.getElementById(`Minusbtn${bundleIndex}${productIndex}`).disabled = true;
//               }
//               document.getElementById(`QTY:${bundleIndex}${productIndex}`).innerText = `Qty: ${TotalQuantity}`
//               document.getElementById(`${bundleIndex}OriginalPrice`).innerText = showAmountWithCurrency(OriginalPrice.toFixed(2));
//               document.getElementById(`${bundleIndex}FInalPrice`).innerText = showAmountWithCurrency(FinalPrice.toFixed(2));
//               document.getElementById(`QuantityCount${bundleIndex}${productIndex}`).innerText = TotalQuantity;
//               let selectedItemMsg = el.translations.translation.youHaveSelectedItems.replace('{{item}}', `${SelectedProductsQuantity}`);
//               document.getElementById(`${bundleIndex}selectedItems`).innerText = selectedItemMsg;
//               document.getElementById(`${bundleIndex}QuantityCounter`).innerText = `Qty: ${SelectedProductsQuantity}`;
//             })
              
//             MinusBtnDiv.append(MinusBtn);

//             let QuantitiesDiv = document.createElement("div");
//             QuantitiesDiv.className = "sd-bundle-mix-match-quantities-div";
//             QuantitySelectorDiv.append(QuantitiesDiv);

//             let QuantityCount = document.createElement("div");
//             QuantityCount.id = `QuantityCount${bundleIndex}${productIndex}`;
//             QuantityCount.innerText = TotalQuantity;
//             QuantityCount.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
//             QuantitiesDiv.append(QuantityCount);
            
//             let PlusBtnDiv = document.createElement("div");
//             PlusBtnDiv.className = "sd-bundle-mix-match-plusBtn-div";

//             QuantitySelectorDiv.append(PlusBtnDiv);

//             let PlusBtn = document.createElement("button");
//             PlusBtn.className = "sd-bundle-mix-match-plus-btn";
//             PlusBtn.id = `PlusBtn${bundleIndex}${productIndex}`;
//             PlusBtn.innerText = "+";
//             PlusBtn.style.cursor = "pointer";
//             PlusBtn.addEventListener("click",addProduct = ()=>{
//               document.getElementById(`Minusbtn${bundleIndex}${productIndex}`).disabled = false;
//               let indexofProducts;
//               elements.variants.map((variants,variantsIndex)=>{
//                 SelectedProducts.map((item,itemIndex)=>{
//                   item.map((itemProducts,indexOfItemProduct)=>{
//                     if(variants.id == itemProducts){
//                       indexofProducts = SelectedProducts.findIndex((checkPrducts)=> checkPrducts[indexOfItemProduct] == variants.id)
//                     }
//                   })
//                 })
//               });
//               let VariantOptionDiv = document.getElementById(`VariantOptionDiv${bundleIndex}${productIndex}`);
//               SelectedProducts[indexofProducts].push(elements.variants[0].id);
//               TotalQuantity =  SelectedProducts[indexofProducts].length;
//               if(VariantOptionDiv !== null){
//                 VariantDropDownFun(productIndex,elements,VariantOptionDiv,TotalQuantity);
//               }
//               PriceArray.push({productName:`Copy${elements.title}${productIndex}`,productQuantity:`${elements.title}${productIndex}Q${TotalQuantity}`,price:`${elements?.variants[0]?.price}`})
//               SelectedProductsQuantity += 1;
//               calaculateOriginalPrice();
//               calculateFinalPriceFunction();
//               document.getElementById(`QTY:${bundleIndex}${productIndex}`).innerText = `Qty: ${TotalQuantity}`;
//               document.getElementById(`${bundleIndex}OriginalPrice`).innerText = showAmountWithCurrency(OriginalPrice.toFixed(2));
//               document.getElementById(`${bundleIndex}FInalPrice`).innerText = showAmountWithCurrency(FinalPrice.toFixed(2));
//               let selectedItemMsg = el.translations.translation.youHaveSelectedItems.replace('{{item}}', `${SelectedProductsQuantity}`);
//               document.getElementById(`${bundleIndex}selectedItems`).innerText = selectedItemMsg;
//               document.getElementById(`QuantityCount${bundleIndex}${productIndex}`).innerText = TotalQuantity;
//               document.getElementById(`${bundleIndex}QuantityCounter`).innerText = `Qty: ${SelectedProductsQuantity}`;
//             })
//             PlusBtnDiv.append(PlusBtn);
//           }
    
//           if(elements.variants.length > 1 ){let VariantOptionDiv = document.createElement("div");
//           VariantOptionDiv.className = "sd-bundle-mix-match-variantOptions-div";
//           VariantOptionDiv.id = `VariantOptionDiv${bundleIndex}${productIndex}`;
//           VariantDropDownFun(productIndex,elements,VariantOptionDiv,TotalQuantity);
//           ProductNamePriceDiv.append(VariantOptionDiv)};

//           let Quantity_Div = document.createElement("div");
//           Quantity_Div.className = "sd-bundle-product-quantity";
//           SetProductsDetailsDiv.append(Quantity_Div);

//           let Quantity_Text = document.createElement("h6");
//           Quantity_Text.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
//           Quantity_Text.style.fontSize = el?.customization?.productMixMatch?.productDetails?.quantities?.size + "px";
//           Quantity_Text.style.color = el?.customization?.productMixMatch?.productDetails?.quantities.color;
//           Quantity_Text.id = `QTY:${bundleIndex}${productIndex}`;
//           Quantity_Text.innerText = `Qty: ${TotalQuantity}`;
//           Quantity_Div.append(Quantity_Text);
          
//           MixMatchDiv.append(SetProductsDetailsDiv);
//         });
        
//         let TotalPriceDiv = document.createElement("div");
//         TotalPriceDiv.className = "sd-product-bundle-total";
//         MixMatchDiv.append(TotalPriceDiv);

//         let PriceTextDiv = document.createElement("div");
//         PriceTextDiv.className = "sd-total-desc";
//         TotalPriceDiv.append(PriceTextDiv);

//         let Total_Text = document.createElement("h4");
//         Total_Text.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
//         Total_Text.innerText = el?.translations?.translation?.total;
//         Total_Text.style.color = el?.customization?.productMixMatch?.totalSection?.color;
//         Total_Text.style.fontSize = `${el?.customization?.productMixMatch?.totalSection?.fontSize}px`;
//         PriceTextDiv.append(Total_Text);

//         let Discount_Text = document.createElement("p");
//         Discount_Text.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
//         Discount_Text.style.color = el?.customization?.productMixMatch?.totalSection?.discountMessage?.color;
//         Discount_Text.style.fontSize = el?.customization?.productMixMatch?.totalSection?.discountMessage?.size+"px";
//         Discount_Text.innerText = el?.translations?.translation?.discountApplied;
//         PriceTextDiv.append(Discount_Text);

//         let AllPriceDiv = document.createElement("div");
//         AllPriceDiv.className = "sd-total-amount";

//         let OriginalPriceDiv = document.createElement("h6");
//         OriginalPriceDiv.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
//         OriginalPriceDiv.id = `${bundleIndex}OriginalPrice`;
//         OriginalPriceDiv.style.color = el?.customization?.productMixMatch?.totalSection?.originalPrice?.color;
//         OriginalPriceDiv.style.fontSize = `${el?.customization?.productMixMatch?.totalSection?.originalPrice?.fontSize}px`;
//         OriginalPriceDiv.innerText = showAmountWithCurrency(OriginalPrice.toFixed(2));

//         let FinalPriceDiv = document.createElement("h4");
//         FinalPriceDiv.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
//         FinalPriceDiv.id = `${bundleIndex}FInalPrice`;
//         FinalPriceDiv.style.color = el?.customization?.productMixMatch?.totalSection?.finalPrice?.color;
//         FinalPriceDiv.style.fontSize = `${el?.customization?.productMixMatch?.totalSection?.finalPrice?.fontSize}px`;
//         FinalPriceDiv.innerText = showAmountWithCurrency(FinalPrice.toFixed(2));

//         AllPriceDiv.append(FinalPriceDiv);
//         AllPriceDiv.append(OriginalPriceDiv);
//         TotalPriceDiv.append(AllPriceDiv);

//         let AddToCartBtnDiv = document.createElement("div");
//         AddToCartBtnDiv.className = "sd-bundle-addto-cart";
//         let AddToCartBTN = document.createElement("button");
//         AddToCartBTN.disabled = true;
//         AddToCartBTN.className = "sd-bundle-add-to-cart-button";
//         AddToCartBTN.id = `sd-bundle-add-to-cart-buttonID${bundleIndex}`
//         AddToCartBTN.style.background = "grey";
//         AddToCartBTN.style.cursor = "not-allowed";
//         AddToCartBTN.style.borderRadius = el?.customization?.productMixMatch?.button?.borderRadius+"px";
//         AddToCartBTN.style.borderColor = el?.customization?.productMixMatch?.button?.borderColor;
//         AddToCartBTN.style.color = `${el?.customization?.productMixMatch?.button?.color}`;
//         AddToCartBTN.style.fontSize = `${el?.customization?.productMixMatch?.button?.fontSize}px`;
//         AddToCartBTN.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
//         AddToCartBTN.innerHTML = el?.translations?.translation?.addToCartButton;
//         AddToCartBTN.type = "button";
//         AddToCartBTN.addEventListener("click",addToCartFunc=(e)=>{
//           let bundleDataArray = SelectedProducts.reduce(
//             (acc, curr) => acc.concat(curr),
//             []
//           );
//           bundleDataArray.map((productsId,productsIndex)=>{
//             bundleData[bundleIndex][productsIndex] = [{
//               id: productsId.replace(
//                 "gid://shopify/ProductVariant/",
//                 ""
//               ),
//               quantity: 1,
//             }];
//           })
//           PriceArray.map((item)=>{
//             bundleSum[bundleIndex].push([item.price]);
//           })
//           let code = JSON.parse(localStorage.getItem("sd_bundle_data"));
//           let discountCodeId = code.discountCreateId ?? "";
//           AddToCartBTN.innerText = "";
//           let btnSpinner = document.createElement("div");
//           btnSpinner.className = "bundleBtnSpinner";
//           AddToCartBTN.append(btnSpinner);

//           btnSpinner.style.display = "block";
//           const mergedArray = bundleData[bundleIndex].reduce(
//             (acc, curr) => acc.concat(curr),
//             []
//           );
//           const mergedGidArray = SelectedProducts.reduce(
//             (acc, curr) => acc.concat(curr),
//             []
//           );
//           let mergedResult = {};
//           for (let item of mergedArray) {
//             if (mergedResult[item.id]) {
//               mergedResult[item.id].quantity += item.quantity;
//             } else {
//               mergedResult[item.id] = { ...item };
//             }
//           }
//           let mergedArrayResult = Object.values(mergedResult);
//           let formData = {
//             items: mergedArrayResult,
//             attributes: { SD_BUNDLE_ID: el._id },
//           };
//           fetch(window.Shopify.routes.root + "cart/add.js", {
//             method: "POST",
//             headers: {
//               "Content-Type": "application/json",
//             },
//             body: JSON.stringify(formData),
//           })
//             .then((response) => {
//               return response.json();
//             })
//             .then((response) => {
//               let errorDiv = document.getElementsByClassName(
//                 "sd-bundle-error-message"
//               );
//               errorDiv[0]?.remove();
//               if (response.status == 422 || response.status == 404) {
//                 AddToCartBTN.innerText =
//                   el.translations.translation.addToCartButton;
//                 btnSpinner.remove();
//                 let errorMessage = document.createElement("div");
//                 errorMessage.className = "sd-bundle-error-message";
//                 MixMatchDiv.append(errorMessage);
//                 errorMessage.innerText = response.description;
//               } else {
//                 fetch(window.Shopify.routes.root + "cart.js", {
//                   method: "GET",
//                   headers: {
//                     "Content-Type": "application/json",
//                   },
//                 })
//                   .then((response) => {
//                     return response.json();
//                   })
//                   .then((response) => {
//                     if (DiscountType == "noDiscount") {
//                       fetch(`${server}/api/storefront/getBundleClick`, {
//                         method: "POST",
//                         headers: {
//                           "Content-Type": "application/json",
//                         },
//                         body: JSON.stringify({
//                           shop: Shopify.shop,
//                           bundleId: el._id,
//                         }),
//                       });
//                       let isDiscount =
//                         DiscountType == "noDiscount"
//                           ? "noDiscount"
//                           : "Fix";
//                       const localData = JSON.parse(
//                         localStorage.getItem("sd_bundle_data")
//                       );
//                       let sd_bundle_data = {
//                         discount_name: el.name,
//                         code: code.code,
//                         bundleId: el._id,
//                         discountType: isDiscount,
//                         variantsId: mergedArrayResult,
//                         discountCreateId: localData.discountCreateId,
//                         prefixCode: el.settings.discountLabel,
//                       };
//                       var jsonString = JSON.stringify(sd_bundle_data);
//                       localStorage.setItem("sd_bundle_data", jsonString);

//                       btnSpinner.remove();
//                       window.location.assign(`https://${Shopify.shop}/cart`);
//                     } else {
//                       let finalSumBundle = bundleSum[bundleIndex].reduce(
//                         (acc, curr) => acc.concat(curr),
//                         []
//                       );
//                       let myArray = finalSumBundle.map(parseFloat);
//                       let total = myArray.reduce(
//                         (accumulator, currentValue) =>
//                           accumulator + currentValue,
//                         0
//                       );
//                       let totalPrice = Number(total.toFixed(2));
//                       let finalPrice;
                      
//                       switch (DiscountType) {
//                         case "percent":
//                           let percentagepart = parseFloat(
//                             DiscountValue
//                           );
//                           let percentage = (totalPrice * percentagepart) / 100;
//                           finalPrice = percentage.toFixed(2);
//                           break;
//                         case "price":
//                           let pricePart = parseFloat(
//                             DiscountValue
//                           );
//                           result = totalPrice - pricePart;
//                           finalPrice = result.toFixed(2);
//                           break;
//                         case "fixed":
//                           let fixedPart = parseFloat(
//                             DiscountValue
//                           );
//                           finalPrice = fixedPart.toFixed(2);
//                           break;
//                         default:
//                           break;
//                       }

//                       let isDiscount =
//                         DiscountType == "noDiscount"
//                           ? "noDiscount"
//                           : "Fix";
//                       let sd_bundle_data = {
//                         discount_name: el.name,
//                         code: `${el.settings.discountLabel}-${code.code}`,
//                         discountType: isDiscount,
//                         discountValue: finalPrice,
//                         variantsId: mergedGidArray,
//                         startDate: new Date(),
//                         endDate: el.endDate,
//                         shop: Shopify.shop,
//                         bundleType: DiscountType,
//                         totalPrice: total.toFixed(2),
//                         discountCreateId: discountCodeId,
//                       };
//                       fetch(server + "/api/storefront/createRule", {
//                         method: "POST",
//                         headers: {
//                           "Content-Type": "application/json",
//                         },
//                         body: JSON.stringify(sd_bundle_data),
//                       })
//                         .then((response) => response.json())
//                         .then((data) => {
//                           if (data.status == 200) {
//                             fetch(`${server}/api/storefront/getBundleClick`, {
//                               method: "POST",
//                               headers: {
//                                 "Content-Type": "application/json",
//                               },
//                               body: JSON.stringify({
//                                 shop: Shopify.shop,
//                                 bundleId: el._id,
//                               }),
//                             });
//                             AddToCartBTN.innerText =
//                               el.translations.translation.addToCartButton;
//                             btnSpinner.remove();

//                             let sd_bundle_data = {
//                               discount_name: el.name,
//                               code: code.code,
//                               bundleId: el._id,
//                               discountType: isDiscount,
//                               variantsId: mergedArrayResult,
//                               discountCreateId: data.response,
//                               prefixCode: el.settings.discountLabel,
//                             };
//                             var jsonString = JSON.stringify(sd_bundle_data);
//                             localStorage.setItem("sd_bundle_data", jsonString);
//                             cartDrawer();
//                           }
//                         });
//                     }
//                   })
//                   .catch((error) => {
//                     AddToCartBTN.innerText =
//                       el.translations.translation.addToCartButton;
//                   });
//               }
//             })
//             .catch((error) => {
//               console.error("Error:", error);
//             });
//         });
//         AddToCartBtnDiv.append(AddToCartBTN);
//         if (el?.customization?.productMixMatch?.button?.position == "bottom") {
//           MixMatchDiv.append(AddToCartBtnDiv);
//         } else {
//           MixMatchDiv.prepend(AddToCartBtnDiv);
//         }

//         if (el?.plans?.plan == "free") {
//           waterMark(MixMatchDiv);
//         }
//         mainDiv.append(MixMatchDiv)

//         let plusIconHandler = (ele,index,activeBadge) =>{
//           if(index ===  el.bundleDetail.discountOptions.length-1){
//             if(el.bundleDetail.discountOptions[index].type === "percent"){
//               activeBadge.innerText = `${ele.quantity}+ items|${ele.value}% ${el.translations.translation.off}`;
//             }
//             if(el.bundleDetail.discountOptions[index].type === "fixed"){
//               activeBadge.innerText = `${ele.quantity}+ items|-${showAmountWithCurrency(ele.value)} ${el.translations.translation.off}`;
//             }
//             if(el.bundleDetail.discountOptions[index].type === "freeShipping"){
//               activeBadge.innerText = `${ele.quantity}+ items|${el.translations.translation.FreeShipping}`;
//             }
//             if(el.bundleDetail.discountOptions[index].type === "noDiscount"){
//               activeBadge.innerText = `${ele.quantity}+ items|${el.translations.translation.off}`;
//             }
//           }
//         }

//         el.bundleDetail.discountOptions.map((ele,index)=>{
//           let getDiscountTextDiv = document.getElementById(`${bundleIndex}discountOffer`)
//           let activeBadge = document.getElementById(`DiscountBadge${bundleIndex}${index}`);
//           let addToCartBTN = document.getElementById(`sd-bundle-add-to-cart-buttonID${bundleIndex}`);
//           let PriceDiv = document.getElementById(`${bundleIndex}OriginalPrice`);
//           plusIconHandler(ele,index,activeBadge)
//           if(el.bundleDetail.discountOptions[index].type === "percent"){
//             if((ele.quantity == SelectedProductsQuantity)  || (index === el.bundleDetail.discountOptions.length-1 && SelectedProductsQuantity >= ele.quantity)) {
//               getDiscountTextDiv.innerText = `${ele.value}% ${el.translations.translation.discountIsApplied}.`;
//               activeBadge.className = "active";
//               addToCartBTN.disabled = false;
//               addToCartBTN.style.cursor = "pointer";
//               addToCartBTN.style.background = `${el?.customization?.productMixMatch?.button?.backgroundColor}`
//             }
//           }
//           if(el.bundleDetail.discountOptions[index].type === "fixed"){
//             if((ele.quantity == SelectedProductsQuantity)  || (index === el.bundleDetail.discountOptions.length-1 && SelectedProductsQuantity >= ele.quantity)) {
//               getDiscountTextDiv.innerText = `-${showAmountWithCurrency(ele.value)} ${el.translations.translation.discountIsApplied}.`;
//               activeBadge.className = "active";
//               addToCartBTN.disabled = false;
//               addToCartBTN.style.cursor = "pointer";
//               addToCartBTN.style.background = `${el?.customization?.productMixMatch?.button?.backgroundColor}`
//             }
//           }
//           if(el.bundleDetail.discountOptions[index].type === "noDiscount"){
//             if((ele.quantity == SelectedProductsQuantity)  || (index === el.bundleDetail.discountOptions.length-1 && SelectedProductsQuantity >= ele.quantity)) {
//               getDiscountTextDiv.innerText = `${el?.translations?.translation?.discountIsApplied}.`;
//               activeBadge.className = "active";
//               PriceDiv.style.display = "none";
//               addToCartBTN.disabled = false;
//               addToCartBTN.style.cursor = "pointer";
//               addToCartBTN.style.background = `${el?.customization?.productMixMatch?.button?.backgroundColor}`
//             }
//           }
//           if(el.bundleDetail.discountOptions[index].type === "freeShipping"){
//             if((ele.quantity == SelectedProductsQuantity)  || (index === el.bundleDetail.discountOptions.length-1 && SelectedProductsQuantity >= ele.quantity)) {
//               getDiscountTextDiv.innerText = `100% ${el?.translations.translation?.FreeShipping} ${el.translations.translation.discountIsApplied}.`;
//               activeBadge.className = "active";
//               PriceDiv.style.display = "none";
//               addToCartBTN.disabled = false;
//               addToCartBTN.style.cursor = "pointer";
//               addToCartBTN.style.background = `${el.customization?.productMixMatch?.button?.backgroundColor}`
//             }
//           }
//         })
//       }
//     }
//     else if (el.type == "bxgy") {
//       if(el.plans.plan == "standard"){
//         let XproductsPriceArray = [];
//         let YproductsPriceArray = [];
//         let OriginalPrice = 0;
//         let FinalPrice = 0;
        
//         let BXGY_DIV = document.createElement("div");
//         BXGY_DIV.className = "sd-bundle-main-column";
//         BXGY_DIV.style.borderRadius = `${el?.customization?.buyXgetY?.box?.borderRadius}px`;
//         BXGY_DIV.style.borderColor = el?.customization?.buyXgetY?.box?.borderColor;
//         BXGY_DIV.style.background = el?.customization?.buyXgetY?.box?.backgroundColor;
//         BXGY_DIV.id = `BXGY_DIV${bundleIndex}`;
//         mainDiv.append(BXGY_DIV);

//         let Desc_Title_text_Div = document.createElement("div");
//         Desc_Title_text_Div.className = "sd-bundle-text-detail";
//         BXGY_DIV.append(Desc_Title_text_Div);

//         let BXGY_TITLE_DIV = document.createElement("h4");
//         BXGY_TITLE_DIV.style.color = el?.customization?.buyXgetY?.title?.color;
//         BXGY_TITLE_DIV.style.textAlign = el?.customization?.buyXgetY?.title?.alignment;
//         BXGY_TITLE_DIV.style.fontSize = `${el?.customization?.buyXgetY?.title?.fontSize}px`;
//         BXGY_TITLE_DIV.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
//         BXGY_TITLE_DIV.style.fontWeight = el?.customization?.buyXgetY?.title?.titleBold;
//         BXGY_TITLE_DIV.innerText = el?.title;
//         Desc_Title_text_Div.append(BXGY_TITLE_DIV);

//         let BXGY_DESCRIPTION_DIV = document.createElement("p");
//         BXGY_DESCRIPTION_DIV.style.color = el?.customization?.buyXgetY?.title?.descriptionColor;
//         BXGY_DESCRIPTION_DIV.style.textAlign = el?.customization?.buyXgetY?.title?.alignment;
//         BXGY_DESCRIPTION_DIV.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
//         BXGY_DESCRIPTION_DIV.style.fontSize = `${el?.customization?.buyXgetY?.title?.descriptionFontSize}px`;
//         BXGY_DESCRIPTION_DIV.style.fontWeight = el?.customization?.buyXgetY?.title?.descriptionBold;
//         BXGY_DESCRIPTION_DIV.innerText = el.description;
//         Desc_Title_text_Div.append(BXGY_DESCRIPTION_DIV);

//         el.bundleDetail.xproducts.map((Xitems,Xindex)=>{
//           let MAIN_BUY_PRODUCT_NAME_IMAGE_DIV = document.createElement("div");
//           MAIN_BUY_PRODUCT_NAME_IMAGE_DIV.className = "sd-bundle-product-detail";
//           MAIN_BUY_PRODUCT_NAME_IMAGE_DIV.style.backgroundColor = el?.customization?.buyXgetY?.productDetails?.productDetailsBox?.backgroundColor;
//           BXGY_DIV.append(MAIN_BUY_PRODUCT_NAME_IMAGE_DIV);

//           let Inner_X_Div = document.createElement("div");
//           Inner_X_Div.className =  "sd-bundle-product-inner";
//           MAIN_BUY_PRODUCT_NAME_IMAGE_DIV.append(Inner_X_Div);
          
//           let BUY_PRODUCT_IMAGE_DIV = document.createElement("div");
//           BUY_PRODUCT_IMAGE_DIV.className = "sd-bundle-product-img";
//           BUY_PRODUCT_IMAGE_DIV.id = `BUY_PRODUCT_IMAGE_DIV${bundleIndex}${Xindex}`;
//           BUY_PRODUCT_IMAGE_DIV.style.border = "2px solid black";
//           BUY_PRODUCT_IMAGE_DIV.style.borderColor = el?.customization?.buyXgetY?.productDetails?.image?.borderColor;
//           BUY_PRODUCT_IMAGE_DIV.style.borderRadius = `${el?.customization?.buyXgetY?.productDetails?.image?.borderRadius}px`;
//           Inner_X_Div.append(BUY_PRODUCT_IMAGE_DIV);

//           let BUY_PRODUCTS_IMAGE = document.createElement("img");
//           BUY_PRODUCTS_IMAGE.src = `${Xitems?.images[0]?.originalSrc}`;
//           BUY_PRODUCT_IMAGE_DIV.append(BUY_PRODUCTS_IMAGE);

//           let BUY_PRODUCTS_NAME_PRICE_DIV = document.createElement("div");
//           BUY_PRODUCTS_NAME_PRICE_DIV.className = "sd-bundle-product-name";
//           Inner_X_Div.append(BUY_PRODUCTS_NAME_PRICE_DIV);

//           let BUY_PRODUCTS_NAME = document.createElement("h5");
//           BUY_PRODUCTS_NAME.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
//           BUY_PRODUCTS_NAME.style.fontSize = `${el?.customization?.buyXgetY?.productDetails?.title?.fontSize}px`;
//           BUY_PRODUCTS_NAME.style.color = el?.customization?.buyXgetY?.productDetails?.title?.color;
//           BUY_PRODUCTS_NAME.innerText = Xitems.title;
//           BUY_PRODUCTS_NAME_PRICE_DIV.append(BUY_PRODUCTS_NAME);

//           let BUY_PRODUCTS_PRICE = document.createElement("h4");
//           BUY_PRODUCTS_PRICE.id = `XproductsPriceDiv${Xindex}`;
//           BUY_PRODUCTS_PRICE.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
//           BUY_PRODUCTS_PRICE.style.fontSize = `${el?.customization?.buyXgetY?.productDetails?.price?.fontSize}px`;
//           BUY_PRODUCTS_PRICE.style.color = el?.customization?.buyXgetY?.productDetails?.price?.color;
//           BUY_PRODUCTS_PRICE.innerText = showAmountWithCurrency(`${Xitems?.variants[0]?.price}`);
//           BUY_PRODUCTS_NAME_PRICE_DIV.append(BUY_PRODUCTS_PRICE);

//           if(Xitems.minimumOrder>1){
//             let QuantityCounterDiv = document.createElement("div");
//             QuantityCounterDiv.className = "sd-bundle-mix-match-quantity-counter-div";
//             QuantityCounterDiv.id = `QuantityCounter${bundleIndex}${Xindex}`;
//             QuantityCounterDiv.style.borderColor = el?.customization?.buyXgetY?.productDetails?.quantities?.borderColor;
//             QuantityCounterDiv.style.background = el?.customization?.buyXgetY?.productDetails?.quantities?.backgroundColor;
//             QuantityCounterDiv.style.color = el?.customization?.buyXgetY?.productDetails?.quantities?.color;
//             QuantityCounterDiv.innerText = `${Xitems.minimumOrder}X`;
//             Inner_X_Div.append(QuantityCounterDiv);
//           }
          
//           Array.from({ length: Xitems.minimumOrder }).map((_, i) => {
//             XproductsPriceArray.push({
//               price:`${Xitems.variants[0].price}`,
//               xProductId:`${Xitems.variants[0].id}`,
//               uniqueId: `Xproduct${Xindex}${i}`,
//             })
//             calaculateOriginalPrice();
//             CalculateFinalPrice();
//             if (Xitems.variants.length > 1) {
//               let BUY_PRODUCTS_SELECT_VARIANT = document.createElement("SELECT");
//               BUY_PRODUCTS_SELECT_VARIANT.style.width = el?.customization?.buyXgetY?.productDetails?.variantSelector?.width+"px";
//               BUY_PRODUCTS_SELECT_VARIANT.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
//               BUY_PRODUCTS_SELECT_VARIANT.style.color = el?.customization?.buyXgetY?.productDetails?.variantSelector?.color;
//               BUY_PRODUCTS_SELECT_VARIANT.style.background = el?.customization?.buyXgetY?.productDetails?.variantSelector?.backgroundColor;
//               BUY_PRODUCTS_SELECT_VARIANT.id = `XvariantsSelect${Xindex}${i + 1}`;
//               BUY_PRODUCTS_NAME_PRICE_DIV.appendChild(BUY_PRODUCTS_SELECT_VARIANT);
          
//               let optionsHTML = Xitems.variants.map((Xvariants, XvariantsIndex) => `
//                 <option value="${Xvariants.id}" id="Xvariants${Xindex}${i + 1}${XvariantsIndex}" price="${Xvariants.price}">
//                   ${Xvariants.title}
//                 </option>
//               `).join('');
          
//               BUY_PRODUCTS_SELECT_VARIANT.innerHTML = optionsHTML;
          
//               BUY_PRODUCTS_SELECT_VARIANT.addEventListener("change", (e) => {
//                 let selectedOption = e.target.options[e.target.selectedIndex];
//                 let selectedVariantPrice = selectedOption.getAttribute("price");
//                 let selectedVariantID = selectedOption.getAttribute("value");
    
//                 let XproductsPriceArrayIndex = XproductsPriceArray.findIndex((checkProduct)=>checkProduct.uniqueId === `Xproduct${Xindex}${i}`);
//                 XproductsPriceArray.splice(XproductsPriceArrayIndex,1,{price:selectedVariantPrice,xProductId:selectedVariantID,uniqueId: `Xproduct${Xindex}${i}`});
//                 document.getElementById(`XproductsPriceDiv${Xindex}`).innerText = showAmountWithCurrency(selectedVariantPrice);
//                 let originalPrice = calaculateOriginalPrice();
//                 let finalPrice = CalculateFinalPrice();
//                 document.getElementById("sd-bxgy-original-price").innerText = showAmountWithCurrency(parseFloat(originalPrice).toFixed(2));
//                 document.getElementById("sd-bxgy-final-price").innerText = showAmountWithCurrency(parseFloat(finalPrice).toFixed(2));
//               });
//             }
//           });
//           let Quantity_Div = document.createElement("div");
//           Quantity_Div.className = "sd-bundle-product-quantity";
//           MAIN_BUY_PRODUCT_NAME_IMAGE_DIV.append(Quantity_Div);
          
//           let Quantity_Text = document.createElement("h6")
//           Quantity_Text.style.fontSize = el?.customization?.buyXgetY?.productDetails?.quantities?.size+"px";
//           Quantity_Text.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
//           Quantity_Text.style.color = el?.customization?.buyXgetY?.productDetails?.quantities?.color;
//           Quantity_Text.innerText = `Qty: ${Xitems.minimumOrder}`;
//           Quantity_Div.append(Quantity_Text);
//         });

//         let BUNDLE_PLUS_BTN_DIV = document.createElement("div");
//         BUNDLE_PLUS_BTN_DIV.className = "sd-add-bundle";
//         BUNDLE_PLUS_BTN_DIV.innerHTML = `<svg viewBox="0 0 18 18" focusable="false" width="18" height="18" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
//           <path d="M6.98047 17.3842V0.580255H10.3239V17.3842H6.98047ZM0.256392 10.6477V7.30433H17.0604V10.6477H0.256392Z" fill= ${
//             el?.customization?.buyXgetY?.productDetails?.plusColor
//           }></path>
//         </svg>`;
//         BXGY_DIV.append(BUNDLE_PLUS_BTN_DIV);

//         //.............................Get Products code............................................................
//         el.bundleDetail.yproducts.map((Yitems,Yindex)=>{
//           let MAIN_GET_PRODUCT_NAME_IMAGE_DIV = document.createElement("div");
//           MAIN_GET_PRODUCT_NAME_IMAGE_DIV.className = "sd-bundle-product-detail"
//           MAIN_GET_PRODUCT_NAME_IMAGE_DIV.style.backgroundColor = el?.customization?.buyXgetY?.productDetails?.productDetailsBox?.backgroundColor;
//           BXGY_DIV.append(MAIN_GET_PRODUCT_NAME_IMAGE_DIV);

//         let DISCOUNT_BADGE_DIV = document.createElement("div");
//           if(el?.customization?.buyXgetY?.DiscountBadge?.badgeType == "rightBanner"){
//             DISCOUNT_BADGE_DIV.className = "sd-bundle-product-badge";
//             DISCOUNT_BADGE_DIV.innerHTML = `<svg
//                       width="91"
//                       height="24"
//                       viewBox="0 0 91 24"
//                       fill="none"
//                       xmlns="http://www.w3.org/2000/svg"
//                     >
//                       <path
//                         d="M0 10L8.63148 0H83.3261L91 10H0Z"
//                         fill= ${
//                           el?.customization?.buyXgetY?.DiscountBadge
//                             ?.backgroundColor
//                         }
//                       />
//                       <path
//                         d="M9 0H83V19C83 21.7614 80.7614 24 78 24H14C11.2386 24 9 21.7614 9 19V0Z"
//                         fill= ${
//                           el?.customization?.buyXgetY?.DiscountBadge
//                             ?.backgroundColor
//                         }
//                       />
//                     </svg>`
//           } else{
//             DISCOUNT_BADGE_DIV.className = "sd-bundle-product-badge left-badge";
//             let DISCOUNT_BADGE_Internal_DIV = document.createElement("div");
//             DISCOUNT_BADGE_Internal_DIV.className = "open-badge";
//             DISCOUNT_BADGE_Internal_DIV.style.background = el?.customization?.buyXgetY?.DiscountBadge?.backgroundColor;
//             DISCOUNT_BADGE_DIV.append(DISCOUNT_BADGE_Internal_DIV);
//           }
//           let Badge_Text = document.createElement("h4");
//           Badge_Text.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
//           if(el.bundleDetail.discountType == "percent"){
//             Badge_Text.innerText = `${el.bundleDetail.discountValue}% Off`;
//           }else if(el.bundleDetail.discountType == "fixed"){
//             Badge_Text.innerText = `${showAmountWithCurrency(el.bundleDetail.discountValue)} Off`;
//           }else{
//             Badge_Text.innerText = `Free`;
//           }
//           DISCOUNT_BADGE_DIV.append(Badge_Text);
//           Badge_Text.style.color = el?.customization?.buyXgetY?.DiscountBadge?.color;
//           Badge_Text.style.fontSize = `${el?.customization?.buyXgetY?.DiscountBadge?.fontSize}px`;
//           MAIN_GET_PRODUCT_NAME_IMAGE_DIV.append(DISCOUNT_BADGE_DIV);
          
//           let Inner_Y_Div = document.createElement("div");
//           Inner_Y_Div.className = "sd-bundle-product-inner";
//           MAIN_GET_PRODUCT_NAME_IMAGE_DIV.append(Inner_Y_Div);
          
//           let GET_PRODUCT_IMAGE_DIV = document.createElement("div");
//           GET_PRODUCT_IMAGE_DIV.className = "sd-bundle-product-img";
//           GET_PRODUCT_IMAGE_DIV.style.border = "2px solid black";
//           GET_PRODUCT_IMAGE_DIV.style.borderColor = el?.customization?.buyXgetY?.productDetails?.image?.borderColor;
//           GET_PRODUCT_IMAGE_DIV.style.borderRadius = `${el?.customization?.buyXgetY?.productDetails?.image?.borderRadius}px`;
//           GET_PRODUCT_IMAGE_DIV.id = `GET_PRODUCT_IMAGE_DIV${bundleIndex}${Yindex}`;
//           Inner_Y_Div.append(GET_PRODUCT_IMAGE_DIV);

//           let GET_PRODUCTS_IMAGE = document.createElement("img");
//           GET_PRODUCTS_IMAGE.src = `${Yitems?.images[0]?.originalSrc}`;
//           GET_PRODUCT_IMAGE_DIV.append(GET_PRODUCTS_IMAGE);

//           let GET_PRODUCTS_NAME_PRICE_DIV = document.createElement("div");
//           GET_PRODUCTS_NAME_PRICE_DIV.className = "sd-bundle-product-name";
//           Inner_Y_Div.append(GET_PRODUCTS_NAME_PRICE_DIV);

//           let GET_PRODUCTS_NAME = document.createElement("h5");
//           GET_PRODUCTS_NAME.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
//           GET_PRODUCTS_NAME.style.fontSize = `${el?.customization?.buyXgetY?.productDetails?.title?.fontSize}px`;
//           GET_PRODUCTS_NAME.style.color = el?.customization?.buyXgetY?.productDetails?.title?.color;
//           GET_PRODUCTS_NAME.innerText = Yitems.title;
//           GET_PRODUCTS_NAME_PRICE_DIV.append(GET_PRODUCTS_NAME);

//           let GET_PRODUCTS_PRICE = document.createElement("h4");
//           GET_PRODUCTS_PRICE.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
//           GET_PRODUCTS_PRICE.id = `YproductsPriceDiv${Yindex}`;
//           GET_PRODUCTS_PRICE.style.fontSize = `${el?.customization?.buyXgetY?.productDetails?.price?.fontSize}px`;
//           GET_PRODUCTS_PRICE.style.color = el?.customization?.buyXgetY?.productDetails?.price?.color;
//           GET_PRODUCTS_PRICE.innerText = showAmountWithCurrency(`${Yitems?.variants[0]?.price}`);
//           GET_PRODUCTS_NAME_PRICE_DIV.append(GET_PRODUCTS_PRICE);

//           if(Yitems.minimumOrder>1){
//             let QuantityCounterDiv = document.createElement("div");
//             QuantityCounterDiv.className = "sd-bundle-mix-match-quantity-counter-div";
//             QuantityCounterDiv.id = `QuantityCounter${bundleIndex}${Yindex}`;
//             QuantityCounterDiv.style.borderColor = el?.customization?.buyXgetY?.productDetails?.quantities?.borderColor;
//             QuantityCounterDiv.style.background = el?.customization?.buyXgetY?.productDetails?.quantities?.backgroundColor;
//             QuantityCounterDiv.style.color = el?.customization?.buyXgetY?.productDetails?.quantities?.color;
//             QuantityCounterDiv.innerText = `${Yitems.minimumOrder}X`;
//             Inner_Y_Div.append(QuantityCounterDiv);
//           }
          
//           Array.from({ length: Yitems.minimumOrder }).map((_, i) => {
//             YproductsPriceArray.push({
//               price:`${Yitems.variants[0].price}`,
//               yProductId:`${Yitems.variants[0].id}`,
//               uniqueId: `Yproduct${Yindex}${i}`
//             })
//             calaculateOriginalPrice();
//             CalculateFinalPrice();
//             if (Yitems.variants.length > 1) {
//               let GET_PRODUCTS_SELECT_VARIANT = document.createElement("SELECT");
//               GET_PRODUCTS_SELECT_VARIANT.style.width = el?.customization?.buyXgetY?.productDetails?.variantSelector?.width+"px";
//               GET_PRODUCTS_SELECT_VARIANT.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
//               GET_PRODUCTS_SELECT_VARIANT.style.background = el?.customization?.buyXgetY?.productDetails?.variantSelector?.backgroundColor;
//               GET_PRODUCTS_SELECT_VARIANT.style.color = el?.customization?.buyXgetY?.productDetails?.variantSelector?.color;
//               GET_PRODUCTS_SELECT_VARIANT.id = `YvariantsSelect${Yindex}${i + 1}`;
//               GET_PRODUCTS_NAME_PRICE_DIV.appendChild(GET_PRODUCTS_SELECT_VARIANT);
          
//               let optionsHTML = Yitems.variants.map((Yvariants, YvariantsIndex) => `
//                 <option value="${Yvariants.id}" id="Yvariants${Yindex}${i + 1}${YvariantsIndex}" price="${Yvariants.price}">
//                   ${Yvariants.title}
//                 </option>
//               `).join('');
          
//               GET_PRODUCTS_SELECT_VARIANT.innerHTML = optionsHTML;
          
//               GET_PRODUCTS_SELECT_VARIANT.addEventListener("change", (e) => {
//                 let selectedOption = e.target.options[e.target.selectedIndex];
//                 let selectedVariantPrice = selectedOption.getAttribute("price");
//                 let selectedVariantID = selectedOption.getAttribute("value");
    
//                 let YproductsPriceArrayIndex = YproductsPriceArray.findIndex((checkProduct)=>checkProduct.uniqueId === `Yproduct${Yindex}${i}`);
//                 YproductsPriceArray.splice(YproductsPriceArrayIndex,1,{price:selectedVariantPrice,yProductId:selectedVariantID,uniqueId: `Yproduct${Yindex}${i}`});
//                 document.getElementById(`YproductsPriceDiv${Yindex}`).innerText = showAmountWithCurrency(selectedVariantPrice);
//                 let originalPrice = calaculateOriginalPrice();
//                 let finalPrice = CalculateFinalPrice();
//                 document.getElementById("sd-bxgy-original-price").innerText = showAmountWithCurrency(parseFloat(originalPrice).toFixed(2));
//                 document.getElementById("sd-bxgy-final-price").innerText = showAmountWithCurrency(parseFloat(finalPrice).toFixed(2));
//               });
//             }
//           });
//           let Quantity_Div = document.createElement("div");
//           Quantity_Div.className = "sd-bundle-product-quantity";
//           MAIN_GET_PRODUCT_NAME_IMAGE_DIV.append(Quantity_Div);
          
//           let Quantity_Text = document.createElement("h6");
//           Quantity_Text.style.fontSize = el?.customization?.buyXgetY?.productDetails?.quantities?.size+"px";
//           Quantity_Text.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
//           Quantity_Text.style.color = el?.customization?.buyXgetY?.productDetails?.quantities?.color;
//           Quantity_Text.innerText = `Qty: ${Yitems.minimumOrder}`;
//           Quantity_Div.append(Quantity_Text);
//         });

//         let TOTAL_SECTION_DIV = document.createElement("div");
//         TOTAL_SECTION_DIV.className = "sd-product-bundle-total";
//         BXGY_DIV.append(TOTAL_SECTION_DIV);

//         let Total_Desc_Div = document.createElement("div");
//         Total_Desc_Div.className = "sd-total-desc";
//         TOTAL_SECTION_DIV.append(Total_Desc_Div);
        
//         let TOTAL_TITLE_DIV = document.createElement("h4");
//         TOTAL_TITLE_DIV.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
//         TOTAL_TITLE_DIV.innerText = el?.translations?.translation?.total;
//         TOTAL_TITLE_DIV.style.fontSize = `${el?.customization?.buyXgetY?.totalSection?.fontSize}px`;
//         TOTAL_TITLE_DIV.style.color = el?.customization?.buyXgetY?.totalSection?.color;
//         Total_Desc_Div.append(TOTAL_TITLE_DIV);

//          if (
//           el.bundleDetail.discountType == "freeShipping" ||
//           el.bundleDetail.discountType == "noDiscount"
//         ) {
//           // no changes
//         } else {
//           let Discount_Description = document.createElement("p");
//           Discount_Description.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
//           Discount_Description.style.color = el?.customization?.buyXgetY?.totalSection?.discountMessage?.color;
//            Discount_Description.style.fontSize = el?.customization?.buyXgetY?.totalSection?.discountMessage?.size+"px";
//           Discount_Description.innerText = el?.translations?.translation?.discountApplied;
//           Total_Desc_Div.append(Discount_Description);
//          }

//         let MAIN_PRICE_DIV = document.createElement("div");
//         MAIN_PRICE_DIV.className = "sd-total-amount";
//         TOTAL_SECTION_DIV.append(MAIN_PRICE_DIV);

//         let ORIGINAL_PRICE_DIV = document.createElement("h6");
//         ORIGINAL_PRICE_DIV.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
//         ORIGINAL_PRICE_DIV.id = "sd-bxgy-original-price";
//         ORIGINAL_PRICE_DIV.innerText = showAmountWithCurrency(parseFloat(OriginalPrice).toFixed(2));
//         ORIGINAL_PRICE_DIV.style.fontSize = `${el?.customization?.buyXgetY?.totalSection?.originalPrice?.fontSize}px`;
//         ORIGINAL_PRICE_DIV.style.color = el?.customization?.buyXgetY?.totalSection?.originalPrice?.color;

//         let FINAL_PRICE_DIV = document.createElement("h4");
//         FINAL_PRICE_DIV.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
//         FINAL_PRICE_DIV.id = "sd-bxgy-final-price";
//         FINAL_PRICE_DIV.innerText = showAmountWithCurrency(parseFloat(FinalPrice).toFixed(2));
//         FINAL_PRICE_DIV.style.fontSize = `${el?.customization?.buyXgetY?.totalSection?.finalPrice?.fontSize}px`;
//         FINAL_PRICE_DIV.style.color = el?.customization?.buyXgetY?.totalSection?.finalPrice?.color;
//         MAIN_PRICE_DIV.append(FINAL_PRICE_DIV);
//         MAIN_PRICE_DIV.append(ORIGINAL_PRICE_DIV);

//         let ADD_TO_CART_DIV = document.createElement("div");
//         ADD_TO_CART_DIV.className = "sd-bundle-addto-cart";
//         BXGY_DIV.append(ADD_TO_CART_DIV);

//         let ADD_TO_CART_BUTTON = document.createElement("button");
//         ADD_TO_CART_BUTTON.style.borderColor = el?.customization?.buyXgetY?.button?.borderColor;
//         ADD_TO_CART_BUTTON.style.borderRadius = el?.customization?.buyXgetY?.button?.borderRadius+"px";
//         ADD_TO_CART_BUTTON.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
//         ADD_TO_CART_BUTTON.style.background = el?.customization?.buyXgetY?.button?.backgroundColor;
//         ADD_TO_CART_BUTTON.style.fontSize = `${el?.customization?.buyXgetY?.button?.fontSize}px`;
//         ADD_TO_CART_BUTTON.style.color = el?.customization?.buyXgetY?.button?.color;
//         ADD_TO_CART_BUTTON.innerText = el?.translations?.translation?.addToCartButton;
//         ADD_TO_CART_BUTTON.addEventListener("click", (e) => {
//             let code = JSON.parse(localStorage.getItem("sd_bundle_data"));
//             let discountCodeId = code.discountCreateId ?? "";
//             ADD_TO_CART_BUTTON.innerText = "";
//             let btnSpinner = document.createElement("div");
//             btnSpinner.className = "bundleBtnSpinner";
//             ADD_TO_CART_BUTTON.append(btnSpinner);

//             btnSpinner.style.display = "block";         
            
//             const XmergedGidArray = [];
//             const YmergedGidArray = [];
            
//             XproductsPriceArray.map((items)=>{
//               XmergedGidArray.push(items.xProductId);
//             })
//             YproductsPriceArray.map((items)=>{
//               YmergedGidArray.push(items.yProductId);
//               bundleSum[bundleIndex].push(items.price);
//             })
//           let lengthOfYProducts = YmergedGidArray.length
//             let XYmergedArray =  XmergedGidArray.concat(YmergedGidArray);
//             const mergedResult = {};
    
//           XYmergedArray.forEach(fullId => {
//             const numericId = fullId.split('/').pop();
//             if (mergedResult[numericId]) {
//                 mergedResult[numericId]++;
//             } else {
//                 mergedResult[numericId] = 1;
//             }
//           });
        
//           const result = Object.keys(mergedResult).map(numericId => ({
//             id: numericId,
//             quantity: mergedResult[numericId]
//           }));
//             let mergedArrayResult = Object.values(result);
//             let formData = {
//               items: mergedArrayResult,
//               attributes: { SD_BUNDLE_ID: el._id },
//             };
//             fetch(window.Shopify.routes.root + "cart/add.js", {
//               method: "POST",
//               headers: {
//                 "Content-Type": "application/json",
//               },
//               body: JSON.stringify(formData),
//             })
//               .then((response) => {
//                 return response.json();
//               })
//               .then((response) => {
//                 let errorDiv = document.getElementsByClassName(
//                   "sd-bundle-error-message"
//                 );
//                 errorDiv[0]?.remove();
//                 if (response.status == 422 || response.status == 404) {
//                   ADD_TO_CART_BUTTON.innerText =
//                     el.translations.translation.addToCartButton;
//                   btnSpinner.remove();
//                   let errorMessage = document.createElement("div");
//                   errorMessage.className = "sd-bundle-error-message";
//                   BXGY_DIV.append(errorMessage);
//                   errorMessage.innerText = response.description;
//                 } else {
//                   fetch(window.Shopify.routes.root + "cart.js", {
//                     method: "GET",
//                     headers: {
//                       "Content-Type": "application/json",
//                     },
//                   })
//                     .then((response) => {
//                       return response.json();
//                     })
//                     .then((response) => {
//                         let finalSumBundle = bundleSum[bundleIndex].reduce(
//                           (acc, curr) => acc.concat(curr),
//                           []
//                         );
//                         let myArray = finalSumBundle.map(parseFloat);
//                         let total = myArray.reduce(
//                           (accumulator, currentValue) =>
//                             accumulator + currentValue,
//                           0
//                         );

//                         let totalPrice = Number(total.toFixed(2));
//                         let finalPrice;
//                         switch (el.bundleDetail.discountType) {
//                           case "percent":
//                             let percentagepart = parseFloat(
//                               el.bundleDetail.discountValue
//                             );
//                             let percentage = (totalPrice * percentagepart) / 100;
//                             finalPrice = percentage.toFixed(2)/lengthOfYProducts;
//                             break;
//                           case "free":
//                             finalPrice = totalPrice.toFixed(2);
//                             break;
//                           case "fixed":
//                             let fixedPart = parseFloat(
//                               el.bundleDetail.discountValue
//                             );
//                             finalPrice = fixedPart.toFixed(2);
//                             break;
//                           default:
//                             break;
//                         }

//                         let isDiscount = "Fix";
//                         let sd_bundle_data = {
//                           discount_name: el.name,
//                           code: `${el.settings.discountLabel}-${code.code}`,
//                           discountType: isDiscount,
//                           discountValue: finalPrice,
//                           XvariantsId: XmergedGidArray,
//                           YvariantsId: YmergedGidArray,
//                           startDate: new Date(),
//                           endDate: el.endDate,
//                           shop: Shopify.shop,
//                           type : el.type,
//                           bundleType: el.bundleDetail.discountType,
//                           totalPrice: total.toFixed(2),
//                           discountCreateId: discountCodeId,
//                         };

//                         fetch(server + "/api/storefront/createRule", {
//                           method: "POST",
//                           headers: {
//                             "Content-Type": "application/json",
//                           },
//                           body: JSON.stringify(sd_bundle_data),
//                         })
//                           .then((response) => response.json())
//                           .then((data) => {
//                             if (data.status == 200) {
//                               fetch(`${server}/api/storefront/getBundleClick`, {
//                                 method: "POST",
//                                 headers: {
//                                   "Content-Type": "application/json",
//                                 },
//                                 body: JSON.stringify({
//                                   shop: Shopify.shop,
//                                   bundleId: el._id,
//                                 }),
//                               });
                              
//                               let sd_bundle_data = {
//                                 discount_name: el.name,
//                                 bundle_type: el.type,
//                                 code: code.code,
//                                 bundleId: el._id,
//                                 discountType: isDiscount,
//                                 variantsId: mergedArrayResult,
//                                 discountCreateId: data.response,
//                                 prefixCode: el.settings.discountLabel,
//                               };
//                               var jsonString = JSON.stringify(sd_bundle_data);
//                               localStorage.setItem("sd_bundle_data", jsonString);
//                               ADD_TO_CART_BUTTON.innerText =
//                               el.translations.translation.addToCartButton;
//                               btnSpinner.remove();
//                               cartDrawer();
//                             }
//                           });
//                     })
//                     .catch((error) => {
//                       ADD_TO_CART_BUTTON.innerText =
//                         el.translations.translation.addToCartButton;
//                     });
//                 }
//               })
//               .catch((error) => {
//                 console.error("Error:", error);
//               });
//           })
//         ADD_TO_CART_DIV.append(ADD_TO_CART_BUTTON);

//         function calaculateOriginalPrice(){
//           let XproductsPrice = XproductPriceCalculate();
//           let YproductsPrice = YproductPriceCalculate();
//           OriginalPrice = XproductsPrice + YproductsPrice;
//           return parseFloat(OriginalPrice).toFixed(2);
//         }

//         function XproductPriceCalculate() {
//           let XproductsPrice = 0;
//           XproductsPriceArray.map((item)=>{
//             XproductsPrice += parseFloat(item.price);
//           })
//           return XproductsPrice;
//         }

//         function YproductPriceCalculate(params) {
//           let YproductsPrice = 0;
//           YproductsPriceArray.map((item)=>{
//             YproductsPrice += parseFloat(item.price);
//           })
//           return YproductsPrice;
//         }

//         function CalculateFinalPrice() {
//           let XproductsPrice = XproductPriceCalculate();
//           let YproductsPrice = YproductPriceCalculate();

//           if(el.bundleDetail.discountType == "fixed"){
//             YproductsPrice = YproductsPrice-el.bundleDetail.discountValue*YproductsPriceArray.length;
//             FinalPrice = parseFloat(XproductsPrice + YproductsPrice);
//             return parseFloat(FinalPrice).toFixed(2);
            
//           }else if(el.bundleDetail.discountType == "percent"){
//             let percentage = YproductsPrice*el.bundleDetail.discountValue/100;
//             YproductsPrice = YproductsPrice - percentage;
//             FinalPrice = XproductsPrice + YproductsPrice;
//             return FinalPrice;
            
//           }else if(el.bundleDetail.discountType == "free"){
//             FinalPrice = XproductsPrice
//             return FinalPrice;
//           }
//         }
      
//         if (el.plans.plan == "free") {
//           waterMark(BXGY_DIV);
//         }
//       }
//     }
//   }); 
// }
// let selectedProducts = [];
// let pageInfoTotalPrice;
// async function bundlePageBuilder(data) {
//   const url = window.location.href;

//   let mainContainer = document.getElementById("sd-bundle-container");

//   if (data.status == 200) {
//     let pageWidth = document.getElementsByClassName("page-width--narrow")[0];
//     pageWidth.style.width = "100%";
//     pageWidth.style.left = "0px";
//     pageWidth.style.marginRight = "0px";
//     pageWidth.style.marginLeft = "0px";
//     pageWidth.style.maxWidth = "100%";
//     pageWidth.style.paddingLeft = "unset";
//     pageWidth.style.paddingRight = "unset";
//     pageWidth.style.textAlign = "center";
//     let innerPageWidth = document.getElementsByClassName("rte")[0];
//     innerPageWidth.style.width = "100%";
//     innerPageWidth.style.left = "0px";
//     innerPageWidth.style.marginRight = "0px";
//     innerPageWidth.style.marginLeft = "0px";
//     innerPageWidth.style.maxWidth = "100%";
//     innerPageWidth.style.paddingLeft = "unset";
//     innerPageWidth.style.paddingRight = "unset";
//     innerPageWidth.style.textAlign = "center";
//     let BUNDLE = data.response;
//     let mainContainer = document.getElementById("sd-bundle-container");

//     let BUNDLE_BUILDER_DIV = document.createElement("div");
//     mainContainer.append(BUNDLE_BUILDER_DIV);
//     BUNDLE_BUILDER_DIV.className = "sd-bundle-builder-container";

//     let BUNDLE_BUILDER_TITLE_DIV = document.createElement("div");
//     BUNDLE_BUILDER_TITLE_DIV.className = "sd-bundle-builder-title-container";
//     BUNDLE_BUILDER_DIV.append(BUNDLE_BUILDER_TITLE_DIV);
//     let bundlebuilderTitle = document.createElement("div");
//     bundlebuilderTitle.className = "sd-bundle-builder-title";
//     BUNDLE_BUILDER_TITLE_DIV.append(bundlebuilderTitle);
//     let titleText = document.createElement("span");
//     titleText.className = "sd-bundle-builder-title-text";
//     titleText.innerText = BUNDLE.title;
//     bundlebuilderTitle.append(titleText);
//     let bundleDescription = document.createElement("div");
//     BUNDLE_BUILDER_TITLE_DIV.append(bundleDescription);
//     bundleDescription.className = "sd-bundle-builder-description-box";
//     let descriptionText = document.createElement("span");
//     descriptionText.className = "sd-bundle-builder-description-text";
//     if (BUNDLE.bundleDetail.description.includes("{discount}")) {
//       if (BUNDLE.bundleDetail.discountType == "percent") {
//         let updatedString = BUNDLE.bundleDetail.description.replace(
//           "{discount}",
//           BUNDLE.bundleDetail.discountValue + "%"
//         );
//         descriptionText.innerText = updatedString;
//       } else if (
//         BUNDLE.bundleDetail.discountType == "price" ||
//         BUNDLE.bundleDetail.discountType == "fixed"
//       ) {
//         let newPrice = sdCurrencySymbolCode.replace(
//           "{{amount}}",
//           BUNDLE.bundleDetail.discountValue
//         );
//         let updatedString = BUNDLE.bundleDetail.description.replace(
//           "{discount}",
//           newPrice + " " + BUNDLE.translations.translation.off
//         );
//         descriptionText.innerText = updatedString;
//       } else if (
//         BUNDLE.bundleDetail.discountType == "noDiscount" ||
//         BUNDLE.bundleDetail.discountType == "freeShipping"
//       ) {
//         descriptionText.innerText = BUNDLE.bundleDetail.description;
//       }
//     } else {
//       descriptionText.innerText = BUNDLE.bundleDetail.description;
//     }
//     bundleDescription.append(descriptionText);
//     let BUNDLE_DATA_DIV = document.createElement("div");
//     BUNDLE_DATA_DIV.className = "sd-bundle-builder-data-container";
//     BUNDLE_BUILDER_DIV.append(BUNDLE_DATA_DIV);

//     BUNDLE.bundleDetail.products.forEach((el, index) => {
//       selectedProducts.push([]);
//       let collectionDiv = document.createElement("div");
//       collectionDiv.className = "sd-bundle-builder-collection-data";
//       BUNDLE_DATA_DIV.append(collectionDiv);
//       let collectionDataHeader = document.createElement("div");
//       collectionDataHeader.className = "sd-bundle-builder-collection-data-header";
//       collectionDiv.append(collectionDataHeader);
//       let arrowBtn = document.createElement("div");
//       arrowBtn.className = "sd-bundle-builder-arrow";
//       arrowBtn.innerHTML = `<svg width="20" height="20" viewBox="0 0 20 20" fill="#5E5E5E" xmlns="http://www.w3.org/2000/svg" style=" width: 30px; height: 30px;"><path fill-rule="evenodd" clip-rule="evenodd" d="M8.00025 16C7.74425 16 7.48825 15.902 7.29325 15.707C6.90225 15.316 6.90225 14.684 7.29325 14.293L11.5863 10L7.29325 5.70701C6.90225 5.31601 6.90225 4.68401 7.29325 4.29301C7.68425 3.90201 8.31625 3.90201 8.70725 4.29301L13.7073 9.29301C14.0983 9.68401 14.0983 10.316 13.7073 10.707L8.70725 15.707C8.51225 15.902 8.25625 16 8.00025 16Z" fill="current"></path></svg>`;
//       collectionDataHeader.append(arrowBtn);

//       arrowBtn.className = "sd-accordion-arrow";

//       let collectionImgDiv = document.createElement("div");
//       collectionImgDiv.className = "sd-bundle-builder-image-box";
//       collectionDataHeader.append(collectionImgDiv);
//       let collectionImg = document.createElement("img");
//       collectionImg.className = "sd-bundle-builder-collection-image";
//       let collectionBuilderImg = el?.image?.originalSrc ?? smartNoImg;
//       collectionImg.setAttribute("src", collectionBuilderImg);
//       collectionImgDiv.append(collectionImg);
//       let collectionTitleDiv = document.createElement("div");
//       collectionTitleDiv.className = "sd-bundle-builder-title-div";
//       collectionDataHeader.append(collectionTitleDiv);
//       collectionDataHeader.addEventListener("click", (e) => {
//         let accordingDiv = document.getElementsByClassName(
//           "sd-bundle-CMM-main-Box" + index
//         );
//         if (accordingDiv[0].style.maxHeight === "0px") {
//           accordingDiv[0].style.maxHeight = "694px";
//           arrowBtn.classList.add("sd-accordion-active");
//         } else {
//           accordingDiv[0].style.maxHeight = "0px";
//           arrowBtn.classList.remove("sd-accordion-active");
//         }
//       });
//       let collectionTitle = document.createElement("div");
//       collectionTitle.className = "sd-bundle-builder-collection-title-text";
//       collectionTitle.innerText = el.title;
//       collectionTitleDiv.append(collectionTitle);
//       let collectionAddItemText = document.createElement("div");
//       collectionAddItemText.className = "sd-bundle-builder-additemtext";

//       let TranslatedcollectionAddItemText = data.response.translations.translation.addItemToSaveMore.replace("{{item}}",el.quantity);
//       collectionAddItemText.innerText = TranslatedcollectionAddItemText;
//       collectionTitleDiv.append(collectionAddItemText);

//       let collctionProductMainBox = document.createElement("div");
//       collctionProductMainBox.className = "sd-bundle-CMM-main-Box" + index;
//       collctionProductMainBox.classList.add("sd-accordion-panel");
//       collctionProductMainBox.style.maxHeight = "0px";
//       collectionDiv.append(collctionProductMainBox);

//       let nextPageCursor = "";
//       let hasNextPage = "";
//       let collectionGid = el.id;

//       fetch(server + "/api/storefront/getCollectionProdcuts", {
//         method: "POST",
//         headers: {
//           "Content-Type": "application/json",
//         },
//         body: JSON.stringify({
//           shop: Shopify.shop,
//           collectionGid: collectionGid,
//           nextPageCursor: nextPageCursor,
//           hasNextPage: hasNextPage,
//         }),
//       })
//         .then((res) => res.json())
//         .then((response) => {
//           const lastValue = response?.response?.products?.edges[response?.response?.products?.edges?.length - 1];
//           nextPageCursor = lastValue?.cursor;
//           hasNextPage = response?.response?.products?.pageInfo?.hasNextPage;

//           let bundleDivider = document.createElement("div");
//           bundleDivider.className = "sd-bundle-builder-divider";
//           collctionProductMainBox.append(bundleDivider);
//           let searchBarDiv = document.createElement("div");
//           searchBarDiv.className = "sd-bundle-builder-search-bar-container";
//           collctionProductMainBox.append(searchBarDiv);
//           let searchBar = document.createElement("input");
//           searchBar.className = "sd-bundle-builder-search-bar";
//           searchBar.setAttribute("type", "text");
//           searchBar.placeholder = "Search Products";
//           searchBarDiv.append(searchBar);
//           let CollectionProductDiv = document.createElement("div");
//           CollectionProductDiv.className = "sd-bundle-collectionMixMatch-all-product-div";
//           CollectionProductDiv.classList.add( "collectionMixMatch-allProduct-div" + index);
//           collctionProductMainBox.append(CollectionProductDiv);

//           let pdata = response?.response?.products;
//           CollectionProductsData(pdata, CollectionProductDiv);
//           let delayTimer;

//           let searchSpinner = document.createElement("div");

//           searchBar.addEventListener("keyup", (e) => {
//             CollectionProductDiv.innerHTML = "";
//             searchSpinner.className = "sd-search-spinner";
//             searchSpinner.classList.add("sd-loader");
//             CollectionProductDiv.append(searchSpinner);

//             document.getElementsByClassName(
//               "sd-builder-seemore-div" + index
//             )[0].style.display = "none";

//             clearTimeout(delayTimer);
//             delayTimer = setTimeout(function () {
//               if (e.target.value.length > 0) {
//                 fetch(server + "/api/storefront/searchCollectionProducts", {
//                   method: "POST",
//                   headers: {
//                     "Content-Type": "application/json",
//                   },
//                   body: JSON.stringify({
//                     shop: Shopify.shop,
//                     collectionGid: collectionGid,
//                     nextPageCursor: nextPageCursor,
//                     hasNextPage: hasNextPage,
//                     search: e.target.value,
//                   }),
//                 })
//                   .then((res) => res.json())
//                   .then((response) => {
//                     CollectionProductDiv.innerHTML = "";
//                     if (response.response.edges) {
//                       const lastValue =
//                         response?.response?.edges[
//                           response.response.edges.length - 1
//                         ];
//                       nextPageCursor = lastValue?.cursor;
//                       hasNextPage = response?.response?.pageInfo?.hasNextPage;
//                     } else {
//                       hasNextPage = false;
//                     }
//                     if (hasNextPage == false) {
//                       document.getElementsByClassName(
//                         "sd-builder-seemore-div" + index
//                       )[0].style.display = "none";
//                     } else {
//                       document.getElementsByClassName(
//                         "sd-builder-seemore-div" + index
//                       )[0].style.display = "block";
//                     }
//                     let pdata = response.response;

//                     CollectionProductsData(pdata, CollectionProductDiv);
//                   })
//                   .catch((error) => {
//                     console.log(error.message);
//                   });
//               } else {
//                 fetch(server + "/api/storefront/getCollectionProdcuts", {
//                   method: "POST",
//                   headers: {
//                     "Content-Type": "application/json",
//                   },
//                   body: JSON.stringify({
//                     shop: Shopify.shop,
//                     collectionGid: collectionGid,
//                     nextPageCursor: nextPageCursor,
//                     hasNextPage: hasNextPage,
//                   }),
//                 })
//                   .then((res) => res.json())
//                   .then((response) => {
//                     CollectionProductDiv.innerHTML = "";
//                     const lastValue =
//                       response?.response?.products?.edges[
//                         response?.response?.products?.edges?.length - 1
//                       ];
//                     nextPageCursor = lastValue?.cursor;
//                     hasNextPage =
//                       response?.response?.products?.pageInfo?.hasNextPage;
//                     let pdata = response?.response?.products;
//                     if (hasNextPage == false) {
//                       document.getElementsByClassName(
//                         "sd-builder-seemore-div" + index
//                       )[0].style.display = "none";
//                     } else {
//                       document.getElementsByClassName(
//                         "sd-builder-seemore-div" + index
//                       )[0].style.display = "block";
//                     }
//                     CollectionProductsData(pdata, CollectionProductDiv);
//                   })
//                   .catch((error) => {
//                     console.log(error.message);
//                   });
//               }
//             }, 1000);
//           });
//           if (hasNextPage == true) {
//             let seeMoreButtonDiv = document.createElement("div");
//             seeMoreButtonDiv.className = "sd-bundle-CMM-see-more-div";
//             seeMoreButtonDiv.classList.add("sd-builder-seemore-div" + index);
//             collctionProductMainBox.append(seeMoreButtonDiv);
//             let seeMoreButton = document.createElement("button");
//             seeMoreButton.className = "sd-bundle-CMM-seeMore-btn";
//             seeMoreButton.innerText = data.response.translations.translation.seeMore;
//             seeMoreButtonDiv.append(seeMoreButton);

//             seeMoreButton.addEventListener("click", (e) => {
//               seeMoreButton.classList.add("sd-spinnerDiv");
//               let spinnerDiv = document.createElement("div");
//               seeMoreButton.innerHTML = '<div class="sd-loader"></div>';

//               let formData = {
//                 shop: Shopify.shop,
//                 hasNextPage: hasNextPage,
//                 gid: response.response.id,
//                 nextPageCursor: nextPageCursor,
//               };

//               fetch(server + "/api/storefront/getMoreCollectionProducts", {
//                 method: "POST",
//                 headers: {
//                   "Content-Type": "application/json",
//                 },
//                 body: JSON.stringify(formData),
//               })
//                 .then((res) => res.json())
//                 .then((response) => {
//                   if (response.flag == 1) {
//                     const sdLoader =
//                       document.getElementsByClassName("sd-loader");
//                     seeMoreButton.innerText =
//                       data.response.translations.translation.seeMore;
//                     seeMoreButton.classList.remove("sd-spinnerDiv");
//                     const lastValue =
//                       response?.response?.products?.edges[
//                         response?.response?.products?.edges?.length - 1
//                       ];
//                     nextPageCursor = lastValue?.cursor;
//                     hasNextPage =
//                       response?.response?.products?.pageInfo?.hasNextPage;
//                     if (hasNextPage == false) {
//                       document.getElementsByClassName(
//                         "sd-builder-seemore-div" + index
//                       )[0].style.display = "none";
//                     } else {
//                       document.getElementsByClassName(
//                         "sd-builder-seemore-div" + index
//                       )[0].style.display = "block";
//                     }
//                     let pdata = response?.response?.products;

//                     CollectionProductsData(pdata, CollectionProductDiv);
//                   } else {
//                     document.getElementsByClassName(
//                       "sd-builder-seemore-div" + index
//                     )[0].style.display = "none";
//                   }
//                 })
//                 .catch((error) => {
//                   console.log(error.message);
//                 });
//             });
//           } else {
//               let seeMoreButtonDiv = document.createElement("div");
//               seeMoreButtonDiv.className = "sd-bundle-CMM-see-more-div";
//               seeMoreButtonDiv.classList.add("sd-builder-seemore-div" + index);
//               collctionProductMainBox.append(seeMoreButtonDiv);
//           }

//           if (hasNextPage == false) {
//             document.getElementsByClassName(
//               "sd-builder-seemore-div" + index
//             )[0].style.display = "none";
//           } else if (hasNextPage == true) {
//             document.getElementsByClassName(
//               "sd-builder-seemore-div" + index
//             )[0].style.display = "block";
//           }
//         })
//         .catch((error) => {});

//       function CollectionProductsData(response, newDiv) {
//         if (response?.edges?.length) {
//           response.edges.map((ele) => {
//             let productDiv = document.createElement("div");
//             productDiv.className = "sd-bundle-CMM-productDiv";
//             newDiv.append(productDiv);
//             let productImageDiv = document.createElement("div");

//             productImageDiv.className = "sd-bundle-CMM-product-img-div";
//             productDiv.append(productImageDiv);
//             let productImg = document.createElement("img");
//             productImg.className = "sd-bundle-CMM-product-img";
//             productImageDiv.append(productImg);
//             let builderProductImg = ele?.node?.images?.edges[0]?.node?.url ?? smartNoImg;
//             productImg.setAttribute("src", builderProductImg);
//             let productTitleDiv = document.createElement("div");
//             productTitleDiv.className = "sd-bundle-CMM-product-title-div";
//             productDiv.append(productTitleDiv);
//             productTitleDiv.innerText = ele.node.title;
//             let productPriceDiv = document.createElement("div");
//             productPriceDiv.className = "sd-bundle-builder-product-price";

//             let newProductPrice = ele.node.variants.edges[0].node.price;

//             productPriceDiv.innerText = showAmountWithCurrency(newProductPrice);
//             productDiv.append(productPriceDiv);

//             let productButtonDiv = document.createElement("div");
//             productButtonDiv.className = "sd-bundle-builder-product-btn-box";
//             productDiv.append(productButtonDiv);

//             if (ele.node.variants.edges.length <= 1) {
//               let addProductButton = document.createElement("button");
//               addProductButton.className = "sd-bundle-builder-add-product-btn";

//               addProductButton.innerText = data.response.translations.translation.add;
//               addProductButton.classList.add("sd-button-add");
//               productButtonDiv.append(addProductButton);
//               addProductButton.addEventListener("click", (e) => {
//                 if (
//                   data.response.bundleDetail.products[index].quantity >
//                   selectedProducts[index].length
//                 ) {
//                   selectedProducts[index].push({
//                     title: ele.node.title,
//                     variantTitle: ele.node.variants.edges[0].node.title,
//                     id: ele.node.variants.edges[0].node.id,
//                     price: ele.node.variants.edges[0].node.price,
//                     image: ele?.node?.images?.edges[0]?.node.url,
//                   });
//                   const getDiv = document.getElementById(
//                     "sd-builder-info-variants-data" + index
//                   );
//                   getDiv.innerHTML = "";

//                   addselectedProductList(selectedProducts, index, "", data);

//                   const quantity = document.getElementById(
//                     `sd-quantityCheck${index}`
//                   );
//                   quantity.innerText = selectedProducts[index].length;
//                   if (
//                     data.response.bundleDetail.products[index].quantity ==
//                     selectedProducts[index].length
//                   ) {
//                     document.getElementsByClassName(
//                       "sd-bundle-CMM-main-Box" + index
//                     )[0].style.maxHeight = "0px";
//                     arrowBtn.classList.remove("sd-accordion-active");
//                   }
//                 }

//                 sumOfVariants(selectedProducts, data);
//                 if (
//                   !checkCartButtonActive(
//                     selectedProducts,
//                     data.response.bundleDetail.products
//                   )
//                 ) {
//                   const getCartButton = document.getElementById(
//                     "sd-builder-cart-info-add-btn"
//                   );
//                   getCartButton.style.background = "black";
//                   getCartButton.style.color = "white";
//                   getCartButton.style.cursor = "pointer";
//                   getCartButton.disabled = false;
//                 }
//               });
//             } else {
//               let productSelectVariant = document.createElement("select");
//               productSelectVariant.className = "sd-builder-select-variants";
//               productButtonDiv.append(productSelectVariant);
//               let productSelectOptions = document.createElement("option");
//               productSelectVariant.append(productSelectOptions);
//               productSelectOptions.value = data.response.translations.translation.add;
//               productSelectOptions.innerText = data.response.translations.translation.add;
//               productSelectOptions.hidden = true;

//               ele.node.variants.edges.map((elem, variantIndex) => {
//                 let productSelectOptions = document.createElement("option");
//                 productSelectOptions.value = elem.node.id.replace(
//                   "gid://shopify/ProductVariant/",
//                   ""
//                 );
//                 productSelectOptions.setAttribute("index", variantIndex);
//                 productSelectOptions.textContent = elem.node.title;
//                 productSelectVariant.appendChild(productSelectOptions);
//               });
//               productSelectVariant.addEventListener("change", (e) => {
//                 if (
//                   data.response.bundleDetail.products[index].quantity >
//                   selectedProducts[index].length
//                 ) {
//                   let get_val = event.target.selectedOptions[0].getAttribute("index");
//                   selectedProducts[index].push({
//                     title: ele.node.title,
//                     variantTitle: ele.node.variants.edges[get_val].node.title,
//                     id: ele.node.variants.edges[get_val].node.id,
//                     price: ele.node.variants.edges[get_val].node.price,
//                     image: ele?.node?.images?.edges[0]?.node.url,
//                   });
//                   const getDiv = document.getElementById(
//                     "sd-builder-info-variants-data" + index
//                   );
//                   getDiv.innerHTML = "";
//                   addselectedProductList(selectedProducts, index, "", data);
//                   const quantity = document.getElementById(
//                     `sd-quantityCheck${index}`
//                   );
//                   quantity.innerText = selectedProducts[index].length;
//                   sumOfVariants(selectedProducts, data);
//                   if (
//                     !checkCartButtonActive(
//                       selectedProducts,
//                       data.response.bundleDetail.products
//                     )
//                   ) {
//                     const getCartButton = document.getElementById(
//                       "sd-builder-cart-info-add-btn"
//                     );
//                     getCartButton.style.color = "red";
//                   }
//                   if (
//                     data.response.bundleDetail.products[index].quantity ==
//                     selectedProducts[index].length
//                   ) {
//                     document.getElementsByClassName(
//                       "sd-bundle-CMM-main-Box" + index
//                     )[0].style.maxHeight = "0px";
//                   }
//                   if (
//                     !checkCartButtonActive(
//                       selectedProducts,
//                       data.response.bundleDetail.products
//                     )
//                   ) {
//                     const getCartButton = document.getElementById(
//                       "sd-builder-cart-info-add-btn"
//                     );
//                     getCartButton.style.background = "black";
//                     getCartButton.style.color = "white";
//                     getCartButton.style.cursor = "pointer";
//                     getCartButton.disabled = false;
//                   }
//                 }
//               });
//             }
//           });
//         } else {
//           let emptyDiv = document.createElement("div");
//           emptyDiv.className = "sd-builder-empty-conatiner";
//           newDiv.append(emptyDiv);
//           emptyDiv.innerText = "No products";
//         }
//       }
//     });
//   }
//   let BUNDLE_BUILDER_INFO_DIV = document.createElement("div");
//   BUNDLE_BUILDER_INFO_DIV.className = "sd-bundle-builder-info-container";
//   mainContainer.append(BUNDLE_BUILDER_INFO_DIV);
//   let INFO_DIV_ADDED_ITEM_TEXT = document.createElement("h5");
//   INFO_DIV_ADDED_ITEM_TEXT.className = "sd-Info-Div-added-item-text";
//   INFO_DIV_ADDED_ITEM_TEXT.innerText =
//     data?.response?.translations?.translation?.addedItems;
//   BUNDLE_BUILDER_INFO_DIV.append(INFO_DIV_ADDED_ITEM_TEXT);
//   let CART_INFO_CART_BODY = document.createElement("div");
//   CART_INFO_CART_BODY.className = "sd-Builder-Cart-Info-Body";
//   BUNDLE_BUILDER_INFO_DIV.append(CART_INFO_CART_BODY);
//   let CART_INFO_CART_ACCORDIONS_DIV = document.createElement("div");
//   CART_INFO_CART_ACCORDIONS_DIV.className =
//     "sd-builder-Cart-Products-Accordions-container";
//   CART_INFO_CART_BODY.append(CART_INFO_CART_ACCORDIONS_DIV);
//   data.response.bundleDetail.products.map((ele, subIndex) => {
//     let productAccordionDiv = document.createElement("div");
//     productAccordionDiv.className =
//       "sd-builder-cart-info-product-accordion-box";
//     CART_INFO_CART_ACCORDIONS_DIV.append(productAccordionDiv);
//     let productAccordionHeading = document.createElement("div");
//     productAccordionHeading.className = "sd-builder-accordion-header-box";
//     productAccordionDiv.append(productAccordionHeading);

//     let headingArrow = document.createElement("div");
//     headingArrow.className = "sd-accordion-arrow";
//     productAccordionHeading.append(headingArrow);

//     let headerCollectionName = document.createElement("span");
//     headerCollectionName.className = "Sd-builder-accordion-heading-name";
//     headerCollectionName.innerText = ele.title;
//     productAccordionHeading.append(headerCollectionName);
//     let variantCounterDiv = document.createElement("div");
//     variantCounterDiv.className = "sd-builder-variant-counter-container";
//     productAccordionHeading.append(variantCounterDiv);
//     let variantCounter = document.createElement("span");
//     let variantCounter1 = document.createElement("span");
//     variantCounter.className = "sd-builder-variant-counter";
//     variantCounter1.className = "sd-builder-variant-counter";
//     console.warn(data);
//     variantCounter.innerText = `/${ele.quantity} ${data.response.translations.translation.added}`;
//     variantCounter1.innerText = "0";
//     variantCounter1.id = `sd-quantityCheck${subIndex}`;
//     variantCounterDiv.append(variantCounter1);
//     variantCounterDiv.append(variantCounter);
//     let productPanel = document.createElement("div");
//     productPanel.className = "sd-builder-product-panel";

//     productAccordionDiv.append(productPanel);
//     let noVariantDiv = document.createElement("div");
//     noVariantDiv.id = "sd-builder-selectedProductContainer" + subIndex;
//     productPanel.append(noVariantDiv);
//     let innerDivContent;
//     noVariantDiv.className = "sd-builder-no-Variant-container";

//     innerDivContent = document.createElement("span");
//     innerDivContent.className = "sd-builder-plus-icon-container";
//     innerDivContent.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M20.3999 10.8004H13.1999V3.60039C13.1999 2.93799 12.6635 2.40039 11.9999 2.40039C11.3363 2.40039 10.7999 2.93799 10.7999 3.60039V10.8004H3.5999C2.9363 10.8004 2.3999 11.338 2.3999 12.0004C2.3999 12.6628 2.9363 13.2004 3.5999 13.2004H10.7999V20.4004C10.7999 21.0628 11.3363 21.6004 11.9999 21.6004C12.6635 21.6004 13.1999 21.0628 13.1999 20.4004V13.2004H20.3999C21.0635 13.2004 21.5999 12.6628 21.5999 12.0004C21.5999 11.338 21.0635 10.8004 20.3999 10.8004Z" fill="#727272"></path></svg>`;

//     noVariantDiv.append(innerDivContent);
//     let noVariantText = document.createElement("span");
//     noVariantText.className = "sd-builder-no-variant-text";
//     noVariantText.innerText = "Please add products from collections";
//     noVariantDiv.append(noVariantText);
//     let variantDataDiv = document.createElement("div");
//     variantDataDiv.id = "sd-builder-info-variants-data" + subIndex;
//     variantDataDiv.classList.add("sd-info-variants-data");
//     productPanel.append(variantDataDiv);
//   });
//   if (data.response.bundleDetail.discountType == "freeShipping") {
//     let noShippingDiv = document.createElement("div");
//     noShippingDiv.className = "sd-bundle-no-shopping-container";
//     CART_INFO_CART_BODY.append(noShippingDiv);
//     let shippingIcon = document.createElement("span");
//     shippingIcon.className = "sd-bundle-shipping-icon";
//     shippingIcon.innerHTML = `<svg viewBox="0 0 1024 1024" focusable="false" data-icon="shopping-cart" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M922.9 701.9H327.4l29.9-60.9 496.8-.9c16.8 0 31.2-12 34.2-28.6l68.8-385.1c1.8-10.1-.9-20.5-7.5-28.4a34.99 34.99 0 00-26.6-12.5l-632-2.1-5.4-25.4c-3.4-16.2-18-28-34.6-28H96.5a35.3 35.3 0 100 70.6h125.9L246 312.8l58.1 281.3-74.8 122.1a34.96 34.96 0 00-3 36.8c6 11.9 18.1 19.4 31.5 19.4h62.8a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7h161.1a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7H923c19.4 0 35.3-15.8 35.3-35.3a35.42 35.42 0 00-35.4-35.2zM305.7 253l575.8 1.9-56.4 315.8-452.3.8L305.7 253zm96.9 612.7c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6zm325.1 0c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6z"></path></svg>`;
//     noShippingDiv.append(shippingIcon);
//     let noShippingText = document.createElement("span");
//     noShippingText.className = "sd-bundle-noShipping-text";
//     noShippingText.innerText = data.response.translations.translation.FreeShipping;
//     noShippingDiv.append(noShippingText);
//   }
//   let CART_INFO_ACTION_BOX = document.createElement("div");

//   CART_INFO_ACTION_BOX.className = "sd-builder-Cart-Info-Action-Box";
//   CART_INFO_CART_BODY.append(CART_INFO_ACTION_BOX);
//   let CART_INFO_TOTAL_DIV = document.createElement("div");
//   CART_INFO_TOTAL_DIV.className = "sd-builder-total-container";
//   CART_INFO_ACTION_BOX.append(CART_INFO_TOTAL_DIV);
//   let totalText = document.createElement("span");
//   totalText.className = "sd-builder-total-text";
//   totalText.innerText = data.response.translations.translation.total;
//   CART_INFO_TOTAL_DIV.append(totalText);
//   let totalPriceText = document.createElement("span");
//   totalPriceText.className = "sd-builder-total-ptice-container";
//   CART_INFO_TOTAL_DIV.append(totalPriceText);
//   let totalRawPrice = document.createElement("span");
//   totalRawPrice.className = "sd-builder-total-raw-price";
//   totalRawPrice.id = "sd-builder-total-raw-price";
//   if (
//     data.response.bundleDetail.discountType == "freeShipping" ||
//     data.response.bundleDetail.discountType == "noDiscount"
//   ) {
//     totalRawPrice.style.textDecoration = "none";
//   }
//   let newTotalPrice = "0.00";

//   totalRawPrice.innerText = showAmountWithCurrency(newTotalPrice);
//   totalPriceText.append(totalRawPrice);
//   let totalDiscountedPrice = document.createElement("span");
//   totalDiscountedPrice.className = "sd-builder-total-discounted-price";
//   totalDiscountedPrice.id = "sd-builder-total-discounted-price-text";
//   totalDiscountedPrice.innerText = "";
//   totalPriceText.append(totalDiscountedPrice);
//   let CART_INFO_ADD_BTN_div = document.createElement("div");
//   CART_INFO_ADD_BTN_div.ClassName = "sd-builder-add-btn-container";
//   CART_INFO_ACTION_BOX.append(CART_INFO_ADD_BTN_div);
//   let cartAddBtn = document.createElement("button");

//   cartAddBtn.className = "sd-builder-cart-info-add-btn";
//   cartAddBtn.id = "sd-builder-cart-info-add-btn";
//   cartAddBtn.style.cursor = "no-drop";
//   cartAddBtn.disabled = true;
//   let newtPrice = sdCurrencySymbolCode.replace(
//     "{{amount}}",
//     data.response.bundleDetail.discountValue
//   );

//   let t =
//     data.response.bundleDetail.discountType == "percent"
//       ? data.response.bundleDetail.discountValue + "%"
//       : data.response.bundleDetail.discountType == "fixed"
//       ? newtPrice + " " + "Off"
//       : "";

//   cartAddBtn.innerText = data.response.translations.translation.addToCartButton;
//   CART_INFO_ADD_BTN_div.append(cartAddBtn);

//   cartAddBtn.addEventListener("click", (e) => {
//     if (
//       !checkCartButtonActive(
//         selectedProducts,
//         data.response.bundleDetail.products
//       )
//     ) {
//       let code = JSON.parse(localStorage.getItem("sd_bundle_data"));
//       let discountCodeId = code.discountCreateId ?? "";

//       cartAddBtn.innerText = "";
//       let BundleBuilderSpinner = document.createElement("div");
//       BundleBuilderSpinner.className = "bundleBtnSpinner";
//       BundleBuilderSpinner.style.display = "block";
//       cartAddBtn.append(BundleBuilderSpinner);

//       let idArray = [];
//       let variantGid = [];
//       for (const category of selectedProducts) {
//         // Loop through the inner array of each category
//         for (const product of category) {
//           // Push the ID of each product to the idArray
//           idArray.push({
//             id: product.id.replace("gid://shopify/ProductVariant/", ""),
//             quantity: 1,
//           });
//           variantGid.push(product.id);
//         }
//       }

//       let formData = {
//         items: idArray,
//         attributes: { SD_BUNDLE_ID: data.response._id },
//       };
//       fetch(window.Shopify.routes.root + "cart/add.js", {
//         method: "POST",
//         headers: {
//           "Content-Type": "application/json",
//         },
//         body: JSON.stringify(formData),
//       })
//         .then((response) => {
//           return response.json();
//         })
//         .then((response) => {
//           let errorDiv = document.getElementsByClassName(
//             "sd-bundle-error-message"
//           );
//           errorDiv[0]?.remove();
//           if (response.status == 422 || response.status == 404) {
//             cartAddBtn.innerText = data.response.translations.translation.addToCartButton;
//             BundleBuilderSpinner.remove();
//             let errorMessage = document.createElement("div");
//             errorMessage.className = "sd-bundle-error-message";
//             CART_INFO_ADD_BTN_div.append(errorMessage);
//             errorMessage.innerText = response.description;
//           } else {
//             fetch(window.Shopify.routes.root + "cart.js", {
//               method: "GET",
//               headers: {
//                 "Content-Type": "application/json",
//               },
//             })
//               .then((response) => {
//                 return response.json();
//               })
//               .then((response) => {
//                 if (data.response.bundleDetail.discountType == "noDiscount") {
//                   fetch(`${server}/api/storefront/getBundleClick`, {
//                     method: "POST",
//                     headers: {
//                       "Content-Type": "application/json",
//                     },
//                     body: JSON.stringify({
//                       shop: Shopify.shop,
//                       bundleId: data.response._id,
//                     }),
//                   });
//                   let isDiscount =
//                     data.response.bundleDetail.discountType == "noDiscount"
//                       ? "noDiscount"
//                       : "Fix";
//                   const localData = JSON.parse(
//                     localStorage.getItem("sd_bundle_data")
//                   );
//                   let sd_bundle_data = {
//                     discount_name: data.response.name,
//                     code: code.code,
//                     bundleId: data.response._id,
//                     discountType: isDiscount,
//                     variantsId: idArray,
//                     discountCreateId: localData.discountCreateId,
//                     prefixCode: data.response.settings.discountLabel,
//                   };
//                   var jsonString = JSON.stringify(sd_bundle_data);
//                   localStorage.setItem("sd_bundle_data", jsonString);

//                   BundleBuilderSpinner.remove();
//                   cartAddBtn.innerText =
//                     data.response.translations.translation.addToCartButton;
//                   window.location.assign(`https://${Shopify.shop}/cart`);
//                 } else {
//                   let totalPrice = Number(pageInfoTotalPrice.toFixed(2));
//                   let finalPrice;
//                   switch (data.response.bundleDetail.discountType) {
//                     case "percent":
//                       let percentagepart = parseFloat(
//                         data.response.bundleDetail.discountValue
//                       );
//                       let percentage = (totalPrice * percentagepart) / 100;
//                       result = percentage;
//                       finalPrice = result.toFixed(2);
//                       break;
//                     case "price":
//                       let pricePart = parseFloat(
//                         data.response.bundleDetail.discountValue
//                       );
//                       result = totalPrice - pricePart;
//                       finalPrice = result.toFixed(2);
//                       break;
//                     case "fixed":
//                       let fixedPart = parseFloat(
//                         data.response.bundleDetail.discountValue
//                       );
//                       finalPrice = fixedPart.toFixed(2);
//                       break;
//                     default:
//                       break;
//                   }

//                   let isDiscount =
//                     data.response.bundleDetail.discountType == "noDiscount"
//                       ? "noDiscount"
//                       : "Fix";
//                   let sd_bundle_data = {
//                     discount_name: data.response.name,
//                     code:
//                       data.response.settings.discountLabel + "-" + code.code,
//                     discountType: isDiscount,
//                     discountValue: finalPrice,
//                     variantsId: variantGid,
//                     startDate: new Date(),
//                     endDate: data.response.endDate,
//                     shop: Shopify.shop,
//                     bundleType: data.response.bundleDetail.discountType,
//                     totalPrice: totalPrice,
//                     discountCreateId: discountCodeId,
//                   };
//                   fetch(server + "/api/storefront/createRule", {
//                     method: "POST",
//                     headers: {
//                       "Content-Type": "application/json",
//                     },
//                     body: JSON.stringify(sd_bundle_data),
//                   })
//                     .then((response) => response.json())
//                     .then((res) => {
//                       if (res.status == 200) {
//                         fetch(`${server}/api/storefront/getBundleClick`, {
//                           method: "POST",
//                           headers: {
//                             "Content-Type": "application/json",
//                           },
//                           body: JSON.stringify({
//                             shop: Shopify.shop,
//                             bundleId: data.response._id,
//                           }),
//                         });
//                         cartAddBtn.innerText =
//                           data.response.translations.translation.addToCartButton;
//                         BundleBuilderSpinner.remove();
//                         let sd_bundle_data = {
//                           discount_name: data.response.name,
//                           code: code.code,
//                           bundleId: data.response._id,
//                           discountType: isDiscount,
//                           variantsId: idArray,
//                           discountCreateId: res.response,
//                           prefixCode: data.response.settings.discountLabel,
//                         };
//                         var jsonString = JSON.stringify(sd_bundle_data);
//                         localStorage.setItem("sd_bundle_data", jsonString);
//                         window.location.assign(`https://${Shopify.shop}/cart`);
//                       }
//                     });
//                 }
//               })
//               .catch((error) => {
//                 // // console.log(error);
//               });
//           }
//         })
//         .catch((error) => {
//           // console.error("Error:", error);
//         });
//     }
//   });
// }

// // function addselectedProductList(selectedProducts, mainIndex, extra, arr1) {
// function addselectedProductList(selectedProducts, mainIndex, extra, data) {
//   if (selectedProducts[mainIndex].length) {
//     if (extra == "") {
//       document.getElementById(
//         "sd-builder-selectedProductContainer" + mainIndex
//       ).style.display = "none";
//     }
//     const getDiv = document.getElementById(
//       "sd-builder-info-variants-data" + mainIndex
//     );
//     let listDiv;
//     let listDivParent = "";
//     listDivParent = document.createElement("div");

//     selectedProducts[mainIndex].map((el, index) => {
//       listDiv = document.createElement("div");
//       listDiv.className = "sd-builder-info-selected-products";
//       listDiv.id = "sd-builder-info-selected-products" + index;
//       let selectedProductImgDiv = document.createElement("div");
//       selectedProductImgDiv.className = "sd-builder-info-product-img-container";
//       listDiv.append(selectedProductImgDiv);
//       let selectedProductImg = document.createElement("img");
//       selectedProductImg.className = "sd-builder-info-product-img";
//       let selectedCartImg = el.image ?? smartNoImg;
//       selectedProductImg.setAttribute("src", selectedCartImg);
//       selectedProductImgDiv.append(selectedProductImg);
//       let selectedProductTitleDiv = document.createElement("div");
//       listDiv.append(selectedProductTitleDiv);
//       let ProductTitle = document.createElement("div");
//       ProductTitle.className = "sd-builder-info-product-title";
//       ProductTitle.innerText = el.title;
//       selectedProductTitleDiv.append(ProductTitle);
//       let productVariantTitle = document.createElement("div");
//       productVariantTitle.className = "sd-builder-info-variant-title";
//       // console.log(el.variantTitle);
//       productVariantTitle.innerText = el.variantTitle;
//       if (el.variantTitle == "Default Title") {
//         productVariantTitle.style.display = "none";
//       }
//       selectedProductTitleDiv.append(productVariantTitle);
//       let removeVariant = document.createElement("button");
//       removeVariant.innerText = "Delete";
//       removeVariant.className = "sd-removeVariant-btn";
//       removeVariant.id = `sd-removeVariant-btn-id${index}`;

//       listDiv.append(removeVariant);

//       listDivParent.append(listDiv);

//       removeVariant.addEventListener("click", () => {
//         selectedProducts[mainIndex].splice(index, 1);
//         const revDiv = document.getElementById(
//           "sd-builder-info-selected-products" + index
//         );

//         const countDiv = document.getElementById(
//           `sd-quantityCheck${mainIndex}`
//         );
//         countDiv.innerText = selectedProducts[mainIndex].length;

//         getDiv.innerHTML = "";
//         const getCartButton = document.getElementById(
//           "sd-builder-cart-info-add-btn"
//         );

//         getCartButton.style.color = "#919191";
//         getCartButton.style.background = "#e5e5e5";
//         getCartButton.style.cursor = "no-drop";
//         getCartButton.disabled = true;
//         addselectedProductList(selectedProducts, mainIndex, "", data);

//         sumOfVariants(selectedProducts, data);
//       });
//     });
//     getDiv.appendChild(listDivParent);
//   } else {
//     document.getElementById(
//       "sd-builder-selectedProductContainer" + mainIndex
//     ).style.display = "block";
//   }
// }

// function sumOfVariants(params, data) {
//   let sum = 0;

//   for (const nestedArray of params) {
//     for (const obj of nestedArray) {
//       sum += parseFloat(obj.price);
//     }
//   }
//   const updateSum = document.getElementById("sd-builder-total-raw-price");
//   let updatedTotalSum = sum.toFixed(2);
//   updateSum.innerText = showAmountWithCurrency(updatedTotalSum);
//   let totalDiv = document.getElementById(
//     "sd-builder-total-discounted-price-text"
//   );

//   if (sum > 0) {
//     let discountedPrice;
//     if (data.response.bundleDetail.discountType == "percent") {
//       let part = parseFloat(data.response.bundleDetail.discountValue);
//       let percentage = (sum * part) / 100;
//       result = sum - percentage;
//       discountedPrice = result.toFixed(2);
//       let newDiscountPrice = discountedPrice;

//       totalDiv.innerText = showAmountWithCurrency(newDiscountPrice);
//     } else if (data.response.bundleDetail.discountType == "fixed") {
//       let part = parseFloat(data.response.bundleDetail.discountValue);
//       let fixed = sum - part;
//       discountedPrice = fixed.toFixed(2);
//       let newDiscountPrice = discountedPrice;
//       totalDiv.innerText = showAmountWithCurrency(newDiscountPrice);
//     } else if (data.response.bundleDetail.discountType == "price") {
//       let part = parseFloat(data.response.bundleDetail.discountValue);
//       discountedPrice = part;
//       let newDiscountPrice = discountedPrice;
//       totalDiv.innerText = showAmountWithCurrency(newDiscountPrice);
//     } else if (data.response.bundleDetail.discountType == "freeShipping") {
//       totalDiv?.remove();
//     } else if (data.response.bundleDetail.discountType == "noDiscount") {
//       totalDiv?.remove();
//     }

//     pageInfoTotalPrice = sum;
//   } else {
//     let newDiscountPrice = "0";
//     totalDiv.innerText = showAmountWithCurrency(newDiscountPrice);
//   }
// }
// // sd-builder-cart-info-add-btn
// function checkCartButtonActive(arr1, arr2) {
//   let t = [];
//   for (let i = 0; i < arr1.length; i++) {
//     if (arr1[i].length == arr2[i].quantity) {
//       t.push(1);
//     } else {
//       t.push(0);
//     }
//   }
//   const v = t.includes(0);
//   return v;
// }

// function waterMark(appendDiv) {
//   let waterMarkDiv = document.createElement("div");
//   waterMarkDiv.className = "sd-bundle-WaterMark-conatiner";
//   let sd_link = document.createElement("a");
//   sd_link.innerText = "Shine Dezign Infonet";
//   sd_link.setAttribute("href", "https://shinedezigninfonet.com/");
//   sd_link.target = "_blank";
//   waterMarkDiv.innerText = "Powered by ";
//   waterMarkDiv.append(sd_link);
//   appendDiv.append(waterMarkDiv);
//   return waterMarkDiv;
// }

// async function addDiscountToProduct() {
//   const localData = JSON.parse(localStorage.getItem("sd_bundle_data"));
//   let checkOutBtn = document.getElementsByName("checkout");
//   checkOutBtn.forEach((e) => {
//     e.addEventListener("click", (event) => {
//       event.preventDefault();
//       fetch(window.Shopify.routes.root + "cart.js", {
//         method: "Get",
//         headers: {
//           "Content-Type": "application/json",
//         },
//       })
//         .then((response) => {
//           return response.json();
//         })
//         .then((response) => {
//           let allIdsMatch = localData.variantsId.every((item) => {
//             let matchingItem = response.items.find(
//               (i) => i.id === parseInt(item.id) && item.quantity <= i.quantity
//             );
//             return !!matchingItem;
//           });

//           if (allIdsMatch == true) {
//             /*here are true id match */
//             activateRule(localData);
//             window.location.href = `${window.location.origin}/checkout?discount=${localData.prefixCode}-${localData.code}`;
//           } else {
//             /*here are false id match */
//             deactivateRule(localData);
//             window.location.href = `${window.location.origin}/cart/checkout`;
//           }
//         })
//         .catch((error) => {
//           console.log(error.message);
//         });
//     });
//   });
// }
// async function activateRule(localData) {
//   const data = {
//     shop: Shopify.shop,
//     discountId: localData.discountCreateId,
//     bundle_type: localData.bundle_type
//   };
//   await fetch(server + "/api/storefront/activateRule", {
//     method: "POST",
//     headers: {
//       "Content-Type": "application/json",
//     },
//     body: JSON.stringify(data),
//   })
//     .then((response) => {
//       return response.json();
//     })
//     .then((response) => {
//       let discountElement = document.getElementById("shineBundleDiscount");
//       if (discountElement == null) {
//         const inputElement = document.createElement("input");

//         // Step 3: Set attributes for the input element
//         inputElement.className = "js-form-discount shine-discount";
//         inputElement.id = "shineBundleDiscount";
//         inputElement.type = "hidden";
//         inputElement.name = "discount";
//         inputElement.value = `${localData.prefixCode}-${localData.code}`;
//         let formDiv = document.querySelectorAll('form[action="/cart"]');
//         formDiv.forEach((form) => {
//           form.append(inputElement);
//         });
//       }
//     })
//     .catch((error) => {
//       console.log(error.message);
//     });
// }
// async function deactivateRule(localData) {
//   const data = {
//     shop: Shopify.shop,
//     discountId: localData.discountCreateId,
//   };
//   await fetch(server + "/api/storefront/deactivateRule", {
//     method: "POST",
//     headers: {
//       "Content-Type": "application/json",
//     },
//     body: JSON.stringify(data),
//   })
//     .then((response) => {
//       return response.json();
//     })
//     .then((response) => {
//       let discountElement = document.getElementById("shineBundleDiscount");
//       if (discountElement !== null) {
//         discountElement.remove();
//       }
//     })
//     .catch((error) => {
//       console.log(error.message);
//     });
// }
// function createDiscountName(dataArray) {
//   if (!Shopify.designMode) {
//     let checkLocalStorage = localStorage.getItem("sd_bundle_data");

//     if (!checkLocalStorage) {
//       function generateRandomSixDigitNumber() {
//         // Generate a random number between 100,000 and 999,999 (inclusive)
//         const min = 100000;
//         const max = 999999;
//         const randomNumber = Math.floor(Math.random() * (max - min + 1)) + min;

//         return randomNumber;
//       }
//       const randomSixDigitNumber = generateRandomSixDigitNumber();
//       let sd_bundle_data = {
//         code: randomSixDigitNumber,
//       };
//       var jsonString = JSON.stringify(sd_bundle_data);
//       localStorage.setItem("sd_bundle_data", jsonString);
//     }
//   }
// }

// function showAmountWithCurrency(value) {
//   let moneyFormat = sdCurrencySymbolCode;
//   let sdCurrencyFormatcondition;

//   if (moneyFormat.includes("{{amount_no_decimals}}")) {
//     sdCurrencyFormatcondition = "amount_no_decimals";
//   } else if (moneyFormat.includes("{{amount_with_comma_separator}}")) {
//     sdCurrencyFormatcondition = "amount_with_comma_separator";
//   } else if (
//     moneyFormat.includes("{{amount_no_decimals_with_space_separator}}")
//   ) {
//     sdCurrencyFormatcondition = "amount_no_decimals_with_space_separator";
//   } else if (
//     moneyFormat.includes("{{amount_no_decimals_with_comma_separator}}") ||
//     moneyFormat.includes("${{ amount_no_decimals_with_comma_separator }}")
//   ) {
//     sdCurrencyFormatcondition = "amount_no_decimals_with_comma_separator";
//   } else if (moneyFormat.includes("{{amount_with_space_separator}}$")) {
//     sdCurrencyFormatcondition = "amount_with_space_separator";
//   } else if (moneyFormat.includes("{{amount}}")) {
//     sdCurrencyFormatcondition = "amount";
//   } else {
//     let pattern = /{{(.*?)}}/;
//     let match = moneyFormat.match(pattern);
//     sdCurrencyFormatcondition = `${match[1]}`;
//   }

//   let sdCurrencyprice;
//   switch (sdCurrencyFormatcondition) {
//     case "amount":
//       sdCurrencyprice = moneyFormat.replace("{{amount}}", value);
//       break;
//     case "amount_with_comma_separator":
//       if (value) {
//         let stringValue = value.toString();
//         if (stringValue.indexOf(".") > 0) {
//           let comma_seperator = stringValue.replace(".", ",");
//           sdCurrencyprice = moneyFormat.replace(
//             "{{amount_with_comma_separator}}",
//             comma_seperator
//           );
//         } else {
//           sdCurrencyprice = moneyFormat.replace(
//             "{{amount_with_comma_separator}}",
//             value
//           );
//         }
//       } else {
//         sdCurrencyprice = moneyFormat.replace(
//           "{{amount_with_comma_separator}}",
//           value
//         );
//       }
//       break;
//     case "amount_no_decimals_with_space_separator":
//       let noDecimalwithSpace = parseInt(value);
//       sdCurrencyprice = moneyFormat.replace(
//         "{{amount_no_decimals_with_space_separator}}",
//         noDecimalwithSpace
//       );
//       break;
//     case "amount_no_decimals":
//       let noDecimal = parseInt(value);
//       sdCurrencyprice = moneyFormat.replace(
//         "{{amount_no_decimals}}",
//         noDecimal
//       );
//       break;
//     case "amount_no_decimals_with_comma_separator":
//       let noDecimalwithComma = parseInt(value);

//       sdCurrencyprice = moneyFormat.replace(
//         /{{amount_no_decimals_with_comma_separator}}|\${{ amount_no_decimals_with_comma_separator }}/g,
//         noDecimalwithComma
//       );
//       break;
//     case "amount_with_space_separator":
//       if (value) {
//         let spaceStringValue = value.toString();
//         if (spaceStringValue.indexOf(".") > 0) {
//           let Space_comma_seperator = spaceStringValue.replace(".", ",");
//           sdCurrencyprice = moneyFormat.replace(
//             "{{amount_with_space_separator}}",
//             Space_comma_seperator
//           );
//         } else {
//           sdCurrencyprice = moneyFormat.replace(
//             "{{amount_with_space_separator}}",
//             value
//           );
//         }
//       } else {
//         sdCurrencyprice = moneyFormat.replace(
//           "{{amount_with_space_separator}}",
//           value
//         );
//       }
//       break;
//     default:
//       sdCurrencyprice = moneyFormat.replace(
//         `{{${sdCurrencyFormatcondition}}}`,
//         value
//       );
//   }
//   return sdCurrencyprice;
// }



let server = "https://bundle.shinedezigninfotech.com";

console.log("Smart Bundle Discount app new version 7.0");
// let server = "https://bundle.shinedezigninfotech.com/";
let smartNoImg = `data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAHYUlEQVR4nO2da0wUVxTHb/xSk/qxNbXCzsyyvGYWFhF51Qeo0IeAjxRba/1kW9MiVA1FGkGbippabWJsVBDQVjuNbEF5iCBoLWw1ltqaan01NmlD6wdi+sAvTWtOcy67I4/VXXF3587s/Scnk50Pyzn3t+eec2fDWUK4uLi4uLi4zCtBlF2CKPdZrYmT9faFawjIt4KkgCAqlzgUBmSzJT0piPIPCMUiyVctlrgpevsU9uJQGBSHwqA4FAbFoTAoDoVBcSgMikNhUBwKg+JQGBSHwqA4FINAiYpSIi2SvNoiKSfwniDJd+gDS0OafIfGJSntFkkummpLiCAGg/KHIMr/6r+QSrDsriApDaIYLxCWZRGVFYIoo7MgWBXIy38ZNm3aCbX7neBs6IaW5h5DmrOhm8aAsSxesgKstkQKxiIqf0dKSj5hURZRLnZ/ciAufjp1ODV9Lhw+1Kr7grYE2OrrG6Fg4XItW3BrJiwpUpQL0DHRaoeStytB/awdMjJzTA2lpbkHSkoqAGPG2JnJlIgIx1RMXVx8hOFxFqGkZcyjUGyxSRAdn6z3vg/+WOrsZ8F16/ZI+20Aztzsh+4L16Ct/esxUNzb119MfJEniHItOoQpPNzRLR9Vg+LIAHtSBnU4fc5z0HbpxthgDWa9/QPQ0XtxRKz597aval1hYGsrSPJ/WOTq65pGwJiWlg1qz3k4cfUmzJqfTx3OyHreFFBct26PgFJX1whSVCJgZ4k7hm5AsJjhQmPn4XHu8yMdYE/KpDA8zpsRSm//ALQeP6vFvWjRCk+WvKUjEKUdncB20ONY0Tvvwar1G8cEYEYoXReuaXFXbtwxBESU2/QDIio30Ina2i80x3DRPznl8hqA2aCcudmvxY3nFPeh+JpuQARRGUQnnM4uzbFYOQW6f+6/bxBmgtLbP6DFjWswlCHKoH5A3K3i8I4DX/sKxExQWkbFjmY4IKxAOfrdZVi5phRSUjPBGp1AryvXltL7YQdEbyh7m09A0vRU2LklF37qK4Q7vy6n1x1VueBIToW9zR3hB0QvKEcvXKYwzp9cDP/8/uoYO3dyMYVy7Psfww+IHlBWrimlmeENhsc+rMqF19aVhieQUENJSc2k29ODgNzoK4SU9JnhCySUUKKiE2nNeBCQwV9eAVuMI7yBuEIEJSXtGZ8Zcv2bQpiREeYZ4goRFGxtsZt6EJDtm7GGlHEgrhBAwXMGdlHYTXmDcbZzqMtqvniFA3GFKFPwnIGLjt0UFnCsKXjFzBg6h3T6fA/8MisstixXiKDgOQNbW+ymsNDjFbcpfzIDzVvshgdy+Mw5mFnwEkQnptErvg4llEcx02XI/uOnINqRDpPKK2BCXT294mu8bxQopgFS1/kl2BzpMLFqKxBV1eyxbR/Q+9VtXYaAYgog94NBDAbFFFuWLxjEQFAMX9T9hUEMAsXQQGo7Tj8UDGIAKIYFMl4YJIhQsL3OWrgU4hxpkL1oqdd225Q15FFhkCBAwbY6LikdsreVw8LWffSKr721277MUEACBYMEEArWMVz8nD3vw5LTBzXLra6i9729tymABBoGCQCU+8EYLxTDbFnBgkEeAYovGOOBYpiiHkwYZBxQdjUc8wvGw0IxDJCJVduCCoO4Df+OzY9nX6ItAbK3v+sXjIeBYhggoYBB/MiU3Y2tIEUlUJ9iM2dBftPHAYXCgaj+Q/HUjLk7N0DcrDlBgcKBqP5lyugCXtC8NyhQOBDV9/ZlTUiFmIQZYwp4MKBwIKp/NUWwp3jtqAINhQNR/S/0gpcsCTQUDkRlCwoHorIDJWfPZg6EMAaFZ4jKFhQORGULCgeisgWFOSCeoTPD/y1akOwwoaYmIM+pCMNQ8pt201g9cTcc6dSG0OgJ5Dr9/qPWqTlmjZ0Gk9aV6b7wxMdTYpFC2TxuKLM3rQNbfLIW9/4abXDAFd1Ha2wcNlpj3gsvQkTmPN0XnQQZSvzMLMjJW6rFXVnJwmgNSS4aPXym7kATCFY7PF5eYVooWVvLaIy1BxvHDp+xKm/qBgSnc+JIIjqeqf6ec6+vXk8nrZkRStbWMpCi7LBqdbkWL856YWI8E0qQlBpvA8wQCn6KIjLnwqS1ZUwX+ok+oCAM+s1jdCKN6Y2iezCaj30FefnL3PVD2Uf0VmRk7NPaiL+SihFQMKXnLyiEqLhkEBkY3yeM2+ye2YqQPGPOiBmSxSUb3N2V/KcgyE8RFoQDILUhmKOgmMXUUYM9D33aAsXFG7QhmBarfQFhSe7pcnRMLM4gxLF3ZoYSE5c8fExsEWFRFknJw4MROopFDjsPnLSGPfrww6PRzOnsgpqaBtra5uUtG7b9yndxeDRhWVNiYp4QJHmXqUeNiwrGdttQv/OI7R/25BZROY6nV8/0OUOaqAwOxSC3YUwYG/9VCAbFoTAoDoVBcSgMikNhUBwKg+JQGBSHwqA4FAbFoTAoDoVBcSgMikNhUFZr4mRBVC4NPbCU+/T2h4t4oMh9gqj08AXh4uLi4uIi5tX/Fms2vZkCm94AAAAASUVORK5CYII=`;
let productPageClass = document.getElementsByClassName("sd-bundle-app");

let cartDrawer = () =>{
  if (sdCartType === "drawer") {
    const btn = document.getElementById('cart-icon-bubble')
    if (btn) {
      setTimeout(()=>{
        btn.click() // Trigger the drawer to open
      },1000);
      fetch('/cart')
      .then(response => response.text())  
      .then(cart => {
        const parser = new DOMParser();
        const doc = parser.parseFromString(cart, 'text/html');
        // Find the #CartDrawer element in the fetched HTML
        const cartDrawerContent = doc?.querySelector('#CartDrawer');
          const cartIconContent = doc?.querySelector('#cart-icon-bubble');
        // If found, update the content of the current #CartDrawer element
        if (cartDrawerContent) {
          document.querySelector('#CartDrawer').innerHTML = cartDrawerContent.innerHTML;
        document.querySelector('#cart-icon-bubble').innerHTML = cartIconContent.innerHTML;
          document.querySelector('cart-drawer.drawer').classList.remove('is-empty');
          updateCart();
        }
      })
      .catch(error => {
        console.error('Error fetching cart:', error);
      });
    }else{
      window.location.assign(`https://${Shopify.shop}/cart`);
    }
  } else {
      window.location.assign(`https://${Shopify.shop}/cart`);
  }
}

let updateCart = () =>{
  const localData = JSON.parse(localStorage.getItem("sd_bundle_data"));
  if (localData?.discountType == "Fix") {
    fetch(window.Shopify.routes.root + "cart.js", {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
      },
    })
      .then((response) => response.json())
      .then((response) => {
        let allIdsMatch = localData.variantsId.every((item) => {
          let matchingItem = response.items.find(
            (i) => i.id === parseInt(item.id) && item.quantity <= i.quantity
          );
          return !!matchingItem;
        });
        if (allIdsMatch == true) {
          activateRule(localData);
          if (localData.discountType == "Fix") {
            addDiscountToProduct();
          }
        } else {
          deactivateRule(localData);
          let formData = {
            attributes: { SD_BUNDLE_ID: el._id },
          };
          fetch(window.Shopify.routes.root + "cart/add.js", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
          });
        }
      })
      .catch((error) => {
        console.log(error.message);
      });
  }else{

  }
}

function getRandomItems(arr, numItems) {
  for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr.slice(0, numItems);
}
 
if (sdbundlePageType == "product") {
  if (productPageClass.length) {
    let sdBundleLoader = document.createElement("div");
    sdBundleLoader.id = "sd-bundle-main-container-loader";
    sdBundleLoader.className = "sd-bundle-main-container-loader";
    let Gdiv = document.createElement("div");
    Gdiv.innerText = "G";
    sdBundleLoader.appendChild(Gdiv);
    let Ndiv = document.createElement("div");
    Ndiv.innerText = "N";
    sdBundleLoader.appendChild(Ndiv);
    let Idiv = document.createElement("div");
    Idiv.innerText = "I";
    sdBundleLoader.appendChild(Idiv);
    let Ddiv = document.createElement("div");
    Ddiv.innerText = "D";
    sdBundleLoader.appendChild(Ddiv);
    let Adiv = document.createElement("div");
    Adiv.innerText = "A";
    sdBundleLoader.appendChild(Adiv);
    let Odiv = document.createElement("div");
    Odiv.innerText = "O";
    sdBundleLoader.appendChild(Odiv);
    let Ldiv = document.createElement("div");
    Ldiv.innerText = "L";
    sdBundleLoader.appendChild(Ldiv);

    productPageClass[0].append(sdBundleLoader);

    document.getElementById("sd-bundle-main-container-loader").style.display =
      "block";

    getData();
  } else {
    console.log("SMART BUNDLE BLOCK is not enabled");
  }
}

async function getData() {
  let shop = Shopify.shop;
  let collectionId = [];
  sdBundleCollectionId.map((id) => {
    collectionId.push(`gid://shopify/Collection/${id}`);
  });
  const response = await fetch(`${server}/api/storefront/getBundleData`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify({
      shop: shop,
      id: sdBundleProductId,
      collId: collectionId,
    }),
  });
  data = await response.json();
  if (data.status === 200) {
    if (sdbundlePageType == "product") {
      document.getElementById("sd-bundle-main-container-loader").style.display =
        "none";
      document.getElementById("sd-bundle-main-container-loader").remove();
      let dataArray = [];
      data.response.map((el) => {
        if (el.type == "productBundle") {
          dataArray.push(el);
        } else if (el.type == "volumeBundle") {
          if (el.bundleDetail.discountedProductType == "specific_product") {
            dataArray.push(el);
          } else if (el.bundleDetail.discountedProductType == "collection") {
            el.bundleDetail.products = [sdProductJson];
            dataArray.push(el);
          } else if (el.bundleDetail.discountedProductType == "all_products") {
            el.bundleDetail.products = [sdProductJson];
            dataArray.push(el);
          }
        } else if (el.type == "collectionMixMatch") {
          dataArray.push(el);
        } else if(el.type == "productMixMatch") {
          dataArray.push(el);
        } else if(el.type == "fbt") {
          dataArray.push(el);
        } else if(el.type == "bxgy") {
          dataArray.push(el)
        }
      });

      if (dataArray.length) {
        createDiscountName(dataArray);
      }

      createBundle(dataArray);
      let bundleId = [];
      dataArray.forEach((id) => {
        bundleId.push(id._id);
      });
      await fetch(`${server}/api/storefront/getBundleViews`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          shop: Shopify.shop,
          bundleId: bundleId,
        }),
      });
    }
  }
}

if (sdbundlePageType == "cart") {
  updateCart();
}
if (sdCartType === "drawer") {
  updateCart();
}

if (sdbundlePageType == "page") {
  const url = window.location.href;
  const urlSearchParams = new URLSearchParams(url.split("?")[1]);
  const path = url.split("/").pop().split("?")[0];
  const id = urlSearchParams.get("b");
  if (path == "collection-mix-match") {
    fetch(`${server}/api/storefront/getCollectionMixMatchData`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        shop: Shopify.shop,
        id: id,
      }),
    })
      .then((response) => response.json())
      .then((data) => {
        bundlePageBuilder(data);
      })
      .catch((error) => {
      });
  }
}

const arr = [];
const bundleData = [];
const bundleSum = [];
const gidArray = [];
let volumeBundleArr = []; 
let volumeBundleSum = [];
function createBundle(BUNDLE_DATA) {
  console.log("check foreach working=======**********",BUNDLE_DATA);
  let bundleMainDiv = document.createElement("div");
  bundleMainDiv.className = "sd-bundle-main-container";
  bundleMainDiv.id = "sd-bundle-main-container";

  productPageClass[0].append(bundleMainDiv);

  let mainDiv = document.getElementById("sd-bundle-main-container");

  BUNDLE_DATA.forEach((el, bundleIndex) => {
    bundleData?.push([]);
    bundleSum?.push([]);
    gidArray?.push([]);
    if (el?.type == "productBundle") {
        let BUNDLE_DIV = document.createElement("div");
        BUNDLE_DIV.className = "sd-bundle-main-column";
        BUNDLE_DIV.style.borderRadius = `${el?.customization?.bundle?.box?.borderRadius}px`;
        BUNDLE_DIV.style.borderColor = el?.customization?.bundle?.box?.borderColor;
        BUNDLE_DIV.style.background = el?.customization?.bundle?.box?.backgroundColor;
        mainDiv.append(BUNDLE_DIV);

        if (el?.badgeText != "" && el?.badgeText != undefined) {
          if (el?.bundleDetail?.discountType === "percent" || el?.bundleDetail?.discountType === "fixed") {
            let VOLUME_HEADER_DIV = document.createElement("span");
            VOLUME_HEADER_DIV.className = "sd-badges-part-optional";
            VOLUME_HEADER_DIV.style.background =el?.customization?.bundle?.optionalBadge?.background;
            VOLUME_HEADER_DIV.style.color = el?.customization?.bundle?.optionalBadge?.color;
            VOLUME_HEADER_DIV.style.fontSize =`${el?.customization?.bundle?.optionalBadge?.fontSize}px`;
            let discountBadge = document.createElement("span");
            discountBadge.className = "sd-collectionMM-badge";
            discountBadge.innerText = el?.badgeText;
            VOLUME_HEADER_DIV.append(discountBadge);
            BUNDLE_DIV.append(VOLUME_HEADER_DIV);
          }
        }

        let BUNDLE_TITLE = document.createElement("div");
        BUNDLE_TITLE.className = "sd-bundle-text-detail";
        BUNDLE_DIV.append(BUNDLE_TITLE);
        if (el?.badgeText != "" && el?.badgeText != undefined) {
          if (el?.bundleDetail?.discountType === "percent" || el?.bundleDetail?.discountType === "fixed") {
            BUNDLE_TITLE.classList.add("extra-padding");
          }
        }
        let bundleTitleText = document.createElement("h4");
        bundleTitleText.innerText = el?.title;
        bundleTitleText.style.color = el?.customization?.bundle?.title?.color;
        bundleTitleText.style.fontSize = `${el?.customization?.bundle?.title?.fontSize}px`;
        bundleTitleText.style.fontWeight = el?.customization?.bundle?.title?.titleBold;
        bundleTitleText.style.textAlign = el?.customization?.bundle?.title?.alignment;
        bundleTitleText.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
        BUNDLE_TITLE.append(bundleTitleText);
      
        let ProductBundleDescription = document.createElement("p");
        ProductBundleDescription.innerText = el?.description;
        ProductBundleDescription.style.textAlign = el?.customization?.bundle?.title?.alignment;
        ProductBundleDescription.style.color = el?.customization?.bundle?.title?.descriptionColor;
        ProductBundleDescription.style.fontSize = `${el?.customization?.bundle?.title?.descriptionFontSize}px`;
        ProductBundleDescription.style.fontWeight = el?.customization?.bundle?.title?.descriptionBold;
        ProductBundleDescription.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
        BUNDLE_TITLE.append(ProductBundleDescription);
      
        el?.bundleDetail?.products?.map((ele, index) => {
          bundleData[bundleIndex].push([]);
          bundleSum[bundleIndex].push([]);
          gidArray[bundleIndex].push([]);
          let BUNDLE_PRODUCT_DIV = document.createElement("div");
          BUNDLE_PRODUCT_DIV.className ="sd-bundle-product-detail";
          BUNDLE_PRODUCT_DIV.style.backgroundColor = el?.customization?.bundle?.productDetails?.productDetailsBox?.backgroundColor
          
          let DATA_SECTION_IMAGE_TITLE_DIV = document.createElement("div");
          DATA_SECTION_IMAGE_TITLE_DIV.className ="sd-bundle-product-inner";
          
          let DATA_SECTION_IMAGE_DIV = document.createElement("div");
          DATA_SECTION_IMAGE_DIV.className = "sd-bundle-product-img";
          DATA_SECTION_IMAGE_DIV.style.border ="1px solid" + el?.customization?.bundle?.productDetails?.image?.borderColor;
          DATA_SECTION_IMAGE_DIV.style.borderRadius = `${el?.customization?.bundle?.productDetails?.image?.borderRadius}px`;
          
          let DATA_SECTION_IMG = document.createElement("img");
          let bundleProductImg = ele?.images[0]?.originalSrc ?? smartNoImg;
          DATA_SECTION_IMG.setAttribute("src", bundleProductImg);
          DATA_SECTION_IMG.style.width = "80";
          DATA_SECTION_IMG.style.height = "80";
          DATA_SECTION_IMAGE_DIV.append(DATA_SECTION_IMG);
          
          let DATA_SECTION_TITLE_PRICE_DIV = document.createElement("div");
          DATA_SECTION_TITLE_PRICE_DIV.className ="sd-bundle-product-name";
          
          let DATA_SECTION_TITLE = document.createElement("h5");
          DATA_SECTION_TITLE.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
          DATA_SECTION_TITLE.style.color = el?.customization?.bundle?.productDetails?.title?.color;
          DATA_SECTION_TITLE.style.fontSize = `${el?.customization?.bundle?.productDetails?.title?.fontSize}px`;

          DATA_SECTION_TITLE.innerText = ele?.title;
          let DATA_SECTION_PRICE = document.createElement("h4");
          DATA_SECTION_PRICE.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
          DATA_SECTION_PRICE.style.color = el?.customization?.bundle?.productDetails?.price?.color;
          DATA_SECTION_PRICE.style.fontSize = `${el?.customization?.bundle?.productDetails?.price?.fontSize}px`;
          DATA_SECTION_PRICE.id = `sd-bundle-datasection-price${index}${bundleIndex}`;
          let covertedPrice = ele?.variants[0]?.price;
          DATA_SECTION_PRICE.innerText = showAmountWithCurrency(covertedPrice);
          
          DATA_SECTION_TITLE_PRICE_DIV.append(
            DATA_SECTION_TITLE,
            DATA_SECTION_PRICE
          );
          DATA_SECTION_IMAGE_TITLE_DIV.append(
            DATA_SECTION_IMAGE_DIV,
            DATA_SECTION_TITLE_PRICE_DIV
          );
          let DATA_SECTION_QUANTITY_DIV = document.createElement("div");
          DATA_SECTION_QUANTITY_DIV.className = "sd-bundle-product-quantity";
          let DATA_SECTION_QUANTITY = document.createElement("h6");
          let QUANTITY_SPAN = document.createElement("span");
          QUANTITY_SPAN.innerText = ele.minimumOrder;
          DATA_SECTION_QUANTITY.append(QUANTITY_SPAN);
          DATA_SECTION_QUANTITY.style.fontSize = el?.customization?.bundle?.productDetails?.quantities?.size+"px";
          DATA_SECTION_QUANTITY.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
          DATA_SECTION_QUANTITY.style.color = el?.customization?.bundle?.productDetails?.quantities?.color;
          DATA_SECTION_QUANTITY.innerText = `Qty: ${QUANTITY_SPAN.innerText}`;
          DATA_SECTION_QUANTITY_DIV.append(DATA_SECTION_QUANTITY);
        
          BUNDLE_PRODUCT_DIV.append(DATA_SECTION_IMAGE_TITLE_DIV,
            DATA_SECTION_QUANTITY_DIV);
          let BUNDLE_SELECT;
          let selectRow = document.createElement("div");
          selectRow.className = "sd-bundle-product-select-main";
          let seeMoreDiv = document.createElement("div");
          let show_more = document.createElement("button");
          show_more.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
          show_more.className = "sd-volume-showMoreLess"
          seeMoreDiv.append(show_more);
          show_more.innerText = el?.translations?.translation?.seeMore;
          let seeLessDiv = document.createElement("div");
          let show_less = document.createElement("button");
          show_less.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
          show_less.className = "sd-volume-showMoreLess"
          seeLessDiv.append(show_less);
          show_less.innerText = el?.translations?.translation?.seeLess;
          seeLessDiv.classList.add("sd-bundle-hide-click");
          for (let i = 1; i <= ele?.minimumOrder; i++) {
            if (ele?.minimumOrder <= 2 || ele?.variants?.length <= 1) {
              seeMoreDiv.style.display = "none";
            }
            gidArray[bundleIndex][index][i - 1] = ele?.variants[0].id;
            bundleData[bundleIndex][index][i - 1] = {
              id: ele?.variants[0]?.id?.replace(
                "gid://shopify/ProductVariant/",
                ""
              ),
              quantity: 1,
            };
            bundleSum[bundleIndex][index][i - 1] = ele?.variants[0]?.price;

            if (ele.variants.length > 1) {
              BUNDLE_SELECT = document.createElement("select");
              BUNDLE_SELECT.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
              BUNDLE_SELECT.style.color = el?.customization?.bundle?.productDetails?.variantSelector?.color;
              BUNDLE_SELECT.style.background = el?.customization?.bundle?.productDetails?.variantSelector?.backgroundColor;
              BUNDLE_SELECT.style.width = `${el?.customization?.bundle?.productDetails?.variantSelector?.width}px`;
              BUNDLE_SELECT.id = `sd-bundle-select-option${i}${bundleIndex}${index}`;
              BUNDLE_SELECT.className = "sd-bundle-select-option";
              BUNDLE_SELECT.classList.add(
                `sd-bundle-select-option${i}${bundleIndex}${index}`
              );

              ele?.variants?.map((elem, optionIndex) => {
                let BUNDLE_OPTION = document.createElement("option");
                BUNDLE_OPTION.textContent = elem?.title;
                BUNDLE_OPTION.value = elem?.id?.replace(
                  "gid://shopify/ProductVariant/",
                  ""
                );
                BUNDLE_OPTION.setAttribute("optionIndex", optionIndex);
                BUNDLE_OPTION.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
                BUNDLE_OPTION.setAttribute("data-id", elem?.price);
                BUNDLE_SELECT.appendChild(BUNDLE_OPTION);

                selectRow.append(BUNDLE_SELECT);
              });
              if (i > 2) {
                BUNDLE_SELECT.classList.add("sd-bundle-hide-click");
              }
              show_more.addEventListener("click", function (e) {
                BUNDLE_SELECT.classList.remove("sd-bundle-hide-click");
                seeMoreDiv.classList.add("sd-bundle-hide-click");
                seeLessDiv.classList.remove("sd-bundle-hide-click");
              });

              show_less.addEventListener("click", function (e) {
                if (i > 2) {
                  BUNDLE_SELECT.classList.add("sd-bundle-hide-click");
                }
                seeLessDiv.classList.add("sd-bundle-hide-click");
                seeMoreDiv.classList.remove("sd-bundle-hide-click");
              });
            }
            DATA_SECTION_TITLE_PRICE_DIV.append(selectRow);
            BUNDLE_DIV.append(BUNDLE_PRODUCT_DIV);

            let selectedElement = document.querySelectorAll(
              `.sd-bundle-select-option${i}${bundleIndex}${index}`
            );

            selectedElement.forEach((selected) => {
              const selectedOption = selected.options[1];
              const id = selectedOption?.getAttribute("data-id");
              arr.push(id);

              selected.addEventListener("change", (e) => {
                const varientPrice = e?.target?.options[e?.target?.selectedIndex]?.dataset?.id;
                bundleSum[bundleIndex][index][i - 1] = varientPrice;
                bundleData[bundleIndex][index][i - 1] = {
                  id: e?.target?.value,
                  quantity: 1,
                };
                const gitVal = "gid://shopify/ProductVariant/" + e?.target?.value;
                gidArray[bundleIndex][index][i - 1] = gitVal;
                let priceDiv = document.getElementById(
                  `sd-bundle-datasection-price${index}${bundleIndex}`
                );
                const selectedOption = selected?.options[selected?.selectedIndex];
                const id = selectedOption.getAttribute("data-id");

                priceDiv.innerText = showAmountWithCurrency(id);

                arr.splice(i, 0, id);

                const finalSumBundle = bundleSum[bundleIndex].reduce(
                  (acc, curr) => acc.concat(curr),
                  []
                );
                let myArray = finalSumBundle.map(parseFloat);

                let total = myArray.reduce(
                  (accumulator, currentValue) => accumulator + currentValue,
                  0
                );

                const getDivPrice = document.getElementById(
                  `sd-bundle-discount-price${bundleIndex}`
                );

                var newPrice = total.toFixed(2);

                getDivPrice.innerHTML = showAmountWithCurrency(newPrice);

                const discountedPriceDiv = document.getElementById(
                  `sd-bundle-final-price${bundleIndex}`
                );

                if (el?.bundleDetail?.discountType == "percent") {
                  let part = parseFloat(el?.bundleDetail?.discountValue);
                  let percentage = (total * part) / 100;
                  let totalPrice = total - percentage;
                  var newPrice = totalPrice.toFixed(2);
                  discountedPriceDiv.innerHTML = showAmountWithCurrency(newPrice);
                } else if (el?.bundleDetail?.discountType == "fixed") {
                  let part = parseFloat(el?.bundleDetail?.discountValue);
                  let fixed = total - part;
                  var newPrice = fixed.toFixed(2);
                  discountedPriceDiv.innerHTML = showAmountWithCurrency(newPrice);
                }
              });

              selected.addEventListener("blur", function () {
              });
            });
          }
              selectRow.append(seeMoreDiv);
              selectRow.append(seeLessDiv);
          // console.log("dgdwydfui",el.bundleDetail.products.length)
          if (index < el.bundleDetail.products.length - 1) {
            let BUNDLE_PLUS_BTN_DIV = document.createElement("div");
            BUNDLE_PLUS_BTN_DIV.className = "sd-add-bundle";
            BUNDLE_PLUS_BTN_DIV.innerHTML = `<svg viewBox="0 0 18 18" focusable="false" width="18" height="18" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
            <path d="M6.98047 17.3842V0.580255H10.3239V17.3842H6.98047ZM0.256392 10.6477V7.30433H17.0604V10.6477H0.256392Z" fill= ${el?.customization?.bundle?.productDetails?.plusColor}></path>
            </svg>`;
            BUNDLE_DIV.append(BUNDLE_PLUS_BTN_DIV);
          }
        });
        let finalSumBundle = bundleSum[bundleIndex].reduce(
          (acc, curr) => acc.concat(curr),
          []
        );
        let myArray = finalSumBundle.map(parseFloat);
        let total = myArray.reduce(
          (accumulator, currentValue) => accumulator + currentValue,
          0
        );
        let discountedPrice;
        if (el?.bundleDetail?.discountType == "percent") {
          let part = parseFloat(el?.bundleDetail?.discountValue);
          let percentage = (total * part) / 100;
          result = total - percentage;
          discountedPrice = result.toFixed(2);
        } else if (el?.bundleDetail?.discountType == "fixed") {
          let part = parseFloat(el?.bundleDetail?.discountValue);
          let fixed = total - part;
          discountedPrice = fixed.toFixed(2);
        } else if (el?.bundleDetail?.discountType == "price") {
          let part = parseFloat(el?.bundleDetail?.discountValue);
          discountedPrice = part;
        } else if (el?.bundleDetail?.discountType == "noDiscount") {
        }

        let TOTAL_DIV = document.createElement("div");
        TOTAL_DIV.className = "sd-product-bundle-total";
        let total_text_Desc = document.createElement("div");
        total_text_Desc.className = "sd-total-desc";
        TOTAL_DIV.append(total_text_Desc);
      
        let total_text =  document.createElement("h4");
        total_text.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
        total_text.style.color = el?.customization?.bundle?.totalSection?.color;
        total_text.style.fontSize = el?.customization?.bundle?.totalSection?.fontSize + "px";
        total_text.innerText = el?.translations?.translation?.total;
        total_text_Desc.append(total_text);
      
        if (
          el?.bundleDetail?.discountType == "freeShipping" ||
          el?.bundleDetail?.discountType == "noDiscount"
        ) {
          // no changes
        } else {
          let infoDescription = document.createElement("p");
          infoDescription.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
          infoDescription.style.color = el?.customization?.bundle?.totalSection?.discountMessage?.color;
          infoDescription.style.fontSize = el?.customization?.bundle?.totalSection?.discountMessage?.size + "px";
          infoDescription.innerText = el?.translations?.translation?.discountApplied;
          total_text_Desc.append(infoDescription);
        }

      if (el?.bundleDetail?.discountType == "freeShipping") {
          let noShippingDiv = document.createElement("div");
          noShippingDiv.className = "sd-bundle-no-shopping-container";
          total_text_Desc.append(noShippingDiv);
          let shippingIcon = document.createElement("span");
          shippingIcon.className = "sd-bundle-shipping-icon";
          shippingIcon.innerHTML = `<svg viewBox="0 0 1024 1024" focusable="false" data-icon="shopping-cart" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M922.9 701.9H327.4l29.9-60.9 496.8-.9c16.8 0 31.2-12 34.2-28.6l68.8-385.1c1.8-10.1-.9-20.5-7.5-28.4a34.99 34.99 0 00-26.6-12.5l-632-2.1-5.4-25.4c-3.4-16.2-18-28-34.6-28H96.5a35.3 35.3 0 100 70.6h125.9L246 312.8l58.1 281.3-74.8 122.1a34.96 34.96 0 00-3 36.8c6 11.9 18.1 19.4 31.5 19.4h62.8a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7h161.1a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7H923c19.4 0 35.3-15.8 35.3-35.3a35.42 35.42 0 00-35.4-35.2zM305.7 253l575.8 1.9-56.4 315.8-452.3.8L305.7 253zm96.9 612.7c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6zm325.1 0c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6z"></path></svg>`;
          noShippingDiv.append(shippingIcon);
          let noShippingText = document.createElement("span");
          noShippingText.className = "sd-bundle-noShipping-text";
          noShippingText.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
          noShippingText.innerText = el?.translations?.translation?.FreeShipping;
          noShippingDiv.append(noShippingText);
        }
      
        let discountedPriceDiv = document.createElement("div");
        discountedPriceDiv.className = "sd-total-amount";
      
        if (
          el?.bundleDetail?.discountType == "freeShipping" ||
          el?.bundleDetail?.discountType == "noDiscount"
        ) {
          let discountPrice = document.createElement("h4");
          discountPrice.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
          discountPrice.id = `sd-bundle-discount-price${bundleIndex}`;
          discountPrice.style.color = el?.customization?.bundle?.totalSection?.originalPrice?.color;
          discountPrice.style.fontSize = el?.customization?.bundle?.totalSection?.originalPrice?.fontSize + "px";
          let newDiscountPrice = total.toFixed(2);
          discountPrice.innerText = showAmountWithCurrency(newDiscountPrice);
          discountedPriceDiv.append(discountPrice);
        } else {
          let finalPrice = document.createElement("h4");
          finalPrice.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
          finalPrice.id = "sd-bundle-final-price" + bundleIndex;
          finalPrice.style.color = el?.customization?.bundle?.totalSection?.finalPrice?.color;
          finalPrice.style.fontSize = el?.customization?.bundle?.totalSection?.finalPrice?.fontSize + "px";
          finalPrice.innerText = showAmountWithCurrency(discountedPrice);
          discountedPriceDiv.append(finalPrice);
          
          let discountPrice = document.createElement("h6");
          discountPrice.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
          discountPrice.id = `sd-bundle-discount-price${bundleIndex}`;
          discountPrice.style.color =
            el?.customization?.bundle?.totalSection?.originalPrice?.color;
          discountPrice.style.fontSize =
            el?.customization?.bundle?.totalSection?.originalPrice?.fontSize + "px";
          let newDiscountPrice = total.toFixed(2);
          discountPrice.innerText = showAmountWithCurrency(newDiscountPrice);
          discountedPriceDiv.append(discountPrice);
        }
      
        TOTAL_DIV.append(discountedPriceDiv);
        BUNDLE_DIV.append(TOTAL_DIV);
        let ADD_TO_CART_BTN_DIV = document.createElement("div");
        ADD_TO_CART_BTN_DIV.className = "sd-bundle-addto-cart";
        let ADD_TO_CART_BUTTON = document.createElement("button");
        ADD_TO_CART_BUTTON.style.fontFamily = el?.customization?.bundle?.box?.fontFamily;
        ADD_TO_CART_BUTTON.style.background = el?.customization?.bundle?.button?.backgroundColor;
        ADD_TO_CART_BUTTON.style.color = el?.customization?.bundle?.button?.color;
        ADD_TO_CART_BUTTON.style.borderColor = el?.customization?.bundle?.button?.borderColor;
        ADD_TO_CART_BUTTON.style.borderRadius = el?.customization?.bundle?.button?.borderRadius + "px";
        ADD_TO_CART_BUTTON.style.fontSize = `${el?.customization?.bundle?.button?.fontSize}px`;
        ADD_TO_CART_BUTTON.innerText = el?.translations?.translation?.addToCartButton;
        ADD_TO_CART_BTN_DIV.append(ADD_TO_CART_BUTTON);
        ADD_TO_CART_BUTTON.addEventListener("click", (e) => {
          let code = JSON.parse(localStorage.getItem("sd_bundle_data"));
          let discountCodeId = code?.discountCreateId ?? "";
          ADD_TO_CART_BUTTON.innerText = "";
          let btnSpinner = document.createElement("div");
          btnSpinner.className = "bundleBtnSpinner";
          ADD_TO_CART_BUTTON.append(btnSpinner);

          btnSpinner.style.display = "block";
          const mergedArray = bundleData[bundleIndex].reduce(
            (acc, curr) => acc.concat(curr),
            []
          );
          const mergedGidArray = gidArray[bundleIndex].reduce(
            (acc, curr) => acc.concat(curr),
            []
          );
          let mergedResult = {};
          
          for (let item of mergedArray) {
            if (mergedResult[item.id]) {
              mergedResult[item.id].quantity += item.quantity;
            } else {
              mergedResult[item.id] = { ...item };
            }
          }
          let mergedArrayResult = Object.values(mergedResult);
          let formData = {
            items: mergedArrayResult,
            attributes: { SD_BUNDLE_ID: el._id },
          };
          fetch(window.Shopify.routes.root + "cart/add.js", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
          })
            .then((response) => {
              return response.json();
            })
            .then((response) => {
              let errorDiv = document.getElementsByClassName(
                "sd-bundle-error-message"
              );
              errorDiv[0]?.remove();
              if (response.status == 422 || response.status == 404) {
                ADD_TO_CART_BUTTON.innerText =
                  el.translations.translation.addToCartButton;
                btnSpinner.remove();
                let errorMessage = document.createElement("div");
                errorMessage.className = "sd-bundle-error-message";
                BUNDLE_DIV.append(errorMessage);
                errorMessage.innerText = response.description;
              } else {
                fetch(window.Shopify.routes.root + "cart.js", {
                  method: "GET",
                  headers: {
                    "Content-Type": "application/json",
                  },
                })
                  .then((response) => {
                    return response.json();
                  })
                  .then((response) => {
                    if (el.bundleDetail.discountType == "noDiscount") {
                      fetch(`${server}/api/storefront/getBundleClick`, {
                        method: "POST",
                        headers: {
                          "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                          shop: Shopify.shop,
                          bundleId: el._id,
                        }),
                      });
                      let isDiscount =
                        el.bundleDetail.discountType == "noDiscount"
                          ? "noDiscount"
                          : "Fix";
                      const localData = JSON.parse(
                        localStorage.getItem("sd_bundle_data")
                      );
                      let sd_bundle_data = {
                        discount_name: el.name,
                        code: code.code,
                        bundleId: el._id,
                        discountType: isDiscount,
                        variantsId: mergedArrayResult,
                        discountCreateId: response.discountCreateId,
                        prefixCode: el.settings.discountLabel,
                      };
                      var jsonString = JSON.stringify(sd_bundle_data);
                      localStorage.setItem("sd_bundle_data", jsonString);

                      btnSpinner.remove();
                      window.location.assign(`https://${Shopify.shop}/cart`);
                    } else {
                      let finalSumBundle = bundleSum[bundleIndex].reduce(
                        (acc, curr) => acc.concat(curr),
                        []
                      );
                      let myArray = finalSumBundle.map(parseFloat);
                      let total = myArray.reduce(
                        (accumulator, currentValue) =>
                          accumulator + currentValue,
                        0
                      );

                      let totalPrice = Number(total.toFixed(2));
                      let finalPrice;
                      switch (el.bundleDetail.discountType) {
                        case "percent":
                          let percentagepart = parseFloat(
                            el.bundleDetail.discountValue
                          );
                          let percentage = (totalPrice * percentagepart) / 100;
                          finalPrice = percentage.toFixed(2);
                          break;
                        case "price":
                          let pricePart = parseFloat(
                            el.bundleDetail.discountValue
                          );
                          result = totalPrice - pricePart;
                          finalPrice = result.toFixed(2);
                          break;
                        case "fixed":
                          let fixedPart = parseFloat(
                            el.bundleDetail.discountValue
                          );
                          finalPrice = fixedPart.toFixed(2);
                          break;
                        default:
                          break;
                      }

                      let isDiscount =
                        el.bundleDetail.discountType == "noDiscount"
                          ? "noDiscount"
                          : "Fix";
                      let sd_bundle_data = {
                        discount_name: el.name,
                        code: `${el.settings.discountLabel}-${code.code}`,
                        discountType: isDiscount,
                        discountValue: finalPrice,
                        variantsId: mergedGidArray,
                        startDate: new Date(),
                        endDate: el.endDate,
                        shop: Shopify.shop,
                        bundleType: el.bundleDetail.discountType,
                        totalPrice: total.toFixed(2),
                        discountCreateId: discountCodeId,
                      };

                      fetch(server + "/api/storefront/createRule", {
                        method: "POST",
                        headers: {
                          "Content-Type": "application/json",
                        },
                        body: JSON.stringify(sd_bundle_data),
                      })
                        .then((response) => response.json())
                        .then((data) => {
                          if (data.status == 200) {
                            fetch(`${server}/api/storefront/getBundleClick`, {
                              method: "POST",
                              headers: {
                                "Content-Type": "application/json",
                              },
                              body: JSON.stringify({
                                shop: Shopify.shop,
                                bundleId: el._id,
                              }),
                            });
                            ADD_TO_CART_BUTTON.innerText =
                              el.translations.translation.addToCartButton;
                            btnSpinner.remove();

                            let sd_bundle_data = {
                              discount_name: el.name,
                              code: code.code,
                              bundleId: el._id,
                              discountType: isDiscount,
                              variantsId: mergedArrayResult,
                              discountCreateId: data.response,
                              prefixCode: el.settings.discountLabel,
                            };
                            var jsonString = JSON.stringify(sd_bundle_data);
                            localStorage.setItem("sd_bundle_data", jsonString);
                            cartDrawer();
                          }
                        });
                    }
                  })
                  .catch((error) => {
                    ADD_TO_CART_BUTTON.innerText =
                      el.translations.translation.addToCartButton;
                  });
              }
            })
            .catch((error) => {
              // console.error("Error:", error);
            });
        });
        BUNDLE_DIV.append(ADD_TO_CART_BTN_DIV);
        if (el?.plans?.plan == "free") {
        waterMark(BUNDLE_DIV);
        }
    } 
    else if (el.type == "volumeBundle") {
        let optionIndex;
        let discountedPrice;
        let VOLUME_DIV = document.createElement("div");
        VOLUME_DIV.className = "sd-bundle-main-column";
        VOLUME_DIV.classList.add("sd-volumeBundle" + bundleIndex);
        VOLUME_DIV.style.background = el?.customization?.volume?.box?.backgroundColor;
        VOLUME_DIV.style.borderRadius = `${el?.customization?.volume?.box?.borderRadius}px`;
        VOLUME_DIV.style.borderColor = el?.customization?.volume?.box?.borderColor;
      
        let VOLUME_TITLE_DIV = document.createElement("div");
        VOLUME_TITLE_DIV.className = "sd-bundle-text-detail";
        
        let volumeTitleText = document.createElement("h4");
        volumeTitleText.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
        volumeTitleText.style.color = el?.customization?.volume?.title?.color;
        volumeTitleText.style.fontWeight = el?.customization?.volume?.title?.titleBold;
        volumeTitleText.style.textAlign =  el?.customization?.volume?.title?.alignment;
        volumeTitleText.style.fontSize =  `${el?.customization?.volume?.title?.fontSize}px`;
        volumeTitleText.innerText = el?.title;
        VOLUME_TITLE_DIV.append(volumeTitleText);

        let VolumeDescription = document.createElement("p");
        VolumeDescription.style.color = el?.customization?.volume?.title?.descriptionColor;
        VolumeDescription.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
        VolumeDescription.style.fontWeight = el?.customization?.volume?.title?.descriptionBold;
        VolumeDescription.style.textAlign = el?.customization?.volume?.title?.alignment;
        VolumeDescription.style.fontSize = `${el?.customization?.volume?.title?.descriptionFontSize}px`;
        VolumeDescription.innerText = el?.description;
        VOLUME_TITLE_DIV.append(VolumeDescription);
      
        VOLUME_DIV.append(VOLUME_TITLE_DIV);

        el.bundleDetail.discountOptions.forEach((ele, volumeIndex) => {
          let DISCOUNTOPTIONS = document.createElement("div");
          DISCOUNTOPTIONS.className = "sd-volume-bundle-detail";
          DISCOUNTOPTIONS.style.background = el?.customization?.volume?.productDetails?.productDetailsBox?.backgroundColor;
          VOLUME_DIV.append(DISCOUNTOPTIONS);
          mainDiv.append(VOLUME_DIV);

          el.bundleDetail.products.map((elem, index) => {
            let DISCOUNT_OPT_HEADLINE = document.createElement("div");
            DISCOUNT_OPT_HEADLINE.className = "sd-select-radio-with-text";
            let DISCOUNT_OPT_titleDiv = document.createElement("div");
            DISCOUNT_OPT_titleDiv.className = "radio";
            DISCOUNT_OPT_titleDiv.id = `sd-bundle-volume-discountOpt-title-box${volumeIndex}${index}`;

            let radioBtn = document.createElement("input");
            radioBtn.classList.add("sd-radio-btn" + bundleIndex);
            radioBtn.setAttribute("type", "radio");
            radioBtn.setAttribute("value", volumeIndex);
            radioBtn.setAttribute("name", "bundle-radio" + bundleIndex);
            radioBtn.setAttribute(
              "id",
              "volumeDiscount" + volumeIndex + bundleIndex
            );

            if (volumeIndex === 0) {
              radioBtn.setAttribute("checked", "checked");
              optionIndex = volumeIndex;
            }

            DISCOUNT_OPT_titleDiv.append(radioBtn);

            let discountOptTitle = document.createElement("label");
            discountOptTitle.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
            discountOptTitle.style.color = el?.customization?.volume?.options?.color;
            discountOptTitle.style.fontSize = `${el?.customization?.volume?.options?.fontSize}px`;
            discountOptTitle.setAttribute(
              "for",
              "volumeDiscount" + volumeIndex + bundleIndex
            );
            discountOptTitle.className = "sd-radio-label";

            if (ele?.description.includes("{discount}")) {
              if (ele?.type == "percent") {
                let updatedString = ele?.description?.replace(
                  "{discount}",
                  ele.value + "%"
                );
                discountOptTitle.innerText = updatedString;
              } else if (ele?.type == "fixed") {
                let newPrice = showAmountWithCurrency(ele?.value);
                let updatedString = ele.description.replace(
                  "{discount}",
                  newPrice + " " + el.translations.translation.off
                );
                discountOptTitle.innerText = updatedString;
              } else if (ele?.type == "price") {
                let updatedString = ele?.description?.replace("{discount}", "");
                discountOptTitle.innerText = updatedString;
              } else if (
                ele?.type == "noDiscount" ||
                ele?.type == "freeShipping"
              ) {
                discountOptTitle.innerText = ele?.description;
              }
            } else {
              discountOptTitle.innerText = ele?.description;
            }

            DISCOUNT_OPT_titleDiv.append(discountOptTitle);

            let DISCOUNT_OPT_BadgeSection = document.createElement("div");
           if (ele?.badgeText != "" && ele?.badgeText != undefined) {
            DISCOUNT_OPT_BadgeSection.className = "style_badge";
        
            const svg1 = `
                <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8" fill="none">
                    <path d="M8 0L0 8H8V0Z" fill=${el?.customization?.volume?.options?.saveDiscount?.backgroundColor}></path>
                    <path d="M8 0L0 8H8V0Z" fill="black" opacity="0.2"></path>
                </svg>
            `;
            
            const svg2 = `
                <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8" fill="none">
                    <path d="M0 0L8 8H0V0Z" fill=${el?.customization?.volume?.options?.saveDiscount?.backgroundColor}></path>
                    <path d="M0 0L8 8H0V0Z" fill="black" opacity="0.2"></path>
                </svg>
            `;
            let Badge_Text = document.createElement("span");
            Badge_Text.innerText = ele.badgeText; // Use the actual badge text from the element
            Badge_Text.style.fontFamily = el?.customization?.volume?.box?.fontFamily || 'inherit';
            Badge_Text.style.background = el?.customization?.volume?.options?.saveDiscount?.backgroundColor
            Badge_Text.style.fontSize = (el?.customization?.volume?.options?.saveDiscount?.fontSize || 16) + "px"; // Default to 16px if not defined
            Badge_Text.style.color = el?.customization?.volume?.options?.saveDiscount?.color || 'white'; // Default to white if not defined
            Badge_Text.style.padding = "2px 4px"; // Optional: add some padding to the badge text
        
            // Clear the badge section and append the SVGs and badge text
            DISCOUNT_OPT_BadgeSection.innerHTML = svg1; // Set inner HTML to the first SVG
            DISCOUNT_OPT_BadgeSection.append(Badge_Text); // Append the badge text
            DISCOUNT_OPT_BadgeSection.innerHTML += svg2; // Append the second SVG
          }
            DISCOUNT_OPT_HEADLINE.append(
              DISCOUNT_OPT_titleDiv,
              DISCOUNT_OPT_BadgeSection
            );
            DISCOUNTOPTIONS.append(DISCOUNT_OPT_HEADLINE);
            VOLUME_DIV.append(DISCOUNTOPTIONS);
            let DISCOUNT_OPT_PRODUCT_DATA = document.createElement("div");
            if (volumeIndex === 0) {
              DISCOUNT_OPT_PRODUCT_DATA.className =
                "sd-bundle-product-detail";
            } else {
              DISCOUNT_OPT_PRODUCT_DATA.className =
                "close";
            }
            DISCOUNT_OPT_PRODUCT_DATA.id = `sd-bundle-volume-productdata-container${index}${volumeIndex}`;
            let DISCOUNT_OPT_PRODUCT = document.createElement("div");
            DISCOUNT_OPT_PRODUCT.className = "sd-bundle-product-inner";
            let productImgDiv = document.createElement("div");
            productImgDiv.className = "sd-bundle-product-img";
            productImgDiv.style.borderColor = el?.customization?.volume?.productDetails?.image?.borderColor;
            productImgDiv.style.borderRadius = `${el?.customization?.volume?.productDetails?.image?.borderRadius}px`;
            let productImg = document.createElement("img");
            if (
              el.bundleDetail.discountedProductType == "collection" ||
              el.bundleDetail.discountedProductType == "all_products"
            ) {
              productImg.setAttribute(
                "src",
                el.bundleDetail.products[0].images[0]
              );
            } else {
              productImg.setAttribute(
                "src",
                el.bundleDetail.products[0].images[0].originalSrc
              );
            }
            productImgDiv.append(productImg);
            let productTitlePriceDiv = document.createElement("div");
            productTitlePriceDiv.className = "sd-bundle-product-name";
            let productTitle = document.createElement("h5");
            productTitle.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
            productTitle.style.color = el?.customization?.volume?.productDetails?.title?.color;
            productTitle.style.fontSize = `${el?.customization?.volume?.productDetails?.title?.fontSize}px`;
            productTitle.innerText = el?.bundleDetail?.products[0]?.title;
            let productPrice = document.createElement("h4");
            productPrice.classList.add(
              "productPrice" + bundleIndex + volumeIndex
            );
            let xprice;
            if (
              el.bundleDetail.discountedProductType == "all_products" ||
              el.bundleDetail.discountedProductType == "collection"
            ) {
              let sdDivivde =
                el.bundleDetail.products[0].variants[0].price / 100;
              xprice = sdDivivde.toFixed(2);
            } else {
              let toFixedPrice = el.bundleDetail.products[0].variants[0].price;
              xprice = parseFloat(toFixedPrice).toFixed(2);
            }
            productPrice.innerText = showAmountWithCurrency(xprice);
            productPrice.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
            productPrice.id = `sd-volume-datasection-price${index}${bundleIndex}${volumeIndex}`;
            productPrice.style.color = el?.customization?.volume?.productDetails?.price?.color;
            productPrice.style.fontSize = `${el?.customization?.volume?.productDetails?.price?.fontSize}px`;
            productTitlePriceDiv.append(productTitle, productPrice);

            DISCOUNT_OPT_PRODUCT.append(productImgDiv, productTitlePriceDiv);
            let discountOptionQuantityBox = document.createElement("div");
            discountOptionQuantityBox.className = "sd-bundle-product-quantity";
            let discountOptionQuantity = document.createElement("h6");
            let QUANTITY_SPAN = document.createElement("span");
            discountOptionQuantity.innerText = ele.quantity;
            QUANTITY_SPAN.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
            discountOptionQuantity.append(QUANTITY_SPAN);
            discountOptionQuantity.style.color = el?.customization?.volume?.productDetails?.quantities?.color;
            discountOptionQuantity.innerText = `Qty: ${ele.quantity}`;
            discountOptionQuantity.style.fontSize = el?.customization?.volume?.productDetails?.quantities?.size + "px";
            // discountOptionQuantity.innerText = `Qty: ${QUANTITY_SPAN.innerText}`;
            discountOptionQuantity.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
            discountOptionQuantityBox.append(discountOptionQuantity);
            
            DISCOUNT_OPT_PRODUCT_DATA.append(DISCOUNT_OPT_PRODUCT,discountOptionQuantityBox);
            DISCOUNTOPTIONS.append(DISCOUNT_OPT_PRODUCT_DATA);

            let VOLUME_SELECT;

            let selectRow = document.createElement("div");
            selectRow.className = "sd-bundle-product-select-main";
            let seeMoreDiv = document.createElement("div");
            let show_more = document.createElement("button");
            show_more.className = "sd-volume-showMoreLess";
            show_more.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
            seeMoreDiv.append(show_more);
            show_more.innerText = el?.translations?.translation?.seeMore;
            let seeLessDiv = document.createElement("div");

            let show_less = document.createElement("button");
            show_less.className = "sd-volume-showMoreLess";
            show_less.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
            seeLessDiv.append(show_less);
            show_less.innerText = el?.translations?.translation?.seeLess;
            seeLessDiv.classList.add("sd-volume-hide-click");
            if (ele.quantity <= 2) {
              seeMoreDiv.style.display = "none";
            };
            for (let i = 1; i <= ele.quantity; i++) {
              VOLUME_SELECT = document.createElement("select");
              VOLUME_SELECT.style.color = el?.customization?.volume?.productDetails?.variantSelector?.color;
              VOLUME_SELECT.style.background = el?.customization?.volume?.productDetails?.variantSelector?.backgroundColor;
              VOLUME_SELECT.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
              VOLUME_SELECT.style.width = el?.customization?.volume?.productDetails?.variantSelector?.width+"px";
              VOLUME_SELECT.id = `sd-volume-select-option${i}${volumeIndex}`;
              VOLUME_SELECT.classList.add(
                "volumeDiscount" + volumeIndex + bundleIndex
              );

              VOLUME_SELECT.addEventListener("change", (e) => {
                bundleData[bundleIndex][i - 1] = {
                  id: e.target.value,
                  quantity: 1,
                };
                const gitVal = "gid://shopify/ProductVariant/" + e.target.value;
                gidArray[bundleIndex][i - 1] = gitVal;

                const varientPrice = e.target.options[e.target.selectedIndex].dataset.id;
                const displayPrice = document.getElementById(
                  `sd-volume-datasection-price${index}${bundleIndex}${volumeIndex}`
                );

                let xPrice;
                if (
                  el.bundleDetail.discountedProductType == "all_products" ||
                  el.bundleDetail.discountedProductType == "collection"
                ) {
                  xPrice = (varientPrice / 100).toFixed(2);
                } else {
                  let toFixedPrice = parseInt(varientPrice).toFixed(2);
                  xPrice = toFixedPrice;
                }
                let newdisplayPrice = showAmountWithCurrency(xPrice);

                displayPrice.innerText = newdisplayPrice;
                bundleSum[bundleIndex][i - 1] = varientPrice;
                const textAmount = document.getElementById(
                  `sd-bundle-volume-discounted-price${bundleIndex}`
                );
                let myArray = bundleSum[bundleIndex].map(parseFloat);
                let tAmount = myArray.reduce(
                  (accumulator, currentValue) => accumulator + currentValue,
                  0
                );
                let tPrice;
                if (
                  el.bundleDetail.discountedProductType == "all_products" ||
                  el.bundleDetail.discountedProductType == "collection"
                ) {
                  tPrice = (tAmount / 100).toFixed(2);
                } else {
                  tPrice = tAmount.toFixed(2);
                }
                var newTextAmt = showAmountWithCurrency(tPrice);

                textAmount.innerHTML = newTextAmt;

                let total = myArray.reduce(
                  (accumulator, currentValue) => accumulator + currentValue,
                  0
                );

                let dTotalprice;
                if (
                  el.bundleDetail.discountedProductType == "all_products" ||
                  el.bundleDetail.discountedProductType == "collection"
                ) {
                  dTotalprice = total / 100;
                } else {
                  dTotalprice = total;
                }

                if (
                  el.bundleDetail.discountOptions[volumeIndex].type == "percent"
                ) {
                  let part = parseFloat(
                    el.bundleDetail.discountOptions[volumeIndex].value
                  );
                  let percentage = (dTotalprice * part) / 100;
                  result = dTotalprice - percentage;
                  discountedPrice = result.toFixed(2);
                } else if (
                  el.bundleDetail.discountOptions[volumeIndex].type == "fixed"
                ) {
                  let part = parseFloat(
                    el.bundleDetail.discountOptions[volumeIndex].value
                  );
                  let fixed = dTotalprice - part;
                  discountedPrice = fixed.toFixed(2);
                } else if (
                  el.bundleDetail.discountOptions[volumeIndex].type == "price"
                ) {
                  let part = parseFloat(
                    el.bundleDetail.discountOptions[volumeIndex].value
                  );
                  discountedPrice = part.toFixed(2);
                }

                let newProductPrice = showAmountWithCurrency(discountedPrice);

                if (
                  el.bundleDetail.discountOptions[optionIndex].type ==
                    "noDiscount" ||
                  el.bundleDetail.discountOptions[optionIndex].type ==
                    "freeShipping"
                ) {
                  document.getElementById(
                    "sd-bundle-volume-discount-final-price" + bundleIndex
                  ).innerText = newTextAmt;
                } else {
                  document.getElementById(
                    "sd-bundle-volume-discount-final-price" + bundleIndex
                  ).innerText = newProductPrice;
                }
              });
              elem.variants.map((element) => {
                let VOLUME_OPTION = document.createElement("option");
                VOLUME_OPTION.textContent = element.title;

                if (
                  el.bundleDetail.discountedProductType == "collection" ||
                  el.bundleDetail.discountedProductType == "all_products"
                ) {
                  VOLUME_OPTION.value = element.id;
                } else {
                  VOLUME_OPTION.value = element.id.replace(
                    "gid://shopify/ProductVariant/",
                    ""
                  );
                }

                VOLUME_OPTION.setAttribute("data-id", element.price);
                VOLUME_SELECT.appendChild(VOLUME_OPTION);
                selectRow.append(VOLUME_SELECT);
              });

              if (el.bundleDetail.products[0].variants.length <= 1) {
                selectRow.style.display = "none";
              }
              if (i > 2) {
                VOLUME_SELECT.classList.add("sd-volume-hide-click");
              }
              show_more.addEventListener("click", function (e) {
                VOLUME_SELECT.classList.remove("sd-volume-hide-click");
                seeMoreDiv.classList.add("sd-volume-hide-click");
                seeLessDiv.classList.remove("sd-volume-hide-click");
              });

              show_less.addEventListener("click", function (e) {
                if (i > 2) {
                  VOLUME_SELECT.classList.add("sd-volume-hide-click");
                }
                seeLessDiv.classList.add("sd-volume-hide-click");
                seeMoreDiv.classList.remove("sd-volume-hide-click");
              });
              productTitlePriceDiv.append(selectRow);
            }
            selectRow.append(seeMoreDiv);
            selectRow.append(seeLessDiv);
            let selectedElement = document.getElementsByClassName(
              "sd-volume-select-option"
            );

            let radioGroup = document.getElementsByName(
              "bundle-radio" + bundleIndex
            );
          });

          let radioGroup = document.getElementsByName(
            "bundle-radio" + bundleIndex
          );

          radioGroup.forEach((radio) => {
            radio.addEventListener("change", () => {
              document
                .querySelectorAll(".volumeDiscount" + volumeIndex + bundleIndex)
                .forEach((selected) => {
                  selected.options[0].selected = true;

                  let price = selected.options[0].getAttribute("data-id");
                  document
                    .querySelectorAll(
                      ".productPrice" + bundleIndex + volumeIndex
                    )
                    .forEach((priceDiv) => {
                      let xprice;
                      if (
                        el.bundleDetail.discountedProductType ==
                          "all_products" ||
                        el.bundleDetail.discountedProductType == "collection"
                      ) {
                        xprice = (price / 100).toFixed(2);
                      } else {
                        let toFixedPrice = parseInt(price).toFixed(2);
                        xprice = toFixedPrice;
                      }
                      let newProductPrice = showAmountWithCurrency(xprice);

                      priceDiv.innerText = newProductPrice;
                    });
                });
              radioGroup.forEach((r) => {
                if (r.checked) {
                  r.parentElement.parentElement.nextSibling.classList.remove(
                    "close"
                  );
                  r.parentElement.parentElement.nextSibling.classList.add(
                    "sd-bundle-product-detail"
                  );
                } else {
                  r.parentElement.parentElement.nextSibling.classList.add(
                    "close"
                  );
                  r.parentElement.parentElement.nextSibling.classList.remove(
                    "sd-bundle-product-detail"
                  );
                }
              });
            });
          });
        });

        let volBundle = document.getElementsByClassName(
          "sd-volumeBundle" + bundleIndex
        )[0];

        let volBundleData = volBundle.querySelectorAll(
          ".sd-radio-btn" + bundleIndex
        );
        volBundleData.forEach((e) => {
          if (e.checked == true) {
            let getId = e.getAttribute("id");
            let getIdData = document.querySelectorAll("." + getId);
            getIdData.forEach((id) => {
              bundleSum[bundleIndex].push(
                id.options[0].getAttribute("data-id")
              );

              bundleData[bundleIndex].push({ id: id.value, quantity: 1 });
              gidArray[bundleIndex].push(
                "gid://shopify/ProductVariant/" + id.value
              );
            });
          }
        });
        let radioBtnBundle = document.querySelectorAll(
          ".sd-radio-btn" + bundleIndex
        );
        radioBtnBundle.forEach((elem, ind) => {
          elem.addEventListener("change", (e) => {
            optionIndex = ind;
            bundleData[bundleIndex] = [];
            bundleSum[bundleIndex] = [];
            gidArray[bundleIndex] = [];
            let getId = e.target.id;
            let getIdData = document.querySelectorAll("." + getId);
            getIdData.forEach((id) => {
              bundleSum[bundleIndex].push(
                id.options[0].getAttribute("data-id")
              );

              bundleData[bundleIndex].push({ id: id.value, quantity: 1 });
              gidArray[bundleIndex].push(
                "gid://shopify/ProductVariant/" + id.value
              );
            });

            let total = bundleSum[bundleIndex].reduce(
              (accumulator, currentValue) => {
                return accumulator + parseInt(currentValue, 10);
              },
              0
            );

            let xprice;
            let xtotal;
            if (
              el.bundleDetail.discountedProductType == "all_products" ||
              el.bundleDetail.discountedProductType == "collection"
            ) {
              xprice = (total / 100).toFixed(2);
              xtotal = (total / 100).toFixed(2);
            } else {
              xprice = total.toFixed(2);
              xtotal = total;
            }
            let newProductPrice = showAmountWithCurrency(xprice);

            const showTotalval = document.getElementById(
              `sd-bundle-volume-discounted-price${bundleIndex}`
            );

            showTotalval.innerText = newProductPrice;

            if (el.bundleDetail.discountOptions[ind].type == "percent") {
              let part = parseFloat(el.bundleDetail.discountOptions[ind].value);
              let percentage = (xtotal * part) / 100;
              result = xtotal - percentage;
              discountedPrice = result.toFixed(2);
            } else if (el.bundleDetail.discountOptions[ind].type == "fixed") {
              let part = parseFloat(el.bundleDetail.discountOptions[ind].value);
              let fixed = xtotal - part;
              discountedPrice = fixed.toFixed(2);
            } else if (el.bundleDetail.discountOptions[ind].type == "price") {
              let part = parseFloat(el.bundleDetail.discountOptions[ind].value);
              discountedPrice = part.toFixed(2);
            }
            let newDiscountedProductPrice =
              showAmountWithCurrency(discountedPrice);
            if (
              el.bundleDetail.discountOptions[optionIndex].type ==
                "noDiscount" ||
              el.bundleDetail.discountOptions[optionIndex].type ==
                "freeShipping"
            ) {
              document.getElementById(
                "sd-bundle-volume-discount-final-price" + bundleIndex
              ).innerText = newProductPrice;
            } else {
              document.getElementById(
                "sd-bundle-volume-discount-final-price" + bundleIndex
              ).innerText = newDiscountedProductPrice;
            }
          });
        });

        let total = bundleSum[bundleIndex].reduce(
          (accumulator, currentValue) => {
            return accumulator + parseInt(currentValue, 10);
          },
          0
        );
        let dNewTotalprice;
        if (
          el.bundleDetail.discountedProductType == "all_products" ||
          el.bundleDetail.discountedProductType == "collection"
        ) {
          dNewTotalprice = total / 100;
        } else {
          dNewTotalprice = total;
        }

        if (el.bundleDetail.discountOptions[0].type == "percent") {
          let part = parseFloat(el.bundleDetail.discountOptions[0].value);
          let percentage = (dNewTotalprice * part) / 100;
          result = dNewTotalprice - percentage;
          discountedPrice = result.toFixed(2);
        } else if (el.bundleDetail.discountOptions[0].type == "fixed") {
          let part = parseFloat(el.bundleDetail.discountOptions[0].value);
          let fixed = dNewTotalprice - part;
          discountedPrice = fixed.toFixed(2);
        } else if (el.bundleDetail.discountOptions[0].type == "price") {
          let part = parseFloat(el.bundleDetail.discountOptions[0].value);
          discountedPrice = part;
        }

        let totalDiv = document.createElement("div");
        totalDiv.className = "sd-bundle-volume-total-box";
        let totalTextDiv = document.createElement("div");
        totalTextDiv.className = "sd-total-desc";
        let TotalText = document.createElement("h4");
        TotalText.style.color = el?.customization?.volume?.totalSection?.color;
        TotalText.style.fontSize = el?.customization?.volume?.totalSection?.fontSize + "px";
        TotalText.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
        TotalText.innerText = el?.translations?.translation?.total;
        TotalText.style.color = el?.customization?.volume?.totalSection?.color;
        totalTextDiv.append(TotalText);

        let DiscountText = document.createElement("p");
        DiscountText.style.fontSize = el?.customization?.volume?.totalSection?.discountMessage?.size + "px";
        DiscountText.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
        DiscountText.style.color = el?.customization?.volume?.totalSection?.discountMessage?.color;
        DiscountText.innerText = el?.translations?.translation?.discountApplied;
        totalTextDiv.append(DiscountText);
        let totalDiscountDiv = document.createElement("div");
        totalDiscountDiv.className = "sd-total-amount";
        let firstDiscountText = document.createElement("h6");
        firstDiscountText.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
        firstDiscountText.id = `sd-bundle-volume-discounted-price${bundleIndex}`;
        firstDiscountText.style.color = el?.customization?.volume?.totalSection?.originalPrice.color;
        firstDiscountText.style.fontSize = el?.customization?.volume.totalSection?.originalPrice?.fontSize + "px";
        let tPrice;
        if (
          el.bundleDetail.discountedProductType == "all_products" ||
          el.bundleDetail.discountedProductType == "collection"
        ) {
          tPrice = (total / 100).toFixed(2);
        } else {
          tPrice = total.toFixed(2);
        }
        let newFirstDiscountPrice = tPrice;
        firstDiscountText.innerText = showAmountWithCurrency(
          newFirstDiscountPrice
        );

        let secondDiscountText = document.createElement("h4");
        secondDiscountText.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
        secondDiscountText.style.color = el?.customization?.volume?.totalSection?.finalPrice?.color;
        secondDiscountText.style.fontSize = el?.customization?.volume?.totalSection?.finalPrice?.fontSize + "px";
        secondDiscountText.id = "sd-bundle-volume-discount-final-price" + bundleIndex;
       
        newSecondDiscountPrice = discountedPrice;
        if (
          el.bundleDetail.discountOptions[optionIndex].type == "noDiscount" ||
          el.bundleDetail.discountOptions[optionIndex].type == "freeShipping"
        ) {
          secondDiscountText.innerText = showAmountWithCurrency(newFirstDiscountPrice);
        } else {
          secondDiscountText.innerText = showAmountWithCurrency(
            newSecondDiscountPrice
          );
        }
        totalDiscountDiv.append(secondDiscountText,firstDiscountText);
        totalDiv.append(totalTextDiv, totalDiscountDiv);
        let addToCart = document.createElement("div");
        addToCart.className = "sd-bundle-addto-cart";
        totalDiv.className = "sd-product-bundle-total";
        VOLUME_DIV.append(totalDiv);
        let addToCartBtn = document.createElement("button");
        addToCartBtn.style.borderColor = el?.customization?.volume?.button?.borderColor;
        addToCartBtn.style.borderRadius = el?.customization?.volume.button?.borderRadius+"px";
        addToCartBtn.style.fontFamily = el?.customization?.volume?.box?.fontFamily;
        addToCartBtn.style.background = el?.customization?.volume?.button?.backgroundColor;
        addToCartBtn.style.color = el?.customization?.volume?.button?.color;
        addToCartBtn.style.fontSize = `${el?.customization?.volume?.button?.fontSize}px`;
        addToCartBtn.innerText = el?.translations?.translation?.addToCartButton;
        addToCart.append(addToCartBtn);

        if (el?.customization?.volume?.button?.position == "bottom") {
          VOLUME_DIV.append(addToCart);
        } else {
          VOLUME_DIV.prepend(addToCart);
        }

        addToCartBtn.addEventListener("click", function () {
          let code = JSON.parse(localStorage.getItem("sd_bundle_data"));
          let discountCodeId = code.discountCreateId ?? "";
          addToCartBtn.innerText = "";
          let volumeBtnSpinner = document.createElement("div");
          addToCartBtn.append(volumeBtnSpinner);
          volumeBtnSpinner.className = "bundleBtnSpinner";
          volumeBtnSpinner.style.display = "block";

          const mergedArray = bundleData[bundleIndex].reduce(
            (acc, curr) => acc.concat(curr),
            []
          );
          const mergedGidArray = gidArray[bundleIndex].reduce(
            (acc, curr) => acc.concat(curr),
            []
          );

          let mergedResult = {};
          for (let item of mergedArray) {
            if (mergedResult[item.id]) {
              mergedResult[item.id].quantity += item.quantity;
            } else {
              mergedResult[item.id] = { ...item };
            }
          }
          let mergedArrayResult = Object.values(mergedResult);

          let formData = {
            items: mergedArrayResult,
            attributes: { SD_BUNDLE_ID: el._id },
          };
          fetch(window.Shopify.routes.root + "cart/add.js", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
          })
            .then((response) => {
              return response.json();
            })
            .then((response) => {
              let errorDiv = document.getElementsByClassName(
                "sd-bundle-error-message"
              );
              errorDiv[0]?.remove();
              if (response.status == 422 || response.status == 404) {
                addToCartBtn.innerText =
                  el.translations.translation.addToCartButton;
                volumeBtnSpinner.remove();
                let errorMessage = document.createElement("div");
                errorMessage.className = "sd-bundle-error-message";
                VOLUME_DIV.append(errorMessage);
                errorMessage.innerText = response.description;
              } else {
                fetch(window.Shopify.routes.root + "cart.js", {
                  method: "GET",
                  headers: {
                    "Content-Type": "application/json",
                  },
                })
                  .then((response) => {
                    return response.json();
                  })
                  .then((response) => {
                    if (
                      el.bundleDetail.discountOptions[optionIndex].type ==
                      "noDiscount"
                    ) {
                      fetch(`${server}/api/storefront/getBundleClick`, {
                        method: "POST",
                        headers: {
                          "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                          shop: Shopify.shop,
                          bundleId: el._id,
                        }),
                      });
                      let isDiscount =
                        el.bundleDetail.discountOptions[optionIndex].type ==
                        "noDiscount"
                          ? "noDiscount"
                          : "Fix";
                      const localData = JSON.parse(
                        localStorage.getItem("sd_bundle_data")
                      );
                      let sd_bundle_data = {
                        discount_name: el.name,
                        code: code.code,
                        bundleId: el._id,
                        discountType: isDiscount,
                        variantsId: mergedArrayResult,
                        discountCreateId: localData.discountCreateId,
                        prefixCode: el.settings.discountLabel,
                      };
                      var jsonString = JSON.stringify(sd_bundle_data);
                      localStorage.setItem("sd_bundle_data", jsonString);
                      addToCartBtn.innerText =
                        el.translations.translation.addToCartButton;
                      volumeBtnSpinner.remove();
                      window.location.assign(`https://${Shopify.shop}/cart`);
                    } else {
                      let finalSumBundle = bundleSum[bundleIndex].reduce(
                        (acc, curr) => acc.concat(curr),
                        []
                      );
                      let myArray = finalSumBundle.map(parseFloat);
                      let total = myArray.reduce(
                        (accumulator, currentValue) =>
                          accumulator + currentValue,
                        0
                      );
                      let xtotalprice;
                      if (
                        el.bundleDetail.discountedProductType ==
                          "all_products" ||
                        el.bundleDetail.discountedProductType == "collection"
                      ) {
                        xtotalprice = (total / 100).toFixed(2);
                      } else {
                        xtotalprice = total;
                      }

                      let finalPrice;

                      switch (
                        el.bundleDetail.discountOptions[optionIndex].type
                      ) {
                        case "percent":
                          let percentage = xtotalprice - discountedPrice;
                          if (
                            el.bundleDetail.discountedProductType ==
                            "all_products"
                          ) {
                            finalPrice = percentage.toFixed(2);
                          } else {
                            finalPrice = percentage.toFixed(2);
                          }
                          break;
                        case "price":
                          let pricePart = parseFloat(
                            el.bundleDetail.discountOptions[optionIndex].value
                          );
                          result = xtotalprice - pricePart;
                          finalPrice = result.toFixed(2);
                          break;
                        case "fixed":
                          let fixedPart = parseFloat(
                            el.bundleDetail.discountOptions[optionIndex].value
                          );
                          finalPrice = fixedPart.toFixed(2);
                        break;

                        default:
                          break;
                      }

                      let isDiscount =
                        el.bundleDetail.discountOptions[optionIndex].type ==
                        "noDiscount"
                          ? "noDiscount"
                          : "Fix";

                      let sd_bundle_data = {
                        discount_name: el.name,
                        code: el.settings.discountLabel + "-" + code.code,
                        discountType: isDiscount,
                        discountValue: finalPrice,
                        variantsId: mergedGidArray,
                        startDate: new Date(),
                        endDate: el.endDate,
                        shop: Shopify.shop,
                        bundleType: el.bundleDetail.discountOptions[optionIndex].type,
                        totalPrice: xtotalprice,
                        discountCreateId: discountCodeId,
                      };

                      fetch(server + "/api/storefront/createRule", {
                        method: "POST",
                        headers: {
                          "Content-Type": "application/json",
                        },
                        body: JSON.stringify(sd_bundle_data),
                      })
                        .then((response) => response.json())
                        .then((data) => {
                          if (data.status == 200) {
                            fetch(`${server}/api/storefront/getBundleClick`, {
                              method: "POST",
                              headers: {
                                "Content-Type": "application/json",
                              },
                              body: JSON.stringify({
                                shop: Shopify.shop,
                                bundleId: el._id,
                              }),
                            });

                            let isDiscount =
                              el.bundleDetail.discountOptions[optionIndex]
                                .type == "noDiscount"
                                ? "noDiscount"
                                : "Fix";
                            let sd_bundle_data = {
                              discount_name: el.name,
                              code: code.code,
                              bundleId: el._id,
                              discountType: isDiscount,
                              variantsId: mergedArrayResult,
                              discountCreateId: data.response,
                              prefixCode: el.settings.discountLabel,
                            };
                            var jsonString = JSON.stringify(sd_bundle_data);
                            localStorage.setItem("sd_bundle_data", jsonString);
                            addToCartBtn.innerText =
                              el.translations.translation.addToCartButton;
                            volumeBtnSpinner.remove();
                            cartDrawer();
                          }
                        });
                    }
                    // .catch((err) => console.error(err));
                  })
                  .catch((error) => {
                    // console.log(error.message);
                  });
              }
            })
            .catch((error) => {
              console.error("Error:", error.message);
            });
        });

        if (el?.plans?.plan == "free") {
        waterMark(VOLUME_DIV);
        }
    } 
    else if (el.type == "collectionMixMatch") {
      // console.log("test....collection data........",el)
      //--------------------------------------------------------------------------Collection Bundle----------------------------------------------------------------------------
      let collectionDiv = document.createElement("div");
        collectionDiv.className = "sd-collection-main-column";
        collectionDiv.style.background = el?.customization?.collectionMixMatch?.box?.backgroundColor;
        collectionDiv.style.border = "1px solid" + el?.customization?.collectionMixMatch?.box?.borderColor;
        collectionDiv.style.borderRadius = el?.customization?.collectionMixMatch?.box?.borderRadius + "px";
        mainDiv.append(collectionDiv);
        if (el?.badgeText != "" && el?.badgeText != undefined) {
        let VOLUME_HEADER_DIV = document.createElement("span");
          VOLUME_HEADER_DIV.className = "sd-badges-part";
          VOLUME_HEADER_DIV.style.background = el?.customization?.collectionMixMatch?.DiscountBadge?.backgroundColor;
          VOLUME_HEADER_DIV.style.fontFamily = el?.customization?.collectionMixMatch?.box?.fontFamily;
          VOLUME_HEADER_DIV.style.color = el?.customization?.collectionMixMatch?.DiscountBadge?.color;
          let discountBadge = document.createElement("span");
          discountBadge.className = "sd-collectionMM-badge";
          discountBadge.innerText = el?.badgeText;
          VOLUME_HEADER_DIV.append(discountBadge);
          collectionDiv.append(VOLUME_HEADER_DIV);
        }
      
        let customiseTitle = document.createElement("div");
        customiseTitle.className = "sd-bundle-text-detail";
        collectionDiv.append(customiseTitle);
        let customiseTitleText = document.createElement("h4");
        customiseTitleText.style.fontFamily = el?.customization?.collectionMixMatch?.box?.fontFamily;
        customiseTitleText.innerText = el?.title;
        customiseTitleText.style.color = el?.customization?.collectionMixMatch?.title?.color;
        customiseTitleText.style.fontSize = el?.customization?.collectionMixMatch?.title?.fontSize + "px";
        customiseTitleText.style.textAlign = el?.customization?.collectionMixMatch?.title?.alignment;
        if (el?.badgeText != "" && el?.badgeText != undefined) {
            customiseTitle.classList.add("extra-padding");
        }
        customiseTitle.append(customiseTitleText);

        let customiseDescriptionText = document.createElement("p");
        customiseDescriptionText.style.fontFamily = el?.customization?.collectionMixMatch?.box?.fontFamily;
        customiseDescriptionText.innerText = el?.description;
        customiseDescriptionText.style.color =
          el?.customization?.collectionMixMatch?.title?.descriptionColor;
        customiseDescriptionText.style.fontSize =
          el?.customization?.collectionMixMatch?.title?.descriptionFontSize + "px";
        customiseDescriptionText.style.textAlign = el?.customization?.collectionMixMatch?.title?.alignment;
        customiseTitle.append(customiseDescriptionText);

        el.bundleDetail.products.forEach((ele, index) => {
          let CollectionDetails = document.createElement("div")
          CollectionDetails.className = "sd-bundle-product-detail create-bundle-discount";
          CollectionDetails.style.backgroundColor = el?.customization?.collectionMixMatch?.collectionDetails?.collectionDetailsBox?.backgroundColor;
          collectionDiv.append(CollectionDetails);
          let selectedCollection = document.createElement("div");
          selectedCollection.className = "sd-bundle-product-inner";
          CollectionDetails.append(selectedCollection);

          let SelectedCollectionImgDiv = document.createElement("div");
          SelectedCollectionImgDiv.className = "sd-bundle-product-img";
          SelectedCollectionImgDiv.style.border = "1px solid" + el?.customization?.collectionMixMatch?.collectionDetails?.imageBorderColor;
          selectedCollection.append(SelectedCollectionImgDiv);
          let selectedCollectionImg = document.createElement("img");
          selectedCollectionImg.style.width = "100%";
          let collectionImg = ele?.image?.originalSrc ?? smartNoImg;
          selectedCollectionImg.setAttribute("src", collectionImg);
          SelectedCollectionImgDiv.append(selectedCollectionImg);
          
          let selectedCollectionData = document.createElement("div");
          selectedCollectionData.className = "sd-bundle-product-name";
          selectedCollection.append(selectedCollectionData);

          let selectedCollectionName = document.createElement("h5");
          selectedCollectionName.style.fontFamily = el?.customization?.collectionMixMatch?.box?.fontFamily;
          selectedCollectionName.style.color = el?.customization?.collectionMixMatch?.collectionDetails?.title?.color;
          selectedCollectionName.style.fontSize = el?.customization?.collectionMixMatch?.collectionDetails?.title?.fontSize + "px";
          selectedCollectionName.innerText = ele.title;
          selectedCollectionData.append(selectedCollectionName);
          let selectedCollectionQuantity = document.createElement("p");
          selectedCollectionQuantity.style.fontFamily = el?.customization?.collectionMixMatch?.box?.fontFamily;
          selectedCollectionQuantity.innerText = `Add ${ele.quantity} items from ${ele.title}`;
          selectedCollectionQuantity.style.color = el?.customization?.collectionMixMatch?.collectionDetails?.description?.color;
          selectedCollectionQuantity.style.fontSize =el?.customization?.collectionMixMatch?.collectionDetails?.description?.fontSize + "px";
          selectedCollectionData.append(selectedCollectionQuantity);

           if (index < el.bundleDetail.products.length - 1) {
            let BUNDLE_PLUS_BTN_DIV = document.createElement("div");
            BUNDLE_PLUS_BTN_DIV.className = "sd-add-bundle";
            BUNDLE_PLUS_BTN_DIV.style.color = el?.customization?.collectionMixMatch?.collectionDetails?.plus?.color;
            BUNDLE_PLUS_BTN_DIV.innerHTML = `<svg viewBox="0 0 18 18" focusable="false" width="18" height="18" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
            <path d="M6.98047 17.3842V0.580255H10.3239V17.3842H6.98047ZM0.256392 10.6477V7.30433H17.0604V10.6477H0.256392Z" fill= ${
                          el?.customization?.collectionMixMatch
                            ?.collectionDetails?.plus?.color
                        }></path>
            </svg>`;
            collectionDiv.append(BUNDLE_PLUS_BTN_DIV);
          } else {
          }
        });

        let Go_To_Bundle_Div = document.createElement("div");
        Go_To_Bundle_Div.className = "sd-bundle-addto-cart"
        let go_to_bundleBuilder_btn = document.createElement("button");
        go_to_bundleBuilder_btn.style.fontFamily = el?.customization?.collectionMixMatch?.box?.fontFamily;
        go_to_bundleBuilder_btn.style.borderColor = el?.customization?.collectionMixMatch?.button?.borderColor;
        go_to_bundleBuilder_btn.style.borderRadius = el?.customization?.collectionMixMatch?.button?.borderRadius + "px";
        go_to_bundleBuilder_btn.style.background = el?.customization?.collectionMixMatch?.button?.backgroundColor;
        go_to_bundleBuilder_btn.style.color = el?.customization?.collectionMixMatch?.button?.color;
        go_to_bundleBuilder_btn.style.fontSize = el?.customization?.collectionMixMatch?.button?.fontSize + "px";
        go_to_bundleBuilder_btn.innerText = el?.translations?.translation?.goToBundleBuilder;
        
        collectionDiv.append(Go_To_Bundle_Div);
        Go_To_Bundle_Div.append(go_to_bundleBuilder_btn)
        go_to_bundleBuilder_btn.addEventListener("click", async (e) => {
          go_to_bundleBuilder_btn.innerText = "";
          let collectionSpinner = document.createElement("div");
          go_to_bundleBuilder_btn.append(collectionSpinner);
          collectionSpinner.className = "bundleBtnSpinner";
          collectionSpinner.style.display = "block";

          const data = {
            shop: Shopify.shop,
          };
          fetch(server + "/api/storefront/getPage", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          })
            .then((response) => response.json())
            .then((response) => {
              if (response.status == 400) {
                fetch(server + "/api/storefront/createPage", {
                  method: "POST",
                  headers: {
                    "content-Type": "application/json",
                  },
                  body: JSON.stringify(data),
                })
                  .then((response) => response.json())
                  .then((response) => {
                    if (response.status == 200) {
                      go_to_bundleBuilder_btn.innerText =
                        el.translations.translation.goToBundleBuilder;
                      collectionSpinner.remove();
                      navigator.sayswho = (function () {
                        var N = navigator.appName,
                          ua = navigator.userAgent,
                          tem,
                          M = ua.match(
                            /(opera|chrome|safari|firefox|msie)\/?\s*([\d\.]+)/i
                          );
                        if (
                          M &&
                          (tem = ua.match(/version\/([\.\d]+)/i)) != null
                        )
                          M[2] = tem[1];
                        M = M ? [M[1], M[2]] : [N, navigator.appVersion, "-?"];
                        return M.join(" ");
                      })();

                      if (navigator.sayswho.includes("Safari") == true) {
                        window.location.assign(
                          `https://${Shopify.shop}/pages/collection-mix-match?b=${el._id}`
                        );
                      } else {
                        let newWindow = window.open("", "_blank");
                        newWindow.location.href = `https://${Shopify.shop}/pages/collection-mix-match?b=${el._id}`;
                      }
                    }
                  });
              } else {
                if (response.status == 200) {
                  go_to_bundleBuilder_btn.innerText =
                    el.translations.translation.goToBundleBuilder;

                  collectionSpinner.remove();
                  navigator.sayswho = (function () {
                    var N = navigator.appName,
                      ua = navigator.userAgent,
                      tem,
                      M = ua.match(
                        /(opera|chrome|safari|firefox|msie)\/?\s*([\d\.]+)/i
                      );
                    if (M && (tem = ua.match(/version\/([\.\d]+)/i)) != null)
                      M[2] = tem[1];
                    M = M ? [M[1], M[2]] : [N, navigator.appVersion, "-?"];
                    return M.join(" ");
                  })();

                  if (navigator.sayswho.includes("Safari") == true) {
                    window.location.assign(
                      `https://${Shopify.shop}/pages/collection-mix-match?b=${el._id}`
                    );
                  } else {
                    let newWindow = window.open("", "_blank");
                    newWindow.location.href = `https://${Shopify.shop}/pages/collection-mix-match?b=${el._id}`;
                  }
                }
              }
            });
        });
        
        if (el?.plans?.plan == "free") {
        waterMark(collectionDiv);
        }
    }
    else if (el.type == "fbt") {
      if(el.plans.plan == "standard"){
        let totalProducts =[];
        function execFbtModern(){
          let originalPriceArray=[];
          let originalPrice ;
          let sellingPrice ;
          let selectedOfferedProductCount = 0;
          let calculateOriginalPrice = () => {
            total = 0;
            originalPriceArray.map((item) => {
              if(item.selected==true){
                total += parseFloat(item.price);        
              }
              });
              originalPrice=total
              document.querySelector(`.sd-fbt-mrp-span${bundleIndex}`).innerText=showAmountWithCurrency(total.toFixed(2))
            return total ; 
          };  
            
          function calculateSellingPrice() {
            let finalPrice = 0;      
            if (el.bundleDetail.discountType == "percent") {
              if (el.bundleDetail.discountValue > 100) {
                finalPrice = 0;
              } else {
                finalPrice =
                  originalPrice -
                originalPrice * (el.bundleDetail.discountValue / 100);
              }
            } else if (el.bundleDetail.discountType == "fixed") {
                if (parseFloat(el.bundleDetail.discountValue) > originalPrice) {
                  finalPrice = 0;
                } else {
                  finalPrice = originalPrice - el.bundleDetail.discountValue;
                }
            } else if (el.bundleDetail.discountType == "freeShipping" || el.bundleDetail.discountType == "noDiscount") {
                finalPrice = originalPrice;
            }
            sellingPrice=finalPrice;
            document.querySelector(`.sd-fbt-sellingPrice-span${bundleIndex}`).innerText=showAmountWithCurrency(finalPrice.toFixed(2))
            return finalPrice;
          }
      
          let FBT_DIV = document.createElement("div");
          FBT_DIV.className = "sd-bundle-main-column";
          FBT_DIV.style.backgroundColor = el?.customization?.frequentlyBoughtTogether?.box?.backgroundColor;
          FBT_DIV.style.borderRadius = el?.customization?.frequentlyBoughtTogether?.box?.borderRadius+"px";
          FBT_DIV.style.borderColor = el?.customization?.frequentlyBoughtTogether?.box?.borderColor;
          FBT_DIV.id = `FBT_DIV${bundleIndex}`;
          mainDiv.append(FBT_DIV);

          if (el?.badgeText != "" && el?.badgeText != undefined) {
            if (el?.bundleDetail?.discountType === "percent" || el?.bundleDetail?.discountType === "fixed") {
              let VOLUME_HEADER_DIV = document.createElement("span");
              VOLUME_HEADER_DIV.className = "sd-badges-part-optional";
              VOLUME_HEADER_DIV.style.background = el?.customization?.frequentlyBoughtTogether?.optionalBadge?.background;
              VOLUME_HEADER_DIV.style.color = el?.customization?.frequentlyBoughtTogether?.optionalBadge?.color;
              VOLUME_HEADER_DIV.style.fontSize = el?.customization?.frequentlyBoughtTogether?.optionalBadge?.fontSize + "px"; 
              let discountBadge = document.createElement("span");
              discountBadge.className = "sd-collectionMM-badge";
              discountBadge.innerText = el?.badgeText;
              VOLUME_HEADER_DIV.append(discountBadge);
              FBT_DIV.append(VOLUME_HEADER_DIV);
            }
          }
          
          let FBT_TITLE_DIV = document.createElement("div");
          FBT_TITLE_DIV.className = "sd-bundle-text-detail";
          if (el?.badgeText != "" && el?.badgeText != undefined) {
            if (el.bundleDetail.discountType === "percent" || el.bundleDetail.discountType === "fixed") {
              FBT_TITLE_DIV.classList.add("extra-padding");
            }
          }
          let FBT_TITLE_TEXT_DIV = document.createElement("h4");
          FBT_TITLE_TEXT_DIV.style.color = el?.customization?.frequentlyBoughtTogether?.title?.color;
          FBT_TITLE_TEXT_DIV.style.fontWeight = el?.customization?.frequentlyBoughtTogether?.title?.titleBold;
          FBT_TITLE_TEXT_DIV.style.fontSize = el?.customization?.frequentlyBoughtTogether?.title?.fontSize+"px";
          FBT_TITLE_TEXT_DIV.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
          FBT_TITLE_TEXT_DIV.innerText = el?.title;
          let FBT_DESCRIPTION_TEXT_DIV = document.createElement("p");
          FBT_DESCRIPTION_TEXT_DIV.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
          FBT_DESCRIPTION_TEXT_DIV.style.color = el?.customization?.frequentlyBoughtTogether?.title?.descriptionColor;
          FBT_DESCRIPTION_TEXT_DIV.style.fontWeight = el?.customization?.frequentlyBoughtTogether?.title?.descriptionBold;
          FBT_DESCRIPTION_TEXT_DIV.style.fontSize = el?.customization?.frequentlyBoughtTogether?.title?.descriptionFontSize+"px";
          FBT_DESCRIPTION_TEXT_DIV.innerText = el?.description;

          FBT_TITLE_DIV.append(FBT_TITLE_TEXT_DIV, FBT_DESCRIPTION_TEXT_DIV)
          FBT_DIV.append(FBT_TITLE_DIV);
      
          totalProducts.map((item, index) => {         
            originalPriceArray.push({price: el.bundleDetail.discountedProductType != 'all_products'  ? item.variants[0].price  : item.variants[0].price/100 ,id: el.bundleDetail.discountedProductType != 'all_products'  ? item.variants[0].id : ('gid://shopify/ProductVariant/' + item.variants[0].id) , selected:true ,quantity:1});
            let FBT_PRODUCT_DETAILS_DIV = document.createElement("div");
            FBT_PRODUCT_DETAILS_DIV.className = "sd-bundle-product-detail";
            FBT_PRODUCT_DETAILS_DIV.style.backgroundColor = el?.customization?.frequentlyBoughtTogether?.productDetails?.productDetailsBox?.backgroundColor;
            FBT_DIV.append(FBT_PRODUCT_DETAILS_DIV);
              
            let SINGLE_PRODUCT_DIV = document.createElement("div");
            SINGLE_PRODUCT_DIV.className = "sd-bundle-product-inner";
            FBT_PRODUCT_DETAILS_DIV.append(SINGLE_PRODUCT_DIV);  
      
           if (index == 0) {
              let CheckBox_Wrapper_Div = document.createElement("div");
              CheckBox_Wrapper_Div.className = "checkbox-wrapper-18";
              SINGLE_PRODUCT_DIV.append(CheckBox_Wrapper_Div);
              
              let FBT_PRODUCT_CHECKBOX_DIV = document.createElement("div");
              FBT_PRODUCT_CHECKBOX_DIV.className = "round";
              CheckBox_Wrapper_Div.append(FBT_PRODUCT_CHECKBOX_DIV);
              
              let FBT_PRODUCT_CHECKBOX = document.createElement("input");
              FBT_PRODUCT_CHECKBOX.setAttribute("type", "checkbox");
              FBT_PRODUCT_CHECKBOX.setAttribute("checked", true);
              FBT_PRODUCT_CHECKBOX.className = "sd-bundle-fbt-product-checkbox-input";
              FBT_PRODUCT_CHECKBOX.id = `FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`;
              
              let FBT_PRODUCT_CHECKBOX_LABEL = document.createElement("label");
              FBT_PRODUCT_CHECKBOX_LABEL.setAttribute("for", `FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`);
              FBT_PRODUCT_CHECKBOX_LABEL.id = `FBT_PRODUCT_CHECKBOX_LABEL${bundleIndex}${index}`;
              
              FBT_PRODUCT_CHECKBOX_DIV.append(FBT_PRODUCT_CHECKBOX, FBT_PRODUCT_CHECKBOX_LABEL);
              
              FBT_PRODUCT_CHECKBOX.addEventListener('change', (e) => {   
                  e.preventDefault();
                  
                  let PopUpMessageDiv = document.createElement("div");
                  PopUpMessageDiv.id = `PopUpMessageDiv${bundleIndex}${index}`;
                  PopUpMessageDiv.className = "sd-bundle-mix-match-checkBox-popup-div";
                  FBT_PRODUCT_CHECKBOX_DIV.append(PopUpMessageDiv);
                  
                  let PopupSpan = document.createElement("span");
                  PopupSpan.className = "sd-bundle-mix-match-checkBox-popup-span";
                  PopupSpan.innerText = "This product is required and can not be deselected";
                  PopUpMessageDiv.append(PopupSpan);
                  
                  setTimeout(() => {
                      document.getElementById(`PopUpMessageDiv${bundleIndex}${index}`).remove();
                      FBT_PRODUCT_CHECKBOX.checked = true;
                  }, 2000);
              });
            }

            if (index != 0) {
              let CheckBox_Wrapper_Div = document.createElement("div");
              CheckBox_Wrapper_Div.className = "checkbox-wrapper-18";
              SINGLE_PRODUCT_DIV.append(CheckBox_Wrapper_Div);
              
              let FBT_PRODUCT_CHECKBOX_DIV = document.createElement("div");
              FBT_PRODUCT_CHECKBOX_DIV.className = "round";
              CheckBox_Wrapper_Div.append(FBT_PRODUCT_CHECKBOX_DIV);
              
              let FBT_PRODUCT_CHECKBOX = document.createElement("input");
              FBT_PRODUCT_CHECKBOX.className = "sd-bundle-fbt-product-checkbox-input";
              FBT_PRODUCT_CHECKBOX.id =`FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`;
              FBT_PRODUCT_CHECKBOX.setAttribute("type", "checkbox");
              FBT_PRODUCT_CHECKBOX.setAttribute("checked", "checked");
              FBT_PRODUCT_CHECKBOX.dataset.bundleindex=bundleIndex;
              if(totalProducts.length <3){
              FBT_PRODUCT_CHECKBOX.disabled=true;
              }
                            
              FBT_PRODUCT_CHECKBOX.dataset.selectedvariantprice =el.bundleDetail.discountedProductType != 'all_products'  ? item.variants[0].price  : item.variants[0].price/100 ;
              FBT_PRODUCT_CHECKBOX.dataset.selectedvariantid = item.variants[0].id ;
              let FBT_PRODUCT_CHECKBOX_LABEL = document.createElement("label");
              FBT_PRODUCT_CHECKBOX_LABEL.setAttribute("for", `FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`);
              FBT_PRODUCT_CHECKBOX_LABEL.id = `FBT_PRODUCT_CHECKBOX_LABEL${bundleIndex}${index}`;
              FBT_PRODUCT_CHECKBOX_DIV.append(FBT_PRODUCT_CHECKBOX, FBT_PRODUCT_CHECKBOX_LABEL);
              selectedOfferedProductCount += 1
              document.getElementById(`FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`).addEventListener('change',(e)=>{
                if(e.target.checked){
                  originalPriceArray[index].selected=true;
                  document.querySelectorAll(`[data-bundleindex="${bundleIndex}"]`).forEach(item=>{
                    if(item.checked==true && selectedOfferedProductCount == 1){ 
                      item.disabled=false
                    }                  
                  })                                   
                  selectedOfferedProductCount += 1 ;                     
                }else{
                  originalPriceArray[index].selected=false;                                 
                  document.querySelectorAll(`[data-bundleindex="${bundleIndex}"]`).forEach(item=>{
                    if(item.checked==true && selectedOfferedProductCount == 2){ 
                      item.disabled=true
                    }                  
                  })                     
                  selectedOfferedProductCount -= 1 ;
                }
                calculateOriginalPrice()
                calculateSellingPrice()
              })
            }
            
            let GET_PRODUCT_IMAGE_DIV = document.createElement("div");
            GET_PRODUCT_IMAGE_DIV.className = "sd-bundle-product-img";    
            GET_PRODUCT_IMAGE_DIV.style.borderColor = el?.customization?.frequentlyBoughtTogether?.productDetails?.image?.borderColor;
            GET_PRODUCT_IMAGE_DIV.style.borderRadius = el?.customization?.frequentlyBoughtTogether?.productDetails?.image?.borderRadius+"px";
            GET_PRODUCT_IMAGE_DIV.id = `GET_PRODUCT_IMAGE_DIV${bundleIndex}${index}`;
            SINGLE_PRODUCT_DIV.append(GET_PRODUCT_IMAGE_DIV);
      
            let GET_PRODUCTS_IMAGE = document.createElement("img");
            GET_PRODUCTS_IMAGE.src = el.bundleDetail.discountedProductType != 'all_products' ? `${item?.images[0]?.originalSrc}` : ('https:' +`${item?.images[0]}`)  ;
            GET_PRODUCT_IMAGE_DIV.append(GET_PRODUCTS_IMAGE);

            let GET_PRODUCTS_NAME_PRICE_DIV = document.createElement("div");
            GET_PRODUCTS_NAME_PRICE_DIV.className = "sd-bundle-product-name";
            SINGLE_PRODUCT_DIV.append(GET_PRODUCTS_NAME_PRICE_DIV);

            let GET_PRODUCTS_NAME = document.createElement("h5");
            GET_PRODUCTS_NAME.style.color = el?.customization?.frequentlyBoughtTogether?.productDetails?.title?.color;
            GET_PRODUCTS_NAME.style.fontSize = el?.customization?.frequentlyBoughtTogether?.productDetails?.title?.fontSize+"px";
            GET_PRODUCTS_NAME.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
            GET_PRODUCTS_NAME.innerText = item.title;
            GET_PRODUCTS_NAME_PRICE_DIV.append(GET_PRODUCTS_NAME);

            let GET_PRODUCTS_PRICE = document.createElement("h4");
            GET_PRODUCTS_PRICE.style.color = el?.customization?.frequentlyBoughtTogether?.productDetails?.price?.color;
            GET_PRODUCTS_PRICE.style.fontSize = el?.customization?.frequentlyBoughtTogether?.productDetails?.price?.fontSize+"px";
            GET_PRODUCTS_PRICE.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
            GET_PRODUCTS_PRICE.id = `productsPriceDiv${bundleIndex}${index}`;       
            GET_PRODUCTS_PRICE.innerText = el.bundleDetail.discountedProductType != 'all_products'  ? showAmountWithCurrency(item.variants[0].price)  : showAmountWithCurrency(item.variants[0].price/100);
            GET_PRODUCTS_NAME_PRICE_DIV.append(GET_PRODUCTS_PRICE);
      
            if (item.variants.length > 1) {
              const select = document.createElement("select");
              select.id=`fbtSelect${bundleIndex}${index}` 
              select.style.backgroundColor = el?.customization?.frequentlyBoughtTogether?.productDetails?.variantSelector?.backgroundColor;
              select.style.color = el?.customization?.frequentlyBoughtTogether?.productDetails?.variantSelector?.color;
              select.style.width = el?.customization?.frequentlyBoughtTogether?.productDetails?.variantSelector?.width+"px";
              select.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
              item.variants.forEach((optionData) => {
                const option = document.createElement("option");
                option.value = el.bundleDetail.discountedProductType != 'all_products'  ? optionData.price  : (optionData.price)/100;
                option.text = optionData.title;
                option.dataset.id= el.bundleDetail.discountedProductType != 'all_products'  ? optionData.id  : ( 'gid://shopify/ProductVariant/'+ optionData.id ); 
                select.appendChild(option);
              });
              GET_PRODUCTS_NAME_PRICE_DIV.append(select);
              document.getElementById(`fbtSelect${bundleIndex}${index}`).addEventListener('change',(e)=>{
                originalPriceArray[index].price=e.target.value;
                originalPriceArray[index].id=e.target.selectedOptions[0].dataset.id;
                document.querySelector(`#productsPriceDiv${bundleIndex}${index}`).innerText= showAmountWithCurrency(e.target.value);
                if(index != 0) {
                  document.querySelector(`#FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`).dataset.selectedvariantprice= e.target.value;
                  document.querySelector(`#FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`).dataset.selectedvariantid=e.target.selectedOptions[0].dataset.id;
                }
                document.querySelector(`.sd-fbt-mrp-span${bundleIndex}`).innerText=showAmountWithCurrency(parseFloat(calculateOriginalPrice()).toFixed(2))
                document.querySelector(`.sd-fbt-sellingPrice-span${bundleIndex}`).innerText=showAmountWithCurrency(parseFloat(calculateSellingPrice()).toFixed(2))
              })
            }

            if(el.bundleDetail.discountedProductType == "specific_product"){
              if (index < ((el.bundleDetail.mainProducts.length + el.bundleDetail.offeredProducts.length) - 1)) {
                let BUNDLE_PLUS_BTN_DIV = document.createElement("div");
                BUNDLE_PLUS_BTN_DIV.className = "sd-add-bundle";
                BUNDLE_PLUS_BTN_DIV.innerHTML = `<svg viewBox="0 0 18 18" focusable="false" width="18" height="18" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
                <path d="M6.98047 17.3842V0.580255H10.3239V17.3842H6.98047ZM0.256392 10.6477V7.30433H17.0604V10.6477H0.256392Z" fill= "#000000"></path>
                </svg>`;
                FBT_DIV.append(BUNDLE_PLUS_BTN_DIV);
              } else {
              }
            }else{
              if (index < (4 - 1)) {
                let BUNDLE_PLUS_BTN_DIV = document.createElement("div");
                BUNDLE_PLUS_BTN_DIV.className = "sd-add-bundle";
                BUNDLE_PLUS_BTN_DIV.innerHTML = `<svg viewBox="0 0 18 18" focusable="false" width="18" height="18" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
                <path d="M6.98047 17.3842V0.580255H10.3239V17.3842H6.98047ZM0.256392 10.6477V7.30433H17.0604V10.6477H0.256392Z" fill= "#000000"></path>
                </svg>`;
                FBT_DIV.append(BUNDLE_PLUS_BTN_DIV);
              } else {
              }
            }
          let GET_PRODUCT_QUANTITY =  document.createElement("div");
          GET_PRODUCT_QUANTITY.className = "sd-bundle-product-quantity";
          FBT_PRODUCT_DETAILS_DIV.append(GET_PRODUCT_QUANTITY);

          let GET_PRODUCT_QUANTITY_TEXT = document.createElement("h6");
          GET_PRODUCT_QUANTITY_TEXT.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
          GET_PRODUCT_QUANTITY_TEXT.style.color = el?.customization?.frequentlyBoughtTogether?.productDetails?.quantities?.color;
          GET_PRODUCT_QUANTITY_TEXT.style.fontSize = el?.customization?.frequentlyBoughtTogether?.productDetails?.quantities?.size+"px";
          GET_PRODUCT_QUANTITY_TEXT.innerText = `Qty: 1`;
          GET_PRODUCT_QUANTITY.append(GET_PRODUCT_QUANTITY_TEXT)
          });
            
          let FBT_ADDTOCART_TOTAL_DIV = document.createElement("div");
          FBT_ADDTOCART_TOTAL_DIV.className = "sd-product-bundle-total";
          FBT_DIV.append(FBT_ADDTOCART_TOTAL_DIV);
      
          let FBT_TOTAL_DIV = document.createElement("div");
          FBT_TOTAL_DIV.className = "sd-total-desc";
          FBT_ADDTOCART_TOTAL_DIV.append(FBT_TOTAL_DIV);

          let FBT_TOTAL_LABEL = document.createElement("h4");
          FBT_TOTAL_LABEL.style.color = el?.customization?.frequentlyBoughtTogether?.totalSection?.color;
          FBT_TOTAL_LABEL.style.fontSize = el?.customization?.frequentlyBoughtTogether?.totalSection?.fontSize+"px";
          FBT_TOTAL_LABEL.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
          FBT_TOTAL_LABEL.innerText = "TOTAL ";
          FBT_TOTAL_DIV.append(FBT_TOTAL_LABEL);

          if (
            el.bundleDetail.discountType == "freeShipping" ||
            el.bundleDetail.discountType == "noDiscount"
          ) {
            // no changes
          } else {
            let FBT_TOTAL_DESCRIPTION = document.createElement("p");
            FBT_TOTAL_DESCRIPTION.style.color = el?.customization?.frequentlyBoughtTogether?.totalSection?.discountMessage?.color;
            FBT_TOTAL_DESCRIPTION.style.fontSize = el?.customization?.frequentlyBoughtTogether?.totalSection?.discountMessage?.size+"px";
            FBT_TOTAL_DESCRIPTION.innerText = `${el?.translations?.translation?.discountApplied}`
            FBT_TOTAL_DESCRIPTION.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
            FBT_TOTAL_DIV.append(FBT_TOTAL_DESCRIPTION);
          }

          let Price_Div = document.createElement("div");
          Price_Div.className = "sd-total-amount";
          FBT_ADDTOCART_TOTAL_DIV.append(Price_Div);

          let FBT_MRP_PRICE = document.createElement("h6");
          FBT_MRP_PRICE.style.color = el?.customization?.frequentlyBoughtTogether?.totalSection?.originalPrice.color;
          FBT_MRP_PRICE.style.fontSize = el?.customization?.frequentlyBoughtTogether?.totalSection?.originalPrice.size+"px";
          FBT_MRP_PRICE.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
          FBT_MRP_PRICE.className = `sd-fbt-mrp-span${bundleIndex}`;

          let FBT_SELLING_PRICE = document.createElement("h4");
          FBT_SELLING_PRICE.style.color = el?.customization?.frequentlyBoughtTogether?.totalSection?.finalPrice?.color;
          FBT_SELLING_PRICE.style.fontSize = el?.customization?.frequentlyBoughtTogether?.totalSection?.finalPrice?.size+"px";
          FBT_SELLING_PRICE.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
          FBT_SELLING_PRICE.className = `sd-fbt-sellingPrice-span${bundleIndex}`;
          Price_Div.append(FBT_SELLING_PRICE);  
          Price_Div.append(FBT_MRP_PRICE);
          
          calculateOriginalPrice()  
          calculateSellingPrice()
          let ADD_TO_CART_BUTTON_DIV = document.createElement("div");
          ADD_TO_CART_BUTTON_DIV.className = "sd-bundle-addto-cart";
          FBT_DIV.append(ADD_TO_CART_BUTTON_DIV);
          let ADD_TO_CART_BUTTON = document.createElement("button");
          ADD_TO_CART_BUTTON.style.backgroundColor = el?.customization?.frequentlyBoughtTogether?.button?.backgroundColor;
          ADD_TO_CART_BUTTON.style.borderColor = el?.customization?.frequentlyBoughtTogether?.button?.borderColor;
          ADD_TO_CART_BUTTON.style.borderRadius = el?.customization?.frequentlyBoughtTogether?.button?.borderRadius+"px";
          ADD_TO_CART_BUTTON.style.color = el?.customization?.frequentlyBoughtTogether?.button?.color;
          ADD_TO_CART_BUTTON.style.fontSize = el?.customization?.frequentlyBoughtTogether?.button?.fontSize+"px";
          ADD_TO_CART_BUTTON.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
          ADD_TO_CART_BUTTON.className = `sd-bundle-fbt-add-to-cart-button${bundleIndex}`;
          ADD_TO_CART_BUTTON.innerHTML = el?.translations?.translation?.addToCartButton;
          ADD_TO_CART_BUTTON.type = "button";
          ADD_TO_CART_BUTTON_DIV.append(ADD_TO_CART_BUTTON);    
          
          ADD_TO_CART_BUTTON.addEventListener("click", (e) => {
            let count=0;         
            let addToCartArray=[];
            let itemsVariantIdArray=[];
            let copyArray=JSON.parse(JSON.stringify(originalPriceArray))
            copyArray.map(item=>{
              if(item.selected){ 
                count +=1 ;
                delete item.selected ;
                delete item.price ;
                itemsVariantIdArray.push(item.id);
                item.id=item.id.split('/').pop()
                addToCartArray.push(item)                      
              }
            })
        
            if(count<2){
              return ;
            }
            let code = JSON.parse(localStorage.getItem("sd_bundle_data"));
            let discountCodeId = code.discountCreateId ?? "";
          
            ADD_TO_CART_BUTTON.innerText = "";
            let btnSpinner = document.createElement("div");
            btnSpinner.className = "bundleBtnSpinner";
            ADD_TO_CART_BUTTON.append(btnSpinner);
            btnSpinner.style.display = "block";         
          
            let formData = {
              items: addToCartArray,
              attributes: { SD_BUNDLE_ID: el._id },
            };
              
              fetch(window.Shopify.routes.root + "cart/add.js", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(formData),
              })
              .then((response) => {
                return response.json();
              })
              .then((response) => {
                let errorDiv = document.getElementsByClassName(
                  "sd-bundle-error-message"
                );
                errorDiv[0]?.remove();
                if (response.status == 422 || response.status == 404) {
                  ADD_TO_CART_BUTTON.innerText =
                    el.translations.translation.addToCartButton;
                  btnSpinner.remove();
                  let errorMessage = document.createElement("div");
                  errorMessage.className = "sd-bundle-error-message";
                  FBT_DIV.append(errorMessage);
                  errorMessage.innerText = response.description;
                } else {
                  fetch(window.Shopify.routes.root + "cart.js", {
                    method: "GET",
                    headers: {
                      "Content-Type": "application/json",
                    },
                  })
                    .then((response) => {
                      return response.json();
                    })
                    .then((response) => {
                      if (el.bundleDetail.discountType == "noDiscount") {
                        fetch(`${server}/api/storefront/getBundleClick`, {
                          method: "POST",
                          headers: {
                            "Content-Type": "application/json",
                          },
                          body: JSON.stringify({
                            shop: Shopify.shop,
                            bundleId: el._id,
                          }),
                        });
                        let isDiscount =
                          el.bundleDetail.discountType == "noDiscount"
                            ? "noDiscount"
                            : "Fix";
                        const localData = JSON.parse(
                          localStorage.getItem("sd_bundle_data")
                        );

                        
                        let sd_bundle_data = {
                          discount_name: el.name,
                          code: code.code,
                          bundleId: el._id,
                          discountType: isDiscount,
                          variantsId: addToCartArray,
                          discountCreateId: localData.discountCreateId,
                          prefixCode: el.settings.discountLabel,
                        };
                        var jsonString = JSON.stringify(sd_bundle_data);
                        localStorage.setItem("sd_bundle_data", jsonString);

                        btnSpinner.remove();
                        window.location.assign(`https://${Shopify.shop}/cart`);
                      } else {
                        let finalPrice;
                        switch (el.bundleDetail.discountType) {
                          case "percent":
                            let percentagepart = parseFloat(
                              el.bundleDetail.discountValue
                            );
                            let percentage = (originalPrice * percentagepart) / 100;
                            finalPrice = percentage.toFixed(2);
                            break;
                          case "price":
                            let pricePart = parseFloat(
                              el.bundleDetail.discountValue
                            );
                            result = originalPrice - pricePart;
                            finalPrice = result.toFixed(2);
                            break;
                          case "fixed":
                            let fixedPart = parseFloat(
                              el.bundleDetail.discountValue
                            );
                            finalPrice = fixedPart.toFixed(2);
                            break;
                          default:
                            break;
                        }
                        let isDiscount =
                          el.bundleDetail.discountType == "noDiscount"
                            ? "noDiscount"
                            : "Fix";
                        let sd_bundle_data = {
                          discount_name: el.name,
                          code: `${el.settings.discountLabel}-${code.code}`,
                          discountType: isDiscount,
                          discountValue: finalPrice,                        
                          variantsId: itemsVariantIdArray,
                          startDate: new Date(),
                          shop: Shopify.shop,
                          bundleType: el.bundleDetail.discountType,
                          totalPrice: originalPrice.toFixed(2),
                          discountCreateId: discountCodeId,
                        };
                        fetch(server + "/api/storefront/createRule", {
                          method: "POST",
                          headers: {
                            "Content-Type": "application/json",
                          },
                          body: JSON.stringify(sd_bundle_data),
                        })
                          .then((response) => response.json())
                          .then((data) => {
                            if (data.status == 200) {
                              fetch(`${server}/api/storefront/getBundleClick`, {
                                method: "POST",
                                headers: {
                                  "Content-Type": "application/json",
                                },
                                body: JSON.stringify({
                                  shop: Shopify.shop,
                                  bundleId: el._id,
                                }),
                              });
                              ADD_TO_CART_BUTTON.innerText =
                                el.translations.translation.addToCartButton;
                              btnSpinner.remove();

                              let sd_bundle_data = {
                                discount_name: el.name,
                                code: code.code,
                                bundleId: el._id,
                                discountType: isDiscount,
                                variantsId: addToCartArray,
                                discountCreateId: data.response,
                                prefixCode: el.settings.discountLabel,
                              };
                              var jsonString = JSON.stringify(sd_bundle_data);
                              localStorage.setItem("sd_bundle_data", jsonString);
                              cartDrawer();
                            }
                          });
                      }
                    })
                    .catch((error) => {
                      ADD_TO_CART_BUTTON.innerText =
                        el.translations.translation.addToCartButton;
                    });
                }
              })
              .catch((error) => {
                console.error("Error:", error);
              });
          });          
        }
    
        function execFbtClassic(){
        let  originalPriceArray=[];
        let originalPrice ;
        let sellingPrice ;
        let selectedOfferedProductCount = 0;
        let calculateOriginalPrice = () => {
          total = 0;
          originalPriceArray.map((item) => {
            if(item.selected==true){
              total += parseFloat(item.price);        
            }
            });
          originalPrice=total
          document.querySelector(`.sd-fbt-mrp-span${bundleIndex}`).innerText=showAmountWithCurrency(total.toFixed(2))
          return total ; 
        };  
        
        function calculateSellingPrice() {
          let finalPrice = 0;      
          if(el.bundleDetail.discountType == "percent") {
            if (el.bundleDetail.discountValue > 100) {
              finalPrice = 0;
            } else {
              finalPrice =
                originalPrice -
              originalPrice * (el.bundleDetail.discountValue / 100);
            }
          } else
          if (el.bundleDetail.discountType == "fixed") {
            if (parseFloat(el.bundleDetail.discountValue) > originalPrice) {
              finalPrice = 0;
            } else {
              finalPrice = originalPrice - el.bundleDetail.discountValue;
            }
          }  else if (
            el.bundleDetail.discountType == "freeShipping" ||
            el.bundleDetail.discountType == "noDiscount"
          ) {
            finalPrice = originalPrice;
          }
          sellingPrice=finalPrice;
          document.querySelector(`.sd-fbt-sellingPrice-span${bundleIndex}`).innerText=showAmountWithCurrency(finalPrice.toFixed(2))
          return finalPrice;
        }
    
        let FBT_DIV = document.createElement("div");
          
        FBT_DIV.className = "sd-bundle-main-column";
        FBT_DIV.style.backgroundColor = el?.customization?.frequentlyBoughtTogether?.box?.backgroundColor;
        FBT_DIV.style.borderRadius = el?.customization?.frequentlyBoughtTogether?.box?.borderRadius+"px";
        FBT_DIV.style.borderColor = el?.customization?.frequentlyBoughtTogether?.box?.borderColor;
        FBT_DIV.id = `FBT_DIV${bundleIndex}`;
        mainDiv.append(FBT_DIV);

        if (el?.badgeText != "" && el?.badgeText != undefined) {
          if (el.bundleDetail.discountType === "percent" || el.bundleDetail.discountType === "fixed") {
            let VOLUME_HEADER_DIV = document.createElement("span");
            VOLUME_HEADER_DIV.className = "sd-badges-part-optional";
            VOLUME_HEADER_DIV.style.background = el?.customization?.frequentlyBoughtTogether?.optionalBadge?.background;
            VOLUME_HEADER_DIV.style.color = el?.customization?.frequentlyBoughtTogether?.optionalBadge?.color;
            VOLUME_HEADER_DIV.style.fontSize = el?.customization?.frequentlyBoughtTogether?.optionalBadge?.fontSize + "px"; 
            let discountBadge = document.createElement("span");
            discountBadge.className = "sd-collectionMM-badge";
            discountBadge.innerText = el?.badgeText;
            VOLUME_HEADER_DIV.append(discountBadge);
            FBT_DIV.append(VOLUME_HEADER_DIV);
          }
        }

        let FBT_BUNDLE_DETAILS_DIV = document.createElement("div");
       
        FBT_BUNDLE_DETAILS_DIV.className = "sd-bundle-text-detail";
        if (el?.badgeText != "" && el?.badgeText != undefined) {
          if (el?.bundleDetail?.discountType === "percent" || el?.bundleDetail?.discountType === "fixed") {
            FBT_BUNDLE_DETAILS_DIV.classList.add("extra-padding");
          }
        }
        FBT_DIV.append(FBT_BUNDLE_DETAILS_DIV);

        let FBT_TITLE_DIV = document.createElement("h4");
        FBT_TITLE_DIV.style.color = el?.customization?.frequentlyBoughtTogether?.title?.color;
        FBT_TITLE_DIV.style.fontWeight = el?.customization?.frequentlyBoughtTogether?.title?.titleBold;
        FBT_TITLE_DIV.style.fontSize = el?.customization?.frequentlyBoughtTogether?.title?.fontSize+"px";
        FBT_TITLE_DIV.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
        FBT_TITLE_DIV.innerText = el.title;
        FBT_BUNDLE_DETAILS_DIV.append(FBT_TITLE_DIV);

        let FBT_DESCRIPTION_DIV = document.createElement("p");
        FBT_DESCRIPTION_DIV.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
        FBT_DESCRIPTION_DIV.style.color = el?.customization?.frequentlyBoughtTogether?.title?.descriptionColor;
        FBT_DESCRIPTION_DIV.style.fontWeight = el?.customization?.frequentlyBoughtTogether?.title?.descriptionBold;
        FBT_DESCRIPTION_DIV.style.fontSize = el?.customization?.frequentlyBoughtTogether?.title?.descriptionFontSize+"px";
        FBT_DESCRIPTION_DIV.innerText = el.description;
        FBT_BUNDLE_DETAILS_DIV.append(FBT_DESCRIPTION_DIV);
          
        let FBT_PRODUCTS_IMAGE_DIV = document.createElement("div");
        FBT_PRODUCTS_IMAGE_DIV.className = "sd-show-selected-product-item";
        FBT_BUNDLE_DETAILS_DIV.append(FBT_PRODUCTS_IMAGE_DIV);

        totalProducts.map((item, index) => {         
          originalPriceArray.push({price: el.bundleDetail.discountedProductType != 'all_products'  ? item.variants[0].price  : item.variants[0].price/100 ,id: el.bundleDetail.discountedProductType != 'all_products'  ? item.variants[0].id : ('gid://shopify/ProductVariant/' + item.variants[0].id) , selected:true ,quantity:1});
          let GET_PRODUCT_IMAGE_DIV = document.createElement("div");
          GET_PRODUCT_IMAGE_DIV.className = "sd-bundle-product-img";    
          GET_PRODUCT_IMAGE_DIV.style.borderColor = el?.customization?.frequentlyBoughtTogether?.productDetails?.image?.borderColor;
          GET_PRODUCT_IMAGE_DIV.style.borderRadius = el?.customization?.frequentlyBoughtTogether?.productDetails?.image?.borderRadius+"px";
          GET_PRODUCT_IMAGE_DIV.className = "sd-selected-product-itemImg";       
          GET_PRODUCT_IMAGE_DIV.id = `GET_PRODUCT_IMAGE_DIV${bundleIndex}${index}`;
          FBT_PRODUCTS_IMAGE_DIV.append(GET_PRODUCT_IMAGE_DIV);

          let GET_PRODUCTS_IMAGE = document.createElement("img");
          GET_PRODUCTS_IMAGE.className = "sd-bundle-fbt-imageThumbnails";
          GET_PRODUCTS_IMAGE.src = el.bundleDetail.discountedProductType != 'all_products' ? `${item?.images[0]?.originalSrc}` : ('https:' +`${item?.images[0]}`);
          GET_PRODUCT_IMAGE_DIV.append(GET_PRODUCTS_IMAGE);

          if (index < totalProducts.length - 1) {
            let BUNDLE_PLUS_BTN_DIV = document.createElement("div");
            BUNDLE_PLUS_BTN_DIV.className = "plus-selectedIcon";
            BUNDLE_PLUS_BTN_DIV.innerHTML = `<svg viewBox="0 0 18 18" focusable="false" width="18" height="18" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
            <path d="M6.98047 17.3842V0.580255H10.3239V17.3842H6.98047ZM0.256392 10.6477V7.30433H17.0604V10.6477H0.256392Z" fill= ${el?.customization?.frequentlyBoughtTogether?.productDetails?.plusColor}></path>
            </svg>`;
            FBT_PRODUCTS_IMAGE_DIV.append(BUNDLE_PLUS_BTN_DIV);
          }  

          let SINGLE_PRODUCT_DIV_CONTAINER=document.createElement("div");
          SINGLE_PRODUCT_DIV_CONTAINER.className = "sd-bundle-product-detail";
          SINGLE_PRODUCT_DIV_CONTAINER.style.backgroundColor = el?.customization?.frequentlyBoughtTogether?.productDetails?.productDetailsBox?.backgroundColor;
          FBT_DIV.append(SINGLE_PRODUCT_DIV_CONTAINER);

          let SINGLE_PRODUCT_DIV = document.createElement("div");
          SINGLE_PRODUCT_DIV.className = "sd-bundle-product-inner";
          SINGLE_PRODUCT_DIV_CONTAINER.append(SINGLE_PRODUCT_DIV);

          if (index == 0) {
            let FBT_PRODUCT_CHECKBOX_DIV=document.createElement("div");
            FBT_PRODUCT_CHECKBOX_DIV.className='checkbox-wrapper-18';
            SINGLE_PRODUCT_DIV.append(FBT_PRODUCT_CHECKBOX_DIV);
            
            let InnerDivFBTClassic = document.createElement("div");
            InnerDivFBTClassic.className = 'round';
            FBT_PRODUCT_CHECKBOX_DIV.append(InnerDivFBTClassic);
            
            let FBT_PRODUCT_CHECKBOX = document.createElement("input");
            FBT_PRODUCT_CHECKBOX.setAttribute("type", "checkbox");
            FBT_PRODUCT_CHECKBOX.setAttribute("checked", "checked");
            FBT_PRODUCT_CHECKBOX.id =`FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`;

            let FBT_PRODUCT_CHECKBOX_LABEL = document.createElement("label");
            FBT_PRODUCT_CHECKBOX_LABEL.setAttribute("for", `FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`);
            FBT_PRODUCT_CHECKBOX_LABEL.id = `FBT_PRODUCT_CHECKBOX_LABEL${bundleIndex}${index}`;
            InnerDivFBTClassic.append(FBT_PRODUCT_CHECKBOX, FBT_PRODUCT_CHECKBOX_LABEL);
             
            document.getElementById(`FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`).addEventListener('click',(e)=>{   
              e.preventDefault();        
              let PopUpMessageDiv = document.createElement("div");
              PopUpMessageDiv.id = `PopUpMessageDiv${bundleIndex}${index}`;
              PopUpMessageDiv.className = "sd-bundle-mix-match-checkBox-popup-div";
              InnerDivFBTClassic.append(PopUpMessageDiv);
              let PopupSpan = document.createElement("span");
              PopupSpan.className = "sd-bundle-mix-match-checkBox-popup-span";
              PopupSpan.innerText = "This product is required and can not be deselected";
              PopUpMessageDiv.append(PopupSpan);
              setTimeout(()=>{
                document.getElementById(`PopUpMessageDiv${bundleIndex}${index}`).remove();
              },2000);  
            }) 
          }
          if (index != 0) {

            let FBT_PRODUCT_CHECKBOX_DIV=document.createElement("div");
            FBT_PRODUCT_CHECKBOX_DIV.className='checkbox-wrapper-18';
            SINGLE_PRODUCT_DIV.append(FBT_PRODUCT_CHECKBOX_DIV);
            
            let InnerDivFBTClassic = document.createElement("div");
            InnerDivFBTClassic.className = 'round';
            FBT_PRODUCT_CHECKBOX_DIV.append(InnerDivFBTClassic);
            
            let FBT_PRODUCT_CHECKBOX = document.createElement("input");
            FBT_PRODUCT_CHECKBOX.className = "sd-bundle-fbt-product-checkbox-input";
            FBT_PRODUCT_CHECKBOX.id =`FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`;
            FBT_PRODUCT_CHECKBOX.setAttribute("type", "checkbox");
            FBT_PRODUCT_CHECKBOX.setAttribute("checked", "checked");
            FBT_PRODUCT_CHECKBOX.dataset.bundleindex=bundleIndex;
            
            if(totalProducts.length <3){
            FBT_PRODUCT_CHECKBOX.disabled=true;
            }
            FBT_PRODUCT_CHECKBOX.dataset.selectedvariantprice =el.bundleDetail.discountedProductType != 'all_products'  ? item.variants[0].price  : item.variants[0].price/100 ;
            FBT_PRODUCT_CHECKBOX.dataset.selectedvariantid = item.variants[0].id ;
            
            let FBT_PRODUCT_CHECKBOX_LABEL = document.createElement("label");
            FBT_PRODUCT_CHECKBOX_LABEL.setAttribute("for", `FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`);
            FBT_PRODUCT_CHECKBOX_LABEL.id = `FBT_PRODUCT_CHECKBOX_LABEL${bundleIndex}${index}`;
            InnerDivFBTClassic.append(FBT_PRODUCT_CHECKBOX, FBT_PRODUCT_CHECKBOX_LABEL);
            
            selectedOfferedProductCount += 1
            document.getElementById(`FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`).addEventListener('change',(e)=>{
              if(e.target.checked){
                originalPriceArray[index].selected=true;
                document.querySelectorAll(`[data-bundleindex="${bundleIndex}"]`).forEach(item=>{
                  if(item.checked==true && selectedOfferedProductCount == 1){ 
                    item.disabled=false
                  }
                })
                selectedOfferedProductCount += 1 ;
              }else{
                originalPriceArray[index].selected=false;                                 
                document.querySelectorAll(`[data-bundleindex="${bundleIndex}"]`).forEach(item=>{
                  if(item.checked==true && selectedOfferedProductCount == 2){ 
                    item.disabled=true
                  }                  
                })                     
                selectedOfferedProductCount -= 1 ;
              }
              calculateOriginalPrice()
              calculateSellingPrice()
            })
          }
          
          let GET_PRODUCTS_NAME_PRICE_DIV = document.createElement("div");
          GET_PRODUCTS_NAME_PRICE_DIV.className = "sd-bundle-product-name";
          SINGLE_PRODUCT_DIV.append(GET_PRODUCTS_NAME_PRICE_DIV);
      
          let GET_PRODUCTS_NAME = document.createElement("h5");
          GET_PRODUCTS_NAME.style.color = el?.customization?.frequentlyBoughtTogether?.productDetails?.title?.color;
          GET_PRODUCTS_NAME.style.fontSize = el?.customization?.frequentlyBoughtTogether?.productDetails?.title?.fontSize+"px";
          GET_PRODUCTS_NAME.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
          GET_PRODUCTS_NAME.innerText = item.title;
          GET_PRODUCTS_NAME_PRICE_DIV.append(GET_PRODUCTS_NAME);

          let GET_PRODUCTS_PRICE = document.createElement("h4");
          GET_PRODUCTS_PRICE.style.color = el?.customization?.frequentlyBoughtTogether?.productDetails?.price?.color;
          GET_PRODUCTS_PRICE.style.fontSize = el?.customization?.frequentlyBoughtTogether?.productDetails?.price.fontSize+"px";
          GET_PRODUCTS_PRICE.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
          GET_PRODUCTS_PRICE.id = `productsPriceDiv${bundleIndex}${index}`;       
          GET_PRODUCTS_PRICE.innerText = el.bundleDetail.discountedProductType != 'all_products'  ? showAmountWithCurrency(item.variants[0].price)  : showAmountWithCurrency(item.variants[0].price/100);
          GET_PRODUCTS_NAME_PRICE_DIV.append(GET_PRODUCTS_PRICE);

          if (item.variants.length > 1) {
            const select = document.createElement("select");
            select.id=`fbtSelect${bundleIndex}${index}` 
            select.style.backgroundColor = el?.customization?.frequentlyBoughtTogether?.productDetails?.variantSelector?.backgroundColor;
            select.style.color = el?.customization?.frequentlyBoughtTogether?.productDetails?.variantSelector?.color;
            select.style.width = el?.customization?.frequentlyBoughtTogether?.productDetails?.variantSelector?.width+"px";
            select.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
            item.variants.forEach((optionData) => {
              const option = document.createElement("option");
              option.value = el.bundleDetail.discountedProductType != 'all_products'  ? optionData.price  : (optionData.price)/100;
              option.text = optionData.title;
              option.dataset.id= el.bundleDetail.discountedProductType != 'all_products'  ? optionData.id  : ( 'gid://shopify/ProductVariant/'+ optionData.id ); 
              select.appendChild(option);
            });
    
            GET_PRODUCTS_NAME_PRICE_DIV.append(select);
            document.getElementById(`fbtSelect${bundleIndex}${index}`).addEventListener('change',(e)=>{
              originalPriceArray[index].price=e.target.value;
              originalPriceArray[index].id=e.target.selectedOptions[0].dataset.id;
              document.querySelector(`#productsPriceDiv${bundleIndex}${index}`).innerText= showAmountWithCurrency(e.target.value);
                if(index != 0) {
                  document.querySelector(`#FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`).dataset.selectedvariantprice= e.target.value;
                  document.querySelector(`#FBT_PRODUCT_CHECKBOX${bundleIndex}${index}`).dataset.selectedvariantid=e.target.selectedOptions[0].dataset.id;
                }
              document.querySelector(`.sd-fbt-mrp-span${bundleIndex}`).innerText=showAmountWithCurrency(parseFloat(calculateOriginalPrice()).toFixed(2))
              document.querySelector(`.sd-fbt-sellingPrice-span${bundleIndex}`).innerText=showAmountWithCurrency(parseFloat(calculateSellingPrice()).toFixed(2))
            })
          }

          let GET_PRODUCT_QUANTITY =  document.createElement("div");
          GET_PRODUCT_QUANTITY.className = "sd-bundle-product-quantity";
          SINGLE_PRODUCT_DIV_CONTAINER.append(GET_PRODUCT_QUANTITY);

          let GET_PRODUCT_QUANTITY_TEXT = document.createElement("h6");
          GET_PRODUCT_QUANTITY_TEXT.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
          GET_PRODUCT_QUANTITY_TEXT.style.color = el?.customization?.frequentlyBoughtTogether?.productDetails?.quantities?.color;
          GET_PRODUCT_QUANTITY_TEXT.style.fontSize = el?.customization?.frequentlyBoughtTogether?.productDetails?.quantities?.size+"px";
          GET_PRODUCT_QUANTITY_TEXT.innerText = `Qty: 1`;
          GET_PRODUCT_QUANTITY.append(GET_PRODUCT_QUANTITY_TEXT)

          if (index < totalProducts.length - 1) {
            let BUNDLE_PLUS_BTN_DIV = document.createElement("div");
            BUNDLE_PLUS_BTN_DIV.className = "sd-add-bundle";
            BUNDLE_PLUS_BTN_DIV.innerHTML = `<svg viewBox="0 0 18 18" focusable="false" width="18" height="18" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
            <path d="M6.98047 17.3842V0.580255H10.3239V17.3842H6.98047ZM0.256392 10.6477V7.30433H17.0604V10.6477H0.256392Z" fill= ${el?.customization?.frequentlyBoughtTogether?.productDetails?.plusColor}></path>
            </svg>`;
            FBT_DIV.append(BUNDLE_PLUS_BTN_DIV);
          }
        });      
       
        let FBT_TOTAL_DIV = document.createElement("div");
        FBT_TOTAL_DIV.className = "sd-product-bundle-total";
        FBT_DIV.append(FBT_TOTAL_DIV);

        let Total_Description_Div = document.createElement("div");
        Total_Description_Div.className = "sd-total-desc";
        FBT_TOTAL_DIV.append(Total_Description_Div);

        let FBT_TOTAL_LABEL = document.createElement("h4");
        FBT_TOTAL_LABEL.style.color = el?.customization?.frequentlyBoughtTogether?.totalSection?.color;
        FBT_TOTAL_LABEL.style.fontSize = el?.customization?.frequentlyBoughtTogether?.totalSection?.fontSize+"px";
        FBT_TOTAL_LABEL.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
        FBT_TOTAL_LABEL.innerText = "TOTAL ";
        Total_Description_Div.append(FBT_TOTAL_LABEL);

        if (
        el.bundleDetail.discountType == "freeShipping" ||
        el.bundleDetail.discountType == "noDiscount"
        ) {
            // no changes
        } else {
          let FBT_DESCRIPTION = document.createElement("p");
          FBT_DESCRIPTION.style.color = el?.customization?.frequentlyBoughtTogether?.totalSection?.discountMessage?.color;
          FBT_DESCRIPTION.style.fontSize = el?.customization?.frequentlyBoughtTogether?.totalSection?.discountMessage?.size+"px";
          FBT_DESCRIPTION.innerText = `${el?.translations?.translation?.discountApplied}`
          FBT_DESCRIPTION.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
          Total_Description_Div.append(FBT_DESCRIPTION);
        }

        let AMOUNT_DIV = document.createElement("div");
        AMOUNT_DIV.className = "sd-total-amount";
        FBT_TOTAL_DIV.append(AMOUNT_DIV);

        let FBT_SELLING_PRICE = document.createElement("h4");
        FBT_SELLING_PRICE.style.color = el?.customization?.frequentlyBoughtTogether?.totalSection?.finalPrice?.color;
        FBT_SELLING_PRICE.style.fontSize = el?.customization?.frequentlyBoughtTogether?.totalSection?.finalPrice?.size+"px";
        FBT_SELLING_PRICE.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
        FBT_SELLING_PRICE.className = `sd-fbt-sellingPrice-span${bundleIndex}`;
        AMOUNT_DIV.append(FBT_SELLING_PRICE);
          
        let FBT_MRP_PRICE = document.createElement("h6");
        FBT_MRP_PRICE.style.color = el?.customization?.frequentlyBoughtTogether?.totalSection?.originalPrice.color;
        FBT_MRP_PRICE.style.fontSize = el?.customization?.frequentlyBoughtTogether?.totalSection?.originalPrice.size+"px";
        FBT_MRP_PRICE.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
        FBT_MRP_PRICE.className = `sd-fbt-mrp-span${bundleIndex}`;
        AMOUNT_DIV.append(FBT_MRP_PRICE);
        
        calculateOriginalPrice()  
        calculateSellingPrice()

        let FBT_ADDTOCART_TOTAL_DIV = document.createElement("div");
        FBT_ADDTOCART_TOTAL_DIV.className = "sd-bundle-addto-cart";
        FBT_DIV.append(FBT_ADDTOCART_TOTAL_DIV);
        
        let ADD_TO_CART_BUTTON = document.createElement("button");
        ADD_TO_CART_BUTTON.style.backgroundColor = el?.customization?.frequentlyBoughtTogether?.button?.backgroundColor;
        ADD_TO_CART_BUTTON.style.borderColor = el?.customization?.frequentlyBoughtTogether?.button?.borderColor;
        ADD_TO_CART_BUTTON.style.borderRadius = el?.customization?.frequentlyBoughtTogether?.button?.borderRadius+"px";
        ADD_TO_CART_BUTTON.style.color = el?.customization?.frequentlyBoughtTogether?.button?.color;
        ADD_TO_CART_BUTTON.style.fontSize = el?.customization?.frequentlyBoughtTogether?.button?.fontSize+"px";
        ADD_TO_CART_BUTTON.style.fontFamily = el?.customization?.frequentlyBoughtTogether?.box?.fontFamily;
        ADD_TO_CART_BUTTON.className = `sd-bundle-fbt-add-to-cart-classic-button sd-bundle-fbt-add-to-cart-button${bundleIndex} `;
        ADD_TO_CART_BUTTON.innerHTML = el?.translations?.translation?.addToCartButton;
        ADD_TO_CART_BUTTON.type = "button";
        FBT_ADDTOCART_TOTAL_DIV.append(ADD_TO_CART_BUTTON);    
        
        ADD_TO_CART_BUTTON.addEventListener("click", (e) => {
          let count=0;         
          let addToCartArray=[];
          let itemsVariantIdArray=[];
          let copyArray=JSON.parse(JSON.stringify(originalPriceArray))
          copyArray.map(item=>{
            if(item.selected){ 
              count +=1 ;
              delete item.selected ;
              delete item.price ;
              itemsVariantIdArray.push(item.id);
              item.id=item.id.split('/').pop()
              addToCartArray.push(item)                      
            }
          })
      
          if(count<2){
            return ;
          }

          let code = JSON.parse(localStorage.getItem("sd_bundle_data"));
          let discountCodeId = code.discountCreateId ?? "";
        
          ADD_TO_CART_BUTTON.innerText = "";
          let btnSpinner = document.createElement("div");
          btnSpinner.className = "bundleBtnSpinner";
          ADD_TO_CART_BUTTON.append(btnSpinner);
          btnSpinner.style.display = "block";         
          let formData = {
            items: addToCartArray,
            attributes: { SD_BUNDLE_ID: el._id },
          };
            
          fetch(window.Shopify.routes.root + "cart/add.js", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
          })
          .then((response) => {
            return response.json();
          })
          .then((response) => {
            let errorDiv = document.getElementsByClassName(
              "sd-bundle-error-message"
            );
            errorDiv[0]?.remove();
            if (response.status == 422 || response.status == 404) {
              ADD_TO_CART_BUTTON.innerText =
                el.translations.translation.addToCartButton;
              btnSpinner.remove();
              let errorMessage = document.createElement("div");
              errorMessage.className = "sd-bundle-error-message";
              FBT_DIV.append(errorMessage);
              errorMessage.innerText = response.description;
            } else {
              fetch(window.Shopify.routes.root + "cart.js", {
                method: "GET",
                headers: {
                  "Content-Type": "application/json",
                },
              })
                .then((response) => {
                  return response.json();
                })
                .then((response) => {
                  if (el.bundleDetail.discountType == "noDiscount") {
                    fetch(`${server}/api/storefront/getBundleClick`, {
                      method: "POST",
                      headers: {
                        "Content-Type": "application/json",
                      },
                      body: JSON.stringify({
                        shop: Shopify.shop,
                        bundleId: el._id,
                      }),
                    });
                    let isDiscount =
                      el.bundleDetail.discountType == "noDiscount"
                        ? "noDiscount"
                        : "Fix";
                    const localData = JSON.parse(
                      localStorage.getItem("sd_bundle_data")
                    );

                    let sd_bundle_data = {
                      discount_name: el.name,
                      code: code.code,
                      bundleId: el._id,
                      discountType: isDiscount,
                      variantsId: addToCartArray,
                      discountCreateId: localData.discountCreateId,
                      prefixCode: el.settings.discountLabel,
                    };
                    var jsonString = JSON.stringify(sd_bundle_data);
                    localStorage.setItem("sd_bundle_data", jsonString);

                    btnSpinner.remove();
                    window.location.assign(`https://${Shopify.shop}/cart`);
                  } else {
                    let finalPrice;
                    switch (el.bundleDetail.discountType) {
                      case "percent":
                        let percentagepart = parseFloat(
                          el.bundleDetail.discountValue
                        );
                        let percentage = (originalPrice * percentagepart) / 100;
                        finalPrice = percentage.toFixed(2);
                        break;
                      case "price":
                        let pricePart = parseFloat(
                          el.bundleDetail.discountValue
                        );
                        result = originalPrice - pricePart;
                        finalPrice = result.toFixed(2);
                        break;
                      case "fixed":
                        let fixedPart = parseFloat(
                          el.bundleDetail.discountValue
                        );
                        finalPrice = fixedPart.toFixed(2);
                        break;
                      default:
                        break;
                    }
                    let isDiscount =
                      el.bundleDetail.discountType == "noDiscount"
                        ? "noDiscount"
                        : "Fix";
                    let sd_bundle_data = {
                      discount_name: el.name,
                      code: `${el.settings.discountLabel}-${code.code}`,
                      discountType: isDiscount,
                      discountValue: finalPrice,                        
                      variantsId: itemsVariantIdArray,
                      // startDate: el.startdate,
                      startDate: new Date(),
                      // endDate: el.endDate,
                      shop: Shopify.shop,
                      bundleType: el.bundleDetail.discountType,
                      totalPrice: originalPrice.toFixed(2),
                      discountCreateId: discountCodeId,
                    };
                    fetch(server + "/api/storefront/createRule", {
                      method: "POST",
                      headers: {
                        "Content-Type": "application/json",
                      },
                      body: JSON.stringify(sd_bundle_data),
                    })
                      .then((response) => response.json())
                      .then((data) => {
                        if (data.status == 200) {
                          fetch(`${server}/api/storefront/getBundleClick`, {
                            method: "POST",
                            headers: {
                              "Content-Type": "application/json",
                            },
                            body: JSON.stringify({
                              shop: Shopify.shop,
                              bundleId: el._id,
                            }),
                          });
                          ADD_TO_CART_BUTTON.innerText =
                            el.translations.translation.addToCartButton;
                          btnSpinner.remove();

                          let sd_bundle_data = {
                            discount_name: el.name,
                            code: code.code,
                            bundleId: el._id,
                            discountType: isDiscount,
                            variantsId: addToCartArray,
                            discountCreateId: data.response,
                            prefixCode: el.settings.discountLabel,
                          };
                          var jsonString = JSON.stringify(sd_bundle_data);
                          localStorage.setItem("sd_bundle_data", jsonString);
                          cartDrawer();
                        }
                      });
                  }
                })
                .catch((error) => {
                  ADD_TO_CART_BUTTON.innerText =
                    el.translations.translation.addToCartButton;
                });
            }
          })
          .catch((error) => {
            console.error("Error:", error);
          });
        });          
        }
  
        if(el.bundleDetail.discountedProductType=='all_products'){
          fetch(window.Shopify.routes.root + `recommendations/products.json?product_id=${sdBundleProductId}&limit=15&intent=related`)
            .then(response => response.json())
            .then(({ products }) => {
              if (products.length > 0) {
            let suggestedProducts=getRandomItems(products,3);
                // console.log("suggestedproducts",sdProductJson)
                totalProducts=[sdProductJson,...suggestedProducts]
                el?.customization?.frequentlyBoughtTogether?.design =='modern' ?  execFbtModern() : execFbtClassic() ;      
              }    
            }
          );
        }
         
        if(el.bundleDetail.discountedProductType !='all_products'){
          totalProducts = [
            ...el.bundleDetail.mainProducts,
            ...el.bundleDetail.offeredProducts,
          ];
          el?.customization?.frequentlyBoughtTogether?.design =='modern'?  execFbtModern() : execFbtClassic() ;  
        }
      }
    }
    else if (el.type == "productMixMatch") {
      if(el.plans.plan != "free"){
        let OriginalPrice = 0;
        let FinalPrice = 0;
        let PriceArray = [];
        let SelectedProducts = [];
        let SelectedProductsQuantity = 0;
        let DiscountType;
        let DiscountValue;
        // console.log("product mixmatch...............",el)
        let VariantDropDownFun = (productIndex,elements,VariantOptionDiv,TotalQuantity) => {
            let SelectVariants = document.createElement("SELECT");
            SelectVariants.id = `SelectVariants${bundleIndex}${productIndex}${TotalQuantity}`;
            SelectVariants.style.background = el?.customization?.productMixMatch?.productDetails?.variantSelector?.backgroundColor;
            SelectVariants.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
            SelectVariants.style.color = el?.customization?.productMixMatch?.productDetails?.variantSelector?.color;
            SelectVariants.style.width = el?.customization?.productMixMatch?.productDetails?.variantSelector?.width + "px";
            SelectVariants.addEventListener("change",VariantOptionFun=(e)=>{
              let SelectedVariantsId = document.querySelector(`#SelectVariants${bundleIndex}${productIndex}${TotalQuantity}`).value;
              let SelectVariantPrice = document.getElementById([`variants${TotalQuantity}${bundleIndex}${SelectedVariantsId}`]).getAttribute("price");
              let variantsIndex = document.getElementById([`variants${TotalQuantity}${bundleIndex}${SelectedVariantsId}`]).getAttribute("variantsId");
              let indexOfPrice = PriceArray.findIndex((checkProduct)=>checkProduct.productQuantity === `${elements.title}${productIndex}Q${TotalQuantity}`);
              let indexOfProduct;
              elements.variants.map((variants,variantIndex)=>{
                SelectedProducts.map((item,itemIndex)=>{
                  item.map((itemProducts,indexOfItemProduct)=>{
                    if(variants.id == itemProducts){
                      indexOfProduct = SelectedProducts.findIndex((checkPrducts)=> checkPrducts[indexOfItemProduct] == variants.id)
                    }
                  })
                })
              }) 
              if(PriceArray[indexOfPrice].productName === `Copy${elements.title}${productIndex}`){
                PriceArray.splice(indexOfPrice,1,{productName:`Copy${elements.title}${productIndex}`,productQuantity:`${elements.title}${productIndex}Q${TotalQuantity}`,price:SelectVariantPrice});
              }else{
                PriceArray.splice(indexOfPrice,1,{productName:`${elements.title}${productIndex}`,productQuantity:`${elements.title}${productIndex}Q${TotalQuantity}`,price:SelectVariantPrice});
              }
              SelectedProducts[indexOfProduct].splice(variantsIndex,1,SelectedVariantsId);
              calaculateOriginalPrice();
              calculateFinalPriceFunction();
              document.getElementById(`ProductPrice${bundleIndex}${productIndex}`).innerText = showAmountWithCurrency(SelectVariantPrice);
              document.getElementById(`${bundleIndex}OriginalPrice`).innerText = showAmountWithCurrency(OriginalPrice.toFixed(2));
              document.getElementById(`${bundleIndex}FInalPrice`).innerText = showAmountWithCurrency(FinalPrice.toFixed(2));
            })
          if(elements.variants.length > 1){elements.variants.map((items,index)=>{
              let VariantOptions = document.createElement("option");
              VariantOptions.value = `${items.id}`;
              VariantOptions.text =`${items.title}`;
              VariantOptions.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
              VariantOptions.setAttribute("variantsId",TotalQuantity-1);
              VariantOptions.id = `variants${TotalQuantity}${bundleIndex}${items.id}`;
              VariantOptions.setAttribute("price",items.price);
              SelectVariants.add(VariantOptions);
              VariantOptionDiv.appendChild(SelectVariants);
            })}
          }

        let calaculateOriginalPrice = ()  =>{
          OriginalPrice = 0;
          PriceArray.map((item)=>{
            OriginalPrice += parseFloat(item.price);
            return OriginalPrice.toFixed(2);
          })
        }

        let ActiveAppliedDiscount = (index) =>{
          let ActiveBadge = document.getElementById(`DiscountBadge${bundleIndex}${index}`)
          let addToCartBTN = document.getElementById(`sd-bundle-add-to-cart-buttonID${bundleIndex}`);
          if(ActiveBadge !== null){
            ActiveBadge.setAttribute("class","active");
            addToCartBTN.disabled = false;
            addToCartBTN.style.cursor = "pointer";
            addToCartBTN.style.background = `${el?.customization?.productMixMatch?.button?.backgroundColor}`
            if(ActiveBadge.previousSibling !== null){
              ActiveBadge.previousSibling.setAttribute("class","")
            }
            if(ActiveBadge.nextSibling !== null){
              ActiveBadge.nextSibling.setAttribute("class","")
            }
          }
        }

        let DeactivateDiscount = (index) => {
          let ActiveBadge = document.getElementById(`DiscountBadge${bundleIndex}${index}`);
          let addToCartBTN = document.getElementById(`sd-bundle-add-to-cart-buttonID${bundleIndex}`);
          if(ActiveBadge !== null){
            ActiveBadge.setAttribute("class","");
            addToCartBTN.disabled = true
            addToCartBTN.style.cursor = "not-allowed";
            addToCartBTN.style.background = "grey";
            if(ActiveBadge.previousSibling !== null) {
              ActiveBadge.previousSibling.setAttribute("class","")
            }
            if(ActiveBadge.nextSibling !== null){
              ActiveBadge.nextSibling.setAttribute("class","")
            }
          }
        }
        
        let calculateFinalPriceFunction = () =>{
          el.bundleDetail.discountOptions.map((item,index)=>{
            if(SelectedProductsQuantity < el.bundleDetail.discountOptions[0].quantity ){
              DeactivateDiscount(index);
              let appliedDiscount = document.getElementById(`${bundleIndex}discountOffer`);
              let PriceDiv = document.getElementById(`${bundleIndex}OriginalPrice`);
              if(appliedDiscount !==null && PriceDiv !== null){
                let selectedItemMsg = el?.translations?.translation?.selectAtLeastItemsToApplyTheDiscount.replace('{{item}}', `${el.bundleDetail.discountOptions[0].quantity}`);
                appliedDiscount.innerText = selectedItemMsg;
                PriceDiv.style.display = "none";
              }
              FinalPrice = OriginalPrice;
              return FinalPrice.toFixed(2);
            }else if( item.quantity < SelectedProductsQuantity && index !== el.bundleDetail.discountOptions.length-1){
              DeactivateDiscount(index);
              let appliedDiscount = document.getElementById(`${bundleIndex}discountOffer`);
              let PriceDiv = document.getElementById(`${bundleIndex}OriginalPrice`);
              if(appliedDiscount !==null && PriceDiv !== null){
                appliedDiscount.innerText = el.translations.translation.noDiscountIsApplied;
                PriceDiv.style.display = "none";
              }
              FinalPrice = OriginalPrice;
              return FinalPrice.toFixed(2);
            }else{
              if(el.bundleDetail.discountOptions[index].type === "percent"){
                if((item.quantity == SelectedProductsQuantity)  || (index === el.bundleDetail.discountOptions.length-1 && SelectedProductsQuantity >= item.quantity)) {
                  ActiveAppliedDiscount(index);
                  DiscountType = "percent";
                  DiscountValue = item.value;
                  let percentage = OriginalPrice*el.bundleDetail.discountOptions[index].value/100;
                  FinalPrice = OriginalPrice-percentage.toFixed(2);
                  let appliedDiscount = document.getElementById(`${bundleIndex}discountOffer`);
                  let PriceDiv = document.getElementById(`${bundleIndex}OriginalPrice`);
                  if(appliedDiscount !==null && PriceDiv !== null){
                    appliedDiscount.innerText = `${item.value}% ${el.translations.translation.discountIsApplied}.`;
                    PriceDiv.style.display = "block";
                  }
                  return FinalPrice.toFixed(2);
                }
              }else if(el.bundleDetail.discountOptions[index].type === "fixed"){
                if((item.quantity == SelectedProductsQuantity)  || (index === el.bundleDetail.discountOptions.length-1 && SelectedProductsQuantity >= item.quantity)) {
                  ActiveAppliedDiscount(index);
                  DiscountType = "fixed";
                  DiscountValue = item.value;
                  FinalPrice = OriginalPrice-el.bundleDetail.discountOptions[index].value;
                  let appliedDiscount = document.getElementById(`${bundleIndex}discountOffer`);
                  let PriceDiv = document.getElementById(`${bundleIndex}OriginalPrice`);
                  if(appliedDiscount !==null && PriceDiv !== null){
                    appliedDiscount.innerText = `-${showAmountWithCurrency(item.value)} ${el.translations.translation.discountIsApplied}.`;
                    PriceDiv.style.display = "block";
                  }
                  if(FinalPrice <0){
                    FinalPrice = 0;
                    return FinalPrice.toFixed(2);
                  }else{
                    return FinalPrice.toFixed(2);
                  }
                }
              }else if(el.bundleDetail.discountOptions[index].type ==="freeShipping"){
                if((item.quantity == SelectedProductsQuantity)  || (index === el.bundleDetail.discountOptions.length-1 && SelectedProductsQuantity >= item.quantity)) {
                  ActiveAppliedDiscount(index);
                  DiscountType = "freeShipping";
                  DiscountValue = item.value;
                  FinalPrice = OriginalPrice;
                  let appliedDiscount = document.getElementById(`${bundleIndex}discountOffer`);
                  let PriceDiv = document.getElementById(`${bundleIndex}OriginalPrice`);
                  if(appliedDiscount !==null && PriceDiv !== null){
                    appliedDiscount.innerText = `100% ${el.translations.translation.FreeShipping} ${el.translations.translation.discountIsApplied}.`;
                    PriceDiv.style.display = "none";
                  }
                  return FinalPrice.toFixed(2)
                }
              }else if(el.bundleDetail.discountOptions[index].type === "noDiscount"){
                if((item.quantity == SelectedProductsQuantity)  || (index === el.bundleDetail.discountOptions.length-1 && SelectedProductsQuantity >= item.quantity)) {
                  ActiveAppliedDiscount(index);
                  DiscountType = "noDiscount";
                  DiscountValue = item.value;
                  FinalPrice = OriginalPrice;
                  let PriceDiv = document.getElementById(`${bundleIndex}OriginalPrice`);
                  let appliedDiscount = document.getElementById(`${bundleIndex}discountOffer`);
                  if(appliedDiscount !==null && PriceDiv !== null){
                    appliedDiscount.innerText = `${el.translations.translation.discountIsApplied}.`;
                    PriceDiv.style.display = "none";
                  }
                  return FinalPrice.toFixed(2)
                }
              }
            }
          })
        }

        let MixMatchDiv = document.createElement("div");
        MixMatchDiv.className = "sd-bundle-main-column";
        MixMatchDiv.style.borderColor = el?.customization?.productMixMatch?.box?.borderColor;
        MixMatchDiv.style.borderRadius = `${el?.customization?.productMixMatch?.box?.borderRadius}px`;
        MixMatchDiv.style.background = el?.customization?.productMixMatch?.box?.backgroundColor;
        MixMatchDiv.style.borderWidth = `${el?.customization?.productMixMatch?.box?.thickness}px`;

        let Title_Description_Div = document.createElement("div");
        Title_Description_Div.className = "sd-bundle-text-detail";
        MixMatchDiv.append(Title_Description_Div);

        let TitleDiv = document.createElement("h4");
        TitleDiv.innerText = el.title;
        TitleDiv.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
        TitleDiv.style.color = el?.customization?.productMixMatch?.title?.color;
        TitleDiv.style.textAlign = el?.customization?.productMixMatch?.title?.alignment;
        TitleDiv.style.fontSize = `${el?.customization?.productMixMatch?.title?.fontSize}px`;
        TitleDiv.style.fontWeight = el?.customization?.productMixMatch?.title?.titleBold;
        Title_Description_Div.append(TitleDiv);

        let DescriptionDiv = document.createElement("p");
        if(el.description != "" && el.description != null && el.description != undefined){
          DescriptionDiv.innerText = el.description;
        }
        DescriptionDiv.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
        DescriptionDiv.style.color = el?.customization?.productMixMatch?.title?.descriptionColor;
        DescriptionDiv.style.fontSize = `${el?.customization?.productMixMatch?.title?.descriptionFontSize}px`;
        DescriptionDiv.style.fontWeight = el?.customization?.productMixMatch?.title?.descriptionBold;
        Title_Description_Div.append(DescriptionDiv);

        let Discount_Information_Div = document.createElement("div");
        Discount_Information_Div.className = "sd-show-selected-items-row";
        MixMatchDiv.append(Discount_Information_Div)

        let ShowActiveDiscountBadgeDiv = document.createElement("div");
        ShowActiveDiscountBadgeDiv.id = `ShowActiveDiscountBadgeDiv${bundleIndex}`;
        ShowActiveDiscountBadgeDiv.className = "sd-show-items";
        el.bundleDetail.discountOptions.map((items,discountBadgeIndex)=>{
          let ShowMultiDiscountBadgeDiv = document.createElement("span");
          ShowMultiDiscountBadgeDiv.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
          ShowMultiDiscountBadgeDiv.id = `DiscountBadge${bundleIndex}${discountBadgeIndex}`;
          if(items.type === "percent"){
            ShowMultiDiscountBadgeDiv.innerText = `${items.quantity} items|${items.value}% ${el.translations.translation.off}`;
          }else if(items.type === "fixed"){
            ShowMultiDiscountBadgeDiv.innerText = `${items.quantity} items|-${showAmountWithCurrency(items.value)} ${el.translations.translation.off}`;
          }else if(items.type === "freeShipping"){
            ShowMultiDiscountBadgeDiv.innerText = `${items.quantity} items|${el.translations.translation.FreeShipping}`;
          }else if(items.type === "noDiscount"){
            ShowMultiDiscountBadgeDiv.innerText = `${items.quantity} items|${el.translations.translation.off}`;
          }
          ShowActiveDiscountBadgeDiv.append(ShowMultiDiscountBadgeDiv);
        })
        Discount_Information_Div.append(ShowActiveDiscountBadgeDiv);

        let Selected_Text_Description_Div = document.createElement("div");
        Selected_Text_Description_Div.className = "sd-have-selected";
        Discount_Information_Div.append(Selected_Text_Description_Div);
        
        let ShowSelectedItemDiv = document.createElement("h5");
        ShowSelectedItemDiv.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
        ShowSelectedItemDiv.style.textAlign = el?.customization?.productMixMatch?.orderOverview?.alignment;
        ShowSelectedItemDiv.style.color = el?.customization.productMixMatch?.orderOverview?.selectedText?.color;
        ShowSelectedItemDiv.style.fontSize = el.customization?.productMixMatch?.orderOverview?.selectedText?.fontSize+"px";
        // ShowSelectedItemDiv.className = "sd-bundle-mix-match-selected-item-div";
        ShowSelectedItemDiv.id = `${bundleIndex}selectedItems`;
        let selectedItemMsg = el.translations.translation.youHaveSelectedItems.replace('{{item}}', `${el.bundleDetail.products.length}`);
        ShowSelectedItemDiv.innerText = selectedItemMsg;
        Selected_Text_Description_Div.append(ShowSelectedItemDiv);

        let DiscountOfferDiv = document.createElement("p");
        DiscountOfferDiv.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
        DiscountOfferDiv.style.textAlign = el?.customization?.productMixMatch?.orderOverview?.alignment;
        DiscountOfferDiv.style.color = el?.customization?.productMixMatch?.orderOverview?.discountText?.color;
        DiscountOfferDiv.style.fontSize = el?.customization?.productMixMatch?.orderOverview?.discountText?.fontSize+"px";
        DiscountOfferDiv.className = "sd-bundle-mix-match-discount-offer-div";
        DiscountOfferDiv.id = `${bundleIndex}discountOffer`;
        Selected_Text_Description_Div.append(DiscountOfferDiv);
        
        let ImageDiv = document.createElement("div");
        ImageDiv.className = "sd-show-selected-product-item";
        el.bundleDetail.products.map((elements,index)=>{
          let MapProductsImages = document.createElement("div");
          MapProductsImages.style.border = "2px solid black";
          MapProductsImages.style.borderColor = el?.customization?.productMixMatch?.productDetails?.image?.borderColor;
          MapProductsImages.style.borderRadius = `${el?.customization?.productMixMatch?.productDetails?.image?.borderRadius}px`;
          MapProductsImages.className = "sd-selected-product-itemImg";
          ImageDiv.append(MapProductsImages);
          let Images = document.createElement("img");
          Images.src = `${elements?.images[0]?.originalSrc}`;
          MapProductsImages.append(Images);

          if (index < el.bundleDetail.products.length - 1) {
              let BUNDLE_PLUS_BTN_DIV = document.createElement("div");
              BUNDLE_PLUS_BTN_DIV.className = "plus-selectedIcon";
              BUNDLE_PLUS_BTN_DIV.style.color = el?.customization?.collectionMixMatch?.collectionDetails?.plus?.color;
              BUNDLE_PLUS_BTN_DIV.innerHTML = `<svg viewBox="0 0 18 18" focusable="false" width="18" height="18" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
              <path d="M6.98047 17.3842V0.580255H10.3239V17.3842H6.98047ZM0.256392 10.6477V7.30433H17.0604V10.6477H0.256392Z" fill= ${
                            el?.customization?.productMixMatch
                              ?.productDetails?.plusColor
                          }></path>
              </svg>`;
              ImageDiv.append(BUNDLE_PLUS_BTN_DIV);
            } else {
            }
        })
        Discount_Information_Div.append(ImageDiv);
        
        let ItemCounterDiv = document.createElement("div");
        ItemCounterDiv.className = "sd-select-all-product";

        let CheckboxLableDiv = document.createElement("div");
        CheckboxLableDiv.className = "sd-checkbox-wrapper-21";
        ItemCounterDiv.append(CheckboxLableDiv);

        let AllCheckBoxLabel = document.createElement("label");
        AllCheckBoxLabel.className = "sd-control sd-control--checkbox";
        AllCheckBoxLabel.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
        AllCheckBoxLabel.style.color = el?.customization?.productMixMatch?.productDetails?.productDetailsBox?.allProductColor;
        AllCheckBoxLabel.innerText = el?.translations?.translation?.allProducts;
        CheckboxLableDiv.append(AllCheckBoxLabel);
        
        let AllProductCheckBox = document.createElement("input");
        AllProductCheckBox.id = `AllProductCheckBox${bundleIndex}`;
        AllProductCheckBox.setAttribute("type", "checkbox");
        AllProductCheckBox.setAttribute("checked","checked");
        AllProductCheckBox.addEventListener("change",handleAllProducts = (e)=>{
          if(e.target.checked === false){
            if(el.bundleDetail.requiredItem.enable === false){
              SelectedProducts = [];
              PriceArray = [];
              SelectedProductsQuantity = SelectedProducts.length;
              calaculateOriginalPrice();
              calculateFinalPriceFunction();
              el.bundleDetail.products.map((allProducts,allProductIndex)=>{
                document.getElementById(`ProductCheckbox${bundleIndex}${allProductIndex}`).checked = false;
                let variantDiv = document.getElementById(`VariantOptionDiv${bundleIndex}${allProductIndex}`);
                if(variantDiv !== null){
                  const childNodes = variantDiv.querySelectorAll('*');
                  childNodes.forEach(node => node.remove());
                }
                let quantityCounter = document.getElementById(`QuantityCount${bundleIndex}${allProductIndex}`);
                let plusButton = document.getElementById(`PlusBtn${bundleIndex}${allProductIndex}`); 
                if(quantityCounter !== null && plusButton !== null){
                  quantityCounter.innerText = 0;
                  plusButton.disabled = true;
                }
              })
              document.getElementById(`${bundleIndex}selectedItems`).innerText = el.translations.translation.youHavenotSelectedanyItemsYet;
              document.getElementById(`${bundleIndex}QuantityCounter`).innerText = `Qty: ${SelectedProductsQuantity}`;
              document.getElementById(`${bundleIndex}OriginalPrice`).innerText = showAmountWithCurrency(OriginalPrice.toFixed(2));
              document.getElementById(`${bundleIndex}FInalPrice`).innerText = showAmountWithCurrency(FinalPrice.toFixed(2));
            }else{
              el.bundleDetail.products.map((requireItem,requiredItemIndex)=>{
                if(requireItem.required === false){
                  let TotalQuantity = 1;
                  let i = SelectedProducts.findIndex((items)=>items[0] === requireItem.variants[0].id);
                  SelectedProductsQuantity -= SelectedProducts[i].length;
                  SelectedProducts.splice(i,1);
                  PriceArray.splice(requiredItemIndex,1,{productName:`${requireItem.title}${requiredItemIndex}`,productQuantity:`${requireItem.title}${requiredItemIndex}Q${TotalQuantity}`,price:"0"})
                  document.getElementById(`ProductCheckbox${bundleIndex}${requiredItemIndex}`).checked = false;
                  let variantDiv = document.getElementById(`VariantOptionDiv${bundleIndex}${requiredItemIndex}`);
                  if(variantDiv !== null){
                    const childNodes = variantDiv.querySelectorAll('*');
                    childNodes.forEach(node => node.remove());
                  }
                  let quantityCounter = document.getElementById(`QuantityCount${bundleIndex}${requiredItemIndex}`);
                  let plusButton = document.getElementById(`PlusBtn${bundleIndex}${requiredItemIndex}`); 
                  if(quantityCounter !== null && plusButton !== null){
                    quantityCounter.innerText = 0;
                    plusButton.disabled = true;
                  }
                }
                calaculateOriginalPrice();
                calculateFinalPriceFunction();
                let selectedItemMsg = el.translations.translation.youHaveSelectedItems.replace('{{item}}', `${SelectedProductsQuantity}`);
                document.getElementById(`${bundleIndex}selectedItems`).innerText = selectedItemMsg;
                document.getElementById(`${bundleIndex}QuantityCounter`).innerText = `Qty: ${SelectedProductsQuantity}`;
                document.getElementById(`${bundleIndex}OriginalPrice`).innerText = showAmountWithCurrency(OriginalPrice.toFixed(2));
                document.getElementById(`${bundleIndex}FInalPrice`).innerText = showAmountWithCurrency(FinalPrice.toFixed(2));
              })
            } 
          }
          if(e.target.checked === true){
            if(SelectedProducts.length === 0){
              el.bundleDetail.products.map((allProducts,allProductIndex)=>{
                let TotalQuantity = 1;
                SelectedProducts.push([allProducts.variants[0].id]);
                PriceArray.push({productName:`${allProducts.title}${allProductIndex}`,productQuantity:`${allProducts.title}${allProductIndex}Q${TotalQuantity}`,price:allProducts.variants[0].price});
                SelectedProductsQuantity += SelectedProducts[allProductIndex].length;
                calaculateOriginalPrice();
                calculateFinalPriceFunction();
                let VariantOptionDiv = document.getElementById(`VariantOptionDiv${bundleIndex}${allProductIndex}`);
                VariantDropDownFun(allProductIndex,allProducts,VariantOptionDiv,TotalQuantity);
                let quantityCounter = document.getElementById(`QuantityCount${bundleIndex}${allProductIndex}`);
                let plusButton = document.getElementById(`PlusBtn${bundleIndex}${allProductIndex}`); 
                if(quantityCounter !== null && plusButton !== null){
                  quantityCounter.innerText = TotalQuantity;
                  plusButton.disabled = false;
                }
                let selectedItemMsg = el.translations.translation.youHaveSelectedItems.replace('{{item}}', `${SelectedProductsQuantity}`);
                document.getElementById(`ProductCheckbox${bundleIndex}${allProductIndex}`).checked = true;
                document.getElementById(`${bundleIndex}selectedItems`).innerText = selectedItemMsg;
                document.getElementById(`${bundleIndex}QuantityCounter`).innerText = `Qty: ${SelectedProductsQuantity}`;
                document.getElementById(`${bundleIndex}OriginalPrice`).innerText = showAmountWithCurrency(OriginalPrice.toFixed(2));
                document.getElementById(`${bundleIndex}FInalPrice`).innerText = showAmountWithCurrency(FinalPrice.toFixed(2));
              })
            }else{
              el.bundleDetail.products.map((elItem,elIndex)=>{
                let TotalQuantity = 1;
                let indexof = SelectedProducts.findIndex((items)=> items[0] === elItem.variants[0].id);
                if(indexof === -1){
                  SelectedProducts.push([elItem.variants[0].id]);
                  PriceArray.splice(elIndex,1,{productName:`${elItem.title}${elIndex}`,productQuantity:`${elItem.title}${elIndex}Q${TotalQuantity}`,price:elItem.variants[0].price})
                  let VariantOptionDiv = document.getElementById(`VariantOptionDiv${bundleIndex}${elIndex}`);
                  VariantDropDownFun(elIndex,elItem,VariantOptionDiv,TotalQuantity);
                  SelectedProductsQuantity += 1;
                  let quantityCounter = document.getElementById(`QuantityCount${bundleIndex}${elIndex}`);
                  let plusButton = document.getElementById(`PlusBtn${bundleIndex}${elIndex}`); 
                  if(quantityCounter !== null && plusButton !== null){
                    quantityCounter.innerText = TotalQuantity;
                    plusButton.disabled = false;
                  }
                }
                calaculateOriginalPrice();
                calculateFinalPriceFunction();
                let selectedItemMsg = el.translations.translation.youHaveSelectedItems.replace('{{item}}', `${SelectedProductsQuantity}`);
                document.getElementById(`ProductCheckbox${bundleIndex}${elIndex}`).checked = true;
                document.getElementById(`${bundleIndex}selectedItems`).innerText = selectedItemMsg;
                document.getElementById(`${bundleIndex}QuantityCounter`).innerText = `Qty: ${SelectedProductsQuantity}`;
                document.getElementById(`${bundleIndex}OriginalPrice`).innerText = showAmountWithCurrency(OriginalPrice.toFixed(2));
                document.getElementById(`${bundleIndex}FInalPrice`).innerText = showAmountWithCurrency(FinalPrice.toFixed(2));
              })
            }
          }
        })
        AllCheckBoxLabel.append(AllProductCheckBox);   

        let Empty_Div = document.createElement("div");
        Empty_Div.className = "sd-control-indicator";
        AllCheckBoxLabel.append(Empty_Div);
        
        let QuantityCounterDiv = document.createElement("div");
        QuantityCounterDiv.className = "sd-bundle-product-quantity";
        ItemCounterDiv.append(QuantityCounterDiv);
        let Quantity_Text = document.createElement("h6");
        Quantity_Text.id = `${bundleIndex}QuantityCounter`;
        Quantity_Text.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
        Quantity_Text.style.fontSize = el?.customization?.productMixMatch?.productDetails?.quantities?.size + "px";
        Quantity_Text.style.color = el?.customization?.productMixMatch?.productDetails?.quantities?.color;
        Quantity_Text.innerText = `Qty: ${el?.bundleDetail?.products?.length}`;
        QuantityCounterDiv.append(Quantity_Text);
        
        MixMatchDiv.append(ItemCounterDiv);

        el.bundleDetail.products.map((elements,productIndex)=>{
          SelectedProducts.push([elements.variants[0].id]);
          let TotalQuantity = 1;
          SelectedProductsQuantity = SelectedProducts.length;
          PriceArray.push({productName:`${elements.title}${productIndex}`,productQuantity:`${elements.title}${productIndex}Q${TotalQuantity}`,price:elements.variants[0].price});
          calaculateOriginalPrice();
          calculateFinalPriceFunction();
          let SetProductsDetailsDiv = document.createElement("div");
          SetProductsDetailsDiv.className = "sd-bundle-product-detail";
          SetProductsDetailsDiv.style.backgroundColor = el?.customization?.productMixMatch?.productDetails?.productDetailsBox?.backgroundColor;

          let Inner_Div = document.createElement("div");
          Inner_Div.className = "sd-bundle-product-inner";
          SetProductsDetailsDiv.append(Inner_Div);

          let CheckBoxDiv = document.createElement("div");
          CheckBoxDiv.className = "checkbox-wrapper-18";
          Inner_Div.append(CheckBoxDiv);

          let CheckBox_Round_Div = document.createElement("div");
          CheckBox_Round_Div.className = "round";
          CheckBoxDiv.append(CheckBox_Round_Div);
                  
          let ProductsCheckBox = document.createElement("input");
          ProductsCheckBox.id = `ProductCheckbox${bundleIndex}${productIndex}`;
          ProductsCheckBox.setAttribute("type", "checkbox");
          ProductsCheckBox.setAttribute("checked","checked");
          ProductsCheckBox.addEventListener("click", (e) =>{
            // console.log("test",e)
            if(elements.required === true){
              document.getElementById(`ProductCheckbox${bundleIndex}${productIndex}`).checked = true; 
              let PopUpMessageDiv = document.createElement("div");
              PopUpMessageDiv.id = `PopUpMessageDiv${bundleIndex}${productIndex}`;
              PopUpMessageDiv.className = "sd-bundle-mix-match-checkBox-popup-div";
              CheckBox_Round_Div.append(PopUpMessageDiv);
              let PopupSpan = document.createElement("span");
              PopupSpan.className = "sd-bundle-mix-match-checkBox-popup-span";
              PopupSpan.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
              PopupSpan.innerText = "This product is required and can not be deselected";
              PopUpMessageDiv.append(PopupSpan);
              setTimeout(()=>{
                document.getElementById(`PopUpMessageDiv${bundleIndex}${productIndex}`).remove();
              },2000);
            }else{
              if (e.target.checked === true) {
              OriginalPrice = 0;
                TotalQuantity = 1;
                SelectedProducts.push([elements.variants[0].id]);
                let indexOfPrice = PriceArray.findIndex((checkProduct)=>checkProduct.productName === `${elements.title}${productIndex}`);
                if(indexOfPrice === -1){
                  PriceArray.push({productName:`${elements.title}${productIndex}`,productQuantity:`${elements.title}${productIndex}Q${TotalQuantity}`,price:elements.variants[0].price});
                }else{
                  PriceArray.splice(indexOfPrice,1,{productName:`${elements.title}${productIndex}`,productQuantity:`${elements.title}${productIndex}Q${TotalQuantity}`,price:elements.variants[0].price});
                }
                SelectedProductsQuantity += 1;
                calaculateOriginalPrice();
                calculateFinalPriceFunction();
                if(elements.multiItemSelect === true){
                  if(TotalQuantity >= 1){
                    document.getElementById(`Minusbtn${bundleIndex}${productIndex}`).disabled = true;
                    document.getElementById(`QuantityCount${bundleIndex}${productIndex}`).innerText = TotalQuantity;
                  }
                }
                if(SelectedProductsQuantity >= el.bundleDetail.products.length){
                  document.getElementById(`AllProductCheckBox${bundleIndex}`).checked = true;
                }
                let plusButton = document.getElementById(`PlusBtn${bundleIndex}${productIndex}`); 
                if(plusButton !== null){
                  plusButton.disabled = false;
                }
                let selectedItemMsg = el.translations.translation.youHaveSelectedItems.replace('{{item}}', `${SelectedProductsQuantity}`);
                let VariantOptionDiv = document.getElementById(`VariantOptionDiv${bundleIndex}${productIndex}`);
                VariantDropDownFun(productIndex,elements,VariantOptionDiv,TotalQuantity);
                document.getElementById(`${bundleIndex}OriginalPrice`).innerText = showAmountWithCurrency(OriginalPrice.toFixed(2));
                document.getElementById(`${bundleIndex}selectedItems`).innerText = selectedItemMsg;
                document.getElementById(`${bundleIndex}QuantityCounter`).innerText = `Qty: ${SelectedProductsQuantity}`;
                document.getElementById(`${bundleIndex}FInalPrice`).innerText = showAmountWithCurrency(FinalPrice.toFixed(2));
              }
              if(e.target.checked === false){
              OriginalPrice = 0;
              let indexProducts ;
              for(i=0; i<elements.variants.length; i++){
                let indexOfProducts = SelectedProducts.findIndex((item)=>item[0] === elements.variants[i].id);
                if(indexOfProducts !== null && indexOfProducts !== undefined && indexOfProducts !== -1){
                  indexProducts = indexOfProducts;
                  break;
                }
              }
              let plusButton = document.getElementById(`PlusBtn${bundleIndex}${productIndex}`); 
              if(plusButton !== null){
                plusButton.disabled = true;
              }
              SelectedProductsQuantity -= SelectedProducts[indexProducts].length;
              SelectedProducts.splice(indexProducts,1);
                
              PriceArray = PriceArray.filter((item)=>{
                return item.productName !== `Copy${elements.title}${productIndex}`;
              })
              
              if(SelectedProductsQuantity !== el.bundleDetail.products.length){
                document.getElementById(`AllProductCheckBox${bundleIndex}`).checked = false;
              }
              let indexOfPrice = PriceArray.findIndex((checkProduct)=>checkProduct.productName === `${elements.title}${productIndex}`);
              PriceArray.splice(indexOfPrice,1,{productName:`${elements.title}${productIndex}`,productQuantity:`${elements.title}${productIndex}Q${TotalQuantity}`,price:"0"});
              TotalQuantity = 0;
                
              if(elements.multiItemSelect === true){
                if(TotalQuantity <= 1){
                  document.getElementById(`Minusbtn${bundleIndex}${productIndex}`).disabled = true;
                  document.getElementById(`QuantityCount${bundleIndex}${productIndex}`).innerText = TotalQuantity;
                }
              }
              calaculateOriginalPrice();
              calculateFinalPriceFunction();
              let variantDiv = document.getElementById(`VariantOptionDiv${bundleIndex}${productIndex}`);
              if(variantDiv !== null){
                const childNodes = variantDiv.querySelectorAll('*');
                childNodes.forEach(node => node.remove());
              }
              let selectedItemMsg = el.translations.translation.youHaveSelectedItems.replace('{{item}}', `${SelectedProductsQuantity}`);
              document.getElementById(`${bundleIndex}OriginalPrice`).innerText = showAmountWithCurrency(OriginalPrice.toFixed(2));
              if(SelectedProductsQuantity === 0 ){
                document.getElementById(`${bundleIndex}selectedItems`).innerText = el.translations.translation.youHavenotSelectedanyItemsYet;
              }else{
                document.getElementById(`${bundleIndex}selectedItems`).innerText = selectedItemMsg;
              }
              document.getElementById(`${bundleIndex}QuantityCounter`).innerText = `Qty: ${SelectedProductsQuantity}`;
              document.getElementById(`${bundleIndex}FInalPrice`).innerText = showAmountWithCurrency(FinalPrice.toFixed(2));
              document.getElementById(`ProductPrice${bundleIndex}${productIndex}`).innerText = showAmountWithCurrency(`${elements.variants[0].price}`);
            }
          }
          });

          let Product_CheckBox_Label = document.createElement("label");
          Product_CheckBox_Label.setAttribute("for",`ProductCheckbox${bundleIndex}${productIndex}`);
          Product_CheckBox_Label.id = `Product_CheckBox_Label${bundleIndex}${productIndex}`;
          CheckBox_Round_Div.append(ProductsCheckBox,Product_CheckBox_Label);

          let ImageDiv = document.createElement("div");
          ImageDiv.className = "sd-bundle-product-img";
          ImageDiv.style.border = "2px solid black";
          ImageDiv.style.borderColor = el?.customization?.productMixMatch?.productDetails?.image?.borderColor;
          ImageDiv.style.borderRadius = `${el?.customization?.productMixMatch?.productDetails?.image?.borderRadius}px`;
          Inner_Div.append(ImageDiv);
          
          let ProductImages = document.createElement("img");
          ProductImages.src = `${elements?.images[0]?.originalSrc}`;
          ImageDiv.append(ProductImages);

          let ProductNamePriceDiv = document.createElement("div");
          ProductNamePriceDiv.className = "sd-bundle-product-name";
          let ProductName = document.createElement("h5");
          ProductName.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
          ProductName.innerText = `${elements?.title}`;
          ProductName.style.color = el?.customization?.productMixMatch?.productDetails?.title?.color;
          ProductName.style.fontSize = `${el?.customization?.productMixMatch?.productDetails?.title?.fontSize}px`;
          ProductNamePriceDiv.append(ProductName);

          let ProductPrice = document.createElement("h4");
          ProductPrice.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
          ProductPrice.id = `ProductPrice${bundleIndex}${productIndex}`;
          ProductPrice.innerText = showAmountWithCurrency(`${elements?.variants[0]?.price}`);
          ProductPrice.style.color = el?.customization?.productMixMatch?.productDetails?.price?.color;
          ProductPrice.style.fontSize = `${el?.customization?.productMixMatch?.productDetails?.price?.fontSize}px`;
          ProductNamePriceDiv.append(ProductPrice);
          Inner_Div.append(ProductNamePriceDiv);

          if(elements.multiItemSelect === true) {
            let QuantitySelectorDiv = document.createElement("div");
            QuantitySelectorDiv.className = "sd-bundle-mix-match-quantityselector-div";
            QuantitySelectorDiv.id = `QuantitySelectorDiv${bundleIndex}${productIndex}`;
            ProductNamePriceDiv.append(QuantitySelectorDiv);

            let MinusBtnDiv = document.createElement("div");
            MinusBtnDiv.className = "sd-bundle-mix-match-minusbtn-div"; 
            QuantitySelectorDiv.append(MinusBtnDiv);

            let MinusBtn = document.createElement("button");
            MinusBtn.id = `Minusbtn${bundleIndex}${productIndex}`;
            MinusBtn.className = "sd-bundle-mix-match-minus-btn";
            MinusBtn.innerText = "-";
            MinusBtn.setAttribute("disabled",true);
            MinusBtn.style.cursor = "pointer";
            MinusBtn.addEventListener("click",removeProduct = ()=>{
              let indexOfPrice = PriceArray.findIndex((checkProduct)=>checkProduct.productName === `${elements.title}${productIndex}Q${TotalQuantity}`);
              let indexofProducts;
              elements.variants.map((variants,variantsIndex)=>{
                SelectedProducts.map((item,itemIndex)=>{
                  item.map((itemProducts,indexOfItemProduct)=>{
                    if(variants.id == itemProducts){
                      indexofProducts = SelectedProducts.findIndex((checkPrducts)=> checkPrducts[indexOfItemProduct] == variants.id)
                    }
                  })
                })
              })
              let selectDropdown = document.getElementById(`SelectVariants${bundleIndex}${productIndex}${TotalQuantity}`);
              if(selectDropdown !==null){
                selectDropdown.remove();
              }
              TotalQuantity = TotalQuantity - 1;
              SelectedProducts[indexofProducts].pop();
              PriceArray.splice(indexOfPrice,1);
              SelectedProductsQuantity -= 1;
              calaculateOriginalPrice();
              calculateFinalPriceFunction();
              if(TotalQuantity <= 1){
                document.getElementById(`Minusbtn${bundleIndex}${productIndex}`).disabled = true;
              }
              document.getElementById(`QTY:${bundleIndex}${productIndex}`).innerText = `Qty: ${TotalQuantity}`
              document.getElementById(`${bundleIndex}OriginalPrice`).innerText = showAmountWithCurrency(OriginalPrice.toFixed(2));
              document.getElementById(`${bundleIndex}FInalPrice`).innerText = showAmountWithCurrency(FinalPrice.toFixed(2));
              document.getElementById(`QuantityCount${bundleIndex}${productIndex}`).innerText = TotalQuantity;
              let selectedItemMsg = el.translations.translation.youHaveSelectedItems.replace('{{item}}', `${SelectedProductsQuantity}`);
              document.getElementById(`${bundleIndex}selectedItems`).innerText = selectedItemMsg;
              document.getElementById(`${bundleIndex}QuantityCounter`).innerText = `Qty: ${SelectedProductsQuantity}`;
            })
              
            MinusBtnDiv.append(MinusBtn);

            let QuantitiesDiv = document.createElement("div");
            QuantitiesDiv.className = "sd-bundle-mix-match-quantities-div";
            QuantitySelectorDiv.append(QuantitiesDiv);

            let QuantityCount = document.createElement("div");
            QuantityCount.id = `QuantityCount${bundleIndex}${productIndex}`;
            QuantityCount.innerText = TotalQuantity;
            QuantityCount.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
            QuantitiesDiv.append(QuantityCount);
            
            let PlusBtnDiv = document.createElement("div");
            PlusBtnDiv.className = "sd-bundle-mix-match-plusBtn-div";

            QuantitySelectorDiv.append(PlusBtnDiv);

            let PlusBtn = document.createElement("button");
            PlusBtn.className = "sd-bundle-mix-match-plus-btn";
            PlusBtn.id = `PlusBtn${bundleIndex}${productIndex}`;
            PlusBtn.innerText = "+";
            PlusBtn.style.cursor = "pointer";
            PlusBtn.addEventListener("click",addProduct = ()=>{
              document.getElementById(`Minusbtn${bundleIndex}${productIndex}`).disabled = false;
              let indexofProducts;
              elements.variants.map((variants,variantsIndex)=>{
                SelectedProducts.map((item,itemIndex)=>{
                  item.map((itemProducts,indexOfItemProduct)=>{
                    if(variants.id == itemProducts){
                      indexofProducts = SelectedProducts.findIndex((checkPrducts)=> checkPrducts[indexOfItemProduct] == variants.id)
                    }
                  })
                })
              });
              let VariantOptionDiv = document.getElementById(`VariantOptionDiv${bundleIndex}${productIndex}`);
              SelectedProducts[indexofProducts].push(elements.variants[0].id);
              TotalQuantity =  SelectedProducts[indexofProducts].length;
              if(VariantOptionDiv !== null){
                VariantDropDownFun(productIndex,elements,VariantOptionDiv,TotalQuantity);
              }
              PriceArray.push({productName:`Copy${elements.title}${productIndex}`,productQuantity:`${elements.title}${productIndex}Q${TotalQuantity}`,price:`${elements?.variants[0]?.price}`})
              SelectedProductsQuantity += 1;
              calaculateOriginalPrice();
              calculateFinalPriceFunction();
              document.getElementById(`QTY:${bundleIndex}${productIndex}`).innerText = `Qty: ${TotalQuantity}`;
              document.getElementById(`${bundleIndex}OriginalPrice`).innerText = showAmountWithCurrency(OriginalPrice.toFixed(2));
              document.getElementById(`${bundleIndex}FInalPrice`).innerText = showAmountWithCurrency(FinalPrice.toFixed(2));
              let selectedItemMsg = el.translations.translation.youHaveSelectedItems.replace('{{item}}', `${SelectedProductsQuantity}`);
              document.getElementById(`${bundleIndex}selectedItems`).innerText = selectedItemMsg;
              document.getElementById(`QuantityCount${bundleIndex}${productIndex}`).innerText = TotalQuantity;
              document.getElementById(`${bundleIndex}QuantityCounter`).innerText = `Qty: ${SelectedProductsQuantity}`;
            })
            PlusBtnDiv.append(PlusBtn);
          }
    
          if(elements.variants.length > 1 ){let VariantOptionDiv = document.createElement("div");
          VariantOptionDiv.className = "sd-bundle-mix-match-variantOptions-div";
          VariantOptionDiv.id = `VariantOptionDiv${bundleIndex}${productIndex}`;
          VariantDropDownFun(productIndex,elements,VariantOptionDiv,TotalQuantity);
          ProductNamePriceDiv.append(VariantOptionDiv)};

          let Quantity_Div = document.createElement("div");
          Quantity_Div.className = "sd-bundle-product-quantity";
          SetProductsDetailsDiv.append(Quantity_Div);

          let Quantity_Text = document.createElement("h6");
          Quantity_Text.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
          Quantity_Text.style.fontSize = el?.customization?.productMixMatch?.productDetails?.quantities?.size + "px";
          Quantity_Text.style.color = el?.customization?.productMixMatch?.productDetails?.quantities.color;
          Quantity_Text.id = `QTY:${bundleIndex}${productIndex}`;
          Quantity_Text.innerText = `Qty: ${TotalQuantity}`;
          Quantity_Div.append(Quantity_Text);
          
          MixMatchDiv.append(SetProductsDetailsDiv);
        });
        
        let TotalPriceDiv = document.createElement("div");
        TotalPriceDiv.className = "sd-product-bundle-total";
        MixMatchDiv.append(TotalPriceDiv);

        let PriceTextDiv = document.createElement("div");
        PriceTextDiv.className = "sd-total-desc";
        TotalPriceDiv.append(PriceTextDiv);

        let Total_Text = document.createElement("h4");
        Total_Text.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
        Total_Text.innerText = el?.translations?.translation?.total;
        Total_Text.style.color = el?.customization?.productMixMatch?.totalSection?.color;
        Total_Text.style.fontSize = `${el?.customization?.productMixMatch?.totalSection?.fontSize}px`;
        PriceTextDiv.append(Total_Text);

        let Discount_Text = document.createElement("p");
        Discount_Text.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
        Discount_Text.style.color = el?.customization?.productMixMatch?.totalSection?.discountMessage?.color;
        Discount_Text.style.fontSize = el?.customization?.productMixMatch?.totalSection?.discountMessage?.size+"px";
        Discount_Text.innerText = el?.translations?.translation?.discountApplied;
        PriceTextDiv.append(Discount_Text);

        let AllPriceDiv = document.createElement("div");
        AllPriceDiv.className = "sd-total-amount";

        let OriginalPriceDiv = document.createElement("h6");
        OriginalPriceDiv.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
        OriginalPriceDiv.id = `${bundleIndex}OriginalPrice`;
        OriginalPriceDiv.style.color = el?.customization?.productMixMatch?.totalSection?.originalPrice?.color;
        OriginalPriceDiv.style.fontSize = `${el?.customization?.productMixMatch?.totalSection?.originalPrice?.fontSize}px`;
        OriginalPriceDiv.innerText = showAmountWithCurrency(OriginalPrice.toFixed(2));

        let FinalPriceDiv = document.createElement("h4");
        FinalPriceDiv.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
        FinalPriceDiv.id = `${bundleIndex}FInalPrice`;
        FinalPriceDiv.style.color = el?.customization?.productMixMatch?.totalSection?.finalPrice?.color;
        FinalPriceDiv.style.fontSize = `${el?.customization?.productMixMatch?.totalSection?.finalPrice?.fontSize}px`;
        FinalPriceDiv.innerText = showAmountWithCurrency(FinalPrice.toFixed(2));

        AllPriceDiv.append(FinalPriceDiv);
        AllPriceDiv.append(OriginalPriceDiv);
        TotalPriceDiv.append(AllPriceDiv);

        let AddToCartBtnDiv = document.createElement("div");
        AddToCartBtnDiv.className = "sd-bundle-addto-cart";
        let AddToCartBTN = document.createElement("button");
        AddToCartBTN.disabled = true;
        AddToCartBTN.className = "sd-bundle-add-to-cart-button";
        AddToCartBTN.id = `sd-bundle-add-to-cart-buttonID${bundleIndex}`
        AddToCartBTN.style.background = "grey";
        AddToCartBTN.style.cursor = "not-allowed";
        AddToCartBTN.style.borderRadius = el?.customization?.productMixMatch?.button?.borderRadius+"px";
        AddToCartBTN.style.borderColor = el?.customization?.productMixMatch?.button?.borderColor;
        AddToCartBTN.style.color = `${el?.customization?.productMixMatch?.button?.color}`;
        AddToCartBTN.style.fontSize = `${el?.customization?.productMixMatch?.button?.fontSize}px`;
        AddToCartBTN.style.fontFamily = el?.customization?.productMixMatch?.box?.fontFamily;
        AddToCartBTN.innerHTML = el?.translations?.translation?.addToCartButton;
        AddToCartBTN.type = "button";
        AddToCartBTN.addEventListener("click",addToCartFunc=(e)=>{
          let bundleDataArray = SelectedProducts.reduce(
            (acc, curr) => acc.concat(curr),
            []
          );
          bundleDataArray.map((productsId,productsIndex)=>{
            bundleData[bundleIndex][productsIndex] = [{
              id: productsId.replace(
                "gid://shopify/ProductVariant/",
                ""
              ),
              quantity: 1,
            }];
          })
          PriceArray.map((item)=>{
            bundleSum[bundleIndex].push([item.price]);
          })
          let code = JSON.parse(localStorage.getItem("sd_bundle_data"));
          let discountCodeId = code.discountCreateId ?? "";
          AddToCartBTN.innerText = "";
          let btnSpinner = document.createElement("div");
          btnSpinner.className = "bundleBtnSpinner";
          AddToCartBTN.append(btnSpinner);

          btnSpinner.style.display = "block";
          const mergedArray = bundleData[bundleIndex].reduce(
            (acc, curr) => acc.concat(curr),
            []
          );
          const mergedGidArray = SelectedProducts.reduce(
            (acc, curr) => acc.concat(curr),
            []
          );
          let mergedResult = {};
          for (let item of mergedArray) {
            if (mergedResult[item.id]) {
              mergedResult[item.id].quantity += item.quantity;
            } else {
              mergedResult[item.id] = { ...item };
            }
          }
          let mergedArrayResult = Object.values(mergedResult);
          let formData = {
            items: mergedArrayResult,
            attributes: { SD_BUNDLE_ID: el._id },
          };
          fetch(window.Shopify.routes.root + "cart/add.js", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
          })
            .then((response) => {
              return response.json();
            })
            .then((response) => {
              let errorDiv = document.getElementsByClassName(
                "sd-bundle-error-message"
              );
              errorDiv[0]?.remove();
              if (response.status == 422 || response.status == 404) {
                AddToCartBTN.innerText =
                  el.translations.translation.addToCartButton;
                btnSpinner.remove();
                let errorMessage = document.createElement("div");
                errorMessage.className = "sd-bundle-error-message";
                MixMatchDiv.append(errorMessage);
                errorMessage.innerText = response.description;
              } else {
                fetch(window.Shopify.routes.root + "cart.js", {
                  method: "GET",
                  headers: {
                    "Content-Type": "application/json",
                  },
                })
                  .then((response) => {
                    return response.json();
                  })
                  .then((response) => {
                    if (DiscountType == "noDiscount") {
                      fetch(`${server}/api/storefront/getBundleClick`, {
                        method: "POST",
                        headers: {
                          "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                          shop: Shopify.shop,
                          bundleId: el._id,
                        }),
                      });
                      let isDiscount =
                        DiscountType == "noDiscount"
                          ? "noDiscount"
                          : "Fix";
                      const localData = JSON.parse(
                        localStorage.getItem("sd_bundle_data")
                      );
                      let sd_bundle_data = {
                        discount_name: el.name,
                        code: code.code,
                        bundleId: el._id,
                        discountType: isDiscount,
                        variantsId: mergedArrayResult,
                        discountCreateId: localData.discountCreateId,
                        prefixCode: el.settings.discountLabel,
                      };
                      var jsonString = JSON.stringify(sd_bundle_data);
                      localStorage.setItem("sd_bundle_data", jsonString);

                      btnSpinner.remove();
                      window.location.assign(`https://${Shopify.shop}/cart`);
                    } else {
                      let finalSumBundle = bundleSum[bundleIndex].reduce(
                        (acc, curr) => acc.concat(curr),
                        []
                      );
                      let myArray = finalSumBundle.map(parseFloat);
                      let total = myArray.reduce(
                        (accumulator, currentValue) =>
                          accumulator + currentValue,
                        0
                      );
                      let totalPrice = Number(total.toFixed(2));
                      let finalPrice;
                      
                      switch (DiscountType) {
                        case "percent":
                          let percentagepart = parseFloat(
                            DiscountValue
                          );
                          let percentage = (totalPrice * percentagepart) / 100;
                          finalPrice = percentage.toFixed(2);
                          break;
                        case "price":
                          let pricePart = parseFloat(
                            DiscountValue
                          );
                          result = totalPrice - pricePart;
                          finalPrice = result.toFixed(2);
                          break;
                        case "fixed":
                          let fixedPart = parseFloat(
                            DiscountValue
                          );
                          finalPrice = fixedPart.toFixed(2);
                          break;
                        default:
                          break;
                      }

                      let isDiscount =
                        DiscountType == "noDiscount"
                          ? "noDiscount"
                          : "Fix";
                      let sd_bundle_data = {
                        discount_name: el.name,
                        code: `${el.settings.discountLabel}-${code.code}`,
                        discountType: isDiscount,
                        discountValue: finalPrice,
                        variantsId: mergedGidArray,
                        startDate: new Date(),
                        endDate: el.endDate,
                        shop: Shopify.shop,
                        bundleType: DiscountType,
                        totalPrice: total.toFixed(2),
                        discountCreateId: discountCodeId,
                      };
                      fetch(server + "/api/storefront/createRule", {
                        method: "POST",
                        headers: {
                          "Content-Type": "application/json",
                        },
                        body: JSON.stringify(sd_bundle_data),
                      })
                        .then((response) => response.json())
                        .then((data) => {
                          if (data.status == 200) {
                            fetch(`${server}/api/storefront/getBundleClick`, {
                              method: "POST",
                              headers: {
                                "Content-Type": "application/json",
                              },
                              body: JSON.stringify({
                                shop: Shopify.shop,
                                bundleId: el._id,
                              }),
                            });
                            AddToCartBTN.innerText =
                              el.translations.translation.addToCartButton;
                            btnSpinner.remove();

                            let sd_bundle_data = {
                              discount_name: el.name,
                              code: code.code,
                              bundleId: el._id,
                              discountType: isDiscount,
                              variantsId: mergedArrayResult,
                              discountCreateId: data.response,
                              prefixCode: el.settings.discountLabel,
                            };
                            var jsonString = JSON.stringify(sd_bundle_data);
                            localStorage.setItem("sd_bundle_data", jsonString);
                            cartDrawer();
                          }
                        });
                    }
                  })
                  .catch((error) => {
                    AddToCartBTN.innerText =
                      el.translations.translation.addToCartButton;
                  });
              }
            })
            .catch((error) => {
              console.error("Error:", error);
            });
        });
        AddToCartBtnDiv.append(AddToCartBTN);
        if (el?.customization?.productMixMatch?.button?.position == "bottom") {
          MixMatchDiv.append(AddToCartBtnDiv);
        } else {
          MixMatchDiv.prepend(AddToCartBtnDiv);
        }

        if (el?.plans?.plan == "free") {
          waterMark(MixMatchDiv);
        }
        mainDiv.append(MixMatchDiv)

        let plusIconHandler = (ele,index,activeBadge) =>{
          if(index ===  el.bundleDetail.discountOptions.length-1){
            if(el.bundleDetail.discountOptions[index].type === "percent"){
              activeBadge.innerText = `${ele.quantity}+ items|${ele.value}% ${el.translations.translation.off}`;
            }
            if(el.bundleDetail.discountOptions[index].type === "fixed"){
              activeBadge.innerText = `${ele.quantity}+ items|-${showAmountWithCurrency(ele.value)} ${el.translations.translation.off}`;
            }
            if(el.bundleDetail.discountOptions[index].type === "freeShipping"){
              activeBadge.innerText = `${ele.quantity}+ items|${el.translations.translation.FreeShipping}`;
            }
            if(el.bundleDetail.discountOptions[index].type === "noDiscount"){
              activeBadge.innerText = `${ele.quantity}+ items|${el.translations.translation.off}`;
            }
          }
        }

        el.bundleDetail.discountOptions.map((ele,index)=>{
          let getDiscountTextDiv = document.getElementById(`${bundleIndex}discountOffer`)
          let activeBadge = document.getElementById(`DiscountBadge${bundleIndex}${index}`);
          let addToCartBTN = document.getElementById(`sd-bundle-add-to-cart-buttonID${bundleIndex}`);
          let PriceDiv = document.getElementById(`${bundleIndex}OriginalPrice`);
          plusIconHandler(ele,index,activeBadge)
          if(el.bundleDetail.discountOptions[index].type === "percent"){
            if((ele.quantity == SelectedProductsQuantity)  || (index === el.bundleDetail.discountOptions.length-1 && SelectedProductsQuantity >= ele.quantity)) {
              getDiscountTextDiv.innerText = `${ele.value}% ${el.translations.translation.discountIsApplied}.`;
              activeBadge.className = "active";
              addToCartBTN.disabled = false;
              addToCartBTN.style.cursor = "pointer";
              addToCartBTN.style.background = `${el?.customization?.productMixMatch?.button?.backgroundColor}`
            }
          }
          if(el.bundleDetail.discountOptions[index].type === "fixed"){
            if((ele.quantity == SelectedProductsQuantity)  || (index === el.bundleDetail.discountOptions.length-1 && SelectedProductsQuantity >= ele.quantity)) {
              getDiscountTextDiv.innerText = `-${showAmountWithCurrency(ele.value)} ${el.translations.translation.discountIsApplied}.`;
              activeBadge.className = "active";
              addToCartBTN.disabled = false;
              addToCartBTN.style.cursor = "pointer";
              addToCartBTN.style.background = `${el?.customization?.productMixMatch?.button?.backgroundColor}`
            }
          }
          if(el.bundleDetail.discountOptions[index].type === "noDiscount"){
            if((ele.quantity == SelectedProductsQuantity)  || (index === el.bundleDetail.discountOptions.length-1 && SelectedProductsQuantity >= ele.quantity)) {
              getDiscountTextDiv.innerText = `${el?.translations?.translation?.discountIsApplied}.`;
              activeBadge.className = "active";
              PriceDiv.style.display = "none";
              addToCartBTN.disabled = false;
              addToCartBTN.style.cursor = "pointer";
              addToCartBTN.style.background = `${el?.customization?.productMixMatch?.button?.backgroundColor}`
            }
          }
          if(el.bundleDetail.discountOptions[index].type === "freeShipping"){
            if((ele.quantity == SelectedProductsQuantity)  || (index === el.bundleDetail.discountOptions.length-1 && SelectedProductsQuantity >= ele.quantity)) {
              getDiscountTextDiv.innerText = `100% ${el?.translations.translation?.FreeShipping} ${el.translations.translation.discountIsApplied}.`;
              activeBadge.className = "active";
              PriceDiv.style.display = "none";
              addToCartBTN.disabled = false;
              addToCartBTN.style.cursor = "pointer";
              addToCartBTN.style.background = `${el.customization?.productMixMatch?.button?.backgroundColor}`
            }
          }
        })
      }
    }
    else if (el.type == "bxgy") {
      if(el.plans.plan == "standard"){
        let XproductsPriceArray = [];
        let YproductsPriceArray = [];
        let OriginalPrice = 0;
        let FinalPrice = 0;
        
        let BXGY_DIV = document.createElement("div");
        BXGY_DIV.className = "sd-bundle-main-column";
        BXGY_DIV.style.borderRadius = `${el?.customization?.buyXgetY?.box?.borderRadius}px`;
        BXGY_DIV.style.borderColor = el?.customization?.buyXgetY?.box?.borderColor;
        BXGY_DIV.style.background = el?.customization?.buyXgetY?.box?.backgroundColor;
        BXGY_DIV.id = `BXGY_DIV${bundleIndex}`;
        mainDiv.append(BXGY_DIV);

        let Desc_Title_text_Div = document.createElement("div");
        Desc_Title_text_Div.className = "sd-bundle-text-detail";
        BXGY_DIV.append(Desc_Title_text_Div);

        let BXGY_TITLE_DIV = document.createElement("h4");
        BXGY_TITLE_DIV.style.color = el?.customization?.buyXgetY?.title?.color;
        BXGY_TITLE_DIV.style.textAlign = el?.customization?.buyXgetY?.title?.alignment;
        BXGY_TITLE_DIV.style.fontSize = `${el?.customization?.buyXgetY?.title?.fontSize}px`;
        BXGY_TITLE_DIV.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
        BXGY_TITLE_DIV.style.fontWeight = el?.customization?.buyXgetY?.title?.titleBold;
        BXGY_TITLE_DIV.innerText = el?.title;
        Desc_Title_text_Div.append(BXGY_TITLE_DIV);

        let BXGY_DESCRIPTION_DIV = document.createElement("p");
        BXGY_DESCRIPTION_DIV.style.color = el?.customization?.buyXgetY?.title?.descriptionColor;
        BXGY_DESCRIPTION_DIV.style.textAlign = el?.customization?.buyXgetY?.title?.alignment;
        BXGY_DESCRIPTION_DIV.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
        BXGY_DESCRIPTION_DIV.style.fontSize = `${el?.customization?.buyXgetY?.title?.descriptionFontSize}px`;
        BXGY_DESCRIPTION_DIV.style.fontWeight = el?.customization?.buyXgetY?.title?.descriptionBold;
        BXGY_DESCRIPTION_DIV.innerText = el.description;
        Desc_Title_text_Div.append(BXGY_DESCRIPTION_DIV);

        el.bundleDetail.xproducts.map((Xitems,Xindex)=>{
          let MAIN_BUY_PRODUCT_NAME_IMAGE_DIV = document.createElement("div");
          MAIN_BUY_PRODUCT_NAME_IMAGE_DIV.className = "sd-bundle-product-detail";
          MAIN_BUY_PRODUCT_NAME_IMAGE_DIV.style.backgroundColor = el?.customization?.buyXgetY?.productDetails?.productDetailsBox?.backgroundColor;
          BXGY_DIV.append(MAIN_BUY_PRODUCT_NAME_IMAGE_DIV);

          let Inner_X_Div = document.createElement("div");
          Inner_X_Div.className =  "sd-bundle-product-inner";
          MAIN_BUY_PRODUCT_NAME_IMAGE_DIV.append(Inner_X_Div);
          
          let BUY_PRODUCT_IMAGE_DIV = document.createElement("div");
          BUY_PRODUCT_IMAGE_DIV.className = "sd-bundle-product-img";
          BUY_PRODUCT_IMAGE_DIV.id = `BUY_PRODUCT_IMAGE_DIV${bundleIndex}${Xindex}`;
          BUY_PRODUCT_IMAGE_DIV.style.border = "2px solid black";
          BUY_PRODUCT_IMAGE_DIV.style.borderColor = el?.customization?.buyXgetY?.productDetails?.image?.borderColor;
          BUY_PRODUCT_IMAGE_DIV.style.borderRadius = `${el?.customization?.buyXgetY?.productDetails?.image?.borderRadius}px`;
          Inner_X_Div.append(BUY_PRODUCT_IMAGE_DIV);

          let BUY_PRODUCTS_IMAGE = document.createElement("img");
          BUY_PRODUCTS_IMAGE.src = `${Xitems?.images[0]?.originalSrc}`;
          BUY_PRODUCT_IMAGE_DIV.append(BUY_PRODUCTS_IMAGE);

          let BUY_PRODUCTS_NAME_PRICE_DIV = document.createElement("div");
          BUY_PRODUCTS_NAME_PRICE_DIV.className = "sd-bundle-product-name";
          Inner_X_Div.append(BUY_PRODUCTS_NAME_PRICE_DIV);

          let BUY_PRODUCTS_NAME = document.createElement("h5");
          BUY_PRODUCTS_NAME.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
          BUY_PRODUCTS_NAME.style.fontSize = `${el?.customization?.buyXgetY?.productDetails?.title?.fontSize}px`;
          BUY_PRODUCTS_NAME.style.color = el?.customization?.buyXgetY?.productDetails?.title?.color;
          BUY_PRODUCTS_NAME.innerText = Xitems.title;
          BUY_PRODUCTS_NAME_PRICE_DIV.append(BUY_PRODUCTS_NAME);

          let BUY_PRODUCTS_PRICE = document.createElement("h4");
          BUY_PRODUCTS_PRICE.id = `XproductsPriceDiv${Xindex}`;
          BUY_PRODUCTS_PRICE.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
          BUY_PRODUCTS_PRICE.style.fontSize = `${el?.customization?.buyXgetY?.productDetails?.price?.fontSize}px`;
          BUY_PRODUCTS_PRICE.style.color = el?.customization?.buyXgetY?.productDetails?.price?.color;
          BUY_PRODUCTS_PRICE.innerText = showAmountWithCurrency(`${Xitems?.variants[0]?.price}`);
          BUY_PRODUCTS_NAME_PRICE_DIV.append(BUY_PRODUCTS_PRICE);

          if(Xitems.minimumOrder>1){
            let QuantityCounterDiv = document.createElement("div");
            QuantityCounterDiv.className = "sd-bundle-mix-match-quantity-counter-div";
            QuantityCounterDiv.id = `QuantityCounter${bundleIndex}${Xindex}`;
            QuantityCounterDiv.style.borderColor = el?.customization?.buyXgetY?.productDetails?.quantities?.borderColor;
            QuantityCounterDiv.style.background = el?.customization?.buyXgetY?.productDetails?.quantities?.backgroundColor;
            QuantityCounterDiv.style.color = el?.customization?.buyXgetY?.productDetails?.quantities?.color;
            QuantityCounterDiv.innerText = `${Xitems.minimumOrder}X`;
            Inner_X_Div.append(QuantityCounterDiv);
          }
          
          Array.from({ length: Xitems.minimumOrder }).map((_, i) => {
            XproductsPriceArray.push({
              price:`${Xitems.variants[0].price}`,
              xProductId:`${Xitems.variants[0].id}`,
              uniqueId: `Xproduct${Xindex}${i}`,
            })
            calaculateOriginalPrice();
            CalculateFinalPrice();
            if (Xitems.variants.length > 1) {
              let BUY_PRODUCTS_SELECT_VARIANT = document.createElement("SELECT");
              BUY_PRODUCTS_SELECT_VARIANT.style.width = el?.customization?.buyXgetY?.productDetails?.variantSelector?.width+"px";
              BUY_PRODUCTS_SELECT_VARIANT.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
              BUY_PRODUCTS_SELECT_VARIANT.style.color = el?.customization?.buyXgetY?.productDetails?.variantSelector?.color;
              BUY_PRODUCTS_SELECT_VARIANT.style.background = el?.customization?.buyXgetY?.productDetails?.variantSelector?.backgroundColor;
              BUY_PRODUCTS_SELECT_VARIANT.id = `XvariantsSelect${Xindex}${i + 1}`;
              BUY_PRODUCTS_NAME_PRICE_DIV.appendChild(BUY_PRODUCTS_SELECT_VARIANT);
          
              let optionsHTML = Xitems.variants.map((Xvariants, XvariantsIndex) => `
                <option value="${Xvariants.id}" id="Xvariants${Xindex}${i + 1}${XvariantsIndex}" price="${Xvariants.price}">
                  ${Xvariants.title}
                </option>
              `).join('');
          
              BUY_PRODUCTS_SELECT_VARIANT.innerHTML = optionsHTML;
          
              BUY_PRODUCTS_SELECT_VARIANT.addEventListener("change", (e) => {
                let selectedOption = e.target.options[e.target.selectedIndex];
                let selectedVariantPrice = selectedOption.getAttribute("price");
                let selectedVariantID = selectedOption.getAttribute("value");
    
                let XproductsPriceArrayIndex = XproductsPriceArray.findIndex((checkProduct)=>checkProduct.uniqueId === `Xproduct${Xindex}${i}`);
                XproductsPriceArray.splice(XproductsPriceArrayIndex,1,{price:selectedVariantPrice,xProductId:selectedVariantID,uniqueId: `Xproduct${Xindex}${i}`});
                document.getElementById(`XproductsPriceDiv${Xindex}`).innerText = showAmountWithCurrency(selectedVariantPrice);
                let originalPrice = calaculateOriginalPrice();
                let finalPrice = CalculateFinalPrice();
                document.getElementById("sd-bxgy-original-price").innerText = showAmountWithCurrency(parseFloat(originalPrice).toFixed(2));
                document.getElementById("sd-bxgy-final-price").innerText = showAmountWithCurrency(parseFloat(finalPrice).toFixed(2));
              });
            }
          });
          let Quantity_Div = document.createElement("div");
          Quantity_Div.className = "sd-bundle-product-quantity";
          MAIN_BUY_PRODUCT_NAME_IMAGE_DIV.append(Quantity_Div);
          
          let Quantity_Text = document.createElement("h6")
          Quantity_Text.style.fontSize = el?.customization?.buyXgetY?.productDetails?.quantities?.size+"px";
          Quantity_Text.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
          Quantity_Text.style.color = el?.customization?.buyXgetY?.productDetails?.quantities?.color;
          Quantity_Text.innerText = `Qty: ${Xitems.minimumOrder}`;
          Quantity_Div.append(Quantity_Text);
        });

        let BUNDLE_PLUS_BTN_DIV = document.createElement("div");
        BUNDLE_PLUS_BTN_DIV.className = "sd-add-bundle";
        BUNDLE_PLUS_BTN_DIV.innerHTML = `<svg viewBox="0 0 18 18" focusable="false" width="18" height="18" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
          <path d="M6.98047 17.3842V0.580255H10.3239V17.3842H6.98047ZM0.256392 10.6477V7.30433H17.0604V10.6477H0.256392Z" fill= ${
            el?.customization?.buyXgetY?.productDetails?.plusColor
          }></path>
        </svg>`;
        BXGY_DIV.append(BUNDLE_PLUS_BTN_DIV);

        //.............................Get Products code............................................................
        el.bundleDetail.yproducts.map((Yitems,Yindex)=>{
          let MAIN_GET_PRODUCT_NAME_IMAGE_DIV = document.createElement("div");
          MAIN_GET_PRODUCT_NAME_IMAGE_DIV.className = "sd-bundle-product-detail"
          MAIN_GET_PRODUCT_NAME_IMAGE_DIV.style.backgroundColor = el?.customization?.buyXgetY?.productDetails?.productDetailsBox?.backgroundColor;
          BXGY_DIV.append(MAIN_GET_PRODUCT_NAME_IMAGE_DIV);

        let DISCOUNT_BADGE_DIV = document.createElement("div");
        if(el?.customization?.buyXgetY?.DiscountBadge?.badgeType == "rightBanner"){
          DISCOUNT_BADGE_DIV.className = "sd-bundle-product-badge";
          DISCOUNT_BADGE_DIV.innerHTML = `<svg
                    width="91"
                    height="24"
                    viewBox="0 0 91 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M0 10L8.63148 0H83.3261L91 10H0Z"
                      fill= ${
                        el?.customization?.buyXgetY?.DiscountBadge
                          ?.backgroundColor
                      }
                    />
                    <path
                      d="M9 0H83V19C83 21.7614 80.7614 24 78 24H14C11.2386 24 9 21.7614 9 19V0Z"
                      fill= ${
                        el?.customization?.buyXgetY?.DiscountBadge
                          ?.backgroundColor
                      }
                    />
                  </svg>`
                  let Badge_Text = document.createElement("h4");
                  Badge_Text.className = "heading"
                  Badge_Text.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
                  if(el.bundleDetail.discountType == "percent"){
                    Badge_Text.innerText = `${el.bundleDetail.discountValue}% Off`;
                  }else if(el.bundleDetail.discountType == "fixed"){
                    Badge_Text.innerText = `${showAmountWithCurrency(el.bundleDetail.discountValue)} Off`;
                  }else{
                    Badge_Text.innerText = `Free`;
                  }
                  DISCOUNT_BADGE_DIV.append(Badge_Text);
                  Badge_Text.style.color = el?.customization?.buyXgetY?.DiscountBadge?.color;
                  Badge_Text.style.fontSize = `${el?.customization?.buyXgetY?.DiscountBadge?.fontSize}px`;
        } else{
          DISCOUNT_BADGE_DIV.className = "sd-bundle-product-badge left-badge";
          let DISCOUNT_BADGE_Internal_DIV = document.createElement("div");
          DISCOUNT_BADGE_Internal_DIV.className = "open-badge";
          DISCOUNT_BADGE_Internal_DIV.style.background = el?.customization?.buyXgetY?.DiscountBadge?.backgroundColor;
          DISCOUNT_BADGE_DIV.append(DISCOUNT_BADGE_Internal_DIV);
          let Badge_Text = document.createElement("h4");
          Badge_Text.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
          if(el.bundleDetail.discountType == "percent"){
            Badge_Text.innerText = `${el.bundleDetail.discountValue}% Off`;
          }else if(el.bundleDetail.discountType == "fixed"){
            Badge_Text.innerText = `${showAmountWithCurrency(el.bundleDetail.discountValue)} Off`;
          }else{
            Badge_Text.innerText = `Free`;
          }
          DISCOUNT_BADGE_Internal_DIV.append(Badge_Text);
          Badge_Text.style.color = el?.customization?.buyXgetY?.DiscountBadge?.color;
          Badge_Text.style.fontSize = `${el?.customization?.buyXgetY?.DiscountBadge?.fontSize}px`;
        }
         
          MAIN_GET_PRODUCT_NAME_IMAGE_DIV.append(DISCOUNT_BADGE_DIV);
          
          let Inner_Y_Div = document.createElement("div");
          Inner_Y_Div.className = "sd-bundle-product-inner";
          MAIN_GET_PRODUCT_NAME_IMAGE_DIV.append(Inner_Y_Div);
          
          let GET_PRODUCT_IMAGE_DIV = document.createElement("div");
          GET_PRODUCT_IMAGE_DIV.className = "sd-bundle-product-img";
          GET_PRODUCT_IMAGE_DIV.style.border = "2px solid black";
          GET_PRODUCT_IMAGE_DIV.style.borderColor = el?.customization?.buyXgetY?.productDetails?.image?.borderColor;
          GET_PRODUCT_IMAGE_DIV.style.borderRadius = `${el?.customization?.buyXgetY?.productDetails?.image?.borderRadius}px`;
          GET_PRODUCT_IMAGE_DIV.id = `GET_PRODUCT_IMAGE_DIV${bundleIndex}${Yindex}`;
          Inner_Y_Div.append(GET_PRODUCT_IMAGE_DIV);

          let GET_PRODUCTS_IMAGE = document.createElement("img");
          GET_PRODUCTS_IMAGE.src = `${Yitems?.images[0]?.originalSrc}`;
          GET_PRODUCT_IMAGE_DIV.append(GET_PRODUCTS_IMAGE);

          let GET_PRODUCTS_NAME_PRICE_DIV = document.createElement("div");
          GET_PRODUCTS_NAME_PRICE_DIV.className = "sd-bundle-product-name";
          Inner_Y_Div.append(GET_PRODUCTS_NAME_PRICE_DIV);

          let GET_PRODUCTS_NAME = document.createElement("h5");
          GET_PRODUCTS_NAME.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
          GET_PRODUCTS_NAME.style.fontSize = `${el?.customization?.buyXgetY?.productDetails?.title?.fontSize}px`;
          GET_PRODUCTS_NAME.style.color = el?.customization?.buyXgetY?.productDetails?.title?.color;
          GET_PRODUCTS_NAME.innerText = Yitems.title;
          GET_PRODUCTS_NAME_PRICE_DIV.append(GET_PRODUCTS_NAME);

          let GET_PRODUCTS_PRICE = document.createElement("h4");
          GET_PRODUCTS_PRICE.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
          GET_PRODUCTS_PRICE.id = `YproductsPriceDiv${Yindex}`;
          GET_PRODUCTS_PRICE.style.fontSize = `${el?.customization?.buyXgetY?.productDetails?.price?.fontSize}px`;
          GET_PRODUCTS_PRICE.style.color = el?.customization?.buyXgetY?.productDetails?.price?.color;
          GET_PRODUCTS_PRICE.innerText = showAmountWithCurrency(`${Yitems?.variants[0]?.price}`);
          GET_PRODUCTS_NAME_PRICE_DIV.append(GET_PRODUCTS_PRICE);

          if(Yitems.minimumOrder>1){
            let QuantityCounterDiv = document.createElement("div");
            QuantityCounterDiv.className = "sd-bundle-mix-match-quantity-counter-div";
            QuantityCounterDiv.id = `QuantityCounter${bundleIndex}${Yindex}`;
            QuantityCounterDiv.style.borderColor = el?.customization?.buyXgetY?.productDetails?.quantities?.borderColor;
            QuantityCounterDiv.style.background = el?.customization?.buyXgetY?.productDetails?.quantities?.backgroundColor;
            QuantityCounterDiv.style.color = el?.customization?.buyXgetY?.productDetails?.quantities?.color;
            QuantityCounterDiv.innerText = `${Yitems.minimumOrder}X`;
            Inner_Y_Div.append(QuantityCounterDiv);
          }
          
          Array.from({ length: Yitems.minimumOrder }).map((_, i) => {
            YproductsPriceArray.push({
              price:`${Yitems.variants[0].price}`,
              yProductId:`${Yitems.variants[0].id}`,
              uniqueId: `Yproduct${Yindex}${i}`
            })
            calaculateOriginalPrice();
            CalculateFinalPrice();
            if (Yitems.variants.length > 1) {
              let GET_PRODUCTS_SELECT_VARIANT = document.createElement("SELECT");
              GET_PRODUCTS_SELECT_VARIANT.style.width = el?.customization?.buyXgetY?.productDetails?.variantSelector?.width+"px";
              GET_PRODUCTS_SELECT_VARIANT.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
              GET_PRODUCTS_SELECT_VARIANT.style.background = el?.customization?.buyXgetY?.productDetails?.variantSelector?.backgroundColor;
              GET_PRODUCTS_SELECT_VARIANT.style.color = el?.customization?.buyXgetY?.productDetails?.variantSelector?.color;
              GET_PRODUCTS_SELECT_VARIANT.id = `YvariantsSelect${Yindex}${i + 1}`;
              GET_PRODUCTS_NAME_PRICE_DIV.appendChild(GET_PRODUCTS_SELECT_VARIANT);
          
              let optionsHTML = Yitems.variants.map((Yvariants, YvariantsIndex) => `
                <option value="${Yvariants.id}" id="Yvariants${Yindex}${i + 1}${YvariantsIndex}" price="${Yvariants.price}">
                  ${Yvariants.title}
                </option>
              `).join('');
          
              GET_PRODUCTS_SELECT_VARIANT.innerHTML = optionsHTML;
          
              GET_PRODUCTS_SELECT_VARIANT.addEventListener("change", (e) => {
                let selectedOption = e.target.options[e.target.selectedIndex];
                let selectedVariantPrice = selectedOption.getAttribute("price");
                let selectedVariantID = selectedOption.getAttribute("value");
    
                let YproductsPriceArrayIndex = YproductsPriceArray.findIndex((checkProduct)=>checkProduct.uniqueId === `Yproduct${Yindex}${i}`);
                YproductsPriceArray.splice(YproductsPriceArrayIndex,1,{price:selectedVariantPrice,yProductId:selectedVariantID,uniqueId: `Yproduct${Yindex}${i}`});
                document.getElementById(`YproductsPriceDiv${Yindex}`).innerText = showAmountWithCurrency(selectedVariantPrice);
                let originalPrice = calaculateOriginalPrice();
                let finalPrice = CalculateFinalPrice();
                document.getElementById("sd-bxgy-original-price").innerText = showAmountWithCurrency(parseFloat(originalPrice).toFixed(2));
                document.getElementById("sd-bxgy-final-price").innerText = showAmountWithCurrency(parseFloat(finalPrice).toFixed(2));
              });
            }
          });
          let Quantity_Div = document.createElement("div");
          Quantity_Div.className = "sd-bundle-product-quantity";
          MAIN_GET_PRODUCT_NAME_IMAGE_DIV.append(Quantity_Div);
          
          let Quantity_Text = document.createElement("h6");
          Quantity_Text.style.fontSize = el?.customization?.buyXgetY?.productDetails?.quantities?.size+"px";
          Quantity_Text.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
          Quantity_Text.style.color = el?.customization?.buyXgetY?.productDetails?.quantities?.color;
          Quantity_Text.innerText = `Qty: ${Yitems.minimumOrder}`;
          Quantity_Div.append(Quantity_Text);
        });

        let TOTAL_SECTION_DIV = document.createElement("div");
        TOTAL_SECTION_DIV.className = "sd-product-bundle-total";
        BXGY_DIV.append(TOTAL_SECTION_DIV);

        let Total_Desc_Div = document.createElement("div");
        Total_Desc_Div.className = "sd-total-desc";
        TOTAL_SECTION_DIV.append(Total_Desc_Div);
        
        let TOTAL_TITLE_DIV = document.createElement("h4");
        TOTAL_TITLE_DIV.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
        TOTAL_TITLE_DIV.innerText = el?.translations?.translation?.total;
        TOTAL_TITLE_DIV.style.fontSize = `${el?.customization?.buyXgetY?.totalSection?.fontSize}px`;
        TOTAL_TITLE_DIV.style.color = el?.customization?.buyXgetY?.totalSection?.color;
        Total_Desc_Div.append(TOTAL_TITLE_DIV);

         if (
          el.bundleDetail.discountType == "freeShipping" ||
          el.bundleDetail.discountType == "noDiscount"
        ) {
          // no changes
        } else {
          let Discount_Description = document.createElement("p");
          Discount_Description.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
          Discount_Description.style.color = el?.customization?.buyXgetY?.totalSection?.discountMessage?.color;
           Discount_Description.style.fontSize = el?.customization?.buyXgetY?.totalSection?.discountMessage?.size+"px";
          Discount_Description.innerText = el?.translations?.translation?.discountApplied;
          Total_Desc_Div.append(Discount_Description);
         }

        let MAIN_PRICE_DIV = document.createElement("div");
        MAIN_PRICE_DIV.className = "sd-total-amount";
        TOTAL_SECTION_DIV.append(MAIN_PRICE_DIV);

        let ORIGINAL_PRICE_DIV = document.createElement("h6");
        ORIGINAL_PRICE_DIV.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
        ORIGINAL_PRICE_DIV.id = "sd-bxgy-original-price";
        ORIGINAL_PRICE_DIV.innerText = showAmountWithCurrency(parseFloat(OriginalPrice).toFixed(2));
        ORIGINAL_PRICE_DIV.style.fontSize = `${el?.customization?.buyXgetY?.totalSection?.originalPrice?.fontSize}px`;
        ORIGINAL_PRICE_DIV.style.color = el?.customization?.buyXgetY?.totalSection?.originalPrice?.color;

        let FINAL_PRICE_DIV = document.createElement("h4");
        FINAL_PRICE_DIV.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
        FINAL_PRICE_DIV.id = "sd-bxgy-final-price";
        FINAL_PRICE_DIV.innerText = showAmountWithCurrency(parseFloat(FinalPrice).toFixed(2));
        FINAL_PRICE_DIV.style.fontSize = `${el?.customization?.buyXgetY?.totalSection?.finalPrice?.fontSize}px`;
        FINAL_PRICE_DIV.style.color = el?.customization?.buyXgetY?.totalSection?.finalPrice?.color;
        MAIN_PRICE_DIV.append(FINAL_PRICE_DIV);
        MAIN_PRICE_DIV.append(ORIGINAL_PRICE_DIV);

        let ADD_TO_CART_DIV = document.createElement("div");
        ADD_TO_CART_DIV.className = "sd-bundle-addto-cart";
        BXGY_DIV.append(ADD_TO_CART_DIV);

        let ADD_TO_CART_BUTTON = document.createElement("button");
        ADD_TO_CART_BUTTON.style.borderColor = el?.customization?.buyXgetY?.button?.borderColor;
        ADD_TO_CART_BUTTON.style.borderRadius = el?.customization?.buyXgetY?.button?.borderRadius+"px";
        ADD_TO_CART_BUTTON.style.fontFamily = el?.customization?.buyXgetY?.box?.fontFamily;
        ADD_TO_CART_BUTTON.style.background = el?.customization?.buyXgetY?.button?.backgroundColor;
        ADD_TO_CART_BUTTON.style.fontSize = `${el?.customization?.buyXgetY?.button?.fontSize}px`;
        ADD_TO_CART_BUTTON.style.color = el?.customization?.buyXgetY?.button?.color;
        ADD_TO_CART_BUTTON.innerText = el?.translations?.translation?.addToCartButton;
        ADD_TO_CART_BUTTON.addEventListener("click", (e) => {
            let code = JSON.parse(localStorage.getItem("sd_bundle_data"));
            let discountCodeId = code.discountCreateId ?? "";
            ADD_TO_CART_BUTTON.innerText = "";
            let btnSpinner = document.createElement("div");
            btnSpinner.className = "bundleBtnSpinner";
            ADD_TO_CART_BUTTON.append(btnSpinner);

            btnSpinner.style.display = "block";         
            
            const XmergedGidArray = [];
            const YmergedGidArray = [];
            
            XproductsPriceArray.map((items)=>{
              XmergedGidArray.push(items.xProductId);
            })
            YproductsPriceArray.map((items)=>{
              YmergedGidArray.push(items.yProductId);
              bundleSum[bundleIndex].push(items.price);
            })
          let lengthOfYProducts = YmergedGidArray.length
            let XYmergedArray =  XmergedGidArray.concat(YmergedGidArray);
            const mergedResult = {};
    
          XYmergedArray.forEach(fullId => {
            const numericId = fullId.split('/').pop();
            if (mergedResult[numericId]) {
                mergedResult[numericId]++;
            } else {
                mergedResult[numericId] = 1;
            }
          });
        
          const result = Object.keys(mergedResult).map(numericId => ({
            id: numericId,
            quantity: mergedResult[numericId]
          }));
            let mergedArrayResult = Object.values(result);
            let formData = {
              items: mergedArrayResult,
              attributes: { SD_BUNDLE_ID: el._id },
            };
            fetch(window.Shopify.routes.root + "cart/add.js", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(formData),
            })
              .then((response) => {
                return response.json();
              })
              .then((response) => {
                let errorDiv = document.getElementsByClassName(
                  "sd-bundle-error-message"
                );
                errorDiv[0]?.remove();
                if (response.status == 422 || response.status == 404) {
                  ADD_TO_CART_BUTTON.innerText =
                    el.translations.translation.addToCartButton;
                  btnSpinner.remove();
                  let errorMessage = document.createElement("div");
                  errorMessage.className = "sd-bundle-error-message";
                  BXGY_DIV.append(errorMessage);
                  errorMessage.innerText = response.description;
                } else {
                  fetch(window.Shopify.routes.root + "cart.js", {
                    method: "GET",
                    headers: {
                      "Content-Type": "application/json",
                    },
                  })
                    .then((response) => {
                      return response.json();
                    })
                    .then((response) => {
                        let finalSumBundle = bundleSum[bundleIndex].reduce(
                          (acc, curr) => acc.concat(curr),
                          []
                        );
                        let myArray = finalSumBundle.map(parseFloat);
                        let total = myArray.reduce(
                          (accumulator, currentValue) =>
                            accumulator + currentValue,
                          0
                        );

                        let totalPrice = Number(total.toFixed(2));
                        let finalPrice;
                        switch (el.bundleDetail.discountType) {
                          case "percent":
                            let percentagepart = parseFloat(
                              el.bundleDetail.discountValue
                            );
                            let percentage = (totalPrice * percentagepart) / 100;
                            finalPrice = percentage.toFixed(2)/lengthOfYProducts;
                            break;
                          case "free":
                            finalPrice = totalPrice.toFixed(2);
                            break;
                          case "fixed":
                            let fixedPart = parseFloat(
                              el.bundleDetail.discountValue
                            );
                            finalPrice = fixedPart.toFixed(2);
                            break;
                          default:
                            break;
                        }

                        let isDiscount = "Fix";
                        let sd_bundle_data = {
                          discount_name: el.name,
                          code: `${el.settings.discountLabel}-${code.code}`,
                          discountType: isDiscount,
                          discountValue: finalPrice,
                          XvariantsId: XmergedGidArray,
                          YvariantsId: YmergedGidArray,
                          startDate: new Date(),
                          endDate: el.endDate,
                          shop: Shopify.shop,
                          type : el.type,
                          bundleType: el.bundleDetail.discountType,
                          totalPrice: total.toFixed(2),
                          discountCreateId: discountCodeId,
                        };

                        fetch(server + "/api/storefront/createRule", {
                          method: "POST",
                          headers: {
                            "Content-Type": "application/json",
                          },
                          body: JSON.stringify(sd_bundle_data),
                        })
                          .then((response) => response.json())
                          .then((data) => {
                            if (data.status == 200) {
                              fetch(`${server}/api/storefront/getBundleClick`, {
                                method: "POST",
                                headers: {
                                  "Content-Type": "application/json",
                                },
                                body: JSON.stringify({
                                  shop: Shopify.shop,
                                  bundleId: el._id,
                                }),
                              });
                              
                              let sd_bundle_data = {
                                discount_name: el.name,
                                bundle_type: el.type,
                                code: code.code,
                                bundleId: el._id,
                                discountType: isDiscount,
                                variantsId: mergedArrayResult,
                                discountCreateId: data.response,
                                prefixCode: el.settings.discountLabel,
                              };
                              var jsonString = JSON.stringify(sd_bundle_data);
                              localStorage.setItem("sd_bundle_data", jsonString);
                              ADD_TO_CART_BUTTON.innerText =
                              el.translations.translation.addToCartButton;
                              btnSpinner.remove();
                              cartDrawer();
                            }
                          });
                    })
                    .catch((error) => {
                      ADD_TO_CART_BUTTON.innerText =
                        el.translations.translation.addToCartButton;
                    });
                }
              })
              .catch((error) => {
                console.error("Error:", error);
              });
          })
        ADD_TO_CART_DIV.append(ADD_TO_CART_BUTTON);

        function calaculateOriginalPrice(){
          let XproductsPrice = XproductPriceCalculate();
          let YproductsPrice = YproductPriceCalculate();
          OriginalPrice = XproductsPrice + YproductsPrice;
          return parseFloat(OriginalPrice).toFixed(2);
        }

        function XproductPriceCalculate() {
          let XproductsPrice = 0;
          XproductsPriceArray.map((item)=>{
            XproductsPrice += parseFloat(item.price);
          })
          return XproductsPrice;
        }

        function YproductPriceCalculate(params) {
          let YproductsPrice = 0;
          YproductsPriceArray.map((item)=>{
            YproductsPrice += parseFloat(item.price);
          })
          return YproductsPrice;
        }

        function CalculateFinalPrice() {
          let XproductsPrice = XproductPriceCalculate();
          let YproductsPrice = YproductPriceCalculate();

          if(el.bundleDetail.discountType == "fixed"){
            YproductsPrice = YproductsPrice-el.bundleDetail.discountValue*YproductsPriceArray.length;
            FinalPrice = parseFloat(XproductsPrice + YproductsPrice);
            return parseFloat(FinalPrice).toFixed(2);
            
          }else if(el.bundleDetail.discountType == "percent"){
            let percentage = YproductsPrice*el.bundleDetail.discountValue/100;
            YproductsPrice = YproductsPrice - percentage;
            FinalPrice = XproductsPrice + YproductsPrice;
            return FinalPrice;
            
          }else if(el.bundleDetail.discountType == "free"){
            FinalPrice = XproductsPrice
            return FinalPrice;
          }
        }
      
        if (el.plans.plan == "free") {
          waterMark(BXGY_DIV);
        }
      }
    }
  }); 
}
let selectedProducts = [];
let pageInfoTotalPrice;
async function bundlePageBuilder(data) {
  const url = window.location.href;

  let mainContainer = document.getElementById("sd-bundle-container");

  if (data.status == 200) {
    let pageWidth = document.getElementsByClassName("page-width--narrow")[0];
    pageWidth.style.width = "100%";
    pageWidth.style.left = "0px";
    pageWidth.style.marginRight = "0px";
    pageWidth.style.marginLeft = "0px";
    pageWidth.style.maxWidth = "100%";
    pageWidth.style.paddingLeft = "unset";
    pageWidth.style.paddingRight = "unset";
    pageWidth.style.textAlign = "center";
    let innerPageWidth = document.getElementsByClassName("rte")[0];
    innerPageWidth.style.width = "100%";
    innerPageWidth.style.left = "0px";
    innerPageWidth.style.marginRight = "0px";
    innerPageWidth.style.marginLeft = "0px";
    innerPageWidth.style.maxWidth = "100%";
    innerPageWidth.style.paddingLeft = "unset";
    innerPageWidth.style.paddingRight = "unset";
    innerPageWidth.style.textAlign = "center";
    let BUNDLE = data.response;
    let mainContainer = document.getElementById("sd-bundle-container");

    let BUNDLE_BUILDER_DIV = document.createElement("div");
    mainContainer.append(BUNDLE_BUILDER_DIV);
    BUNDLE_BUILDER_DIV.className = "sd-bundle-builder-container";

    let BUNDLE_BUILDER_TITLE_DIV = document.createElement("div");
    BUNDLE_BUILDER_TITLE_DIV.className = "sd-bundle-builder-title-container";
    BUNDLE_BUILDER_DIV.append(BUNDLE_BUILDER_TITLE_DIV);
    let bundlebuilderTitle = document.createElement("div");
    bundlebuilderTitle.className = "sd-bundle-builder-title";
    BUNDLE_BUILDER_TITLE_DIV.append(bundlebuilderTitle);
    let titleText = document.createElement("span");
    titleText.className = "sd-bundle-builder-title-text";
    titleText.innerText = BUNDLE.title;
    bundlebuilderTitle.append(titleText);
    let bundleDescription = document.createElement("div");
    BUNDLE_BUILDER_TITLE_DIV.append(bundleDescription);
    bundleDescription.className = "sd-bundle-builder-description-box";
    let descriptionText = document.createElement("span");
    descriptionText.className = "sd-bundle-builder-description-text";
    if (BUNDLE.bundleDetail.description.includes("{discount}")) {
      if (BUNDLE.bundleDetail.discountType == "percent") {
        let updatedString = BUNDLE.bundleDetail.description.replace(
          "{discount}",
          BUNDLE.bundleDetail.discountValue + "%"
        );
        descriptionText.innerText = updatedString;
      } else if (
        BUNDLE.bundleDetail.discountType == "price" ||
        BUNDLE.bundleDetail.discountType == "fixed"
      ) {
        let newPrice = sdCurrencySymbolCode.replace(
          "{{amount}}",
          BUNDLE.bundleDetail.discountValue
        );
        let updatedString = BUNDLE.bundleDetail.description.replace(
          "{discount}",
          newPrice + " " + BUNDLE.translations.translation.off
        );
        descriptionText.innerText = updatedString;
      } else if (
        BUNDLE.bundleDetail.discountType == "noDiscount" ||
        BUNDLE.bundleDetail.discountType == "freeShipping"
      ) {
        descriptionText.innerText = BUNDLE.bundleDetail.description;
      }
    } else {
      descriptionText.innerText = BUNDLE.bundleDetail.description;
    }
    bundleDescription.append(descriptionText);
    let BUNDLE_DATA_DIV = document.createElement("div");
    BUNDLE_DATA_DIV.className = "sd-bundle-builder-data-container";
    BUNDLE_BUILDER_DIV.append(BUNDLE_DATA_DIV);

    BUNDLE.bundleDetail.products.forEach((el, index) => {
      selectedProducts.push([]);
      let collectionDiv = document.createElement("div");
      collectionDiv.className = "sd-bundle-builder-collection-data";
      BUNDLE_DATA_DIV.append(collectionDiv);
      let collectionDataHeader = document.createElement("div");
      collectionDataHeader.className = "sd-bundle-builder-collection-data-header";
      collectionDiv.append(collectionDataHeader);
      let arrowBtn = document.createElement("div");
      arrowBtn.className = "sd-bundle-builder-arrow";
      arrowBtn.innerHTML = `<svg width="20" height="20" viewBox="0 0 20 20" fill="#5E5E5E" xmlns="http://www.w3.org/2000/svg" style=" width: 30px; height: 30px;"><path fill-rule="evenodd" clip-rule="evenodd" d="M8.00025 16C7.74425 16 7.48825 15.902 7.29325 15.707C6.90225 15.316 6.90225 14.684 7.29325 14.293L11.5863 10L7.29325 5.70701C6.90225 5.31601 6.90225 4.68401 7.29325 4.29301C7.68425 3.90201 8.31625 3.90201 8.70725 4.29301L13.7073 9.29301C14.0983 9.68401 14.0983 10.316 13.7073 10.707L8.70725 15.707C8.51225 15.902 8.25625 16 8.00025 16Z" fill="current"></path></svg>`;
      collectionDataHeader.append(arrowBtn);

      arrowBtn.className = "sd-accordion-arrow";

      let collectionImgDiv = document.createElement("div");
      collectionImgDiv.className = "sd-bundle-builder-image-box";
      collectionDataHeader.append(collectionImgDiv);
      let collectionImg = document.createElement("img");
      collectionImg.className = "sd-bundle-builder-collection-image";
      let collectionBuilderImg = el?.image?.originalSrc ?? smartNoImg;
      collectionImg.setAttribute("src", collectionBuilderImg);
      collectionImgDiv.append(collectionImg);
      let collectionTitleDiv = document.createElement("div");
      collectionTitleDiv.className = "sd-bundle-builder-title-div";
      collectionDataHeader.append(collectionTitleDiv);
      collectionDataHeader.addEventListener("click", (e) => {
        let accordingDiv = document.getElementsByClassName(
          "sd-bundle-CMM-main-Box" + index
        );
        if (accordingDiv[0].style.maxHeight === "0px") {
          accordingDiv[0].style.maxHeight = "694px";
          arrowBtn.classList.add("sd-accordion-active");
        } else {
          accordingDiv[0].style.maxHeight = "0px";
          arrowBtn.classList.remove("sd-accordion-active");
        }
      });
      let collectionTitle = document.createElement("div");
      collectionTitle.className = "sd-bundle-builder-collection-title-text";
      collectionTitle.innerText = el.title;
      collectionTitleDiv.append(collectionTitle);
      let collectionAddItemText = document.createElement("div");
      collectionAddItemText.className = "sd-bundle-builder-additemtext";

      let TranslatedcollectionAddItemText = data.response.translations.translation.addItemToSaveMore.replace("{{item}}",el.quantity);
      collectionAddItemText.innerText = TranslatedcollectionAddItemText;
      collectionTitleDiv.append(collectionAddItemText);

      let collctionProductMainBox = document.createElement("div");
      collctionProductMainBox.className = "sd-bundle-CMM-main-Box" + index;
      collctionProductMainBox.classList.add("sd-accordion-panel");
      collctionProductMainBox.style.maxHeight = "0px";
      collectionDiv.append(collctionProductMainBox);

      let nextPageCursor = "";
      let hasNextPage = "";
      let collectionGid = el.id;

      fetch(server + "/api/storefront/getCollectionProdcuts", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          shop: Shopify.shop,
          collectionGid: collectionGid,
          nextPageCursor: nextPageCursor,
          hasNextPage: hasNextPage,
        }),
      })
        .then((res) => res.json())
        .then((response) => {
          const lastValue = response?.response?.products?.edges[response?.response?.products?.edges?.length - 1];
          nextPageCursor = lastValue?.cursor;
          hasNextPage = response?.response?.products?.pageInfo?.hasNextPage;

          let bundleDivider = document.createElement("div");
          bundleDivider.className = "sd-bundle-builder-divider";
          collctionProductMainBox.append(bundleDivider);
          let searchBarDiv = document.createElement("div");
          searchBarDiv.className = "sd-bundle-builder-search-bar-container";
          collctionProductMainBox.append(searchBarDiv);
          let searchBar = document.createElement("input");
          searchBar.className = "sd-bundle-builder-search-bar";
          searchBar.setAttribute("type", "text");
          searchBar.placeholder = "Search Products";
          searchBarDiv.append(searchBar);
          let CollectionProductDiv = document.createElement("div");
          CollectionProductDiv.className = "sd-bundle-collectionMixMatch-all-product-div";
          CollectionProductDiv.classList.add( "collectionMixMatch-allProduct-div" + index);
          collctionProductMainBox.append(CollectionProductDiv);

          let pdata = response?.response?.products;
          CollectionProductsData(pdata, CollectionProductDiv);
          let delayTimer;

          let searchSpinner = document.createElement("div");

          searchBar.addEventListener("keyup", (e) => {
            CollectionProductDiv.innerHTML = "";
            searchSpinner.className = "sd-search-spinner";
            searchSpinner.classList.add("sd-loader");
            CollectionProductDiv.append(searchSpinner);

            document.getElementsByClassName(
              "sd-builder-seemore-div" + index
            )[0].style.display = "none";

            clearTimeout(delayTimer);
            delayTimer = setTimeout(function () {
              if (e.target.value.length > 0) {
                fetch(server + "/api/storefront/searchCollectionProducts", {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify({
                    shop: Shopify.shop,
                    collectionGid: collectionGid,
                    nextPageCursor: nextPageCursor,
                    hasNextPage: hasNextPage,
                    search: e.target.value,
                  }),
                })
                  .then((res) => res.json())
                  .then((response) => {
                    CollectionProductDiv.innerHTML = "";
                    if (response.response.edges) {
                      const lastValue =
                        response?.response?.edges[
                          response.response.edges.length - 1
                        ];
                      nextPageCursor = lastValue?.cursor;
                      hasNextPage = response?.response?.pageInfo?.hasNextPage;
                    } else {
                      hasNextPage = false;
                    }
                    if (hasNextPage == false) {
                      document.getElementsByClassName(
                        "sd-builder-seemore-div" + index
                      )[0].style.display = "none";
                    } else {
                      document.getElementsByClassName(
                        "sd-builder-seemore-div" + index
                      )[0].style.display = "block";
                    }
                    let pdata = response.response;

                    CollectionProductsData(pdata, CollectionProductDiv);
                  })
                  .catch((error) => {
                    console.log(error.message);
                  });
              } else {
                fetch(server + "/api/storefront/getCollectionProdcuts", {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify({
                    shop: Shopify.shop,
                    collectionGid: collectionGid,
                    nextPageCursor: nextPageCursor,
                    hasNextPage: hasNextPage,
                  }),
                })
                  .then((res) => res.json())
                  .then((response) => {
                    CollectionProductDiv.innerHTML = "";
                    const lastValue =
                      response?.response?.products?.edges[
                        response?.response?.products?.edges?.length - 1
                      ];
                    nextPageCursor = lastValue?.cursor;
                    hasNextPage =
                      response?.response?.products?.pageInfo?.hasNextPage;
                    let pdata = response?.response?.products;
                    if (hasNextPage == false) {
                      document.getElementsByClassName(
                        "sd-builder-seemore-div" + index
                      )[0].style.display = "none";
                    } else {
                      document.getElementsByClassName(
                        "sd-builder-seemore-div" + index
                      )[0].style.display = "block";
                    }
                    CollectionProductsData(pdata, CollectionProductDiv);
                  })
                  .catch((error) => {
                    console.log(error.message);
                  });
              }
            }, 1000);
          });
          if (hasNextPage == true) {
            let seeMoreButtonDiv = document.createElement("div");
            seeMoreButtonDiv.className = "sd-bundle-CMM-see-more-div";
            seeMoreButtonDiv.classList.add("sd-builder-seemore-div" + index);
            collctionProductMainBox.append(seeMoreButtonDiv);
            let seeMoreButton = document.createElement("button");
            seeMoreButton.className = "sd-bundle-CMM-seeMore-btn";
            seeMoreButton.innerText = data.response.translations.translation.seeMore;
            seeMoreButtonDiv.append(seeMoreButton);

            seeMoreButton.addEventListener("click", (e) => {
              seeMoreButton.classList.add("sd-spinnerDiv");
              let spinnerDiv = document.createElement("div");
              seeMoreButton.innerHTML = '<div class="sd-loader"></div>';

              let formData = {
                shop: Shopify.shop,
                hasNextPage: hasNextPage,
                gid: response.response.id,
                nextPageCursor: nextPageCursor,
              };

              fetch(server + "/api/storefront/getMoreCollectionProducts", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(formData),
              })
                .then((res) => res.json())
                .then((response) => {
                  if (response.flag == 1) {
                    const sdLoader =
                      document.getElementsByClassName("sd-loader");
                    seeMoreButton.innerText =
                      data.response.translations.translation.seeMore;
                    seeMoreButton.classList.remove("sd-spinnerDiv");
                    const lastValue =
                      response?.response?.products?.edges[
                        response?.response?.products?.edges?.length - 1
                      ];
                    nextPageCursor = lastValue?.cursor;
                    hasNextPage =
                      response?.response?.products?.pageInfo?.hasNextPage;
                    if (hasNextPage == false) {
                      document.getElementsByClassName(
                        "sd-builder-seemore-div" + index
                      )[0].style.display = "none";
                    } else {
                      document.getElementsByClassName(
                        "sd-builder-seemore-div" + index
                      )[0].style.display = "block";
                    }
                    let pdata = response?.response?.products;

                    CollectionProductsData(pdata, CollectionProductDiv);
                  } else {
                    document.getElementsByClassName(
                      "sd-builder-seemore-div" + index
                    )[0].style.display = "none";
                  }
                })
                .catch((error) => {
                  console.log(error.message);
                });
            });
          } else {
              let seeMoreButtonDiv = document.createElement("div");
              seeMoreButtonDiv.className = "sd-bundle-CMM-see-more-div";
              seeMoreButtonDiv.classList.add("sd-builder-seemore-div" + index);
              collctionProductMainBox.append(seeMoreButtonDiv);
          }

          if (hasNextPage == false) {
            document.getElementsByClassName(
              "sd-builder-seemore-div" + index
            )[0].style.display = "none";
          } else if (hasNextPage == true) {
            document.getElementsByClassName(
              "sd-builder-seemore-div" + index
            )[0].style.display = "block";
          }
        })
        .catch((error) => {});

      function CollectionProductsData(response, newDiv) {
        if (response?.edges?.length) {
          response.edges.map((ele) => {
            let productDiv = document.createElement("div");
            productDiv.className = "sd-bundle-CMM-productDiv";
            newDiv.append(productDiv);
            let productImageDiv = document.createElement("div");

            productImageDiv.className = "sd-bundle-CMM-product-img-div";
            productDiv.append(productImageDiv);
            let productImg = document.createElement("img");
            productImg.className = "sd-bundle-CMM-product-img";
            productImageDiv.append(productImg);
            let builderProductImg = ele?.node?.images?.edges[0]?.node?.url ?? smartNoImg;
            productImg.setAttribute("src", builderProductImg);
            let productTitleDiv = document.createElement("div");
            productTitleDiv.className = "sd-bundle-CMM-product-title-div";
            productDiv.append(productTitleDiv);
            productTitleDiv.innerText = ele.node.title;
            let productPriceDiv = document.createElement("div");
            productPriceDiv.className = "sd-bundle-builder-product-price";

            let newProductPrice = ele.node.variants.edges[0].node.price;

            productPriceDiv.innerText = showAmountWithCurrency(newProductPrice);
            productDiv.append(productPriceDiv);

            let productButtonDiv = document.createElement("div");
            productButtonDiv.className = "sd-bundle-builder-product-btn-box";
            productDiv.append(productButtonDiv);

            if (ele.node.variants.edges.length <= 1) {
              let addProductButton = document.createElement("button");
              addProductButton.className = "sd-bundle-builder-add-product-btn";

              addProductButton.innerText = data.response.translations.translation.add;
              addProductButton.classList.add("sd-button-add");
              productButtonDiv.append(addProductButton);
              addProductButton.addEventListener("click", (e) => {
                if (
                  data.response.bundleDetail.products[index].quantity >
                  selectedProducts[index].length
                ) {
                  selectedProducts[index].push({
                    title: ele.node.title,
                    variantTitle: ele.node.variants.edges[0].node.title,
                    id: ele.node.variants.edges[0].node.id,
                    price: ele.node.variants.edges[0].node.price,
                    image: ele?.node?.images?.edges[0]?.node.url,
                  });
                  const getDiv = document.getElementById(
                    "sd-builder-info-variants-data" + index
                  );
                  getDiv.innerHTML = "";

                  addselectedProductList(selectedProducts, index, "", data);

                  const quantity = document.getElementById(
                    `sd-quantityCheck${index}`
                  );
                  quantity.innerText = selectedProducts[index].length;
                  if (
                    data.response.bundleDetail.products[index].quantity ==
                    selectedProducts[index].length
                  ) {
                    document.getElementsByClassName(
                      "sd-bundle-CMM-main-Box" + index
                    )[0].style.maxHeight = "0px";
                    arrowBtn.classList.remove("sd-accordion-active");
                  }
                }

                sumOfVariants(selectedProducts, data);
                if (
                  !checkCartButtonActive(
                    selectedProducts,
                    data.response.bundleDetail.products
                  )
                ) {
                  const getCartButton = document.getElementById(
                    "sd-builder-cart-info-add-btn"
                  );
                  getCartButton.style.background = "black";
                  getCartButton.style.color = "white";
                  getCartButton.style.cursor = "pointer";
                  getCartButton.disabled = false;
                }
              });
            } else {
              let productSelectVariant = document.createElement("select");
              productSelectVariant.className = "sd-builder-select-variants";
              productButtonDiv.append(productSelectVariant);
              let productSelectOptions = document.createElement("option");
              productSelectVariant.append(productSelectOptions);
              productSelectOptions.value = data.response.translations.translation.add;
              productSelectOptions.innerText = data.response.translations.translation.add;
              productSelectOptions.hidden = true;

              ele.node.variants.edges.map((elem, variantIndex) => {
                let productSelectOptions = document.createElement("option");
                productSelectOptions.value = elem.node.id.replace(
                  "gid://shopify/ProductVariant/",
                  ""
                );
                productSelectOptions.setAttribute("index", variantIndex);
                productSelectOptions.textContent = elem.node.title;
                productSelectVariant.appendChild(productSelectOptions);
              });
              productSelectVariant.addEventListener("change", (e) => {
                if (
                  data.response.bundleDetail.products[index].quantity >
                  selectedProducts[index].length
                ) {
                  let get_val = event.target.selectedOptions[0].getAttribute("index");
                  selectedProducts[index].push({
                    title: ele.node.title,
                    variantTitle: ele.node.variants.edges[get_val].node.title,
                    id: ele.node.variants.edges[get_val].node.id,
                    price: ele.node.variants.edges[get_val].node.price,
                    image: ele?.node?.images?.edges[0]?.node.url,
                  });
                  const getDiv = document.getElementById(
                    "sd-builder-info-variants-data" + index
                  );
                  getDiv.innerHTML = "";
                  addselectedProductList(selectedProducts, index, "", data);
                  const quantity = document.getElementById(
                    `sd-quantityCheck${index}`
                  );
                  quantity.innerText = selectedProducts[index].length;
                  sumOfVariants(selectedProducts, data);
                  if (
                    !checkCartButtonActive(
                      selectedProducts,
                      data.response.bundleDetail.products
                    )
                  ) {
                    const getCartButton = document.getElementById(
                      "sd-builder-cart-info-add-btn"
                    );
                    getCartButton.style.color = "red";
                  }
                  if (
                    data.response.bundleDetail.products[index].quantity ==
                    selectedProducts[index].length
                  ) {
                    document.getElementsByClassName(
                      "sd-bundle-CMM-main-Box" + index
                    )[0].style.maxHeight = "0px";
                  }
                  if (
                    !checkCartButtonActive(
                      selectedProducts,
                      data.response.bundleDetail.products
                    )
                  ) {
                    const getCartButton = document.getElementById(
                      "sd-builder-cart-info-add-btn"
                    );
                    getCartButton.style.background = "black";
                    getCartButton.style.color = "white";
                    getCartButton.style.cursor = "pointer";
                    getCartButton.disabled = false;
                  }
                }
              });
            }
          });
        } else {
          let emptyDiv = document.createElement("div");
          emptyDiv.className = "sd-builder-empty-conatiner";
          newDiv.append(emptyDiv);
          emptyDiv.innerText = "No products";
        }
      }
    });
  }
  let BUNDLE_BUILDER_INFO_DIV = document.createElement("div");
  BUNDLE_BUILDER_INFO_DIV.className = "sd-bundle-builder-info-container";
  mainContainer.append(BUNDLE_BUILDER_INFO_DIV);
  let INFO_DIV_ADDED_ITEM_TEXT = document.createElement("h5");
  INFO_DIV_ADDED_ITEM_TEXT.className = "sd-Info-Div-added-item-text";
  INFO_DIV_ADDED_ITEM_TEXT.innerText =
    data?.response?.translations?.translation?.addedItems;
  BUNDLE_BUILDER_INFO_DIV.append(INFO_DIV_ADDED_ITEM_TEXT);
  let CART_INFO_CART_BODY = document.createElement("div");
  CART_INFO_CART_BODY.className = "sd-Builder-Cart-Info-Body";
  BUNDLE_BUILDER_INFO_DIV.append(CART_INFO_CART_BODY);
  let CART_INFO_CART_ACCORDIONS_DIV = document.createElement("div");
  CART_INFO_CART_ACCORDIONS_DIV.className =
    "sd-builder-Cart-Products-Accordions-container";
  CART_INFO_CART_BODY.append(CART_INFO_CART_ACCORDIONS_DIV);
  data.response.bundleDetail.products.map((ele, subIndex) => {
    let productAccordionDiv = document.createElement("div");
    productAccordionDiv.className =
      "sd-builder-cart-info-product-accordion-box";
    CART_INFO_CART_ACCORDIONS_DIV.append(productAccordionDiv);
    let productAccordionHeading = document.createElement("div");
    productAccordionHeading.className = "sd-builder-accordion-header-box";
    productAccordionDiv.append(productAccordionHeading);

    let headingArrow = document.createElement("div");
    headingArrow.className = "sd-accordion-arrow";
    productAccordionHeading.append(headingArrow);

    let headerCollectionName = document.createElement("span");
    headerCollectionName.className = "Sd-builder-accordion-heading-name";
    headerCollectionName.innerText = ele.title;
    productAccordionHeading.append(headerCollectionName);
    let variantCounterDiv = document.createElement("div");
    variantCounterDiv.className = "sd-builder-variant-counter-container";
    productAccordionHeading.append(variantCounterDiv);
    let variantCounter = document.createElement("span");
    let variantCounter1 = document.createElement("span");
    variantCounter.className = "sd-builder-variant-counter";
    variantCounter1.className = "sd-builder-variant-counter";
    console.warn(data);
    variantCounter.innerText = `/${ele.quantity} ${data.response.translations.translation.added}`;
    variantCounter1.innerText = "0";
    variantCounter1.id = `sd-quantityCheck${subIndex}`;
    variantCounterDiv.append(variantCounter1);
    variantCounterDiv.append(variantCounter);
    let productPanel = document.createElement("div");
    productPanel.className = "sd-builder-product-panel";

    productAccordionDiv.append(productPanel);
    let noVariantDiv = document.createElement("div");
    noVariantDiv.id = "sd-builder-selectedProductContainer" + subIndex;
    productPanel.append(noVariantDiv);
    let innerDivContent;
    noVariantDiv.className = "sd-builder-no-Variant-container";

    innerDivContent = document.createElement("span");
    innerDivContent.className = "sd-builder-plus-icon-container";
    innerDivContent.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M20.3999 10.8004H13.1999V3.60039C13.1999 2.93799 12.6635 2.40039 11.9999 2.40039C11.3363 2.40039 10.7999 2.93799 10.7999 3.60039V10.8004H3.5999C2.9363 10.8004 2.3999 11.338 2.3999 12.0004C2.3999 12.6628 2.9363 13.2004 3.5999 13.2004H10.7999V20.4004C10.7999 21.0628 11.3363 21.6004 11.9999 21.6004C12.6635 21.6004 13.1999 21.0628 13.1999 20.4004V13.2004H20.3999C21.0635 13.2004 21.5999 12.6628 21.5999 12.0004C21.5999 11.338 21.0635 10.8004 20.3999 10.8004Z" fill="#727272"></path></svg>`;

    noVariantDiv.append(innerDivContent);
    let noVariantText = document.createElement("span");
    noVariantText.className = "sd-builder-no-variant-text";
    noVariantText.innerText = "Please add products from collections";
    noVariantDiv.append(noVariantText);
    let variantDataDiv = document.createElement("div");
    variantDataDiv.id = "sd-builder-info-variants-data" + subIndex;
    variantDataDiv.classList.add("sd-info-variants-data");
    productPanel.append(variantDataDiv);
  });
  if (data.response.bundleDetail.discountType == "freeShipping") {
    let noShippingDiv = document.createElement("div");
    noShippingDiv.className = "sd-bundle-no-shopping-container";
    CART_INFO_CART_BODY.append(noShippingDiv);
    let shippingIcon = document.createElement("span");
    shippingIcon.className = "sd-bundle-shipping-icon";
    shippingIcon.innerHTML = `<svg viewBox="0 0 1024 1024" focusable="false" data-icon="shopping-cart" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M922.9 701.9H327.4l29.9-60.9 496.8-.9c16.8 0 31.2-12 34.2-28.6l68.8-385.1c1.8-10.1-.9-20.5-7.5-28.4a34.99 34.99 0 00-26.6-12.5l-632-2.1-5.4-25.4c-3.4-16.2-18-28-34.6-28H96.5a35.3 35.3 0 100 70.6h125.9L246 312.8l58.1 281.3-74.8 122.1a34.96 34.96 0 00-3 36.8c6 11.9 18.1 19.4 31.5 19.4h62.8a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7h161.1a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7H923c19.4 0 35.3-15.8 35.3-35.3a35.42 35.42 0 00-35.4-35.2zM305.7 253l575.8 1.9-56.4 315.8-452.3.8L305.7 253zm96.9 612.7c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6zm325.1 0c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6z"></path></svg>`;
    noShippingDiv.append(shippingIcon);
    let noShippingText = document.createElement("span");
    noShippingText.className = "sd-bundle-noShipping-text";
    noShippingText.innerText = data.response.translations.translation.FreeShipping;
    noShippingDiv.append(noShippingText);
  }
  let CART_INFO_ACTION_BOX = document.createElement("div");

  CART_INFO_ACTION_BOX.className = "sd-builder-Cart-Info-Action-Box";
  CART_INFO_CART_BODY.append(CART_INFO_ACTION_BOX);
  let CART_INFO_TOTAL_DIV = document.createElement("div");
  CART_INFO_TOTAL_DIV.className = "sd-builder-total-container";
  CART_INFO_ACTION_BOX.append(CART_INFO_TOTAL_DIV);
  let totalText = document.createElement("span");
  totalText.className = "sd-builder-total-text";
  totalText.innerText = data.response.translations.translation.total;
  CART_INFO_TOTAL_DIV.append(totalText);
  let totalPriceText = document.createElement("span");
  totalPriceText.className = "sd-builder-total-ptice-container";
  CART_INFO_TOTAL_DIV.append(totalPriceText);
  let totalRawPrice = document.createElement("span");
  totalRawPrice.className = "sd-builder-total-raw-price";
  totalRawPrice.id = "sd-builder-total-raw-price";
  if (
    data.response.bundleDetail.discountType == "freeShipping" ||
    data.response.bundleDetail.discountType == "noDiscount"
  ) {
    totalRawPrice.style.textDecoration = "none";
  }
  let newTotalPrice = "0.00";

  totalRawPrice.innerText = showAmountWithCurrency(newTotalPrice);
  totalPriceText.append(totalRawPrice);
  let totalDiscountedPrice = document.createElement("span");
  totalDiscountedPrice.className = "sd-builder-total-discounted-price";
  totalDiscountedPrice.id = "sd-builder-total-discounted-price-text";
  totalDiscountedPrice.innerText = "";
  totalPriceText.append(totalDiscountedPrice);
  let CART_INFO_ADD_BTN_div = document.createElement("div");
  CART_INFO_ADD_BTN_div.ClassName = "sd-builder-add-btn-container";
  CART_INFO_ACTION_BOX.append(CART_INFO_ADD_BTN_div);
  let cartAddBtn = document.createElement("button");

  cartAddBtn.className = "sd-builder-cart-info-add-btn";
  cartAddBtn.id = "sd-builder-cart-info-add-btn";
  cartAddBtn.style.cursor = "no-drop";
  cartAddBtn.disabled = true;
  let newtPrice = sdCurrencySymbolCode.replace(
    "{{amount}}",
    data.response.bundleDetail.discountValue
  );

  let t =
    data.response.bundleDetail.discountType == "percent"
      ? data.response.bundleDetail.discountValue + "%"
      : data.response.bundleDetail.discountType == "fixed"
      ? newtPrice + " " + "Off"
      : "";

  cartAddBtn.innerText = data.response.translations.translation.addToCartButton;
  CART_INFO_ADD_BTN_div.append(cartAddBtn);

  cartAddBtn.addEventListener("click", (e) => {
    if (
      !checkCartButtonActive(
        selectedProducts,
        data.response.bundleDetail.products
      )
    ) {
      let code = JSON.parse(localStorage.getItem("sd_bundle_data"));
      let discountCodeId = code.discountCreateId ?? "";

      cartAddBtn.innerText = "";
      let BundleBuilderSpinner = document.createElement("div");
      BundleBuilderSpinner.className = "bundleBtnSpinner";
      BundleBuilderSpinner.style.display = "block";
      cartAddBtn.append(BundleBuilderSpinner);

      let idArray = [];
      let variantGid = [];
      for (const category of selectedProducts) {
        // Loop through the inner array of each category
        for (const product of category) {
          // Push the ID of each product to the idArray
          idArray.push({
            id: product.id.replace("gid://shopify/ProductVariant/", ""),
            quantity: 1,
          });
          variantGid.push(product.id);
        }
      }

      let formData = {
        items: idArray,
        attributes: { SD_BUNDLE_ID: data.response._id },
      };
      fetch(window.Shopify.routes.root + "cart/add.js", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(formData),
      })
        .then((response) => {
          return response.json();
        })
        .then((response) => {
          let errorDiv = document.getElementsByClassName(
            "sd-bundle-error-message"
          );
          errorDiv[0]?.remove();
          if (response.status == 422 || response.status == 404) {
            cartAddBtn.innerText = data.response.translations.translation.addToCartButton;
            BundleBuilderSpinner.remove();
            let errorMessage = document.createElement("div");
            errorMessage.className = "sd-bundle-error-message";
            CART_INFO_ADD_BTN_div.append(errorMessage);
            errorMessage.innerText = response.description;
          } else {
            fetch(window.Shopify.routes.root + "cart.js", {
              method: "GET",
              headers: {
                "Content-Type": "application/json",
              },
            })
              .then((response) => {
                return response.json();
              })
              .then((response) => {
                if (data.response.bundleDetail.discountType == "noDiscount") {
                  fetch(`${server}/api/storefront/getBundleClick`, {
                    method: "POST",
                    headers: {
                      "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                      shop: Shopify.shop,
                      bundleId: data.response._id,
                    }),
                  });
                  let isDiscount =
                    data.response.bundleDetail.discountType == "noDiscount"
                      ? "noDiscount"
                      : "Fix";
                  const localData = JSON.parse(
                    localStorage.getItem("sd_bundle_data")
                  );
                  let sd_bundle_data = {
                    discount_name: data.response.name,
                    code: code.code,
                    bundleId: data.response._id,
                    discountType: isDiscount,
                    variantsId: idArray,
                    discountCreateId: localData.discountCreateId,
                    prefixCode: data.response.settings.discountLabel,
                  };
                  var jsonString = JSON.stringify(sd_bundle_data);
                  localStorage.setItem("sd_bundle_data", jsonString);

                  BundleBuilderSpinner.remove();
                  cartAddBtn.innerText =
                    data.response.translations.translation.addToCartButton;
                  window.location.assign(`https://${Shopify.shop}/cart`);
                } else {
                  let totalPrice = Number(pageInfoTotalPrice.toFixed(2));
                  let finalPrice;
                  switch (data.response.bundleDetail.discountType) {
                    case "percent":
                      let percentagepart = parseFloat(
                        data.response.bundleDetail.discountValue
                      );
                      let percentage = (totalPrice * percentagepart) / 100;
                      result = percentage;
                      finalPrice = result.toFixed(2);
                      break;
                    case "price":
                      let pricePart = parseFloat(
                        data.response.bundleDetail.discountValue
                      );
                      result = totalPrice - pricePart;
                      finalPrice = result.toFixed(2);
                      break;
                    case "fixed":
                      let fixedPart = parseFloat(
                        data.response.bundleDetail.discountValue
                      );
                      finalPrice = fixedPart.toFixed(2);
                      break;
                    default:
                      break;
                  }

                  let isDiscount =
                    data.response.bundleDetail.discountType == "noDiscount"
                      ? "noDiscount"
                      : "Fix";
                  let sd_bundle_data = {
                    discount_name: data.response.name,
                    code:
                      data.response.settings.discountLabel + "-" + code.code,
                    discountType: isDiscount,
                    discountValue: finalPrice,
                    variantsId: variantGid,
                    startDate: new Date(),
                    endDate: data.response.endDate,
                    shop: Shopify.shop,
                    bundleType: data.response.bundleDetail.discountType,
                    totalPrice: totalPrice,
                    discountCreateId: discountCodeId,
                  };
                  fetch(server + "/api/storefront/createRule", {
                    method: "POST",
                    headers: {
                      "Content-Type": "application/json",
                    },
                    body: JSON.stringify(sd_bundle_data),
                  })
                    .then((response) => response.json())
                    .then((res) => {
                      if (res.status == 200) {
                        fetch(`${server}/api/storefront/getBundleClick`, {
                          method: "POST",
                          headers: {
                            "Content-Type": "application/json",
                          },
                          body: JSON.stringify({
                            shop: Shopify.shop,
                            bundleId: data.response._id,
                          }),
                        });
                        cartAddBtn.innerText =
                          data.response.translations.translation.addToCartButton;
                        BundleBuilderSpinner.remove();
                        let sd_bundle_data = {
                          discount_name: data.response.name,
                          code: code.code,
                          bundleId: data.response._id,
                          discountType: isDiscount,
                          variantsId: idArray,
                          discountCreateId: res.response,
                          prefixCode: data.response.settings.discountLabel,
                        };
                        var jsonString = JSON.stringify(sd_bundle_data);
                        localStorage.setItem("sd_bundle_data", jsonString);
                        window.location.assign(`https://${Shopify.shop}/cart`);
                      }
                    });
                }
              })
              .catch((error) => {
                // // console.log(error);
              });
          }
        })
        .catch((error) => {
          // console.error("Error:", error);
        });
    }
  });
}

// function addselectedProductList(selectedProducts, mainIndex, extra, arr1) {
function addselectedProductList(selectedProducts, mainIndex, extra, data) {
  if (selectedProducts[mainIndex].length) {
    if (extra == "") {
      document.getElementById(
        "sd-builder-selectedProductContainer" + mainIndex
      ).style.display = "none";
    }
    const getDiv = document.getElementById(
      "sd-builder-info-variants-data" + mainIndex
    );
    let listDiv;
    let listDivParent = "";
    listDivParent = document.createElement("div");

    selectedProducts[mainIndex].map((el, index) => {
      listDiv = document.createElement("div");
      listDiv.className = "sd-builder-info-selected-products";
      listDiv.id = "sd-builder-info-selected-products" + index;
      let selectedProductImgDiv = document.createElement("div");
      selectedProductImgDiv.className = "sd-builder-info-product-img-container";
      listDiv.append(selectedProductImgDiv);
      let selectedProductImg = document.createElement("img");
      selectedProductImg.className = "sd-builder-info-product-img";
      let selectedCartImg = el.image ?? smartNoImg;
      selectedProductImg.setAttribute("src", selectedCartImg);
      selectedProductImgDiv.append(selectedProductImg);
      let selectedProductTitleDiv = document.createElement("div");
      listDiv.append(selectedProductTitleDiv);
      let ProductTitle = document.createElement("div");
      ProductTitle.className = "sd-builder-info-product-title";
      ProductTitle.innerText = el.title;
      selectedProductTitleDiv.append(ProductTitle);
      let productVariantTitle = document.createElement("div");
      productVariantTitle.className = "sd-builder-info-variant-title";
      // console.log(el.variantTitle);
      productVariantTitle.innerText = el.variantTitle;
      if (el.variantTitle == "Default Title") {
        productVariantTitle.style.display = "none";
      }
      selectedProductTitleDiv.append(productVariantTitle);
      let removeVariant = document.createElement("button");
      removeVariant.innerText = "Delete";
      removeVariant.className = "sd-removeVariant-btn";
      removeVariant.id = `sd-removeVariant-btn-id${index}`;

      listDiv.append(removeVariant);

      listDivParent.append(listDiv);

      removeVariant.addEventListener("click", () => {
        selectedProducts[mainIndex].splice(index, 1);
        const revDiv = document.getElementById(
          "sd-builder-info-selected-products" + index
        );

        const countDiv = document.getElementById(
          `sd-quantityCheck${mainIndex}`
        );
        countDiv.innerText = selectedProducts[mainIndex].length;

        getDiv.innerHTML = "";
        const getCartButton = document.getElementById(
          "sd-builder-cart-info-add-btn"
        );

        getCartButton.style.color = "#919191";
        getCartButton.style.background = "#e5e5e5";
        getCartButton.style.cursor = "no-drop";
        getCartButton.disabled = true;
        addselectedProductList(selectedProducts, mainIndex, "", data);

        sumOfVariants(selectedProducts, data);
      });
    });
    getDiv.appendChild(listDivParent);
  } else {
    document.getElementById(
      "sd-builder-selectedProductContainer" + mainIndex
    ).style.display = "block";
  }
}

function sumOfVariants(params, data) {
  let sum = 0;

  for (const nestedArray of params) {
    for (const obj of nestedArray) {
      sum += parseFloat(obj.price);
    }
  }
  const updateSum = document.getElementById("sd-builder-total-raw-price");
  let updatedTotalSum = sum.toFixed(2);
  updateSum.innerText = showAmountWithCurrency(updatedTotalSum);
  let totalDiv = document.getElementById(
    "sd-builder-total-discounted-price-text"
  );

  if (sum > 0) {
    let discountedPrice;
    if (data.response.bundleDetail.discountType == "percent") {
      let part = parseFloat(data.response.bundleDetail.discountValue);
      let percentage = (sum * part) / 100;
      result = sum - percentage;
      discountedPrice = result.toFixed(2);
      let newDiscountPrice = discountedPrice;

      totalDiv.innerText = showAmountWithCurrency(newDiscountPrice);
    } else if (data.response.bundleDetail.discountType == "fixed") {
      let part = parseFloat(data.response.bundleDetail.discountValue);
      let fixed = sum - part;
      discountedPrice = fixed.toFixed(2);
      let newDiscountPrice = discountedPrice;
      totalDiv.innerText = showAmountWithCurrency(newDiscountPrice);
    } else if (data.response.bundleDetail.discountType == "price") {
      let part = parseFloat(data.response.bundleDetail.discountValue);
      discountedPrice = part;
      let newDiscountPrice = discountedPrice;
      totalDiv.innerText = showAmountWithCurrency(newDiscountPrice);
    } else if (data.response.bundleDetail.discountType == "freeShipping") {
      totalDiv?.remove();
    } else if (data.response.bundleDetail.discountType == "noDiscount") {
      totalDiv?.remove();
    }

    pageInfoTotalPrice = sum;
  } else {
    let newDiscountPrice = "0";
    totalDiv.innerText = showAmountWithCurrency(newDiscountPrice);
  }
}
// sd-builder-cart-info-add-btn
function checkCartButtonActive(arr1, arr2) {
  let t = [];
  for (let i = 0; i < arr1.length; i++) {
    if (arr1[i].length == arr2[i].quantity) {
      t.push(1);
    } else {
      t.push(0);
    }
  }
  const v = t.includes(0);
  return v;
}

function waterMark(appendDiv) {
  let waterMarkDiv = document.createElement("div");
  waterMarkDiv.className = "sd-bundle-WaterMark-conatiner";
  let sd_link = document.createElement("a");
  sd_link.innerText = "Shine Dezign Infonet";
  sd_link.setAttribute("href", "https://shinedezigninfonet.com/");
  sd_link.target = "_blank";
  waterMarkDiv.innerText = "Powered by ";
  waterMarkDiv.append(sd_link);
  appendDiv.append(waterMarkDiv);
  return waterMarkDiv;
}

async function addDiscountToProduct() {
  const localData = JSON.parse(localStorage.getItem("sd_bundle_data"));
  let checkOutBtn = document.getElementsByName("checkout");
  checkOutBtn.forEach((e) => {
    e.addEventListener("click", (event) => {
      event.preventDefault();
      fetch(window.Shopify.routes.root + "cart.js", {
        method: "Get",
        headers: {
          "Content-Type": "application/json",
        },
      })
        .then((response) => {
          return response.json();
        })
        .then((response) => {
          let allIdsMatch = localData.variantsId.every((item) => {
            let matchingItem = response.items.find(
              (i) => i.id === parseInt(item.id) && item.quantity <= i.quantity
            );
            return !!matchingItem;
          });

          if (allIdsMatch == true) {
            /*here are true id match */
            activateRule(localData);
            window.location.href = `${window.location.origin}/checkout?discount=${localData.prefixCode}-${localData.code}`;
          } else {
            /*here are false id match */
            deactivateRule(localData);
            window.location.href = `${window.location.origin}/cart/checkout`;
          }
        })
        .catch((error) => {
          console.log(error.message);
        });
    });
  });
}
async function activateRule(localData) {
  const data = {
    shop: Shopify.shop,
    discountId: localData.discountCreateId,
    bundle_type: localData.bundle_type
  };
  await fetch(server + "/api/storefront/activateRule", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify(data),
  })
    .then((response) => {
      return response.json();
    })
    .then((response) => {
      let discountElement = document.getElementById("shineBundleDiscount");
      if (discountElement == null) {
        const inputElement = document.createElement("input");

        // Step 3: Set attributes for the input element
        inputElement.className = "js-form-discount shine-discount";
        inputElement.id = "shineBundleDiscount";
        inputElement.type = "hidden";
        inputElement.name = "discount";
        inputElement.value = `${localData.prefixCode}-${localData.code}`;
        let formDiv = document.querySelectorAll('form[action="/cart"]');
        formDiv.forEach((form) => {
          form.append(inputElement);
        });
      }
    })
    .catch((error) => {
      console.log(error.message);
    });
}
async function deactivateRule(localData) {
  const data = {
    shop: Shopify.shop,
    discountId: localData.discountCreateId,
  };
  await fetch(server + "/api/storefront/deactivateRule", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify(data),
  })
    .then((response) => {
      return response.json();
    })
    .then((response) => {
      let discountElement = document.getElementById("shineBundleDiscount");
      if (discountElement !== null) {
        discountElement.remove();
      }
    })
    .catch((error) => {
      console.log(error.message);
    });
}
function createDiscountName(dataArray) {
  if (!Shopify.designMode) {
    let checkLocalStorage = localStorage.getItem("sd_bundle_data");

    if (!checkLocalStorage) {
      function generateRandomSixDigitNumber() {
        // Generate a random number between 100,000 and 999,999 (inclusive)
        const min = 100000;
        const max = 999999;
        const randomNumber = Math.floor(Math.random() * (max - min + 1)) + min;

        return randomNumber;
      }
      const randomSixDigitNumber = generateRandomSixDigitNumber();
      let sd_bundle_data = {
        code: randomSixDigitNumber,
      };
      var jsonString = JSON.stringify(sd_bundle_data);
      localStorage.setItem("sd_bundle_data", jsonString);
    }
  }
}

function showAmountWithCurrency(value) {
  let moneyFormat = sdCurrencySymbolCode;
  let sdCurrencyFormatcondition;

  if (moneyFormat.includes("{{amount_no_decimals}}")) {
    sdCurrencyFormatcondition = "amount_no_decimals";
  } else if (moneyFormat.includes("{{amount_with_comma_separator}}")) {
    sdCurrencyFormatcondition = "amount_with_comma_separator";
  } else if (
    moneyFormat.includes("{{amount_no_decimals_with_space_separator}}")
  ) {
    sdCurrencyFormatcondition = "amount_no_decimals_with_space_separator";
  } else if (
    moneyFormat.includes("{{amount_no_decimals_with_comma_separator}}") ||
    moneyFormat.includes("${{ amount_no_decimals_with_comma_separator }}")
  ) {
    sdCurrencyFormatcondition = "amount_no_decimals_with_comma_separator";
  } else if (moneyFormat.includes("{{amount_with_space_separator}}$")) {
    sdCurrencyFormatcondition = "amount_with_space_separator";
  } else if (moneyFormat.includes("{{amount}}")) {
    sdCurrencyFormatcondition = "amount";
  } else {
    let pattern = /{{(.*?)}}/;
    let match = moneyFormat.match(pattern);
    sdCurrencyFormatcondition = `${match[1]}`;
  }

  let sdCurrencyprice;
  switch (sdCurrencyFormatcondition) {
    case "amount":
      sdCurrencyprice = moneyFormat.replace("{{amount}}", value);
      break;
    case "amount_with_comma_separator":
      if (value) {
        let stringValue = value.toString();
        if (stringValue.indexOf(".") > 0) {
          let comma_seperator = stringValue.replace(".", ",");
          sdCurrencyprice = moneyFormat.replace(
            "{{amount_with_comma_separator}}",
            comma_seperator
          );
        } else {
          sdCurrencyprice = moneyFormat.replace(
            "{{amount_with_comma_separator}}",
            value
          );
        }
      } else {
        sdCurrencyprice = moneyFormat.replace(
          "{{amount_with_comma_separator}}",
          value
        );
      }
      break;
    case "amount_no_decimals_with_space_separator":
      let noDecimalwithSpace = parseInt(value);
      sdCurrencyprice = moneyFormat.replace(
        "{{amount_no_decimals_with_space_separator}}",
        noDecimalwithSpace
      );
      break;
    case "amount_no_decimals":
      let noDecimal = parseInt(value);
      sdCurrencyprice = moneyFormat.replace(
        "{{amount_no_decimals}}",
        noDecimal
      );
      break;
    case "amount_no_decimals_with_comma_separator":
      let noDecimalwithComma = parseInt(value);

      sdCurrencyprice = moneyFormat.replace(
        /{{amount_no_decimals_with_comma_separator}}|\${{ amount_no_decimals_with_comma_separator }}/g,
        noDecimalwithComma
      );
      break;
    case "amount_with_space_separator":
      if (value) {
        let spaceStringValue = value.toString();
        if (spaceStringValue.indexOf(".") > 0) {
          let Space_comma_seperator = spaceStringValue.replace(".", ",");
          sdCurrencyprice = moneyFormat.replace(
            "{{amount_with_space_separator}}",
            Space_comma_seperator
          );
        } else {
          sdCurrencyprice = moneyFormat.replace(
            "{{amount_with_space_separator}}",
            value
          );
        }
      } else {
        sdCurrencyprice = moneyFormat.replace(
          "{{amount_with_space_separator}}",
          value
        );
      }
      break;
    default:
      sdCurrencyprice = moneyFormat.replace(
        `{{${sdCurrencyFormatcondition}}}`,
        value
      );
  }
  return sdCurrencyprice;
}
